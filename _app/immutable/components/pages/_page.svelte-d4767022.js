import{S as Ce,i as De,s as Le,e as je,b as te,R as ce,A as Pe,h as M,V as mt,G as he,k as H,q as de,a as re,l as q,m as X,r as pe,c as ie,n as R,F as P,u as Me,N as Xe,a4 as ye,p as ke,Q as Fe,g as rt,t as oe,d as it,f as ee,a5 as ge,a2 as cr,a3 as rn,_ as ra,O as Ke,P as pt,v as we,w as Oe,x as Ee,T as vt,y as Ne,X as Lt,H as ia,L as oa,U as aa,Y as sa,Z as ar,o as sn,a6 as Gt,B as la,C as ua,D as fa,E as ca,a7 as ps,a1 as ms}from"../../chunks/index-f5a154de.js";import{w as Ye}from"../../chunks/index-892500ad.js";import{_ as gs}from"../../chunks/preload-helper-aa6bc0ce.js";import{T as vs,e as Ot}from"../../chunks/Toggle-3ca16f02.js";let ys=!1;const Br=!0,_s=!1,bs=Object.freeze(Object.defineProperty({__proto__:null,browser:Br,dev:_s,prerendering:ys},Symbol.toStringTag,{value:"Module"}));var ws=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Es={macOS:[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],windows:[/microsoft\s(windows)\s(vista|xp)/i],linux:[/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i,/(cros)\s[\w]+\s([\w\.]+\w)/i,/(sunos)\s?([\w\.]+\d)*/i,/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i,/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i]},ci={name:"Control",abbreviation:"Ctrl",symbol:"^"},hi={name:"Alt",abbreviation:"Alt",symbol:""},di={name:"Windows Key",abbreviation:"Win",symbol:"\u229E"},Ns={macOS:{os:"Mac OS",primaryMeta:!0,meta:{name:"Command",abbreviation:"Cmd",symbol:"\u2318"},ctrl:{name:"Control",abbreviation:"Ctrl",symbol:"\u2303"},alt:{name:"Option (alt)",abbreviation:"Alt",symbol:"\u2325"}},windows:{os:"Windows",primaryMeta:!1,meta:di,ctrl:ci,alt:hi},linux:{os:"Linux",primaryMeta:!1,meta:di,ctrl:ci,alt:hi}};function Ss(n,e){for(var i in e)for(var t=e[i],r=0;r<t.length;r++)if(n.match(t[r]))return i}function xs(n){var e=Ss(n,Es);if(e)return Ns[e]}var Is=xs;const Os=window.navigator,Ts=Is(Os.userAgent),As="UniversalCommand",Rs="Shift",Ms="Escape",Bt=Ts.primaryMeta?"Meta":"Control",Dt=Ye({});function pi(n,e,i){const t=n.slice();return t[9]=e[i],t}function mi(n){let e,i,t,r=Object.keys(n[2]).join("+")+"",o,a,l,s,f,u,c=n[1],h=[];for(let p=0;p<c.length;p+=1)h[p]=gi(pi(n,c,p));return{c(){e=H("div"),i=de("Keys"),t=re(),o=de(r),a=re(),l=H("div"),s=de("Shortcuts"),f=re();for(let p=0;p<h.length;p+=1)h[p].c();u=je(),this.h()},l(p){e=q(p,"DIV",{class:!0});var m=X(e);i=pe(m,"Keys"),m.forEach(M),t=ie(p),o=pe(p,r),a=ie(p),l=q(p,"DIV",{class:!0});var v=X(l);s=pe(v,"Shortcuts"),v.forEach(M),f=ie(p);for(let d=0;d<h.length;d+=1)h[d].l(p);u=je(),this.h()},h(){R(e,"class","italic"),R(l,"class","italic")},m(p,m){te(p,e,m),P(e,i),te(p,t,m),te(p,o,m),te(p,a,m),te(p,l,m),P(l,s),te(p,f,m);for(let v=0;v<h.length;v+=1)h[v].m(p,m);te(p,u,m)},p(p,m){if(m&4&&r!==(r=Object.keys(p[2]).join("+")+"")&&Me(o,r),m&2){c=p[1];let v;for(v=0;v<c.length;v+=1){const d=pi(p,c,v);h[v]?h[v].p(d,m):(h[v]=gi(d),h[v].c(),h[v].m(u.parentNode,u))}for(;v<h.length;v+=1)h[v].d(1);h.length=c.length}},d(p){p&&M(e),p&&M(t),p&&M(o),p&&M(a),p&&M(l),p&&M(f),Xe(h,p),p&&M(u)}}}function gi(n){let e,i=n[9].command.join("+")+"",t;return{c(){e=H("div"),t=de(i)},l(r){e=q(r,"DIV",{});var o=X(e);t=pe(o,i),o.forEach(M)},m(r,o){te(r,e,o),P(e,t)},p(r,o){o&2&&i!==(i=r[9].command.join("+")+"")&&Me(t,i)},d(r){r&&M(e)}}}function Ps(n){let e,i,t,r=n[0]&&mi(n);return{c(){r&&r.c(),e=je()},l(o){r&&r.l(o),e=je()},m(o,a){r&&r.m(o,a),te(o,e,a),i||(t=[ce(window,"keydown",n[3]),ce(window,"keyup",n[4])],i=!0)},p(o,[a]){o[0]?r?r.p(o,a):(r=mi(o),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null)},i:Pe,o:Pe,d(o){r&&r.d(o),o&&M(e),i=!1,mt(t)}}}function ks(n,e,i){let t;he(n,Dt,h=>i(2,t=h));let{debug:r=!1}=e,o,{shortcuts:a=[]}=e,l=[],s={};function f(h){let p=ye(Dt);Dt.update(v=>(v[h.key]=!0,v)),p[Bt]&&(o={...p});let m=0;for(const v of l||[]){let d=!0;for(let _ of v.command)_==As&&(_=Bt),p[_]||(d=!1);d&&(v==null?void 0:v.action)&&(!s[m]&&v.command.find(_=>_==h.key)&&v.action(h),v.command.find(_=>_==Bt)),m+=1}}function u(h){if(Dt.update(p=>(delete p[h.key],p)),h.key==Bt&&o){for(const p of Object.keys(o))Dt.update(m=>(delete m[p],m));s={},o=null}Dt.set({...ye(Dt)})}function c(h){!Array.isArray(h)&&typeof h=="object"?Object.keys(h).forEach(p=>{l.push({command:p.split("+"),action:h[p]})}):l=[...l,...h],l=l.map(p=>(p.command=p.command.map(m=>m+""),p))}return n.$$set=h=>{"debug"in h&&i(0,r=h.debug),"shortcuts"in h&&i(1,a=h.shortcuts)},[r,a,t,f,u,c]}class ha extends Ce{constructor(e){super(),De(this,e,ks,Ps,Le,{debug:0,shortcuts:1,addBindings:5})}get addBindings(){return this.$$.ctx[5]}}const sr=n=>{const e=(i,t)=>({prepend:"vec3",type:"function",name:i,body:t,arguments:[{type:"vec3",name:"a"},{type:"vec3",name:"b"}]});return[e("NORM","return b;"),e("ADD","return min(a + b, vec3(1.0));"),e("DARKEN","return COLOR_MAP(DARKEN, a, b);"),e("SCREEN","return COLOR_MAP(SCREEN, a, b);"),e("OVERLAY","return COLOR_MAP(OVERLAY, a, b);"),e("HARD","return OVERLAY(b, a);"),e("SOFT","return COLOR_MAP(SOFT, a, b);"),e("PIN","return COLOR_MAP(PIN, a, b);"),e("DIFFERENCE","return abs(a - b);"),e("REFLECT","return COLOR_MAP(REFLECT, a, b);"),e("LIGHTEN","return COLOR_MAP(LIGHTEN, a, b);"),e("VIVID","return COLOR_MAP(VIVID, a, b);"),e("SUBTRACT","return max(a + b - vec3(1.0), vec3(0.0));"),e("MULTI","return a * b;"),e("AVERAGE","return (a + b) / 2.0;"),e("COLORBURN","return COLOR_MAP(COLORBURN, a, b);"),e("COLORDODGE","return COLOR_MAP(COLORDODGE, a, b);"),e("EXCLUSION","return a + b - 2.0 * a * b;"),e("GLOW","return REFLECT(b, a);"),e("HARD_MIX","return COLOR_MAP(HARD_MIX, a, b);"),e("BURN","return max(a + b - vec3(1.0), vec3(0.0));"),e("DODGE","return min(a + b, vec3(1.0));"),e("LINEAR","return COLOR_MAP(LINEAR, a, b);"),e("NEGATE","return vec3(1.0) - abs(vec3(1.0) - a - b);"),e("PHOENIX","return min(a, b) - max(a, b) + vec3(1.0);")]},Cs=sr().map(n=>n.name),zt={APPLICATION:"application",ASSIGNMENTS:"assignments",DEBUG_SHADER:"debug_shader",DEBUG_SYSTEM:"debug_system",MIXER:"mixer"},Ds={float:"float",image:"sampler2D",bool:"bool",event:"bool",long:"int",color:"vec4",point2D:"vec2"},Ls={OpSelect:"vec4"},Mn={START:`
/*--BEGIN_PROJECT--`,END:`--END_PROJECT--*/
`},Qt={BL_MODE:"BlendMode",BL_AMT:"BlendAmt"},ct={DEF:"define",VAR:"variable",FUNC:"function",COMMENT:"comment"},Tt={PAUSE:"pause",COMPILE:"compile",DONE:"done"},ht={IMAGE:"image",VIDEO:"video",CAMERA:"camera",FEEDBACK:"feedback"};let Fs=n=>new Promise((e,i)=>{let t=[{type:ht.IMAGE,path:"mxz/testcards/transparent.png"},{type:ht.IMAGE,path:"mxz/testcards/bw.jpg"},{type:ht.IMAGE,path:"mxz/testcards/testcard.png"},{type:ht.IMAGE,path:"mxz/testcards/grid.png"},{type:ht.FEEDBACK}];gs(()=>Promise.resolve().then(()=>bs),void 0,import.meta.url).then(r=>{const{browser:o}=r;o?navigator.mediaDevices.enumerateDevices().then(function(a){a.forEach(l=>{l.kind=="videoinput"&&t.push({type:ht.CAMERA,path:l.label})}),e(t)}):e(t)}).catch(r=>{e(t)})});const Us={SOURCE:"source",UNIT:"unit"},lt={APPEND:"append",INSERT:"insert",MOVE:"move",BIN:"bin"},Dn=Ye(null),da=Ye({}),pa=Ye([]),_t=Ye([]),ue=Ye({}),nn=Ye("application"),Vt=Ye({width:720,height:576}),bt=Ye({}),ma={rotate:[0,0,0],skew:[0,0],scale:[1,1],translate:[0,0]},lr=Ye(ma),Ht=Ye({}),kr=Ye({}),yt=Ye("compile"),nt=Ye(null),At=Ye(!1),jt=Ye(null),Zt=Ye(!1),$t=Ye(!1),en=Ye(null),Pn=Ye(!1),br=(n,e)=>console.log(`[Store] ${n}`,e||"");function vi(n){try{const e=JSON.parse(n);br("\u{1F4BE} loading stores from text",e==null?void 0:e._UNIFORMS),Dn.set((e==null?void 0:e._PREVIEW)||null),da.set((e==null?void 0:e._TITLES)||{}),lr.set((e==null?void 0:e._PROJECTION)||ma),pa.set((e==null?void 0:e._SOURCES)||[]),_t.set((e==null?void 0:e._SEQUENCE)||[]),ue.set((e==null?void 0:e._UNIFORMS)||{}),nn.set((e==null?void 0:e._CURRENT_VIEW)||"application"),Vt.set((e==null?void 0:e._DIMENSIONS)||{width:720,height:576}),bt.set((e==null?void 0:e._ASSIGNMENTS)||{}),Ht.set((e==null?void 0:e._HIDDEN)||{}),Br&&window.requestAnimationFrame(i=>{br("\u{1F3A8} setting uniforms and recompiling",(e==null?void 0:e._UNIFORMS)||"\u274C NO UNIFORMS"),ue.set((e==null?void 0:e._UNIFORMS)||{}),yt.set("compile")})}catch(e){br("\u274C could not load stores",e.message)}}function jr(n){return JSON.stringify({_PREVIEW:ye(Dn),_PROJECTION:ye(lr),_TITLES:ye(da),_SOURCES:ye(pa),_SEQUENCE:ye(_t),_UNIFORMS:ye(ue),_CURRENT_VIEW:ye(nn),_DIMENSIONS:ye(Vt),_ASSIGNMENTS:ye(bt),_HIDDEN:ye(Ht)},null,n)}var ga=`const int hardMax = 99999;
float cap = 0.;
float battery = 0.;
bool discharging = false;
vec3 outpix = vec3(0.);
vec2 pos = gl_FragCoord.xy;

float xx = direction == 1 ? pos.x :  center.x * RENDERSIZE.x;
float yy = direction == 0 ? pos.y :  center.y * RENDERSIZE.y;

vec2 centerPix = vec2(xx,yy);
int dist = int( distance(centerPix, pos) );
float angle = ANGLE(centerPix, pos) + 180.;
float res = resistance;
if (type ==0) res *= 2.;

for (int i = 0; i < hardMax; i++) {

	
	

	vec2 lookup = vec2(xx,yy);
	vec3 rgb = IMG_PIXEL( TEXTURE, lookup ).rgb;
	float pix = length(rgb)/3.;
	pix = (rgb.r + rgb.g + rgb.b)/3.;
	pix = pow(pix, power);
	
	if (type == 0) { 
	
		cap += pix;
		if (cap > res) cap -= res;

		
	} else if (type == 1) { 
	
		if (battery < res && !discharging) battery += pix;
		if (battery > res) discharging = true;
		if (battery < 0.) discharging = false;
		
		if (discharging) {
			cap = battery;
			battery -= ((discharge.x * 20.)+0.05) + (discharge.y / 5.);
		} else {
			cap = 0.;
		}
	} else if (type == 2) { 
		cap += pix;
		cap -= discharge.x;
	}
	
	/* LOOP */
	
	int idx = direction == 3 ? dist - i : i;
	vec2 outward = VEC2_FROM_ANGLE(centerPix, angle, float(idx));
	
	xx = direction == 1 ? gl_FragCoord.x : outward.x;
	yy = direction == 0 ? gl_FragCoord.y : outward.y;
	
	if (i >= dist) break;
	
}

cap /= res;

return vec4( HSL_TO_RGB(vec3(hue,saturation,cap*lightness)), INPUT.a);`,va="return INPUT;",ya=`vec2 pos = POS_NORM;
float amt = Amt;
float Amount = Amt;

if (TYPE == 0) { 

	/*
		LumaSharpen 1.4.1

		original hlsl by Christian Cann Schuldt Jensen ~ CeeJay.dk
		port to glsl by Anon

		It blurs the original pixel with the surrounding pixels and then subtracts this blur to sharpen the image.
		It does this in luma to avoid color artifacts and allows limiting the maximum sharpning to avoid or lessen halo artifacts.

		This is similar to using Unsharp Mask in Photoshop.
	*/

	float sharp_strength = Amount;
	float sharp_clamp = sharp_strength;
	float offset_bias = Radius * 10.0;
	
	#define COEFLUMA vec3(0.299, 0.587, 0.114)       
	

	vec4 colorInput = IMG_NORM_PIXEL(TEXTURE, POS_NORM);
	
	vec3 ori = colorInput.rgb;
	vec3 sharp_strength_luma = (COEFLUMA * sharp_strength);
	
	
	

	float px = 1.0/RENDERSIZE.x;
	float py = 1.0/RENDERSIZE.y;
	vec2 xy = gl_FragCoord.xy;

	

	vec3 blur_ori = IMG_NORM_PIXEL(TEXTURE, POS_NORM.xy + vec2(px,-py) * 0.5 * offset_bias).rgb; 
	blur_ori += IMG_NORM_PIXEL(TEXTURE, POS_NORM.xy + vec2(-px,-py) * 0.5 * offset_bias).rgb;  
	blur_ori += IMG_NORM_PIXEL(TEXTURE, POS_NORM.xy + vec2(px,py) * 0.5 * offset_bias).rgb; 
	blur_ori += IMG_NORM_PIXEL(TEXTURE, POS_NORM.xy + vec2(-px,py) * 0.5 * offset_bias).rgb; 
	blur_ori *= 0.25;
	vec3 sharp = ori - blur_ori;
	vec4 sharp_strength_luma_clamp = vec4(sharp_strength_luma * (0.5 / sharp_clamp),0.5);
	float sharp_luma = clamp((dot(vec4(sharp,1.0), sharp_strength_luma_clamp)), 0.0,1.0 );
	sharp_luma = (sharp_clamp * 2.0) * sharp_luma - sharp_clamp;
	colorInput.rgb = colorInput.rgb + sharp_luma;

	return clamp(colorInput, 0.0,1.0);

	

	for (int i = 0; i < 4; i++) {

		float blur_ori = IMG_NORM_PIXEL(TEXTURE, POS_NORM.xy + vec2(px,-py) * 0.5 * offset_bias)[i]; 
		blur_ori += IMG_NORM_PIXEL(TEXTURE, POS_NORM.xy + vec2(-px,-py) * 0.5 * offset_bias)[i];  
		blur_ori += IMG_NORM_PIXEL(TEXTURE, POS_NORM.xy + vec2(px,py) * 0.5 * offset_bias)[i]; 
		blur_ori += IMG_NORM_PIXEL(TEXTURE, POS_NORM.xy + vec2(-px,py) * 0.5 * offset_bias)[i]; 

		blur_ori *= 0.25;  

		
		float sharp = ori[i] - blur_ori;  

		
		float sharp_strength_luma_clamp = sharp_strength_luma[i] * (0.5 / sharp_clamp); 

		float sharp_luma = clamp((sharp + sharp_strength_luma_clamp), 0.0,1.0 ); 
		sharp_luma = (sharp_clamp * 2.0) * sharp_luma - sharp_clamp; 

		

		colorInput[i] = colorInput[i] + sharp_luma;    
	}

	return clamp(colorInput, 0.0,1.0);
	
} else if (TYPE == 1) {

	

	vec3 res = vec3(RENDERSIZE, 1.);
	float time = TIME;

	const vec2 blurdir = vec2( 1.0, 0.0 );

	float blurdist_px = float(RENDERSIZE.x*Radius);
	vec2 POS = POS_FRAG;
	vec2 suv = POS / res.xy; 
	vec2 uv = POS / res.xy;

	float blur = 10. * amt * blurdist_px;
	blur *= .1; 

	float da = 6.283;
	float a = 1.0;

    if (Jitter) { 
    	a = da * HASH12N(uv+(time)); 
	} else { 
		a = da * HASH12N(uv); 
	}

	vec3 sumcol = vec3(0.0);

	for (int i=0;i<10;++i) {
		vec2 ofs = vec2( cos(a), sin(a) ) / res.xy * blur*float(i+1)*.31;
		vec2 p = uv+(ofs/10.);
		vec3 pix = IMG_NORM_PIXEL(TEXTURE, p).rgb;
		sumcol = sumcol+SRGB2LIN(pix);
		a += da;
	}

	sumcol = sumcol / 10.;
	sumcol = max( sumcol, 0.0 );

	return vec4( LIN2SRGB( sumcol ), INPUT.a);
} else {

	
	return IMG_NORM_PIXEL(TEXTURE, pos );

}`,_a=`vec2 pos = POS_NORM;
vec2 center = vec2( 0.5, 0.5 );
float off = Offset;
float all = mix(SUM_RGBA(Src)/3.0,1.0,1.0-SrcAmount);
if (Invert) all = 1.0 - all;
float bb = (all*2.0)-1.0;
bb += off;

float mini = Mini ? 0.02 : 1.;

vec2 xy = XY * vec2(mini,mini);
vec2 zoom = Zoom * vec2(mini,mini);

float angle = ANGLE(center, pos);

pos.x += xy.x * bb;
pos.y += xy.y * bb;
pos.x += (((pos.x * 2.0) - 1.0) * zoom.x) * bb;
pos.y += ((pos.y * 2.0) - 1.0) * (zoom.y * bb);
if (Rotate) pos = ROTATE_VEC2(Origin, pos, 	Degree * bb * 180. * mini);

return IMG_NORM_PIXEL(TEXTURE,pos);`,ba=`float MINI = Mini ? 0.2 : 1.; 

vec3 hsl = RGB_TO_HSL( INPUT.rgb );

if (ColorMode == 3) {

	

	float maxDelta = sqrt(hsl.y) - hsl.y;
	hsl.y += (maxDelta * Vibrance);

} else if (ColorMode == 1) {

	

	vec3 tint = vec3(TintHue / 360.0,1.0,0.5);
	hsl = RGB_TO_HSL(mix(HSL_TO_RGB(hsl),HSL_TO_RGB(tint),TintAmount * hsl.z * MINI));

} else if (ColorMode == 2) {

	

	
	
	
	
	
	

	
	

	
	
	

	float space = 1./Levels;
	float snapped = hsl.z - FMOD(hsl.z,space); 
	float blend = FMOD(hsl.z,space)*Levels; 
	if (blend > 0.5) blend -= blend - 0.5;
	blend *= 2.;

	float h1 = snapped * Spacing;
	float h2 = (snapped + space) * Spacing;
	vec3 rgb1 = HSL_TO_RGB(vec3(h1, 1.0, 0.5));
	vec3 rgb2 = HSL_TO_RGB(vec3(h2, 1.0, 0.5));

	hsl = RGB_TO_HSL(mix(rgb1,rgb2,blend*Smooth));

}

/*------------ SATURATION ------------*/

hsl.y += Saturation * MINI;
hsl.y = clamp( hsl.y, 0.0, 1.0 );
hsl.x = FMOD( hsl.x + (Shift * MINI), 1.0);

/*------------ LIGHT / RGB ------------*/

vec3 rgb = HSL_TO_RGB(hsl);
vec3 final;

if (LightMode == 0) {

	

	vec3 hsl = RGB_TO_HSL(rgb);
	hsl.z += Light * MINI;
	final = HSL_TO_RGB(hsl);

} else if (LightMode == 1) {

	

	final = rgb * pow(2.0, Light * MINI);

} else if (LightMode == 2) {

	

	vec3 hsv = RGB_TO_HSV(rgb);
	hsv.z += Light * MINI;
	final = HSV_TO_RGB(hsv);

}

/*------------ INVERT ------------*/

if (Invert) final = RGB_SHIFT( vec3(1.0,1.0,1.0) - final, 0.5);

/*------------ LOW / HIGH ------------*/

float low = Low * (MINI/2.);
float high = 1.0 - (High * (MINI/2.));

/*------------ NOISE ------------*/

return vec4( LEVELS(final.rgb, Low, 1.0, High).rgb, INPUT.a );`,wa=`vec3 mask = INPUT.rgb;
vec3 foreground = INPUT.rgb;

if (Mode == 1) {
	mask = Mask.rgb;
	foreground = Foreground.rgb;
}

float amt;
float sat = RGB_TO_HSL(mask).y;

if (LightMode == 0) {
	
	amt = RGB_TO_HSL(mask).z;
} else if (LightMode == 1) {
	
	amt = RGB_TO_HSV(mask).z;
} else {
	
	amt = mask.r + mask.g + mask.b;
}

if (Invert) amt = 1.0 - amt;

float ll = MAP(Threshold.x,0.0,1.0,-0.1,1.1);
float hh = MAP(Threshold.y,0.0,1.0,-0.1,1.1);

float low = MAP(amt,ll, ll+Smooth.x,1.0,0.0, true);
float high = MAP(amt,hh-Smooth.y,hh,0.0,1.0, false);
float blend = CLAMP(max(low,high),-1.0,1.0);
blend = MAP(blend,0.0,1.0,-1.0,1.0);

blend *= 1.0 + (sat * SatInfluence * 1.);
blend = (blend+1.0)/2.0;

return vec4( mix(foreground,Background.rgb,blend), 1.0);`,Ea=`if (Mode == 0) {
	return INPUT;
} else if (Mode == 1) {
	return IMG_NORM_PIXEL( u999, POS_NORM ).rgb;
} else if (Mode == 2) {
	return Src;
}`,Na=`bool SnapShape = true; 
float Skew = 0.5; 

vec2 pos = POS_FRAG;
float ratio = RENDERSIZE.y / RENDERSIZE.x;

vec2 center = Center * RENDERSIZE;
vec2 trueCenter = vec2( 0.5, 0.5 ) * RENDERSIZE;

vec3 rgb = INPUT.rgb;
bool inv = false;

pos = ROTATE_VEC2( center, pos, Rotate * 360.0 );

if (Fit) pos.x = (pos.x * ratio) + (( RENDERSIZE.x - RENDERSIZE.y) / 2.0);

float shape = float(Shape);
float pointsTotal = shape + 1.0;
float segmentAng = 360.0 / pointsTotal;
float miniAngle = segmentAng * mod( pointsTotal, 1. );

float flip = 90.;
int p = int( floor( pointsTotal ) );
if (p == 2) {
    flip +=  miniAngle / 2. ;
    flip += 180.;
} else if (p == 3) {
    flip +=  miniAngle / 2. ;
} else if (p == 4) {
    flip -= (segmentAng / 2.0);
    flip - (miniAngle / 2.);
    inv = !inv;
} else if (p == 5) {
    flip += 180.;
    flip +=  miniAngle / 2. ;
    inv = !inv;
} else if (p == 6) {
    flip -= (segmentAng / 2.0);
    flip +=  miniAngle / 2. ;
    inv = !inv;
} else if (p == 7) {
    flip +=  miniAngle / 2. ;
    inv = !inv;
} else if (p == 8) {
    flip -= (segmentAng / 2.0);
    flip +=  miniAngle / 2. ;
} else if (p == 9) {
    flip +=  miniAngle / 2. ;
} else if (p == 10) {
    flip -= (segmentAng / 2.0);
    flip +=  miniAngle / 2. ;
    inv = !inv;
} else if (p == 11) {
    inv = !inv;
}

pos = ROTATE_VEC2( center, pos, flip );

float posAngle = ANGLE( center, pos );
float centerDist = distance(center, pos);
bool isMini = posAngle > 360.0 - miniAngle && posAngle < 360.;

float prevAngle = posAngle -mod( posAngle, segmentAng );
float midpointAngle;

if (!isMini) {

    

    midpointAngle = prevAngle + (segmentAng / 2.0);

} else {

    midpointAngle = -( (miniAngle) / 2.0 );

}

vec2 rotatedLoc = ROTATE_VEC2( center, pos, midpointAngle );
vec2 rotatePrev = ROTATE_VEC2( center, pos, midpointAngle);

float ogDist2Center = distance( rotatedLoc.x, center.x );
float dist2Center = ogDist2Center;
float DIST = RENDERSIZE.x * Size;
float HDIST = DIST / 2.0;

    

float alter = (ShapeMode == 1) ? Alternate : 0.0;
bool ODD = mod( posAngle, segmentAng * (1.0 + alter) ) > segmentAng;
if (ODD) dist2Center += DIST / 2.0;

dist2Center -= TIME * Scroll * DIST;
centerDist -= TIME * Scroll * DIST;

float skew = MAP( Skew, 0.0, 1.0, -1.0, 1.0);
float pointy = abs( center.y - rotatePrev.y  ) * skew * 10.;

float idxDist = mix( dist2Center, centerDist, Circular) + pointy;
float idxMod = mod( idxDist, DIST );
int idx = int( (idxDist - idxMod) / DIST );

vec3 red = vec3(0.0);

float wipe = Recursion * DIST;
float smo = (DIST * Smooth);
bool isRecur = ShapeMode == 1;
if (!isRecur) idxMod = idxDist;
red.r = MAP(idxMod, wipe, wipe + smo, 1.0, 0.0);
red.r = clamp(red.r, 0.0, 1.0);

if (Invert) red.r = 1.0 - red.r;

vec3 black = vec3(0.0,0.0,0.0);
vec3 white = vec3(1.0,1.0,1.0);

if ( Mode == 0 ) {

    return vec4( HSL_TO_RGB( Color[0], Color[1], Color[2] * red.r ), 1.0);

} else if (Mode == 1) {
    vec3 invt = RGB_SHIFT(vec3(1.0,1.0,1.0)-rgb,0.5);
    vec3 mixed = (invt * red.r) + (rgb * (1.0-red.r));
    return vec4( mixed, 1.0);
} else if (Mode == 2) {
    return vec4( mix(Mask.rgb,rgb,red.r), 1.0);
} else {
    return vec4( mix(Mask.rgb,rgb,red.r), 1.0);
}`,Sa="return INPUT;",xa=`vec3 src = INPUT.rgb;
vec2 frag = POS_FRAG;
vec2 norm = POS_NORM;
vec2 center = CENTER();
float ratio = RENDERSIZE.y / RENDERSIZE.x;

float mask = SUM_RGB( Mode != 1 ? vec3(.5) : Src.rgb ) / 3.0;
mask = pow(mask, SmoothExp);
if (Invert) mask = 1.0 - mask;

float width = RENDERSIZE.x;
float height = RENDERSIZE.y;
float total = width*height;

/* define sizes */

float pixel = (frag.y * RENDERSIZE.x) + frag.x;
float scanline = MAP(pixel,0.,total, 0.,1.);

/* set frequencies */

float count = 30.; 
float freq = float(int((Freq * count) + 1.));

/* SYNC */

freq += Sync * 0.1;
freq += mask * ExtSync * 0.1;

/* MISC */

float space = Lock == 0 ? width/freq : total/freq;

/* do scrolls here */

frag.y -= RENDERSIZE.y / 2.0;

/* OFFSET */

pixel += Offset * TIME * ( Lock == 0 ? width : width * height );
pixel += mask * ExtOffset * ( Lock == 0 ? width : width * height );

float wave = clamp( MAP( FMOD(pixel,space),0.0, space * Ramp, 0.0, PI), 0.0, PI);
float r = WAVE( wave, 1., Amp, Exp );
if (Mask) r *= mask;

return vec4( HSL_TO_RGB( Color[0], Color[1], Color[2] * r ), 1.0);`,Ia=`vec2 pos = POS_NORM;
vec2 xy = POS_FRAG;
float idx = ( xy.y * RENDERSIZE.x ) + ( xy.x );

if (Mode == 1) {
	idx = distance(pos,Origin) * (RENDERSIZE.x * RENDERSIZE.y);
}

float freq = (Frequency.x * 0.01) + (Frequency.y * 0.0001);
float wobble = sin((TIME * Speed) + (idx * freq));

pos = VEC2_FROM_ANGLE( pos, Angle, wobble * Amount * 0.5 );

pos.x = FMOD(pos.x, 1.);
pos.y = FMOD(pos.y, 1.);

return IMG_NORM_PIXEL(TEXTURE,pos);`;const Bs=!0,js={type:{type:"long",default:2,values:[0,1,2],labels:["DIGITAL","ANALOG","ADDITIVE"]},direction:{type:"long",default:0,values:[0,1,2,3],labels:["X","Y","XY","XYREV"]},resistance:{type:"float",default:10,min:1,max:100},power:{type:"float",default:1,min:1,max:4},discharge:{type:"point2D",default:[.2,0],min:[0,-1],max:[1,1]},center:{type:"point2D",default:[0,0],min:[0,0],max:[1,1]},blend:{type:"float",default:.2,min:0,max:1},hue:{type:"float",default:0,min:0,max:1},saturation:{type:"float",default:0,min:0,max:1},lightness:{type:"float",default:1,min:0,max:2}},Vr={PASS:Bs,INPUTS:js},Vs=!0,Gs={},Gr={CHANNEL:Vs,INPUTS:Gs},Hs=!0,qs={TYPE:{type:"long",default:0,gui:"MultiClick",labels:["SHARPEN","DITHER"]},Amt:{type:"float",min:0,max:1,default:0},Threshold:{type:"float",min:0,max:1,default:.2},Radius:{type:"float",min:0,max:1,default:.2},Jitter:{type:"bool",default:!1}},Hr={PASS:Hs,INPUTS:qs},zs=!0,Xs={Mini:{type:"bool",default:!0},Src:{type:"long",min:-1,default:-1,gui:"OpSelect"},SrcAmount:{type:"float",min:0,max:1,default:0},Invert:{type:"bool",default:!1},Offset:{type:"float",default:0,min:-1,max:1},XY:{type:"point2D",default:[0,0],min:[-1,-1],max:[1,1]},Zoom:{type:"point2D",default:[0,0],min:[-1,-1],max:[1,1]},Rotate:{type:"bool",default:!1},Degree:{type:"float",default:0,min:-1,max:1},Origin:{type:"point2D",default:[.5,.5],min:[0,0],max:[1,1]}},qr={PASS:zs,INPUTS:Xs},Ws={Mini:{type:"bool",default:!1},Invert:{type:"bool",default:!1},LightMode:{type:"long",default:0,labels:["Lightness","Exposure","Brightness"],gui:"MultiClick"},Low:{type:"float",default:0,min:0,max:1},Light:{type:"float",default:0,min:-1,max:1},High:{type:"float",default:1,min:0,max:1},Saturation:{type:"float",default:0,min:-1,max:1},Shift:{type:"float",default:0,min:-.5,max:.5,position:-1,smooth:0,degrees:359},ColorMode:{type:"long",default:0,labels:["Basic","Tint","Colorise","Tweak"],gui:"MultiClick"},TintAmount:{type:"float",default:0,min:0,max:1,link:"ColorMode:1"},TintHue:{type:"float",default:0,min:-180,max:180,degrees:359,link:"ColorMode:1"},Levels:{type:"float",default:0,min:0,max:10,link:"ColorMode:2"},Spacing:{type:"float",default:.5,min:0,max:1,link:"ColorMode:2"},Smooth:{type:"float",default:0,min:0,max:1,link:"ColorMode:2"},Flip:{type:"bool",default:!1},Vibrance:{type:"float",default:0,min:0,max:1,link:"ColorMode:3"}},zr={INPUTS:Ws},Ys={Mode:{type:"long",default:0,labels:["Basic","Advanced"],gui:"MultiClick"},Background:{type:"long",min:-1,default:-1,gui:"OpSelect"},Foreground:{type:"long",min:-1,default:-1,gui:"OpSelect",link:"Mode:1"},Mask:{type:"long",min:-1,default:-1,gui:"OpSelect",link:"Mode:1"},LightMode:{type:"long",default:0,labels:["Lightness","Brightness","RGB"],gui:"MultiClick",link:"Mode:1"},Invert:{type:"bool",default:!1},Threshold:{type:"point2D",default:[0,1],min:[0,0],max:[1,1]},Smooth:{type:"point2D",default:[0,0],min:[0,0],max:[1,1]},SatInfluence:{type:"float",default:0,min:-1,max:1}},Xr={INPUTS:Ys},Js={Mode:{type:"long",default:0,labels:["Anchor","Output","Teleport"],gui:"MultiClick"},Src:{gui:"OpSelect",link:"Mode:2"}},Wr={INPUTS:Js},Ks={Mode:{type:"long",default:0,labels:["MATTE","INVERT","MASK","ALPHA"],gui:"MultiClick"},ShapeMode:{type:"long",default:0,labels:["SHAPE","RECURSIVE"],gui:"MultiClick"},Mask:{type:"long",default:-1,gui:"OpSelect",link:"Mode:2"},Shape:{type:"long",default:3,labels:["Horizontal","Vertical","Triangle","Square","Pentagon","Hexagon","Heptagon","Octagon"]},Circular:{type:"float",default:0,min:0,max:1},Smooth:{type:"float",default:0,min:0,max:1},Size:{type:"float",default:.5,min:0,max:1.5},Center:{type:"point2D",default:[.5,.5],min:[0,0],max:[1,1]},Rotate:{type:"float",default:.5,min:0,max:1},Invert:{type:"bool",default:!1},Fit:{type:"bool",default:!1},Recursion:{type:"float",default:.5,min:0,max:1,link:"ShapeMode:1"},Scroll:{type:"float",default:0,min:-1,max:1,link:"ShapeMode:1"},Alternate:{type:"float",default:0,min:0,max:1,link:"ShapeMode:1"},Color:{type:"color",min:[0,0,0],max:[1,1,1],default:[1,1,1]},Alpha:{type:"bool",default:!1}},Yr={INPUTS:Ks},Zs={Src:{type:"image",gui:"ExtSource",default:{type:"image",path:"mxz/testcards/transparent.png"}},Rows:{type:"long",default:1},Columns:{type:"long",default:1},Index:{type:"long",default:0}},Jr={INPUTS:Zs},Qs={Mode:{type:"long",min:0,default:0,gui:"MultiClick",labels:["BASIC","DEFORM"]},Lock:{type:"long",default:0,labels:["Horizontal","Vertical"],gui:"MultiClick"},Ramp:{type:"float",default:1,min:0,max:2},Amp:{type:"float",default:0,min:0,max:2},Exp:{type:"float",default:1,min:1,max:8},Freq:{type:"float",min:0,max:1,default:.45},Sync:{type:"float",min:-1,max:1,default:0},Offset:{type:"float",min:-1,max:1,default:0},Src:{type:"long",min:-1,default:-1,gui:"OpSelect",link:"Mode:1"},SmoothExp:{type:"float",min:0,max:2,default:1,link:"Mode:1"},Mask:{type:"bool",default:!1,link:"Mode:1"},Invert:{type:"bool",default:!1,link:"Mode:1"},ExtSync:{type:"float",min:-1,max:1,default:0,link:"Mode:1"},ExtOffset:{type:"float",min:-1,max:1,default:0,link:"Mode:1"},Color:{type:"color",min:[0,0,0],max:[1,1,1],default:[1,1,1]}},Kr={INPUTS:Qs},$s=!0,el={Frequency:{type:"point2D",default:[0,0],min:[-1,-1],max:[1,1]},Speed:{type:"float",default:0,min:-10,max:10},Angle:{type:"float",default:0,min:0,max:360},Amount:{type:"float",default:.5,min:0,max:1},Mode:{type:"long",default:0,labels:["Scanline","Origin"],gui:"MultiClick"},Origin:{type:"point2D",default:[0,0],min:[0,0],max:[1,1],link:"Mode:1"}},Zr={PASS:$s,INPUTS:el},{window:tl}=cr;function yi(n,e,i){const t=n.slice();return t[37]=e[i],t[39]=i,t}function nl(n){let e;return{c(){e=de("NONE")},l(i){e=pe(i,"NONE")},m(i,t){te(i,e,t)},p:Pe,i:Pe,o:Pe,d(i){i&&M(e)}}}function rl(n){let e,i,t;function r(a){n[32](a)}let o={};return n[4][n[1]]!==void 0&&(o.value=n[4][n[1]]),e=new vs({props:o}),Ke.push(()=>pt(e,"value",r)),e.$on("contextmenu",n[8]),{c(){we(e.$$.fragment)},l(a){Oe(e.$$.fragment,a)},m(a,l){Ee(e,a,l),t=!0},p(a,l){const s={};!i&&l[0]&18&&(i=!0,s.value=a[4][a[1]],vt(()=>i=!1)),e.$set(s)},i(a){t||(ee(e.$$.fragment,a),t=!0)},o(a){oe(e.$$.fragment,a),t=!1},d(a){Ne(e,a)}}}function il(n){let e,i,t=n[4][n[1]]&&_i(n);return{c(){t&&t.c(),e=je()},l(r){t&&t.l(r),e=je()},m(r,o){t&&t.m(r,o),te(r,e,o),i=!0},p(r,o){r[4][r[1]]?t?(t.p(r,o),o[0]&18&&ee(t,1)):(t=_i(r),t.c(),ee(t,1),t.m(e.parentNode,e)):t&&(rt(),oe(t,1,1,()=>{t=null}),it())},i(r){i||(ee(t),i=!0)},o(r){oe(t),i=!1},d(r){t&&t.d(r),r&&M(e)}}}function ol(n){let e,i,t=n[4][n[1]]&&bi(n);return{c(){t&&t.c(),e=je()},l(r){t&&t.l(r),e=je()},m(r,o){t&&t.m(r,o),te(r,e,o),i=!0},p(r,o){r[4][r[1]]?t?(t.p(r,o),o[0]&18&&ee(t,1)):(t=bi(r),t.c(),ee(t,1),t.m(e.parentNode,e)):t&&(rt(),oe(t,1,1,()=>{t=null}),it())},i(r){i||(ee(t),i=!0)},o(r){oe(t),i=!1},d(r){t&&t.d(r),r&&M(e)}}}function al(n){let e,i,t;return{c(){e=H("input"),this.h()},l(r){e=q(r,"INPUT",{id:!0,class:!0,type:!0,name:!0}),this.h()},h(){R(e,"id",n[1]),R(e,"class","w100pc radius100pc"),R(e,"type","text"),R(e,"name",n[2])},m(r,o){te(r,e,o),Lt(e,n[4][n[1]]),i||(t=[ce(e,"contextmenu",n[8]),ce(e,"input",n[21])],i=!0)},p(r,o){o[0]&2&&R(e,"id",r[1]),o[0]&4&&R(e,"name",r[2]),o[0]&18&&e.value!==r[4][r[1]]&&Lt(e,r[4][r[1]])},i:Pe,o:Pe,d(r){r&&M(e),i=!1,mt(t)}}}function sl(n){let e;function i(o,a){return!o[0].max&&!o[0].labels?cl:fl}let t=i(n),r=t(n);return{c(){r.c(),e=je()},l(o){r.l(o),e=je()},m(o,a){r.m(o,a),te(o,e,a)},p(o,a){t===(t=i(o))&&r?r.p(o,a):(r.d(1),r=t(o),r&&(r.c(),r.m(e.parentNode,e)))},i:Pe,o:Pe,d(o){r.d(o),o&&M(e)}}}function ll(n){let e,i,t;const r=[{name:n[2]},{id:n[1]},n[0],{step:n[0].type=="float"?0:1},{class:"mb0 pop"}];function o(l){n[18](l)}let a={};for(let l=0;l<r.length;l+=1)a=ia(a,r[l]);return n[4][n[1]]!==void 0&&(a.value=n[4][n[1]]),e=new Ot({props:a}),Ke.push(()=>pt(e,"value",o)),e.$on("contextmenu",n[8]),{c(){we(e.$$.fragment)},l(l){Oe(e.$$.fragment,l)},m(l,s){Ee(e,l,s),t=!0},p(l,s){const f=s[0]&7?oa(r,[s[0]&4&&{name:l[2]},s[0]&2&&{id:l[1]},s[0]&1&&aa(l[0]),s[0]&1&&{step:l[0].type=="float"?0:1},r[4]]):{};!i&&s[0]&18&&(i=!0,f.value=l[4][l[1]],vt(()=>i=!1)),e.$set(f)},i(l){t||(ee(e.$$.fragment,l),t=!0)},o(l){oe(e.$$.fragment,l),t=!1},d(l){Ne(e,l)}}}function ul(n){let e,i,t,r;const o=[{name:n[2]},{id:n[1]},n[0]];function a(f){n[17](f)}var l=n[3];function s(f){let u={};for(let c=0;c<o.length;c+=1)u=ia(u,o[c]);return f[4][f[1]]!==void 0&&(u.value=f[4][f[1]]),{props:u}}return l&&(e=new l(s(n)),Ke.push(()=>pt(e,"value",a)),e.$on("contextmenu",n[8])),{c(){e&&we(e.$$.fragment),t=je()},l(f){e&&Oe(e.$$.fragment,f),t=je()},m(f,u){e&&Ee(e,f,u),te(f,t,u),r=!0},p(f,u){const c=u[0]&7?oa(o,[u[0]&4&&{name:f[2]},u[0]&2&&{id:f[1]},u[0]&1&&aa(f[0])]):{};if(!i&&u[0]&18&&(i=!0,c.value=f[4][f[1]],vt(()=>i=!1)),l!==(l=f[3])){if(e){rt();const h=e;oe(h.$$.fragment,1,0,()=>{Ne(h,1)}),it()}l?(e=new l(s(f)),Ke.push(()=>pt(e,"value",a)),e.$on("contextmenu",f[8]),we(e.$$.fragment),ee(e.$$.fragment,1),Ee(e,t.parentNode,t)):e=null}else l&&e.$set(c)},i(f){r||(e&&ee(e.$$.fragment,f),r=!0)},o(f){e&&oe(e.$$.fragment,f),r=!1},d(f){f&&M(t),e&&Ne(e,f)}}}function _i(n){let e,i,t,r,o,a,l,s,f;function u(d){n[26](d)}let c={class:"mb0-5 pop",min:n[0].min[0],max:n[0].max[0]};n[4][n[1]][0]!==void 0&&(c.value=n[4][n[1]][0]),e=new Ot({props:c}),Ke.push(()=>pt(e,"value",u)),e.$on("contextmenu",n[27]);function h(d){n[28](d)}let p={class:"mb0-5 pop",min:n[0].min[1],max:n[0].max[1]};n[4][n[1]][1]!==void 0&&(p.value=n[4][n[1]][1]),r=new Ot({props:p}),Ke.push(()=>pt(r,"value",h)),r.$on("contextmenu",n[29]);function m(d){n[30](d)}let v={class:"mb0 pop",min:n[0].min[2],max:n[0].max[2]};return n[4][n[1]][2]!==void 0&&(v.value=n[4][n[1]][2]),l=new Ot({props:v}),Ke.push(()=>pt(l,"value",m)),l.$on("contextmenu",n[31]),{c(){we(e.$$.fragment),t=re(),we(r.$$.fragment),a=re(),we(l.$$.fragment)},l(d){Oe(e.$$.fragment,d),t=ie(d),Oe(r.$$.fragment,d),a=ie(d),Oe(l.$$.fragment,d)},m(d,_){Ee(e,d,_),te(d,t,_),Ee(r,d,_),te(d,a,_),Ee(l,d,_),f=!0},p(d,_){const y={};_[0]&1&&(y.min=d[0].min[0]),_[0]&1&&(y.max=d[0].max[0]),!i&&_[0]&18&&(i=!0,y.value=d[4][d[1]][0],vt(()=>i=!1)),e.$set(y);const b={};_[0]&1&&(b.min=d[0].min[1]),_[0]&1&&(b.max=d[0].max[1]),!o&&_[0]&18&&(o=!0,b.value=d[4][d[1]][1],vt(()=>o=!1)),r.$set(b);const E={};_[0]&1&&(E.min=d[0].min[2]),_[0]&1&&(E.max=d[0].max[2]),!s&&_[0]&18&&(s=!0,E.value=d[4][d[1]][2],vt(()=>s=!1)),l.$set(E)},i(d){f||(ee(e.$$.fragment,d),ee(r.$$.fragment,d),ee(l.$$.fragment,d),f=!0)},o(d){oe(e.$$.fragment,d),oe(r.$$.fragment,d),oe(l.$$.fragment,d),f=!1},d(d){Ne(e,d),d&&M(t),Ne(r,d),d&&M(a),Ne(l,d)}}}function bi(n){let e,i,t,r,o,a;function l(c){n[22](c)}let s={class:"mb0-5 pop",min:n[0].min[0],max:n[0].max[0]};n[4][n[1]][0]!==void 0&&(s.value=n[4][n[1]][0]),e=new Ot({props:s}),Ke.push(()=>pt(e,"value",l)),e.$on("contextmenu",n[23]);function f(c){n[24](c)}let u={class:"mb0 pop",min:n[0].min[1],max:n[0].max[1]};return n[4][n[1]][1]!==void 0&&(u.value=n[4][n[1]][1]),r=new Ot({props:u}),Ke.push(()=>pt(r,"value",f)),r.$on("contextmenu",n[25]),{c(){we(e.$$.fragment),t=re(),we(r.$$.fragment)},l(c){Oe(e.$$.fragment,c),t=ie(c),Oe(r.$$.fragment,c)},m(c,h){Ee(e,c,h),te(c,t,h),Ee(r,c,h),a=!0},p(c,h){const p={};h[0]&1&&(p.min=c[0].min[0]),h[0]&1&&(p.max=c[0].max[0]),!i&&h[0]&18&&(i=!0,p.value=c[4][c[1]][0],vt(()=>i=!1)),e.$set(p);const m={};h[0]&1&&(m.min=c[0].min[1]),h[0]&1&&(m.max=c[0].max[1]),!o&&h[0]&18&&(o=!0,m.value=c[4][c[1]][1],vt(()=>o=!1)),r.$set(m)},i(c){a||(ee(e.$$.fragment,c),ee(r.$$.fragment,c),a=!0)},o(c){oe(e.$$.fragment,c),oe(r.$$.fragment,c),a=!1},d(c){Ne(e,c),c&&M(t),Ne(r,c)}}}function fl(n){let e,i,t,r=n[0].labels||[],o=[];for(let a=0;a<r.length;a+=1)o[a]=wi(yi(n,r,a));return{c(){e=H("select");for(let a=0;a<o.length;a+=1)o[a].c();this.h()},l(a){e=q(a,"SELECT",{id:!0,class:!0,type:!0});var l=X(e);for(let s=0;s<o.length;s+=1)o[s].l(l);l.forEach(M),this.h()},h(){R(e,"id",n[1]),R(e,"class","w100pc text-center italic maxw1000pc overflow-hidden"),R(e,"type","text"),n[4][n[1]]===void 0&&sa(()=>n[20].call(e))},m(a,l){te(a,e,l);for(let s=0;s<o.length;s+=1)o[s].m(e,null);ar(e,n[4][n[1]]),i||(t=[ce(e,"contextmenu",n[8]),ce(e,"change",n[20])],i=!0)},p(a,l){if(l[0]&1){r=a[0].labels||[];let s;for(s=0;s<r.length;s+=1){const f=yi(a,r,s);o[s]?o[s].p(f,l):(o[s]=wi(f),o[s].c(),o[s].m(e,null))}for(;s<o.length;s+=1)o[s].d(1);o.length=r.length}l[0]&2&&R(e,"id",a[1]),l[0]&18&&ar(e,a[4][a[1]])},d(a){a&&M(e),Xe(o,a),i=!1,mt(t)}}}function cl(n){let e,i,t;return{c(){e=H("input"),this.h()},l(r){e=q(r,"INPUT",{class:!0,type:!0}),this.h()},h(){R(e,"class","input button"),R(e,"type","number")},m(r,o){te(r,e,o),Lt(e,n[4][n[1]]),i||(t=ce(e,"input",n[19]),i=!0)},p(r,o){o[0]&18&&rn(e.value)!==r[4][r[1]]&&Lt(e,r[4][r[1]])},d(r){r&&M(e),i=!1,t()}}}function wi(n){let e,i=n[37]+"",t,r;return{c(){e=H("option"),t=de(i),this.h()},l(o){e=q(o,"OPTION",{name:!0});var a=X(e);t=pe(a,i),a.forEach(M),this.h()},h(){R(e,"name",r=n[37]),e.__value=n[39],e.value=e.__value},m(o,a){te(o,e,a),P(e,t)},p(o,a){a[0]&1&&i!==(i=o[37]+"")&&Me(t,i),a[0]&1&&r!==(r=o[37])&&R(e,"name",r)},d(o){o&&M(e)}}}function hl(n){let e,i,t,r=n[6]?"Learning...":"MIDI Learn",o,a,l,s,f,u,c,h,p,m;const v=[ul,ll,sl,al,ol,il,rl,nl],d=[];function _(y,b){return y[3]?0:y[0].type=="float"||y[0].type=="int"?1:y[0].type=="long"?2:y[0].type=="string"?3:y[0].type=="point2D"?4:y[0].type=="color"?5:y[0].type=="bool"?6:7}return u=_(n),c=d[u]=v[u](n),{c(){e=H("div"),i=H("div"),t=H("div"),o=de(r),a=re(),l=H("div"),s=de("Remove Assignments"),f=re(),c.c(),this.h()},l(y){e=q(y,"DIV",{class:!0});var b=X(e);i=q(b,"DIV",{style:!0,class:!0});var E=X(i);t=q(E,"DIV",{class:!0});var N=X(t);o=pe(N,r),N.forEach(M),a=ie(E),l=q(E,"DIV",{class:!0});var S=X(l);s=pe(S,"Remove Assignments"),S.forEach(M),E.forEach(M),f=ie(b),c.l(b),b.forEach(M),this.h()},h(){R(t,"class","bb clickable"),R(l,"class","bb clickable"),ke(i,"transform","translate("+n[5].offsetX+"px, "+n[5].offsetY+"px)"),R(i,"class","z-index2 bg abs t0 l0 border bt bl br cplr1 cptb0-5"),Fe(i,"none",(n[7]||"").indexOf(n[1])==-1),R(e,"class","auto-element rel")},m(y,b){te(y,e,b),P(e,i),P(i,t),P(t,o),P(i,a),P(i,l),P(l,s),P(e,f),d[u].m(e,null),h=!0,p||(m=[ce(tl,"click",n[9]),ce(t,"click",n[10]),ce(l,"click",n[11]),ce(e,"click",dl)],p=!0)},p(y,b){(!h||b[0]&64)&&r!==(r=y[6]?"Learning...":"MIDI Learn")&&Me(o,r),(!h||b[0]&32)&&ke(i,"transform","translate("+y[5].offsetX+"px, "+y[5].offsetY+"px)"),(!h||b[0]&130)&&Fe(i,"none",(y[7]||"").indexOf(y[1])==-1);let E=u;u=_(y),u===E?d[u].p(y,b):(rt(),oe(d[E],1,1,()=>{d[E]=null}),it(),c=d[u],c?c.p(y,b):(c=d[u]=v[u](y),c.c()),ee(c,1),c.m(e,null))},i(y){h||(ee(c),h=!0)},o(y){oe(c),h=!1},d(y){y&&M(e),d[u].d(),p=!1,mt(m)}}}function dl(n){n.stopPropagation()}function pl(n,e,i){let t,r,o,a,l;he(n,kr,z=>i(33,t=z)),he(n,$t,z=>i(6,r=z)),he(n,Zt,z=>i(7,o=z)),he(n,bt,z=>i(34,a=z)),he(n,ue,z=>i(4,l=z));let{def:s}=e,{key:f}=e,{parentName:u}=e,{name:c}=e,{uuid:h}=e,{rowIdx:p}=e,{colIdx:m}=e;const v=window,d=(z,ve)=>console.log(`[Auto] ${z}`,ve||"");let{component:_=null}=e,y={offsetX:0,offsetY:0};function b(z,ve){ge(Zt,o=f,o),ve!=null&&ge(Zt,o+=":"+ve,o),d(`opening context menu with ${o}`);const{offsetX:Ae,offsetY:Ze}=z;i(5,y={offsetX:Ae,offsetY:Ze}),z.preventDefault()}function E(z){ge(Zt,o=null,o),ge($t,r=null,r)}function N(z){ge($t,r=r?null:o,r)}function S(z){delete a[o],bt.set(a),ge(Zt,o=null,o),ge($t,r=null,r)}let A;function x(z){n.$$.not_equal(l[f],z)&&(l[f]=z,ue.set(l))}function w(z){n.$$.not_equal(l[f],z)&&(l[f]=z,ue.set(l))}function I(){l[f]=rn(this.value),ue.set(l)}function L(){l[f]=ra(this),ue.set(l)}function C(){l[f]=this.value,ue.set(l)}function j(z){n.$$.not_equal(l[f][0],z)&&(l[f][0]=z,ue.set(l))}const Y=z=>b(z,0);function ae(z){n.$$.not_equal(l[f][1],z)&&(l[f][1]=z,ue.set(l))}const V=z=>b(z,1);function se(z){n.$$.not_equal(l[f][0],z)&&(l[f][0]=z,ue.set(l))}const Te=z=>b(z,0);function _e(z){n.$$.not_equal(l[f][1],z)&&(l[f][1]=z,ue.set(l))}const J=z=>b(z,1);function Q(z){n.$$.not_equal(l[f][2],z)&&(l[f][2]=z,ue.set(l))}const xe=z=>b(z,2);function Se(z){n.$$.not_equal(l[f],z)&&(l[f]=z,ue.set(l))}return n.$$set=z=>{"def"in z&&i(0,s=z.def),"key"in z&&i(1,f=z.key),"parentName"in z&&i(12,u=z.parentName),"name"in z&&i(2,c=z.name),"uuid"in z&&i(13,h=z.uuid),"rowIdx"in z&&i(14,p=z.rowIdx),"colIdx"in z&&i(15,m=z.colIdx),"component"in z&&i(3,_=z.component)},n.$$.update=()=>{n.$$.dirty[0]&19&&(z=>{if(l[f]==null&&s.default!=null&&ge(ue,l[f]=JSON.parse(JSON.stringify(s.default)),l),!!v.RNDRS){for(const[ve,Ae]of Object.entries(v.RNDRS))if(Ae.getValue()!=l[f]&&!s.ignore)try{Ae.uniforms[f]&&Ae.setValue(f,l[f])}catch(Ze){console.log("\u274C error setting value in Auto",Ze)}}})(),n.$$.dirty[0]&65539&&(z=>{A!=f&&(ge(kr,t[f]=s,t),i(16,A=f))})()},[s,f,c,_,l,y,r,o,b,E,N,S,u,h,p,m,A,x,w,I,L,C,j,Y,ae,V,se,Te,_e,J,Q,xe,Se]}class Cr extends Ce{constructor(e){super(),De(this,e,pl,hl,Le,{def:0,key:1,parentName:12,name:2,uuid:13,rowIdx:14,colIdx:15,component:3},null,[-1,-1])}}function Ei(n,e,i){const t=n.slice();return t[2]=e[i],t}function Ni(n){let e,i=n[2].type+"",t,r,o=(n[2].path||"")+"",a,l,s;return{c(){e=H("option"),t=de(i),r=re(),a=de(o),l=re(),this.h()},l(f){e=q(f,"OPTION",{});var u=X(e);t=pe(u,i),r=ie(u),a=pe(u,o),l=ie(u),u.forEach(M),this.h()},h(){e.__value=s=n[2],e.value=e.__value},m(f,u){te(f,e,u),P(e,t),P(e,r),P(e,a),P(e,l)},p(f,u){u&32&&i!==(i=f[2].type+"")&&Me(t,i),u&32&&o!==(o=(f[2].path||"")+"")&&Me(a,o),u&32&&s!==(s=f[2])&&(e.__value=s,e.value=e.__value)},d(f){f&&M(e)}}}function ml(n){let e,i;return{c(){e=H("video"),this.h()},l(t){e=q(t,"VIDEO",{src:!0}),X(e).forEach(M),this.h()},h(){var t;e.autoplay=!0,e.loop=!0,e.controls=!0,Gt(e.src,i=(t=n[4][n[1]])==null?void 0:t.path)||R(e,"src",i)},m(t,r){te(t,e,r),n[17](e)},p(t,r){var o;r&18&&!Gt(e.src,i=(o=t[4][t[1]])==null?void 0:o.path)&&R(e,"src",i)},d(t){t&&M(e),n[17](null)}}}function gl(n){let e,i;return{c(){e=H("video"),this.h()},l(t){e=q(t,"VIDEO",{volume:!0,src:!0}),X(e).forEach(M),this.h()},h(){var t;e.autoplay=!0,R(e,"volume","0"),e.muted=!0,e.loop=!0,e.controls=!0,Gt(e.src,i=(t=n[4][n[1]])==null?void 0:t.path)||R(e,"src",i)},m(t,r){te(t,e,r),n[16](e)},p(t,r){var o;r&18&&!Gt(e.src,i=(o=t[4][t[1]])==null?void 0:o.path)&&R(e,"src",i)},d(t){t&&M(e),n[16](null)}}}function vl(n){let e,i;return{c(){e=H("img"),this.h()},l(t){e=q(t,"IMG",{src:!0}),this.h()},h(){var t;Gt(e.src,i=(t=n[4][n[1]])==null?void 0:t.path)||R(e,"src",i)},m(t,r){te(t,e,r),n[15](e)},p(t,r){var o;r&18&&!Gt(e.src,i=(o=t[4][t[1]])==null?void 0:o.path)&&R(e,"src",i)},d(t){t&&M(e),n[15](null)}}}function yl(n){let e,i,t,r,o,a,l,s,f,u,c=n[5],h=[];for(let d=0;d<c.length;d+=1)h[d]=Ni(Ei(n,c,d));function p(d,_){var y,b,E;if(((y=d[4][d[1]])==null?void 0:y.type)==ht.IMAGE)return vl;if(((b=d[4][d[1]])==null?void 0:b.type)==ht.VIDEO)return gl;if(((E=d[4][d[1]])==null?void 0:E.type)==ht.CAMERA)return ml}let m=p(n),v=m&&m(n);return{c(){e=H("div"),i=H("div"),t=H("div"),r=de(n[0]),o=re(),a=H("select");for(let d=0;d<h.length;d+=1)h[d].c();l=re(),s=H("div"),v&&v.c(),this.h()},l(d){e=q(d,"DIV",{class:!0});var _=X(e);i=q(_,"DIV",{class:!0});var y=X(i);t=q(y,"DIV",{class:!0});var b=X(t);r=pe(b,n[0]),b.forEach(M),o=ie(y),a=q(y,"SELECT",{class:!0});var E=X(a);for(let S=0;S<h.length;S+=1)h[S].l(E);E.forEach(M),y.forEach(M),l=ie(_),s=q(_,"DIV",{class:!0});var N=X(s);v&&v.l(N),N.forEach(M),_.forEach(M),this.h()},h(){R(t,"class","plr0-5 flex row-flex-start-center"),R(a,"class","invisible abs l0 t0"),n[6]===void 0&&sa(()=>n[14].call(a)),R(i,"class","select bl bt br bb rel maxw100pc overflow-hidden 100pc"),R(s,"class","w100pc filled minh2em sticky t0 l0"),R(e,"class","flex column sticky t0 l0")},m(d,_){te(d,e,_),P(e,i),P(i,t),P(t,r),P(i,o),P(i,a);for(let y=0;y<h.length;y+=1)h[y].m(a,null);ar(a,n[6]),P(e,l),P(e,s),v&&v.m(s,null),f||(u=[ce(a,"change",n[7]),ce(a,"change",n[14]),ce(e,"dragover",_l),ce(e,"drop",n[8])],f=!0)},p(d,[_]){if(_&1&&Me(r,d[0]),_&32){c=d[5];let y;for(y=0;y<c.length;y+=1){const b=Ei(d,c,y);h[y]?h[y].p(b,_):(h[y]=Ni(b),h[y].c(),h[y].m(a,null))}for(;y<h.length;y+=1)h[y].d(1);h.length=c.length}_&96&&ar(a,d[6]),m===(m=p(d))&&v?v.p(d,_):(v&&v.d(1),v=m&&m(d),v&&(v.c(),v.m(s,null)))},i:Pe,o:Pe,d(d){d&&M(e),Xe(h,d),v&&v.d(),f=!1,mt(u)}}}function _l(n){n.preventDefault()}function bl(n,e,i){let t;he(n,ue,x=>i(4,t=x));let{def:r}=e,{key:o}=e,{parentName:a}=e,{name:l}=e,{uuid:s}=e,{rowIdx:f}=e,{colIdx:u}=e;const c=window;let h=[];function p(){var x;if(c.RNDRS){for(const[w,I]of Object.entries(c.RNDRS))if(I&&d)I.setValue(o,d);else if(((x=t[o])==null?void 0:x.type)==ht.FEEDBACK){const L=document.getElementById("main");I.setValue(o,L)}}c.requestAnimationFrame(p)}sn(async x=>{i(5,h=await Fs()),p()});let m=!1;function v(x){i(13,m=!0),navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then((w,I)=>{console.log("camera opened",w),i(3,d.srcObject=w,d)})}let d,_;function y(x){window.requestAnimationFrame(w=>{_&&ge(ue,t[o]=_,t)})}async function b(x){var j,Y;x.preventDefault();const w=(Y=(j=x==null?void 0:x.dataTransfer)==null?void 0:j.items)==null?void 0:Y[0];if(!w)return;const I=await w.getAsFileSystemHandle(),L=I.name.split(".").pop().toLowerCase(),{name:C}=I;if(I.kind=="file"){const ae=URL.createObjectURL(await I.getFile()),V=["mp4","mov","avi","mkv"],se=["jpg","png","gif","jpeg"];V.indexOf(L)!=-1?ge(ue,t[o]={type:ht.VIDEO,path:ae,name:C},t):se.indexOf(L)!=-1&&ge(ue,t[o]={type:ht.IMAGE,path:ae,name:C},t)}}function E(){_=ra(this),i(6,_),i(5,h)}function N(x){Ke[x?"unshift":"push"](()=>{d=x,i(3,d)})}function S(x){Ke[x?"unshift":"push"](()=>{d=x,i(3,d)})}function A(x){Ke[x?"unshift":"push"](()=>{d=x,i(3,d)})}return n.$$set=x=>{"def"in x&&i(2,r=x.def),"key"in x&&i(1,o=x.key),"parentName"in x&&i(9,a=x.parentName),"name"in x&&i(0,l=x.name),"uuid"in x&&i(10,s=x.uuid),"rowIdx"in x&&i(11,f=x.rowIdx),"colIdx"in x&&i(12,u=x.colIdx)},n.$$.update=()=>{var x,w;n.$$.dirty&22&&(I=>{if(t[o]==null&&r.default!=null&&ge(ue,t[o]=JSON.parse(JSON.stringify(r.default)),t),!!c.RNDRS)for(const[L,C]of Object.entries(c.RNDRS));})(),n.$$.dirty&8218&&(I=>{var L;((L=t[o])==null?void 0:L.type)==ht.CAMERA?m||v():i(13,m=!1)})(),n.$$.dirty&18&&i(0,l=(x=t==null?void 0:t[o])!=null&&x.name?t[o].name:(w=t==null?void 0:t[o])!=null&&w.path?t[o].path.split("/").pop():"N/A")},[l,o,r,d,t,h,_,y,b,a,s,f,u,m,E,N,S,A]}class wl extends Ce{constructor(e){super(),De(this,e,bl,yl,Le,{def:2,key:1,parentName:9,name:0,uuid:10,rowIdx:11,colIdx:12})}}function El(n){let e,i=n[0].labels[n[2][n[1]]]+"",t,r,o;return{c(){e=H("button"),t=de(i),this.h()},l(a){e=q(a,"BUTTON",{class:!0});var l=X(e);t=pe(l,i),l.forEach(M),this.h()},h(){R(e,"class","italic")},m(a,l){te(a,e,l),P(e,t),r||(o=ce(e,"mousedown",n[3]),r=!0)},p(a,[l]){l&7&&i!==(i=a[0].labels[a[2][a[1]]]+"")&&Me(t,i)},i:Pe,o:Pe,d(a){a&&M(e),r=!1,o()}}}function Nl(n,e,i){let t;he(n,ue,p=>i(2,t=p));let{def:r}=e,{key:o}=e,{parentName:a}=e,{name:l}=e,{uuid:s}=e,{rowIdx:f}=e,{colIdx:u}=e;const c=window;function h(p){ge(ue,t[o]+=1,t),t[o]>=r.labels.length&&ge(ue,t[o]=0,t)}return n.$$set=p=>{"def"in p&&i(0,r=p.def),"key"in p&&i(1,o=p.key),"parentName"in p&&i(4,a=p.parentName),"name"in p&&i(5,l=p.name),"uuid"in p&&i(6,s=p.uuid),"rowIdx"in p&&i(7,f=p.rowIdx),"colIdx"in p&&i(8,u=p.colIdx)},n.$$.update=()=>{n.$$.dirty&7&&(p=>{if(t[o]==null&&r.default!=null&&ge(ue,t[o]=JSON.parse(JSON.stringify(r.default)),t),!!c.RNDRS){for(const[m,v]of Object.entries(c.RNDRS))if(v.getValue()!=t[o]&&!r.ignore)try{v.uniforms[o]&&v.setValue(o,t[o])}catch(d){console.log("\u274C error setting value in MultiClick",d)}}})()},[r,o,t,h,a,l,s,f,u]}class Sl extends Ce{constructor(e){super(),De(this,e,Nl,El,Le,{def:0,key:1,parentName:4,name:5,uuid:6,rowIdx:7,colIdx:8})}}const{window:xl}=cr;function Il(n){let e,i,t,r,o,a,l;return{c(){e=H("div"),i=H("button"),t=de(n[2]),r=re(),o=H("button"),this.h()},l(s){e=q(s,"DIV",{class:!0});var f=X(e);i=q(f,"BUTTON",{class:!0});var u=X(i);t=pe(u,n[2]),u.forEach(M),r=ie(f),o=q(f,"BUTTON",{class:!0}),X(o).forEach(M),f.forEach(M),this.h()},h(){R(i,"class","italic"),Fe(i,"fade",n[1][n[0]]==-1),Fe(i,"error",n[1][n[0]]!=-1),R(o,"class","italic"),R(e,"class","flex")},m(s,f){te(s,e,f),P(e,i),P(i,t),P(e,r),P(e,o),a||(l=[ce(xl,"mousedown",n[5]),ce(i,"mousedown",n[3]),ce(o,"click",n[4])],a=!0)},p(s,[f]){f&4&&Me(t,s[2]),f&3&&Fe(i,"fade",s[1][s[0]]==-1),f&3&&Fe(i,"error",s[1][s[0]]!=-1)},i:Pe,o:Pe,d(s){s&&M(e),a=!1,mt(l)}}}function Ol(n,e,i){let t,r;he(n,jt,b=>i(13,t=b)),he(n,ue,b=>i(1,r=b));let{def:o}=e,{key:a}=e,{parentName:l}=e,{name:s}=e,{uuid:f}=e,{rowIdx:u}=e,{colIdx:c}=e;const h=window,p=(b,E)=>console.log(`[OpSelect] ${b}`,E||"");let m=null,v;function d(b){if((t==null?void 0:t.key)==a){ge(jt,t=null,t);return}p(`initiating selection for ${a}`),ge(jt,t={key:a,uuid:f},t),b.stopPropagation()}function _(){ge(ue,r[a]=-1,r)}function y(b){h.requestAnimationFrame(E=>{t&&(p("no source was selected"),ge(jt,t=null,t))})}return n.$$set=b=>{"def"in b&&i(6,o=b.def),"key"in b&&i(0,a=b.key),"parentName"in b&&i(7,l=b.parentName),"name"in b&&i(8,s=b.name),"uuid"in b&&i(9,f=b.uuid),"rowIdx"in b&&i(10,u=b.rowIdx),"colIdx"in b&&i(11,c=b.colIdx)},n.$$.update=()=>{n.$$.dirty&67&&(b=>{if(r[a]==null&&o.default!=null&&ge(ue,r[a]=JSON.parse(JSON.stringify(o.default)),r),!!h.RNDRS){for(const[E,N]of Object.entries(h.RNDRS))if(N.getValue()!=r[a]&&!o.ignore)try{N.uniforms[a]&&N.setValue(a,r[a])}catch(S){console.log("\u274C error setting value in OpSelect",S)}}})(),n.$$.dirty&4099&&(b=>{if(v!=r[a]){if(i(12,v=r[a]),r[a]>=0&&r[a]<99)i(2,m=`${Ln(r[a])} (${r[a]})`);else{const E=ei(r[a]),N=Rt().find(S=>S.uuid==E);i(2,m=`${(N==null?void 0:N.name)||"\u21E9"} ${(N==null?void 0:N.uuid)||""}`)}yt.set(Tt.COMPILE)}})(r[a])},[a,r,m,d,_,y,o,l,s,f,u,c,v]}class Tl extends Ce{constructor(e){super(),De(this,e,Ol,Il,Le,{def:6,key:0,parentName:7,name:8,uuid:9,rowIdx:10,colIdx:11})}}const Al=Cr,Rl=wl,Ml=Sl,Pl=Tl,Si=Object.freeze(Object.defineProperty({__proto__:null,Auto:Al,ExtSource:Rl,MultiClick:Ml,OpSelect:Pl},Symbol.toStringTag,{value:"Module"}));function xi(n,e,i){const t=n.slice();return t[7]=e[i][0],t[8]=e[i][1],t}function Ii(n){let e,i,t=(n[8].label||n[7])+"",r,o,a,l,s;var f=Si[n[8].gui]||Cr;function u(c){return{props:{def:c[8],uuid:c[1],rowIdx:c[3],colIdx:c[4],parentName:c[2],name:c[7],key:c[1]+c[7]}}}return f&&(a=new f(u(n))),{c(){e=H("div"),i=H("div"),r=de(t),o=re(),a&&we(a.$$.fragment),l=re(),this.h()},l(c){e=q(c,"DIV",{class:!0});var h=X(e);i=q(h,"DIV",{class:!0});var p=X(i);r=pe(p,t),p.forEach(M),o=ie(h),a&&Oe(a.$$.fragment,h),l=ie(h),h.forEach(M),this.h()},h(){R(i,"class","grow monospace f0 bold uppercase"),R(e,"class","flex row-stretch-center wrap"),Fe(e,"none",n[5][n[1]+n[7]])},m(c,h){te(c,e,h),P(e,i),P(i,r),P(e,o),a&&Ee(a,e,null),P(e,l),s=!0},p(c,h){(!s||h&1)&&t!==(t=(c[8].label||c[7])+"")&&Me(r,t);const p={};if(h&1&&(p.def=c[8]),h&2&&(p.uuid=c[1]),h&8&&(p.rowIdx=c[3]),h&16&&(p.colIdx=c[4]),h&4&&(p.parentName=c[2]),h&1&&(p.name=c[7]),h&3&&(p.key=c[1]+c[7]),f!==(f=Si[c[8].gui]||Cr)){if(a){rt();const m=a;oe(m.$$.fragment,1,0,()=>{Ne(m,1)}),it()}f?(a=new f(u(c)),we(a.$$.fragment),ee(a.$$.fragment,1),Ee(a,e,l)):a=null}else f&&a.$set(p);(!s||h&35)&&Fe(e,"none",c[5][c[1]+c[7]])},i(c){s||(a&&ee(a.$$.fragment,c),s=!0)},o(c){a&&oe(a.$$.fragment,c),s=!1},d(c){c&&M(e),a&&Ne(a)}}}function kl(n){let e,i,t=Object.entries(n[0].INPUTS),r=[];for(let a=0;a<t.length;a+=1)r[a]=Ii(xi(n,t,a));const o=a=>oe(r[a],1,1,()=>{r[a]=null});return{c(){for(let a=0;a<r.length;a+=1)r[a].c();e=je()},l(a){for(let l=0;l<r.length;l+=1)r[l].l(a);e=je()},m(a,l){for(let s=0;s<r.length;s+=1)r[s].m(a,l);te(a,e,l),i=!0},p(a,[l]){if(l&63){t=Object.entries(a[0].INPUTS);let s;for(s=0;s<t.length;s+=1){const f=xi(a,t,s);r[s]?(r[s].p(f,l),ee(r[s],1)):(r[s]=Ii(f),r[s].c(),ee(r[s],1),r[s].m(e.parentNode,e))}for(rt(),s=t.length;s<r.length;s+=1)o(s);it()}},i(a){if(!i){for(let l=0;l<t.length;l+=1)ee(r[l]);i=!0}},o(a){r=r.filter(Boolean);for(let l=0;l<r.length;l+=1)oe(r[l]);i=!1},d(a){Xe(r,a),a&&M(e)}}}function Cl(n,e,i){let t;he(n,Ht,u=>i(5,t=u));let{schema:r}=e,{uuid:o}=e,{name:a}=e,{shader:l}=e,{rowIdx:s}=e,{colIdx:f}=e;return n.$$set=u=>{"schema"in u&&i(0,r=u.schema),"uuid"in u&&i(1,o=u.uuid),"name"in u&&i(2,a=u.name),"shader"in u&&i(6,l=u.shader),"rowIdx"in u&&i(3,s=u.rowIdx),"colIdx"in u&&i(4,f=u.colIdx)},[r,o,a,s,f,t,l]}class Et extends Ce{constructor(e){super(),De(this,e,Cl,kl,Le,{schema:0,uuid:1,name:2,shader:6,rowIdx:3,colIdx:4})}}function Dl(n){let e,i;return e=new Et({props:{name:n[0],uuid:n[1],schema:Vr,shader:ga,colIdx:n[2],rowIdx:n[3]}}),{c(){we(e.$$.fragment)},l(t){Oe(e.$$.fragment,t)},m(t,r){Ee(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(ee(e.$$.fragment,t),i=!0)},o(t){oe(e.$$.fragment,t),i=!1},d(t){Ne(e,t)}}}function Ll(n,e,i){let t;he(n,ue,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>gt({name:r,uuid:o,schema:Vr}))()},[r,o,a,l,t]}class Fl extends Ce{constructor(e){super(),De(this,e,Ll,Dl,Le,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function Ul(n){let e,i;return e=new Et({props:{name:n[0],uuid:n[1],schema:Gr,shader:va,colIdx:n[2],rowIdx:n[3]}}),{c(){we(e.$$.fragment)},l(t){Oe(e.$$.fragment,t)},m(t,r){Ee(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(ee(e.$$.fragment,t),i=!0)},o(t){oe(e.$$.fragment,t),i=!1},d(t){Ne(e,t)}}}function Bl(n,e,i){let t;he(n,ue,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>gt({name:r,uuid:o,schema:Gr}))()},[r,o,a,l,t]}class jl extends Ce{constructor(e){super(),De(this,e,Bl,Ul,Le,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function Vl(n){let e,i;return e=new Et({props:{name:n[0],uuid:n[1],schema:Hr,shader:ya,colIdx:n[2],rowIdx:n[3]}}),{c(){we(e.$$.fragment)},l(t){Oe(e.$$.fragment,t)},m(t,r){Ee(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(ee(e.$$.fragment,t),i=!0)},o(t){oe(e.$$.fragment,t),i=!1},d(t){Ne(e,t)}}}function Gl(n,e,i){let t;he(n,ue,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>gt({name:r,uuid:o,schema:Hr}))()},[r,o,a,l,t]}class Hl extends Ce{constructor(e){super(),De(this,e,Gl,Vl,Le,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function ql(n){let e,i;return e=new Et({props:{name:n[0],uuid:n[1],schema:qr,shader:_a,colIdx:n[2],rowIdx:n[3]}}),{c(){we(e.$$.fragment)},l(t){Oe(e.$$.fragment,t)},m(t,r){Ee(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(ee(e.$$.fragment,t),i=!0)},o(t){oe(e.$$.fragment,t),i=!1},d(t){Ne(e,t)}}}function zl(n,e,i){let t;he(n,ue,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>gt({name:r,uuid:o,schema:qr}))()},[r,o,a,l,t]}class Xl extends Ce{constructor(e){super(),De(this,e,zl,ql,Le,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function Wl(n){let e,i;return e=new Et({props:{name:n[0],uuid:n[1],schema:zr,shader:ba,colIdx:n[2],rowIdx:n[3]}}),{c(){we(e.$$.fragment)},l(t){Oe(e.$$.fragment,t)},m(t,r){Ee(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(ee(e.$$.fragment,t),i=!0)},o(t){oe(e.$$.fragment,t),i=!1},d(t){Ne(e,t)}}}function Yl(n,e,i){let t;he(n,ue,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>gt({name:r,uuid:o,schema:zr}))()},[r,o,a,l,t]}class Jl extends Ce{constructor(e){super(),De(this,e,Yl,Wl,Le,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function Kl(n){let e,i;return e=new Et({props:{name:n[0],uuid:n[1],schema:Xr,shader:wa,colIdx:n[2],rowIdx:n[3]}}),{c(){we(e.$$.fragment)},l(t){Oe(e.$$.fragment,t)},m(t,r){Ee(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(ee(e.$$.fragment,t),i=!0)},o(t){oe(e.$$.fragment,t),i=!1},d(t){Ne(e,t)}}}function Zl(n,e,i){let t;he(n,ue,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>gt({name:r,uuid:o,schema:Xr}))()},[r,o,a,l,t]}class Ql extends Ce{constructor(e){super(),De(this,e,Zl,Kl,Le,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function $l(n){let e,i;return e=new Et({props:{name:n[0],uuid:n[1],schema:Wr,shader:Ea,colIdx:n[2],rowIdx:n[3]}}),{c(){we(e.$$.fragment)},l(t){Oe(e.$$.fragment,t)},m(t,r){Ee(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(ee(e.$$.fragment,t),i=!0)},o(t){oe(e.$$.fragment,t),i=!1},d(t){Ne(e,t)}}}function eu(n,e,i){let t;he(n,ue,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>gt({name:r,uuid:o,schema:Wr}))()},[r,o,a,l,t]}class tu extends Ce{constructor(e){super(),De(this,e,eu,$l,Le,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function nu(n){let e,i;return e=new Et({props:{name:n[0],uuid:n[1],schema:Yr,shader:Na,colIdx:n[2],rowIdx:n[3]}}),{c(){we(e.$$.fragment)},l(t){Oe(e.$$.fragment,t)},m(t,r){Ee(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(ee(e.$$.fragment,t),i=!0)},o(t){oe(e.$$.fragment,t),i=!1},d(t){Ne(e,t)}}}function ru(n,e,i){let t;he(n,ue,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>gt({name:r,uuid:o,schema:Yr}))()},[r,o,a,l,t]}class iu extends Ce{constructor(e){super(),De(this,e,ru,nu,Le,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function ou(n){let e,i;return e=new Et({props:{name:n[0],uuid:n[1],schema:Jr,shader:Sa,colIdx:n[2],rowIdx:n[3]}}),{c(){we(e.$$.fragment)},l(t){Oe(e.$$.fragment,t)},m(t,r){Ee(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(ee(e.$$.fragment,t),i=!0)},o(t){oe(e.$$.fragment,t),i=!1},d(t){Ne(e,t)}}}function au(n,e,i){let t;he(n,ue,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>gt({name:r,uuid:o,schema:Jr}))()},[r,o,a,l,t]}class su extends Ce{constructor(e){super(),De(this,e,au,ou,Le,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function lu(n){let e,i;return e=new Et({props:{name:n[0],uuid:n[1],schema:Kr,shader:xa,colIdx:n[2],rowIdx:n[3]}}),{c(){we(e.$$.fragment)},l(t){Oe(e.$$.fragment,t)},m(t,r){Ee(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(ee(e.$$.fragment,t),i=!0)},o(t){oe(e.$$.fragment,t),i=!1},d(t){Ne(e,t)}}}function uu(n,e,i){let t;he(n,ue,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>gt({name:r,uuid:o,schema:Kr}))()},[r,o,a,l,t]}class fu extends Ce{constructor(e){super(),De(this,e,uu,lu,Le,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function cu(n){let e,i;return e=new Et({props:{name:n[0],uuid:n[1],schema:Zr,shader:Ia,colIdx:n[2],rowIdx:n[3]}}),{c(){we(e.$$.fragment)},l(t){Oe(e.$$.fragment,t)},m(t,r){Ee(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(ee(e.$$.fragment,t),i=!0)},o(t){oe(e.$$.fragment,t),i=!1},d(t){Ne(e,t)}}}function hu(n,e,i){let t;he(n,ue,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>gt({name:r,uuid:o,schema:Zr}))()},[r,o,a,l,t]}class du extends Ce{constructor(e){super(),De(this,e,hu,cu,Le,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function Nt(n,e){e.INPUTS={BlendMode:{type:"long",label:"Blend Mode",min:0,max:sr().length,default:0,labels:sr().map(i=>i.name)},BlendAmt:{type:"float",label:"Blend Amount",min:0,max:1,default:1},...e.INPUTS};for(let[i,t]of Object.entries(e.INPUTS))t.gui=="OpSelect"&&(e.INPUTS[i]={...t,gui:"OpSelect",type:"float",min:-1,max:999});return e}const pu={COMPONENT:Fl,GLSL:ga,SCHEMA:Nt("Capacitor",Vr)},mu={COMPONENT:jl,GLSL:va,SCHEMA:Nt("Channel",Gr)},gu={COMPONENT:Hl,GLSL:ya,SCHEMA:Nt("Convolution",Hr)},vu={COMPONENT:Xl,GLSL:_a,SCHEMA:Nt("Deform",qr)},yu={COMPONENT:Jl,GLSL:ba,SCHEMA:Nt("Light",zr)},_u={COMPONENT:Ql,GLSL:wa,SCHEMA:Nt("Mask",Xr)},bu={COMPONENT:tu,GLSL:Ea,SCHEMA:Nt("Mix",Wr)},wu={COMPONENT:iu,GLSL:Na,SCHEMA:Nt("Shape",Yr)},Eu={COMPONENT:su,GLSL:Sa,SCHEMA:Nt("Source",Jr)},Nu={COMPONENT:fu,GLSL:xa,SCHEMA:Nt("Synth",Kr)},Su={COMPONENT:du,GLSL:Ia,SCHEMA:Nt("Wobbulate",Zr)},on=Object.freeze(Object.defineProperty({__proto__:null,Capacitor:pu,Channel:mu,Convolution:gu,Deform:vu,Light:yu,Mask:_u,Mix:bu,Shape:wu,Source:Eu,Synth:Nu,Wobbulate:Su},Symbol.toStringTag,{value:"Module"})),Oa=(n,e)=>console.log(`[API] ${n}`,e||""),Ta=n=>{let e=[{type:"vec4",name:"INPUT"},{type:"int",name:"IN_PASS"},{type:"vec2",name:"POS_NORM"},{type:"vec2",name:"POS_FRAG"}];for(const[i,t]of Object.entries(n)){let{ignore:r,type:o}=t;const a=i==Qt.BL_AMT||i==Qt.BL_MODE;!r&&!a&&(o=Ls[t.gui]||Ds[t.type]||o,e.push({type:o,name:i}))}return e};function nr(n,e,i,t,r){const o=r-t,a=i-e;return(n-e)*o/a+t}const Aa="Channel";function Ra(){Oa("\u{1F39E} sequence changed");let n=!1;console.log("skipping channel adjustments (TODO)");const e=ye(_t);let i=[];for(const t of e)t.length==1&&t[0].indexOf(Aa)!=-1?(console.log("EMPTY CHANNEL"),n=!0):i.push(t);return n&&_t.set(i),n}function Qr(){Oa("\u{1F5D1} clearing up uniforms");const n=ye(ue);let e={};for(const i of Rt())for(const[t,r]of Object.entries(i.schema.INPUTS)){const o=i.uuid+t;e[o]=n[o]}ue.set(e)}function Ma(n,e){try{if(e=="float")return n.toFixed(3);if(e=="int"||e=="long")return parseInt(n)+"";if(e=="vec2"||e=="vec3"||e=="vec4")return`${e}(${n.map(i=>i.toFixed(3)).join(",")})`}catch{}return n+""}function Pa(n,e){let i=0;for(const t of ye(_t).slice(0,n))i+=t.length;return i+e}function $r(n){const e=n,i=ye(nt);if(!!i)return(e[0]==i[0][0]?e[1]>=i[0][1]:e[0]>i[0][0])&&(e[0]==i[1][0]?e[1]<=i[1][1]:e[0]<=i[0][0])}function Dr(n,e){return e||(e=-1),n?parseInt(n.substring(1)):e}function ei(n,e){return"u"+(n+"").padStart(3,"0")}function gt(n){const{name:e,uuid:i,schema:t}=n;let r=ye(ue);for(const[o,a]of Object.entries(t.INPUTS)){const l=i+o;if(a.link!=null){const s=a.link.split(":")[0],f=parseInt(a.link.split(":")[1]);Ht.update(u=>(u[l]=r[i+s]!=f,u))}}}const rr=n=>`${Math.floor(Math.random()*9)+1}`[0];function ka(){const n=Rt().map(e=>e.uuid);for(let e=0;e<1e3;e++){const i=`u${rr()}${rr()}${rr()}`;if(n.indexOf(i)==-1)return i}alert("error generating uuid")}function Ca(n){return n+":"+ka()}function ti(n,e){return`${Ln(n.x)}${n.y+1} ${n.name} ${e}`}function Lr(n){const e=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg,i=/([^\s,]+)/g;let t=n.toString().replace(e,""),r=t.slice(t.indexOf("(")+1,t.indexOf(")")).match(i);return r===null&&(r=[]),r}function Da(n){let e,i=Object.keys(n),t=i.length,r={};for(;t--;)e=i[t],r[e.toUpperCase()]=n[e];for(const[o,a]of Object.entries(r))a.constructor;return r}function Ln(n){return String.fromCharCode(97+n).toUpperCase()}function ni(){var t;const n=ye(nt),e=ye(_t);if(!n)return[];if(n.length!=2)return[];let i=[];for(let r=n[0][0];r<=n[1][0];r++)for(let o=n[0][1];o<=n[1][1];o++){const a=(t=e==null?void 0:e[r])==null?void 0:t[o];a&&i.push(a)}return i}function ri(n,e,i,t){console.log(`[API] \u{1F4A7} ${n} with [${e},${i}]`);let r=[],o=[];t&&(o=t);let a=0;for(const l of ye(_t)){let s=0;r.push([]);for(const f of l){let u=$r([a,s]);u&&o.push(f),u||r[a].push(f),s+=1}a+=1}return n==lt.MOVE&&(r[e]=[...r[e].slice(0,i+1),...o,...r[e].slice(i+1)]),n==lt.INSERT&&(r=[...r.slice(0,e),o,...r.slice(e)]),n==lt.APPEND&&(r=[...r,o]),_t.set(r),r}function La(n){return["Image","Video","Source","Media","Camera"].indexOf(n)!=-1}function Fa(){return ye(_t).map(n=>n.length).reduce((n,e)=>n+e,0)}function Bn(n){const e=ye(_t);let i=0;for(const t of e){let r=0;for(const o of t){const a=o.split(":")[0],l=o.split(":")[1],s=on[a].SCHEMA,f=La(a);n({name:a,schema:s,x:i,y:r,source:f,uuid:l}),r+=1}i+=1}}function Rt(){let n=[];return Bn(e=>n.push(e)),n}function hr(){var i;let n,e=[];for(const t of Rt()){const r=((i=t==null?void 0:t.schema)==null?void 0:i.PASS)&&n,o=(n==null?void 0:n.name)==Aa;(r||o)&&e.indexOf(n.uuid)==-1&&e.push(n.uuid),n=t}return e}function ir(n){return n=n.substring(0,4),Rt().find(e=>e.uuid==n)}function ii(n){let e=ye(Ht);if(!n)return e;for(const i of Rt())for(const[t,r]of Object.entries(i.schema.INPUTS))r.gui=="OpSelect"&&(e[i.uuid+r.name]=!0);return e}const Oi=Object.freeze(Object.defineProperty({__proto__:null,GetISFFunctionArgsFromSchema:Ta,ScaleValue:nr,SequenceUpdatedCallback:Ra,ClearUpUniforms:Qr,ConvertVariableToString:Ma,IndexFromRowAndCol:Pa,IsRowColSelected:$r,UuidToInt:Dr,IntToUuid:ei,SetOpCallback:gt,R:rr,GenerateUuid:ka,GenerateUuidWithName:Ca,GetLabelFromOp:ti,GetFunctionArgumentNames:Lr,MakeJsonKeysUppercase:Da,GetLetterFromIdx:Ln,GetSelectedSequenceList:ni,MakeSequenceAdjustment:ri,IsSource:La,TotalSequenceLength:Fa,LoopThroughSequence:Bn,GetSequenceAsList:Rt,GetUuidsForPasses:hr,GetOpByUuid:ir,GetExpandedHiddenUniforms:ii},Symbol.toStringTag,{value:"Module"}));function Ti(n,e,i){const t=n.slice();return t[7]=e[i][0],t[8]=e[i][1],t[9]=e,t[10]=i,t}function Ai(n,e,i){const t=n.slice();return t[11]=e[i],t[13]=i,t}function xu(n){let e=n[8]+"",i;return{c(){i=de(e)},l(t){i=pe(t,e)},m(t,r){te(t,i,r)},p(t,r){r&8&&e!==(e=t[8]+"")&&Me(i,e)},d(t){t&&M(i)}}}function Iu(n){let e=n[8].toFixed(2)+"",i;return{c(){i=de(e)},l(t){i=pe(t,e)},m(t,r){te(t,i,r)},p(t,r){r&8&&e!==(e=t[8].toFixed(2)+"")&&Me(i,e)},d(t){t&&M(i)}}}function Ou(n){let e,i=n[8],t=[];for(let r=0;r<i.length;r+=1)t[r]=Ri(Ai(n,i,r));return{c(){for(let r=0;r<t.length;r+=1)t[r].c();e=je()},l(r){for(let o=0;o<t.length;o+=1)t[o].l(r);e=je()},m(r,o){for(let a=0;a<t.length;a+=1)t[a].m(r,o);te(r,e,o)},p(r,o){if(o&8){i=r[8];let a;for(a=0;a<i.length;a+=1){const l=Ai(r,i,a);t[a]?t[a].p(l,o):(t[a]=Ri(l),t[a].c(),t[a].m(e.parentNode,e))}for(;a<t.length;a+=1)t[a].d(1);t.length=i.length}},d(r){Xe(t,r),r&&M(e)}}}function Ri(n){let e=(n[11]?n[11].toFixed(2):"null")+"",i;return{c(){i=de(e)},l(t){i=pe(t,e)},m(t,r){te(t,i,r)},p(t,r){r&8&&e!==(e=(t[11]?t[11].toFixed(2):"null")+"")&&Me(i,e)},d(t){t&&M(i)}}}function Mi(n){let e,i,t,r,o,a,l=n[7]+"",s,f,u,c,h,p,m;function v(){n[6].call(t,n[7])}function d(b,E){return E&8&&(c=null),c==null&&(c=!!Array.isArray(b[8])),c?Ou:typeof b[8]=="number"?Iu:xu}let _=d(n,-1),y=_(n);return{c(){e=H("div"),i=H("label"),t=H("input"),r=re(),o=H("span"),a=re(),s=de(l),f=re(),u=H("span"),y.c(),h=re(),this.h()},l(b){e=q(b,"DIV",{class:!0});var E=X(e);i=q(E,"LABEL",{class:!0});var N=X(i);t=q(N,"INPUT",{type:!0}),r=ie(N),o=q(N,"SPAN",{}),X(o).forEach(M),a=ie(N),s=pe(N,l),N.forEach(M),f=ie(E),u=q(E,"SPAN",{});var S=X(u);y.l(S),S.forEach(M),h=ie(E),E.forEach(M),this.h()},h(){R(t,"type","checkbox"),R(i,"class","checkbox"),R(e,"class","flex row-space-between-flex-start minw16em")},m(b,E){te(b,e,E),P(e,i),P(i,t),t.checked=n[4][n[7]],P(i,r),P(i,o),P(i,a),P(i,s),P(e,f),P(e,u),y.m(u,null),P(e,h),p||(m=ce(t,"change",v),p=!0)},p(b,E){n=b,E&24&&(t.checked=n[4][n[7]]),E&8&&l!==(l=n[7]+"")&&Me(s,l),_===(_=d(n,E))&&y?y.p(n,E):(y.d(1),y=_(n),y&&(y.c(),y.m(u,null)))},d(b){b&&M(e),y.d(),p=!1,m()}}}function Tu(n){let e,i,t,r,o,a,l,s,f,u,c,h,p,m,v,d,_,y,b,E=n[0].trim()+"",N,S=Object.entries(n[3]),A=[];for(let x=0;x<S.length;x+=1)A[x]=Mi(Ti(n,S,x));return{c(){e=H("div"),i=H("div"),t=H("div"),r=de("PREVIEW"),o=re(),a=H("div"),l=de(n[1]),s=re(),f=H("div"),u=de("selected"),c=re(),h=H("div"),p=de(n[2]),m=re(),v=H("div"),d=de("uniforms"),_=re();for(let x=0;x<A.length;x+=1)A[x].c();y=re(),b=H("pre"),N=de(E),this.h()},l(x){e=q(x,"DIV",{class:!0});var w=X(e);i=q(w,"DIV",{class:!0});var I=X(i);t=q(I,"DIV",{class:!0});var L=X(t);r=pe(L,"PREVIEW"),L.forEach(M),o=ie(I),a=q(I,"DIV",{class:!0});var C=X(a);l=pe(C,n[1]),C.forEach(M),s=ie(I),f=q(I,"DIV",{class:!0});var j=X(f);u=pe(j,"selected"),j.forEach(M),c=ie(I),h=q(I,"DIV",{class:!0});var Y=X(h);p=pe(Y,n[2]),Y.forEach(M),m=ie(I),v=q(I,"DIV",{class:!0});var ae=X(v);d=pe(ae,"uniforms"),ae.forEach(M),_=ie(I);for(let se=0;se<A.length;se+=1)A[se].l(I);I.forEach(M),y=ie(w),b=q(w,"PRE",{class:!0});var V=X(b);N=pe(V,E),V.forEach(M),w.forEach(M),this.h()},h(){R(t,"class","bold"),R(a,"class",""),R(f,"class","bold"),R(h,"class",""),R(v,"class","bold"),R(i,"class","flex column p1"),R(b,"class","monospace p1 pl3 grow filled overflow-auto f2 rel"),R(e,"class","flex row")},m(x,w){te(x,e,w),P(e,i),P(i,t),P(t,r),P(i,o),P(i,a),P(a,l),P(i,s),P(i,f),P(f,u),P(i,c),P(i,h),P(h,p),P(i,m),P(i,v),P(v,d),P(i,_);for(let I=0;I<A.length;I+=1)A[I].m(i,null);P(e,y),P(e,b),P(b,N)},p(x,[w]){if(w&2&&Me(l,x[1]),w&4&&Me(p,x[2]),w&24){S=Object.entries(x[3]);let I;for(I=0;I<S.length;I+=1){const L=Ti(x,S,I);A[I]?A[I].p(L,w):(A[I]=Mi(L),A[I].c(),A[I].m(i,null))}for(;I<A.length;I+=1)A[I].d(1);A.length=S.length}w&1&&E!==(E=x[0].trim()+"")&&Me(N,E)},i:Pe,o:Pe,d(x){x&&M(e),Xe(A,x)}}}function Au(n,e,i){let t,r,o,a,l;he(n,nn,u=>i(5,t=u)),he(n,Dn,u=>i(1,r=u)),he(n,nt,u=>i(2,o=u)),he(n,ue,u=>i(3,a=u)),he(n,Ht,u=>i(4,l=u));let s="";function f(u){l[u]=this.checked,Ht.set(l)}return n.$$.update=()=>{n.$$.dirty&32&&(u=>{i(0,s=jr("	"))})()},[s,r,o,a,l,t,f]}class Ru extends Ce{constructor(e){super(),De(this,e,Au,Tu,Le,{})}}const Mu=n=>{const e=ye(ue),i=hr();let t=[];return Bn(r=>{var o,a,l,s;if(((a=(o=r.schema)==null?void 0:o.PASSES)==null?void 0:a.length)>0)for(let f=0;f<((s=(l=r.schema)==null?void 0:l.PASSES)==null?void 0:s.length);f++)t.push({...r,uuid:r.uuid,pass:f});t.push(r)}),[{type:ct.FUNC,name:"main",prepend:"void",body:(r=>{let o="";o+=`vec2 POS_NORM = POSITION_NORM();
`,o+=`vec2 POS_FRAG = POSITION_FRAG();
`,o+=`vec4 BG = vec4(0.0); // GRID(0.02, POS_FRAG);
`,o+=`vec4 temp = BG;
`;let a=0,l,s;return t.forEach((f,u)=>{var b,E;const c=u==t.length-1,h=i.indexOf(f.uuid)!=-1||c,p=f.name=="Channel",m=Dr((b=t[s])==null?void 0:b.uuid),v=Dr((E=t[l])==null?void 0:E.uuid),d=p?m:v,_=N=>{if(N<0||N==null)return"BG";const S=ei(N);return i.indexOf(S)!=-1?`IMG_NORM_PIXEL(${S}, POS_NORM)`:S},y=N=>{let S="";if(f.source){const A=f.uuid+"Index",x=f.uuid+"Rows";f.uuid+"";const w=`(1. / float(${x} ))`,I=`(${w} * float(${A}) )`;S+="texture2D(",S+=f.uuid+"Src",S+=`, (POS_NORM * vec2( ${w}, 1.0) + vec2(${I},0.0) ))`}else{let A=[_(v),a,"POS_NORM","POS_FRAG"];for(const[x,w]of Object.entries(f.schema.INPUTS)){const I=x==Qt.BL_AMT||x==Qt.BL_MODE;if(!w.ignore&&!I)if(w.gui=="OpSelect"){const L=e[f.uuid+x],C=_(L);A.push(C)}else A.push(f.uuid+x)}S+=f.name,f.schema.PASS&&(S+=f.uuid),S+="(",S+=A.join(","),S+=")"}return S};o+=`
/* ${h?"PASS":""} ${p?"CHANNEL	":""} ${f.name} ${f.uuid}  */
`,o+=`temp = ${y()};
`,o+=h?"gl_FragColor = ":f.uuid+" = ",o+="MAKE_PASS( ",o+=`${f.uuid}${Qt.BL_MODE}`,o+=`, ${d?_(d):BG}`,o+=", temp",o+=`, ${f.uuid}${Qt.BL_AMT})`,o+=`;
`,h&&(o+=`if ( PASSINDEX == ${a} ) { return; }
`,a+=1),l=u,p&&(s=u)}),o})()}]},Pu=n=>`



float CLAMP( float v, float min, float max ) {

    if (v > max) v = max;
    if (v < min) v = min;
    return v;
}


// wenn yu perfekt lieber Gott boese (Nam june Paik 1963)

#define COLOR_MAP(f, a, b) vec3(f(a.r, b.r), f(a.g, b.g), f(a.b, b.b))
#define PI 3.14159265358979323846264338327
#define HPI 1.5707963267948966

/*  EXPERIMENTAL CONVOLUTION

varying vec2 VTC_11;
varying vec2 VTC_00;
varying vec2 VTC_02;
varying vec2 VTC_20;
varying vec2 VTC_22;
*/


vec3 SRGB2LIN(vec3 c) { return c*c; }
vec3 LIN2SRGB(vec3 c) { return sqrt(c); }

//note: uniform pdf rand [0;1]

float HASH12N(vec2 p)
{
    p  = fract(p * vec2(5.3987, 5.4421));
    p += dot(p.yx, p.xy + vec2(21.5351, 14.3137));
    return fract(p.x * p.y * 95.4307);
}

vec2 PIXELATE( vec2 coord, vec2 size ) {
    return floor( coord / size ) * size;
}

float ADD(float a, float b) { return min(a + b, 1.0); }
float COLORBURN(float a, float b) { return (b == 0.0) ? b : max((1.0 - ((1.0 - a) / b)), 0.0); }
float DARKEN(float a, float b) { return min(b, a); }
float LIGHTEN(float a, float b) { return max(b, a); }
float PIN(float a, float b) { return (b < 0.5) ? DARKEN(a, (2.0 * b)) : LIGHTEN(a , (2.0 * (b - 0.5))); }
float COLORDODGE(float a, float b) { return (b == 1.0) ? b : min(a / (1.0 - b), 1.0); }
float REFLECT(float a, float b) { return (b == 1.0) ? b : min(a * a / (1.0 - b), 1.0); }
float VIVID(float a, float b) { return (b < 0.5) ? COLORBURN(a, (2.0 * b)) : COLORDODGE(a, (2.0 * (b - 0.5))); }
float HARD_MIX(float a, float b) { return (VIVID(a, b) < 0.5) ? 0.0 : 1.0; }
float OVERLAY(float a, float b) { return a < 0.5 ? (2.0 * a * b) : (1.0 - 2.0 * (1.0 - a) * (1.0 - b)); }
float DODGE(float a, float b) { return min(a + b, 1.0); }
float SCREEN(float a, float b) { return 1.0 - ((1.0 - a) * (1.0 - b)); }
float SOFT(float a, float b) { return (b < 0.5) ? (2.0 * a * b + a * a * (1.0 - 2.0 * b)) : (sqrt(a) * (2.0 * b - 1.0) + 2.0 * a * (1.0 - b)); }
float SUBTRACT(float a, float b) { return max(a + b - 1.0, 0.0); }
float LINEAR(float a, float b) { return b < 0.5 ? SUBTRACT(a, (2.0 * b)) : DODGE(a, (2.0 * (b - 0.5))); }

float SUM_RGBA( vec4 v ) {
    return v.r + v.g + v.b;
}

float SUM_RGB( vec3 v ) {
    return v.r + v.g + v.b;
}

float PHI = 1.61803398874989484820459;  // \u03A6 = Golden Ratio  


float HASH(float n) { return fract(sin(n) * 1e4); }
float HASH(vec2 p) { return fract(1e4 * sin(17.0 * p.x + p.y * 0.1) * (0.1 + abs(sin(p.y * 13.0 + p.x)))); }


vec3 GAMMA_CORRECT(vec3 color, float gamma){
    return pow(color, vec3(1.0/gamma));
}

vec3 LEVEL_RANGE(vec3 color, float minInput, float maxInput){
    return min(max(color - vec3(minInput), vec3(0.0)) / (vec3(maxInput) - vec3(minInput)), vec3(1.0));
}

vec3 LEVELS(vec3 color, float minInput, float gamma, float maxInput){
    return GAMMA_CORRECT(LEVEL_RANGE(color, minInput, maxInput), gamma);
}

float RANDOM(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

vec2 NORM_TO_VEC2( vec2 xy ) {

    xy.x = ( ( xy.x * 2.0 ) - 1.0 );
    xy.y = ( ( xy.y * 2.0 ) - 1.0 );
    return xy;
}
vec2 NORM_TO_VEC2( float x, float y ) {


    x = ( ( x * 2.0 ) - 1.0 );
    y = ( ( y * 2.0 ) - 1.0 );
    return vec2(x,y);
}

float BRIGHT( vec4 xyz ) {

    return (xyz.r + xyz.g + xyz.b)/3.0;
}

float MAP(float oldValue, float oldMin, float oldMax, float newMin, float newMax) {
    float oldRange = oldMax - oldMin;
    float newRange = newMax - newMin;

    float newVal = ((oldValue - oldMin) * newRange / oldRange) + newMin;
    return newVal;
}

float MAP(float oldValue, float oldMin, float oldMax, float newMin, float newMax, bool clamp) {
    float oldRange = oldMax - oldMin;
    float newRange = newMax - newMin;

    float newVal = ((oldValue - oldMin) * newRange / oldRange) + newMin;
    if (clamp) return CLAMP(newVal, min(newMin,newMax), max(newMin,newMax));
    return newVal;
}


float FMOD( float a, float b ) {
    return a - b * floor(a/b);
}


int WITHIN(float value, float low, float high) {
  bool a = value > low && value < high;
  bool b = value + 1.0 > low && value + 1.0 < high;
  bool c = value - 1.0 > low && value - 1.0 < high;
  if (a) return 1;
  if (b) return 2;
  if (c) return 3;
  return 0;
}


vec2 INTERSECTION(vec2 a,vec2 b,vec2 c,vec2 d) {
    float ua, ub, denom = (d.y - c.y)*(b.x - a.x) - (d.x - c.x)*(b.y - a.y);
    if (denom == 0.0) return vec2(-1.0,-1.0);
    ua = ((d.x - c.x)*(a.y - c.y) - (d.y - c.y)*(a.x - c.x))/denom;
    ub = ((b.x - a.x)*(a.y - c.y) - (b.y - a.y)*(a.x - c.x))/denom;
    return vec2(
        a.x + ua * (b.x - a.x),
        a.y + ua * (b.y - a.y)
    );
}
vec2 INTERLACE_VEC2(vec2 pointA, vec2 pointB, vec2 pointC, vec2 pointD) {

  float z1 = (pointA.x - pointB.x);
  float z2 = (pointC.x - pointD.x);
  float z3 = (pointA.y - pointB.y);
  float z4 = (pointC.y - pointD.y);
  float dist = z1 * z4 - z3 * z2;
  vec2 blank = vec2(-1.0,-1.0);
  if (dist == 0.0) {
    return blank;
  }
  float tempA = (pointA.x * pointB.y - pointA.y * pointB.x);
  float tempB = (pointC.x * pointD.y - pointC.y * pointD.x);
  float xCoor = (tempA * z2 - z1 * tempB) / dist;
  float yCoor = (tempA * z4 - z3 * tempB) / dist;

  return vec2(xCoor, yCoor);
}

vec2 ROTATE_VEC2(vec2 origin, vec2 point, float angle) {
  float rad = (PI / 180.0) * angle;
  float _cos = cos(rad);
  float _sin = sin(rad);
  float run = point.x - origin.x;
  float rise = point.y - origin.y;
  float cx = (_cos * run) + (_sin * rise) + origin.x;
  float cy = (_cos * rise) - (_sin * run) + origin.y;
  return vec2(
    cx,
    cy
  );
}


float ANGLE( vec2 a, vec2 b ) {
    return ((atan(b.y - a.y, b.x - a.x)  * 360.0 / PI) + 360.0) / 2.0;
}

vec2 VEC2_FROM_ANGLE(vec2 xy, float angle, float dist) {
    float x = cos(angle * PI / 180.0) * dist + xy.x;
    float y = sin(angle * PI / 180.0) * dist + xy.y;
    return vec2(x,y);
}


vec2 VEC2_POLAR( vec2 a, vec2 b, vec2 c) {

    float slope = (a.y - b.y) / (a.x - b.x);
    float m = -1.0 / slope;
    float x = (m * c.x - c.y - slope * a.x + a.y) / (m - slope);
    float y = m * x - m * c.x + c.y;
    return vec2(x,y);
}

float VEC2_POLAR_DIST(vec2 a, vec2 b, vec2 c) {

    return ((c.x - a.x)*(b.x - a.x) + (c.y - a.y)*(b.y - a.y)) /
    (pow(b.x - a.x, 2.0) + pow(b.y - a.y, 2.0));
}



vec3 CMYK_TO_RGB (vec4 cmyk) {
    float c = cmyk.x;
    float m = cmyk.y;
    float y = cmyk.z;
    float k = cmyk.w;

    float invK = 1.0 - k;
    float r = 1.0 - min(1.0, c * invK + k);
    float g = 1.0 - min(1.0, m * invK + k);
    float b = 1.0 - min(1.0, y * invK + k);
    return clamp(vec3(r, g, b), 0.0, 1.0);
}

vec4 RGB_TO_CMYK (vec3 rgb) {
    float r = rgb.r;
    float g = rgb.g;
    float b = rgb.b;
    float k = min(1.0 - r, min(1.0 - g, 1.0 - b));
    vec3 cmy = vec3(0.0);
    float invK = 1.0 - k;
    if (invK != 0.0) {
        cmy.x = (1.0 - r - k) / invK;
        cmy.y = (1.0 - g - k) / invK;
        cmy.z = (1.0 - b - k) / invK;
    }
    return clamp(vec4(cmy, k), 0.0, 1.0);
}

vec3 RGB_TO_HSL(vec3 color) {
    vec3 hsl; // init to 0 to avoid warnings ? (and reverse if + remove first part)

    float fmin = min(min(color.r, color.g), color.b); //Min. value of RGB
    float fmax = max(max(color.r, color.g), color.b); //Max. value of RGB
    float delta = fmax - fmin; //Delta RGB value

    hsl.z = (fmax + fmin) / 2.0; // Luminance

    if (delta == 0.0) //This is a gray, no chroma...
    {
        hsl.x = 0.0; // Hue
        hsl.y = 0.0; // Saturation
    } else //Chromatic data...
    {
        if (hsl.z < 0.5)
            hsl.y = delta / (fmax + fmin); // Saturation
        else
            hsl.y = delta / (2.0 - fmax - fmin); // Saturation

        float deltaR = (((fmax - color.r) / 6.0) + (delta / 2.0)) / delta;
        float deltaG = (((fmax - color.g) / 6.0) + (delta / 2.0)) / delta;
        float deltaB = (((fmax - color.b) / 6.0) + (delta / 2.0)) / delta;

        if (color.r == fmax)
            hsl.x = deltaB - deltaG; // Hue
        else if (color.g == fmax)
            hsl.x = (1.0 / 3.0) + deltaR - deltaB; // Hue
        else if (color.b == fmax)
            hsl.x = (2.0 / 3.0) + deltaG - deltaR; // Hue

        if (hsl.x < 0.0)
            hsl.x += 1.0; // Hue
        else if (hsl.x > 1.0)
            hsl.x -= 1.0; // Hue
    }

    return hsl;
}

float HUE_TO_RGB(float f1, float f2, float hue) {
    if (hue < 0.0)
        hue += 1.0;
    else if (hue > 1.0)
        hue -= 1.0;
    float res;
    if ((6.0 * hue) < 1.0)
        res = f1 + (f2 - f1) * 6.0 * hue;
    else if ((2.0 * hue) < 1.0)
        res = f2;
    else if ((3.0 * hue) < 2.0)
        res = f1 + (f2 - f1) * ((2.0 / 3.0) - hue) * 6.0;
    else
        res = f1;
    return res;
}

vec3 HSL_TO_RGB(vec3 hsl) {
    vec3 rgb;
    
    if (hsl.y == 0.0) {
        rgb = vec3(hsl.z); // Luminance
    } else {
        float f2;
        
        if (hsl.z < 0.5)
            f2 = hsl.z * (1.0 + hsl.y);
        else
            f2 = hsl.z + hsl.y - hsl.y * hsl.z;
            
        float f1 = 2.0 * hsl.z - f2;
        
        rgb.r = HUE_TO_RGB(f1, f2, hsl.x + (1.0/3.0));
        rgb.g = HUE_TO_RGB(f1, f2, hsl.x);
        rgb.b = HUE_TO_RGB(f1, f2, hsl.x - (1.0/3.0));
    }   
    return rgb;
}

vec3 HSL_TO_RGB(float h, float s, float l) {
    return HSL_TO_RGB(vec3(h, s, l));
}


vec3 RGB_SHIFT(vec3 color, float hue) {
    hue *= 6.28318530718;
    const vec3 k = vec3(0.57735, 0.57735, 0.57735);
    float cosAngle = cos(hue);
    return vec3(color * cosAngle + cross(k, color) * sin(hue) + k * dot(k, color) * (1.0 - cosAngle));
}

vec3 HSV_TO_RGB(vec3 c)
{
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}

vec3 RGB_TO_HSV(vec3 rgb) {
    float Cmax = max(rgb.r, max(rgb.g, rgb.b));
    float Cmin = min(rgb.r, min(rgb.g, rgb.b));
    float delta = Cmax - Cmin;

    vec3 hsv = vec3(0., 0., Cmax);

    if (Cmax > Cmin) {
        hsv.y = delta / Cmax;

        if (rgb.r == Cmax)
            hsv.x = (rgb.g - rgb.b) / delta;
        else {
            if (rgb.g == Cmax)
                hsv.x = 2. + (rgb.b - rgb.r) / delta;
            else
                hsv.x = 4. + (rgb.r - rgb.g) / delta;
        }
        hsv.x = fract(hsv.x / 6.);
    }
    return hsv;
}


vec3 GRID( float width, vec2 coord ) {
    float size = width * RENDERSIZE.x;
    vec3 a = HSL_TO_RGB( vec3(0.0,0.0,0.9) );
    vec3 b = HSL_TO_RGB( vec3(0.0,0.0,0.7) );

    if (size == 0.0)    {
        return a;
    } else if ((mod((coord.x / size),2.0) < 1.0)&&(mod((coord.y / size),2.0) > 1.0))  {
        return a;
    } else if ((mod((coord.x / size),2.0) > 1.0)&&(mod((coord.y / size),2.0) < 1.0))  {
        return a;
    }
    
    return b;

}

float SAW( float t ) {
    return 1.0-abs(2.*fract(t/PI)-1.);
}

float WAVE( float t, float shape, float amp, float exp ) {

    float sine = sin(t);
    float saw = SAW(t);
    return pow((mix(sine,saw,shape)*(1.+amp))-(amp/2.),exp);
}



`,ku=n=>{const e=ye(ue),i=ii(n.hide),t=[...hr().map(s=>({TARGET:s,WIDTH:"$WIDTH",HEIGHT:"$HEIGHT",PERSISTENT:!0})),{TARGET:"u999",WIDTH:"$WIDTH",HEIGHT:"$HEIGHT",PERSISTENT:!0}];let r=[],o=[{NAME:"inputImage",TYPE:"image"},{NAME:"Preview",TYPE:"bool",default:!1},{NAME:"PreviewSrc",TYPE:"long",default:-1}];Bn(s=>{let{x:f,y:u,name:c,uuid:h,schema:p,source:m}=s;for(const[v,d]of Object.entries(p.INPUTS)){const _=n.hide?i[h+v]:!1;if(!d.ignore&&!_){let y={...Da(d),NAME:h+v,LABEL:ti(s,v),DEFAULT:e[h+v]||d.default};d.labels&&(y.VALUES=d.labels.map((b,E)=>E)),o.push(y)}}for(let v of o)v.GUI=="Teleport"&&(v.LABELS=[...t.map(d=>d.TARGET)],v.MAX=t.length);r.indexOf(c)==-1&&r.push(c),u+=1});const a=t.map(s=>s.TARGET);return{DESCRIPTION:"COMPILED: "+new Date().toLocaleString().toUpperCase().replaceAll(/[&\/\\#,+()$~%.'":*?<>{}]/g,"_"),CREDIT:"MX",PERSISTENT_BUFFERS:a,CATEGORIES:r,INPUTS:o,PASSES:t}},Cu=n=>{ye(ue);let e={},i;return Bn(t=>{let{x:r,y:o,name:a,schema:l,source:s,uuid:f}=t,u=a;if(l.PASS&&(a+=f),!e[a]){let c=on[u].GLSL.split(`
`).map(p=>"	"+p).join(`
`);const h=i?i==null?void 0:i.uuid:"inputImage";c=c.replaceAll("TEXTURE",h),e[a]={type:ct.FUNC,name:a,prepend:"vec4",arguments:Ta(l.INPUTS),body:c}}i=t}),Object.values(e)},kt=(n,e)=>({name:e,type:n}),Du=n=>{const e=ye(ue),i=ii(n.hide),t={float:"float",image:"sampler2D",bool:"bool",event:"bool",long:"int",color:"vec4",point2D:"vec2"};let r=[];if(n.hide)for(const l of Rt()){const{schema:s,uuid:f}=l;for(const[u,c]of Object.entries(s.INPUTS))if(i[f+u]){const h=t[c.type],p=Ma(e[f+u]||c.default,h);r.push({type:ct.VAR,name:f+u,prepend:"const "+h,body:p})}}const o=hr();return[...Rt().filter(l=>o.indexOf(l.uuid)==-1).map(l=>({type:ct.VAR,name:l.uuid,prepend:"vec4"})),...r,{type:ct.VAR,name:"TOTAL_PASSES",prepend:"int",body:`${Fa()}`},{type:ct.FUNC,name:"POSITION_FRAG",prepend:"vec2",body:"return gl_FragCoord.xy;"},{type:ct.FUNC,name:"POSITION_NORM",prepend:"vec2",body:`
				vec2 p = isf_FragNormCoord;
				// p *= 2.;
				// if (p.y < 0.5) p.y = p.y * 1.5;
				return p;`},{type:ct.FUNC,name:"CENTER",arguments:[],prepend:"vec2",body:"return vec2( 0.5, 0.5 ) * RENDERSIZE;"},{type:ct.FUNC,name:"BLEND",arguments:[kt("int","mode"),kt("vec3","a"),kt("vec3","b"),kt("float","amount")],prepend:"vec3",body:`vec3 color;
`+Cs.map((l,s)=>`${s==0?"if":"else if"} (mode == ${s}) { color = ${l}(a, b); }`).join(`
`)+`
return mix(a, color, amount);`},{type:ct.FUNC,name:"MAKE_PASS",arguments:[kt("int","blendMode"),kt("vec4","srcA"),kt("vec4","srcB"),kt("float","slider")],prepend:"vec4",body:`
			float amt = slider * srcB.a;
			float first = clamp( amt * 2.0, 0.0, 1.0);
			float second = clamp( (amt - 0.5) * 2.0, 0.0, 1.0);

			vec3 blend = BLEND( blendMode, srcA.rgb, srcB.rgb, first);
			// 0.5 - 1.0 = 0.0 - 1.0
			return vec4( mix( blend, srcB.rgb, second), 1.0);
			`}]},Lu=(n,e)=>console.log(`[Compiler] ${n}`,e||""),Fr={JSON_CONFIG:ku,HELPERS:Pu,BLEND_MODES:sr,UTILS:Du,OPS:Cu,BODY:Mu},Fu=n=>"	"+n.trim().split(`
`).map(e=>e.trim()).join(`
	`),ur=n=>{n||(n={}),n.keys||(n.keys=Object.keys(Fr)),Lu(`\u{1F4DA} parsing ${n.keys.join(" ")}`),ye(ue);let e="";for(const i of n.keys){const t=Fr[i](n);t||SAT(`\u274C no such section called ${i}`),Array.isArray(t)?e+=t.map(r=>{let o="";return o+=`
${r.prepend} ${r.name}`,r.type==ct.VAR&&r.body&&(o+=" = "),r.type==ct.FUNC?(o+="( ",o+=(r.arguments||[]).map(a=>`${a.type} ${a.name}`).join(", "),o+=`) {
`,o+=`${Fu(r.body||"")}`):o+=`${r.body||""};`,r.type==ct.FUNC&&(o+=`
}`),o}).join(`
`):typeof t=="string"?e+=t:e+=`/*
${JSON.stringify(t,null,2)}
*/`}return e+=Mn.START,e+=jr(),e+=Mn.END,e};function Pi(n,e,i){const t=n.slice();return t[6]=e[i],t[8]=i,t}function ki(n,e,i){const t=n.slice();return t[9]=e[i],t}function Ci(n){let e,i=n[9]+"",t,r,o,a;function l(...s){return n[3](n[9],...s)}return{c(){e=H("button"),t=de(i),r=re(),this.h()},l(s){e=q(s,"BUTTON",{});var f=X(e);t=pe(f,i),r=ie(f),f.forEach(M),this.h()},h(){Fe(e,"filled",n[0]==n[9])},m(s,f){te(s,e,f),P(e,t),P(e,r),o||(a=ce(e,"mousedown",l),o=!0)},p(s,f){n=s,f&5&&Fe(e,"filled",n[0]==n[9])},d(s){s&&M(e),o=!1,a()}}}function Di(n){let e,i;return{c(){e=de(n[8]),i=H("br")},l(t){e=pe(t,n[8]),i=q(t,"BR",{})},m(t,r){te(t,e,r),te(t,i,r)},p:Pe,d(t){t&&M(e),t&&M(i)}}}function Uu(n){let e,i,t,r,o,a=n[1].trim()+"",l,s,f,u,c,h=["VERTEX","FRAGMENT","ISF",...n[2],"API"],p=[];for(let d=0;d<h.length;d+=1)p[d]=Ci(ki(n,h,d));let m=new Array(n[1].split(`
`).length),v=[];for(let d=0;d<m.length;d+=1)v[d]=Di(Pi(n,m,d));return{c(){e=H("div"),i=H("nav");for(let d=0;d<p.length;d+=1)p[d].c();t=re(),r=H("div"),o=H("pre"),l=de(a),s=de(`
			`),f=H("pre");for(let d=0;d<v.length;d+=1)v[d].c();u=de(`
			`),c=de(`
		`),this.h()},l(d){e=q(d,"DIV",{class:!0});var _=X(e);i=q(_,"NAV",{class:!0});var y=X(i);for(let S=0;S<p.length;S+=1)p[S].l(y);y.forEach(M),t=ie(_),r=q(_,"DIV",{class:!0});var b=X(r);o=q(b,"PRE",{class:!0});var E=X(o);l=pe(E,a),s=pe(E,`
			`),f=q(E,"PRE",{class:!0,style:!0});var N=X(f);for(let S=0;S<v.length;S+=1)v[S].l(N);u=pe(N,`
			`),N.forEach(M),c=pe(E,`
		`),E.forEach(M),b.forEach(M),_.forEach(M),this.h()},h(){R(i,"class","flex column br"),R(f,"class","abs l0 t0 mt1 plr0-5 fade"),ke(f,"user-select","none",1),R(o,"class","monospace whitespace-prewrap p1 pl3 grow filled overflow-auto f2 rel"),R(r,"class","overflow-auto h100pc"),R(e,"class","row flex")},m(d,_){te(d,e,_),P(e,i);for(let y=0;y<p.length;y+=1)p[y].m(i,null);P(e,t),P(e,r),P(r,o),P(o,l),P(o,s),P(o,f);for(let y=0;y<v.length;y+=1)v[y].m(f,null);P(f,u),P(o,c)},p(d,[_]){if(_&5){h=["VERTEX","FRAGMENT","ISF",...d[2],"API"];let y;for(y=0;y<h.length;y+=1){const b=ki(d,h,y);p[y]?p[y].p(b,_):(p[y]=Ci(b),p[y].c(),p[y].m(i,null))}for(;y<p.length;y+=1)p[y].d(1);p.length=h.length}if(_&2&&a!==(a=d[1].trim()+"")&&Me(l,a),_&2){m=new Array(d[1].split(`
`).length);let y;for(y=0;y<m.length;y+=1){const b=Pi(d,m,y);v[y]?v[y].p(b,_):(v[y]=Di(b),v[y].c(),v[y].m(f,u))}for(;y<v.length;y+=1)v[y].d(1);v.length=m.length}},i:Pe,o:Pe,d(d){d&&M(e),Xe(p,d),Xe(v,d)}}}function Bu(n,e,i){const t=window;let r="JSON_CONFIG",o="";const a=Object.keys(Fr),l=(s,f)=>i(0,r=s);return n.$$.update=()=>{n.$$.dirty&1&&(s=>{var f,u,c,h;s=="API"?i(1,o=Object.keys(Oi).map(p=>{const m=Oi[p];return console.log(Lr(m)),`${p}( ${Lr(m).join(", ")} )`}).join(`
`)):s=="FRAGMENT"?i(1,o=((u=(f=t==null?void 0:t.renderer)==null?void 0:f.parser)==null?void 0:u.fragmentShader)||(window==null?void 0:window.shaderSrc)||"// None"):s=="VERTEX"?i(1,o=((h=(c=t==null?void 0:t.renderer)==null?void 0:c.parser)==null?void 0:h.vertexShader)||"// None"):s=="ISF"?i(1,o=ur({hide:!0})):a.indexOf(s)!=-1&&i(1,o=ur({keys:[s],hide:!0}))})(r)},[r,o,a,l]}class ju extends Ce{constructor(e){super(),De(this,e,Bu,Uu,Le,{})}}var Xt=function(n,e,i){return n<64?e:i},Ut=function(n,e,i){return n===0?e:n===127?i:null},Vu=function(n,e){switch(n){case 0:return"bankselect";case 1:return"modulation";case 2:return"breathcontroller";case 4:return"footcontroller";case 5:return"portamentotime";case 6:return"dataentry";case 7:return"volume";case 8:return"balance";case 10:return"pan";case 11:return"expressioncontroller";case 12:return"effect1";case 13:return"effect2";case 16:return"generalpurposecontroller1";case 17:return"generalpurposecontroller2";case 18:return"generalpurposecontroller3";case 19:return"generalpurposecontroller4";case 32:return"bankselectfine";case 33:return"modulationfine";case 34:return"breathcontrollerfine";case 36:return"footcontrollerfine";case 37:return"portamentotimefine";case 38:return"dataentryfine";case 39:return"volumefine";case 40:return"balancefine";case 42:return"panfine";case 43:return"expressioncontrollerfine";case 44:return"effect1fine";case 45:return"effect2fine";case 48:return"generalpurposecontroller1fine";case 49:return"generalpurposecontroller2fine";case 50:return"generalpurposecontroller3fine";case 51:return"generalpurposecontroller4fine";case 64:return Xt(e,"sustainoff","sustainon");case 65:return Xt(e,"portamentooff","portamentoon");case 66:return Xt(e,"sostenutooff","sostenutoon");case 67:return Xt(e,"softoff","softon");case 68:return Xt(e,"legatooff","legatoon");case 69:return Xt(e,"hold2off","hold2on");case 70:return"soundcontroller1";case 71:return"soundcontroller2";case 72:return"soundcontroller3";case 73:return"soundcontroller4";case 74:return"soundcontroller5";case 75:return"soundcontroller6";case 76:return"soundcontroller7";case 77:return"soundcontroller8";case 78:return"soundcontroller9";case 79:return"soundcontroller10";case 80:return"generalpurposecontroller5";case 81:return"generalpurposecontroller6";case 82:return"generalpurposecontroller7";case 83:return"generalpurposecontroller8";case 84:return"portamentocontrol";case 91:return"effectdepth1";case 92:return"effectdepth2";case 93:return"effectdepth3";case 94:return"effectdepth4";case 95:return"effectdepth5";case 96:return"dataincrement";case 97:return"datadecrement";case 98:return"nonregisteredparameternumberfine";case 99:return"nonregisteredparameternumber";case 100:return"registeredparameternumberfine";case 101:return"registeredparameternumber"}return null},Gu=function(n,e){switch(n){case 120:return Ut(e,"allsoundoff",null);case 121:return Ut(e,"resetallcontrollers",null);case 122:return Ut(e,"localcontroloff","localcontrolon");case 123:return Ut(e,"allnotesoff",null);case 124:return Ut(e,"omnimodeoff",null);case 125:return Ut(e,"omnimodeon",null);case 126:return"monomodeon";case 127:return Ut(e,"polymodeon",null)}return null},Hu=Math.pow(2,7),zn=Math.pow(Hu,2)/2;function Ua(n){var e=n[0],i=n[1],t=n[2],r={messageCode:240&e,channel:1+(15&e)};switch(r.messageCode){case 128:return Object.assign({},r,{messageType:"noteoff",key:i,velocity:t});case 144:return Object.assign({},r,{messageType:t===0?"noteoff":"noteon",key:i,velocity:t});case 160:return Object.assign({},r,{messageType:"keypressure",key:i,pressure:t});case 176:return i<120?Object.assign({},r,{messageType:"controlchange",controlNumber:i,controlFunction:Vu(i,t),controlValue:t}):Object.assign({},r,{messageType:"channelmodechange",controlNumber:i,channelModeMessage:Gu(i,t),controlValue:t});case 192:return Object.assign({},r,{messageType:"programchange",program:i});case 208:return Object.assign({},r,{messageType:"channelpressure",pressure:i});case 224:var o=(t<<7)+i;return Object.assign({},r,{messageType:"pitchbendchange",pitchBend:o,pitchBendMultiplier:(o-zn)/(o<=zn?zn:zn-1)});default:return Object.assign({},r,{messageType:"unknown",data1:i,data2:t})}}const fr=(n,e)=>console.log(`[MIDI] \u{1F39B} ${n}`,e||""),tn={CC:"controlchange",NOTE:"note",NOTEON:"noteon",NOTEOFF:"noteoff"};let kn={},Ur={};const qu=.92;function Ba(){const n=ye(bt);for(const[e,i]of Object.entries(n))for(const t of i)if(Ur[t]!=null){let r=qu;kn[t]=kn[t]*r+Ur[t]*(1-r),ja(e,kn[t])}window.requestAnimationFrame(Ba)}function zu(n){const{manufacturer:e,name:i}=n.target,t=Ua(n.data),{messageCode:r,controlFunction:o,messageType:a,controlNumber:l,controlValue:s,channel:f,key:u,velocity:c}=t;return tn.CC==a?[e,i,f,a,l].join(":"):tn.NOTEON==a||tn.NOTEOFF==a?[e,i,f,tn.NOTE,u].join(":"):null}function ja(n,e){const i=n.split(":"),t=i[0],r=parseInt(i[1]),o=ye(kr),a=o==null?void 0:o[t];if(!a)return fr(`\u274C no lookup for ${t}`);const{min:l,max:s,type:f}=a;let u=ye(ue);a.type=="float"?u[t]=nr(e,0,127,l,s):a.type=="point2D"||a.type=="color"?(u[t],u[t][r]=nr(e,0,127,l[r],s[r])):a.type=="long"?u[t]=nr(e,0,127,0,a.labels.length):a.type=="bool"&&(u[t]=!u[t]),ue.set(u)}function Xu(n){const e=ye($t);let i=ye(bt);const t=zu(n);e&&(i[e]||(i[e]=[]),i[e].indexOf(t)!=-1?alert("this assignment already exists."):(fr(`adding assignment ${t} to ${e}`),i[e]=[...i[e],t]),bt.set(i),$t.set(!1),Zt.set(!1));for(const[r,o]of Object.entries(i))if(o.indexOf(t)!=-1){const a=Ua(n.data),{messageCode:l,controlFunction:s,messageType:f,controlNumber:u,controlValue:c,channel:h,key:p,velocity:m}=a;tn.CC==f?(kn[t]||(kn[t]=c),Ur[t]=c):tn.NOTEON==f&&ja(r,m)}}async function Wu(){const n=await navigator.requestMIDIAccess();fr("requesting MIDI devices");for(const[e,i]of n.inputs)i.onmidimessage=Xu,fr(`\u2705 attached ${i.manufacturer} ${i.name}`);window.requestAnimationFrame(Ba)}function Li(n,e,i){const t=n.slice();return t[3]=e[i][0],t[4]=e[i][1],t}function Fi(n){let e,i,t=n[3]+"",r,o,a,l=n[4]+"",s,f,u,c,h,p;function m(...v){return n[2](n[3],...v)}return{c(){e=H("div"),i=H("div"),r=de(t),o=re(),a=H("div"),s=de(l),f=re(),u=H("button"),c=re(),this.h()},l(v){e=q(v,"DIV",{class:!0});var d=X(e);i=q(d,"DIV",{class:!0});var _=X(i);r=pe(_,t),_.forEach(M),o=ie(d),a=q(d,"DIV",{class:!0});var y=X(a);s=pe(y,l),y.forEach(M),f=ie(d),u=q(d,"BUTTON",{class:!0});var b=X(u);b.forEach(M),c=ie(d),d.forEach(M),this.h()},h(){R(i,"class","bold"),R(a,"class",""),R(u,"class","cross h2em"),R(e,"class","flex row-space-between-center")},m(v,d){te(v,e,d),P(e,i),P(i,r),P(e,o),P(e,a),P(a,s),P(e,f),P(e,u),P(e,c),h||(p=ce(u,"click",m),h=!0)},p(v,d){n=v,d&1&&t!==(t=n[3]+"")&&Me(r,t),d&1&&l!==(l=n[4]+"")&&Me(s,l)},d(v){v&&M(e),h=!1,p()}}}function Yu(n){let e,i=Object.entries(n[0]),t=[];for(let r=0;r<i.length;r+=1)t[r]=Fi(Li(n,i,r));return{c(){e=H("div");for(let r=0;r<t.length;r+=1)t[r].c();this.h()},l(r){e=q(r,"DIV",{id:!0,class:!0});var o=X(e);for(let a=0;a<t.length;a+=1)t[a].l(o);o.forEach(M),this.h()},h(){R(e,"id","assignments"),R(e,"class","flex column-stretch-flex-start p1")},m(r,o){te(r,e,o);for(let a=0;a<t.length;a+=1)t[a].m(e,null)},p(r,[o]){if(o&3){i=Object.entries(r[0]);let a;for(a=0;a<i.length;a+=1){const l=Li(r,i,a);t[a]?t[a].p(l,o):(t[a]=Fi(l),t[a].c(),t[a].m(e,null))}for(;a<t.length;a+=1)t[a].d(1);t.length=i.length}},i:Pe,o:Pe,d(r){r&&M(e),Xe(t,r)}}}function Ju(n,e,i){let t;he(n,bt,a=>i(0,t=a)),sn(async a=>{await Wu()});function r(a){delete t[a],bt.set(t)}return[t,r,(a,l)=>r(a)]}class Ku extends Ce{constructor(e){super(),De(this,e,Ju,Yu,Le,{})}}function Ui(n,e,i){const t=n.slice();return t[12]=e[i][0],t[13]=e[i][1],t}function Bi(n,e,i){const t=n.slice();return t[12]=e[i][0],t[13]=e[i][1],t}function ji(n,e,i){const t=n.slice();return t[12]=e[i],t}function Vi(n){let e,i=n[12].split(":")[0]+"",t,r;return{c(){e=H("div"),t=de(i),r=re(),this.h()},l(o){e=q(o,"DIV",{style:!0,class:!0});var a=X(e);t=pe(a,i),r=ie(a),a.forEach(M),this.h()},h(){ke(e,"background","var(--blue5-0)"),R(e,"class","bt p0-5 bold grow w100pc h40px flex row-flex-start-center")},m(o,a){te(o,e,a),P(e,t),P(e,r)},p(o,a){a&1&&i!==(i=o[12].split(":")[0]+"")&&Me(t,i)},d(o){o&&M(e)}}}function Gi(n){let e,i=n[13].name+"",t,r,o,a;function l(...s){return n[8](n[12],...s)}return{c(){e=H("button"),t=de(i),r=re(),this.h()},l(s){e=q(s,"BUTTON",{class:!0});var f=X(e);t=pe(f,i),r=ie(f),f.forEach(M),this.h()},h(){R(e,"class","grow"),Fe(e,"filled",n[1]==n[12])},m(s,f){te(s,e,f),P(e,t),P(e,r),o||(a=ce(e,"click",l),o=!0)},p(s,f){n=s,f&10&&Fe(e,"filled",n[1]==n[12])},d(s){s&&M(e),o=!1,a()}}}function Hi(n){let e,i,t,r;var o=n[13].view;function a(l){return{}}return o&&(i=new o(a())),{c(){e=H("section"),i&&we(i.$$.fragment),t=re(),this.h()},l(l){e=q(l,"SECTION",{id:!0,class:!0});var s=X(e);i&&Oe(i.$$.fragment,s),t=ie(s),s.forEach(M),this.h()},h(){R(e,"id",n[12]),R(e,"class","flex column grow"),Fe(e,"none",n[12]!=n[1])},m(l,s){te(l,e,s),i&&Ee(i,e,null),P(e,t),r=!0},p(l,s){if(o!==(o=l[13].view)){if(i){rt();const f=i;oe(f.$$.fragment,1,0,()=>{Ne(f,1)}),it()}o?(i=new o(a()),we(i.$$.fragment),ee(i.$$.fragment,1),Ee(i,e,t)):i=null}(!r||s&10)&&Fe(e,"none",l[12]!=l[1])},i(l){r||(i&&ee(i.$$.fragment,l),r=!0)},o(l){i&&oe(i.$$.fragment,l),r=!1},d(l){l&&M(e),i&&Ne(i)}}}function Zu(n){let e,i,t,r,o,a,l,s,f,u=n[0],c=[];for(let y=0;y<u.length;y+=1)c[y]=Vi(ji(n,u,y));let h={};t=new ha({props:h}),n[7](t);let p=Object.entries(n[3]),m=[];for(let y=0;y<p.length;y+=1)m[y]=Gi(Bi(n,p,y));let v=Object.entries(n[3]),d=[];for(let y=0;y<v.length;y+=1)d[y]=Hi(Ui(n,v,y));const _=y=>oe(d[y],1,1,()=>{d[y]=null});return{c(){e=H("div");for(let y=0;y<c.length;y+=1)c[y].c();i=re(),we(t.$$.fragment),r=re(),o=H("div"),a=H("nav");for(let y=0;y<m.length;y+=1)m[y].c();l=re(),s=H("article");for(let y=0;y<d.length;y+=1)d[y].c();this.h()},l(y){e=q(y,"DIV",{id:!0,style:!0,class:!0});var b=X(e);for(let A=0;A<c.length;A+=1)c[A].l(b);b.forEach(M),i=ie(y),Oe(t.$$.fragment,y),r=ie(y),o=q(y,"DIV",{id:!0,class:!0});var E=X(o);a=q(E,"NAV",{style:!0,class:!0});var N=X(a);for(let A=0;A<m.length;A+=1)m[A].l(N);N.forEach(M),l=ie(E),s=q(E,"ARTICLE",{class:!0});var S=X(s);for(let A=0;A<d.length;A+=1)d[A].l(S);S.forEach(M),E.forEach(M),this.h()},h(){R(e,"id","drag-visualiser"),ke(e,"bottom","-100%"),R(e,"class","pop w80px fixed b0 l0 bl bb br flex column-center-center z-index66"),Fe(e,"none",!n[0]),ke(a,"background","var(--blue5-0)"),R(a,"class","flex bb fixed t0 l0 w100pc z-index44 none"),R(s,"class","flex column grow overflow-auto"),R(o,"id","app"),R(o,"class","app mxz dark flex row-stretch-stretch")},m(y,b){te(y,e,b);for(let E=0;E<c.length;E+=1)c[E].m(e,null);te(y,i,b),Ee(t,y,b),te(y,r,b),te(y,o,b),P(o,a);for(let E=0;E<m.length;E+=1)m[E].m(a,null);P(o,l),P(o,s);for(let E=0;E<d.length;E+=1)d[E].m(s,null);f=!0},p(y,[b]){if(b&1){u=y[0];let N;for(N=0;N<u.length;N+=1){const S=ji(y,u,N);c[N]?c[N].p(S,b):(c[N]=Vi(S),c[N].c(),c[N].m(e,null))}for(;N<c.length;N+=1)c[N].d(1);c.length=u.length}(!f||b&1)&&Fe(e,"none",!y[0]);const E={};if(t.$set(E),b&10){p=Object.entries(y[3]);let N;for(N=0;N<p.length;N+=1){const S=Bi(y,p,N);m[N]?m[N].p(S,b):(m[N]=Gi(S),m[N].c(),m[N].m(a,null))}for(;N<m.length;N+=1)m[N].d(1);m.length=p.length}if(b&10){v=Object.entries(y[3]);let N;for(N=0;N<v.length;N+=1){const S=Ui(y,v,N);d[N]?(d[N].p(S,b),ee(d[N],1)):(d[N]=Hi(S),d[N].c(),ee(d[N],1),d[N].m(s,null))}for(rt(),N=v.length;N<d.length;N+=1)_(N);it()}},i(y){if(!f){ee(t.$$.fragment,y);for(let b=0;b<v.length;b+=1)ee(d[b]);f=!0}},o(y){oe(t.$$.fragment,y),d=d.filter(Boolean);for(let b=0;b<d.length;b+=1)oe(d[b]);f=!1},d(y){y&&M(e),Xe(c,y),y&&M(i),n[7](null),Ne(t,y),y&&M(r),y&&M(o),Xe(m,y),Xe(d,y)}}}function Qu(n,e,i){let t,r,o,a;he(n,nn,v=>i(1,t=v)),he(n,nt,v=>i(6,r=v)),he(n,Pn,v=>i(9,o=v)),he(n,Dn,v=>i(10,a=v));const l=(v,d)=>console.log(`[App] ${v}`,d||"");let{application:s}=e,f=[],u=!1,c;sn(async v=>{l(`getting current view ${t}`),i(5,u=!0),c.addBindings([{command:["Tab"],action:d=>{}},{command:[Bt,"f"],action:d=>{ge(Pn,o=!o,o),d.preventDefault()}},{command:[Bt,"d"],action:d=>{console.log("CAPTURING IMAGE"),window.captureImage(),d.preventDefault(),d.stopPropagation()}},{command:[Ms],action:d=>{o&&ge(Pn,o=!1,o),d.preventDefault()}},...Object.values(zt).map((d,_)=>({command:[Bt,_+1+""],action:y=>{ge(nn,t=Object.values(zt)[_],t),y.preventDefault()}})),{command:["Backspace"],action:d=>{var _,y,b,E;r&&(l("\u{1F6A9} deleting",r),((_=r==null?void 0:r[0])==null?void 0:_[0])!=null&&((y=r==null?void 0:r[0])==null?void 0:y[1])!=null&&(ri(lt.BIN,(b=r==null?void 0:r[0])==null?void 0:b[0],(E=r==null?void 0:r[0])==null?void 0:E[1]),Qr(),window.requestAnimationFrame(N=>{yt.set(Tt.COMPILE)})))}}])});const h={[zt.APPLICATION]:{name:"Application",view:s},[zt.ASSIGNMENTS]:{name:"Assignments",view:Ku},[zt.DEBUG_SHADER]:{name:"Shader (Debug)",view:ju},[zt.DEBUG_SYSTEM]:{name:"System (Debug)",view:Ru}};function p(v){Ke[v?"unshift":"push"](()=>{c=v,i(2,c)})}const m=(v,d)=>nn.set(v);return n.$$set=v=>{"application"in v&&i(4,s=v.application)},n.$$.update=()=>{n.$$.dirty&65&&(v=>{i(0,f=ni()),ge(Dn,a=f==null?void 0:f[f.length-1],a)})(),n.$$.dirty&34&&(v=>{u&&(l(`setting view to ${t}`),window.localStorage.setItem("__CURRENT_VIEW",t))})()},[f,t,c,h,s,u,r,p,m]}class $u extends Ce{constructor(e){super(),De(this,e,Qu,Zu,Le,{application:4})}}var Va={exports:{}},Ga={};Number.isFinite=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)};Number.isNaN=Number.isNaN||function(n){return n!==n};var ot={},oi=function(e){return e&&e.constructor.prototype.isBigNumber||!1};(function(n){function e(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?e=function(o){return typeof o}:e=function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},e(t)}var i=oi;n.clone=function t(r){var o=e(r);if(o==="number"||o==="string"||o==="boolean"||r===null||r===void 0)return r;if(typeof r.clone=="function")return r.clone();if(Array.isArray(r))return r.map(function(a){return t(a)});if(r instanceof Date)return new Date(r.valueOf());if(i(r))return r;if(r instanceof RegExp)throw new TypeError("Cannot clone "+r);return n.map(r,t)},n.map=function(t,r){var o={};for(var a in t)n.hasOwnProperty(t,a)&&(o[a]=r(t[a]));return o},n.extend=function(t,r){for(var o in r)n.hasOwnProperty(r,o)&&(t[o]=r[o]);return t},n.deepExtend=function t(r,o){if(Array.isArray(o))throw new TypeError("Arrays are not supported by deepExtend");for(var a in o)if(n.hasOwnProperty(o,a))if(o[a]&&o[a].constructor===Object)r[a]===void 0&&(r[a]={}),r[a].constructor===Object?t(r[a],o[a]):r[a]=o[a];else{if(Array.isArray(o[a]))throw new TypeError("Arrays are not supported by deepExtend");r[a]=o[a]}return r},n.deepEqual=function(r,o){var a,l,s;if(Array.isArray(r)){if(!Array.isArray(o)||r.length!==o.length)return!1;for(l=0,s=r.length;l<s;l++)if(!n.deepEqual(r[l],o[l]))return!1;return!0}else if(r instanceof Object){if(Array.isArray(o)||!(o instanceof Object))return!1;for(a in r)if(!n.deepEqual(r[a],o[a]))return!1;for(a in o)if(!n.deepEqual(r[a],o[a]))return!1;return!0}else return r===o},n.canDefineProperty=function(){try{if(Object.defineProperty)return Object.defineProperty({},"x",{get:function(){}}),!0}catch{}return!1},n.lazy=function(t,r,o){if(n.canDefineProperty()){var a=!0,l;Object.defineProperty(t,r,{get:function(){return a&&(l=o(),a=!1),l},set:function(f){l=f,a=!1},configurable:!0,enumerable:!0})}else t[r]=o()},n.traverse=function(t,r){var o=t;if(r)for(var a=r.split("."),l=0;l<a.length;l++){var s=a[l];s in o||(o[s]={}),o=o[s]}return o},n.hasOwnProperty=function(t,r){return t&&Object.hasOwnProperty.call(t,r)},n.isFactory=function(t){return t&&typeof t.factory=="function"}})(ot);var Ha={},qa={exports:{}};(function(n,e){(function(i,t){n.exports=t()})(ws,function(){function i(){return!0}function t(){return!1}function r(){}function o(){var a=[{name:"number",test:function(T){return typeof T=="number"}},{name:"string",test:function(T){return typeof T=="string"}},{name:"boolean",test:function(T){return typeof T=="boolean"}},{name:"Function",test:function(T){return typeof T=="function"}},{name:"Array",test:Array.isArray},{name:"Date",test:function(T){return T instanceof Date}},{name:"RegExp",test:function(T){return T instanceof RegExp}},{name:"Object",test:function(T){return typeof T=="object"&&T.constructor===Object}},{name:"null",test:function(T){return T===null}},{name:"undefined",test:function(T){return T===void 0}}],l={name:"any",test:i},s=[],f=[],u={types:a,conversions:f,ignore:s};function c(T){var D=Z(u.types,function(k){return k.name===T});if(D)return D;if(T==="any")return l;var U=Z(u.types,function(k){return k.name.toLowerCase()===T.toLowerCase()});throw new TypeError('Unknown type "'+T+'"'+(U?'. Did you mean "'+U.name+'"?':""))}function h(T){return T===l?999:u.types.indexOf(T)}function p(T){var D=Z(u.types,function(U){return U.test(T)});if(D)return D.name;throw new TypeError("Value has unknown type. Value: "+T)}function m(T,D){if(!T.signatures)throw new TypeError("Function is no typed-function");var U;if(typeof D=="string"){U=D.split(",");for(var k=0;k<U.length;k++)U[k]=U[k].trim()}else if(Array.isArray(D))U=D;else throw new TypeError("String array or a comma separated string expected");var $=U.join(","),ne=T.signatures[$];if(ne)return ne;throw new TypeError("Signature not found (signature: "+(T.name||"unnamed")+"("+U.join(", ")+"))")}function v(T,D){var U=p(T);if(D===U)return T;for(var k=0;k<u.conversions.length;k++){var $=u.conversions[k];if($.from===U&&$.to===D)return $.convert(T)}throw new Error("Cannot convert from "+U+" to "+D)}function d(T){return T.map(function(D){var U=D.types.map(w);return(D.restParam?"...":"")+U.join("|")}).join(",")}function _(T,D){var U=T.indexOf("...")===0,k=U?T.length>3?T.slice(3):"any":T,$=k.split("|").map(ve).filter(Ae).filter(z),ne=se(D,$),fe=$.map(function(G){var me=c(G);return{name:G,typeIndex:h(me),test:me.test,conversion:null,conversionIndex:-1}}),le=ne.map(function(G){var me=c(G.from);return{name:G.from,typeIndex:h(me),test:me.test,conversion:G,conversionIndex:D.indexOf(G)}});return{types:fe.concat(le),restParam:U}}function y(T,D,U){var k=[];return T.trim()!==""&&(k=T.split(",").map(ve).map(function($,ne,fe){var le=_($,U);if(le.restParam&&ne!==fe.length-1)throw new SyntaxError('Unexpected rest parameter "'+$+'": only allowed for the last parameter');return le})),k.some(Re)?null:{params:k,fn:D}}function b(T){var D=dt(T);return D?D.restParam:!1}function E(T){return T.types.some(function(D){return D.conversion!=null})}function N(T){if(!T||T.types.length===0)return i;if(T.types.length===1)return c(T.types[0].name).test;if(T.types.length===2){var D=c(T.types[0].name).test,U=c(T.types[1].name).test;return function(ne){return D(ne)||U(ne)}}else{var k=T.types.map(function($){return c($.name).test});return function(ne){for(var fe=0;fe<k.length;fe++)if(k[fe](ne))return!0;return!1}}}function S(T){var D,U,k;if(b(T)){D=Pt(T).map(N);var $=D.length,ne=N(dt(T)),fe=function(le){for(var G=$;G<le.length;G++)if(!ne(le[G]))return!1;return!0};return function(G){for(var me=0;me<D.length;me++)if(!D[me](G[me]))return!1;return fe(G)&&G.length>=$+1}}else return T.length===0?function(G){return G.length===0}:T.length===1?(U=N(T[0]),function(G){return U(G[0])&&G.length===1}):T.length===2?(U=N(T[0]),k=N(T[1]),function(G){return U(G[0])&&k(G[1])&&G.length===2}):(D=T.map(N),function(G){for(var me=0;me<D.length;me++)if(!D[me](G[me]))return!1;return G.length===D.length})}function A(T,D){return D<T.params.length?T.params[D]:b(T.params)?dt(T.params):null}function x(T,D,U){var k=A(T,D),$=k?U?k.types.filter(I):k.types:[];return $.map(w)}function w(T){return T.name}function I(T){return T.conversion===null||T.conversion===void 0}function L(T,D){var U=Ge(He(T,function(k){return x(k,D,!1)}));return U.indexOf("any")!==-1?["any"]:U}function C(T,D,U){var k,$,ne=T||"unnamed",fe=U,le;for(le=0;le<D.length;le++){var G=fe.filter(function(ut){var dn=N(A(ut,le));return(le<ut.params.length||b(ut.params))&&dn(D[le])});if(G.length===0){if($=L(fe,le),$.length>0){var me=p(D[le]);return k=new TypeError("Unexpected type of argument in function "+ne+" (expected: "+$.join(" or ")+", actual: "+me+", index: "+le+")"),k.data={category:"wrongType",fn:ne,index:le,actual:me,expected:$},k}}else fe=G}var Je=fe.map(function(ut){return b(ut.params)?1/0:ut.params.length});if(D.length<Math.min.apply(null,Je))return $=L(fe,le),k=new TypeError("Too few arguments in function "+ne+" (expected: "+$.join(" or ")+", index: "+D.length+")"),k.data={category:"tooFewArgs",fn:ne,index:D.length,expected:$},k;var et=Math.max.apply(null,Je);return D.length>et?(k=new TypeError("Too many arguments in function "+ne+" (expected: "+et+", actual: "+D.length+")"),k.data={category:"tooManyArgs",fn:ne,index:D.length,expectedLength:et},k):(k=new TypeError('Arguments of type "'+D.join(", ")+'" do not match any of the defined signatures of function '+ne+"."),k.data={category:"mismatch",actual:D.map(p)},k)}function j(T){for(var D=999,U=0;U<T.types.length;U++)I(T.types[U])&&(D=Math.min(D,T.types[U].typeIndex));return D}function Y(T){for(var D=999,U=0;U<T.types.length;U++)I(T.types[U])||(D=Math.min(D,T.types[U].conversionIndex));return D}function ae(T,D){var U;return U=T.restParam-D.restParam,U!==0||(U=E(T)-E(D),U!==0)||(U=j(T)-j(D),U!==0)?U:Y(T)-Y(D)}function V(T,D){var U=Math.min(T.params.length,D.params.length),k,$;if($=T.params.some(E)-D.params.some(E),$!==0)return $;for(k=0;k<U;k++)if($=E(T.params[k])-E(D.params[k]),$!==0)return $;for(k=0;k<U;k++)if($=ae(T.params[k],D.params[k]),$!==0)return $;return T.params.length-D.params.length}function se(T,D){var U={};return T.forEach(function(k){D.indexOf(k.from)===-1&&D.indexOf(k.to)!==-1&&!U[k.from]&&(U[k.from]=k)}),Object.keys(U).map(function(k){return U[k]})}function Te(T,D){var U=D;if(T.some(E)){var k=b(T),$=T.map(_e);U=function(){for(var G=[],me=k?arguments.length-1:arguments.length,Je=0;Je<me;Je++)G[Je]=$[Je](arguments[Je]);return k&&(G[me]=arguments[me].map($[me])),D.apply(null,G)}}var ne=U;if(b(T)){var fe=T.length-1;ne=function(){return U.apply(null,Ve(arguments,0,fe).concat([Ve(arguments,fe)]))}}return ne}function _e(T){var D,U,k,$,ne=[],fe=[];switch(T.types.forEach(function(le){le.conversion&&(ne.push(c(le.conversion.from).test),fe.push(le.conversion.convert))}),fe.length){case 0:return function(G){return G};case 1:return D=ne[0],k=fe[0],function(G){return D(G)?k(G):G};case 2:return D=ne[0],U=ne[1],k=fe[0],$=fe[1],function(G){return D(G)?k(G):U(G)?$(G):G};default:return function(G){for(var me=0;me<fe.length;me++)if(ne[me](G))return fe[me](G);return G}}}function J(T){var D={};return T.forEach(function(U){U.params.some(E)||Q(U.params,!0).forEach(function(k){D[d(k)]=U.fn})}),D}function Q(T,D){function U(k,$,ne){if($<k.length){var fe=k[$],le=D?fe.types.filter(I):fe.types,G;if(fe.restParam){var me=le.filter(I);G=me.length<le.length?[me,le]:[le]}else G=le.map(function(et){return[et]});return He(G,function(et){return U(k,$+1,ne.concat([et]))})}else{var Je=ne.map(function(et,ut){return{types:et,restParam:ut===k.length-1&&b(k)}});return[Je]}}return U(T,0,[])}function xe(T,D){for(var U=Math.max(T.params.length,D.params.length),k=0;k<U;k++){var $=x(T,k,!0),ne=x(D,k,!0);if(!K($,ne))return!1}var fe=T.params.length,le=D.params.length,G=b(T.params),me=b(D.params);return G?me?fe===le:le>=fe:me?fe>=le:fe===le}function Se(T,D){if(Object.keys(D).length===0)throw new SyntaxError("No signatures provided");var U=[];Object.keys(D).map(function(Qe){return y(Qe,D[Qe],u.conversions)}).filter(Ze).forEach(function(Qe){var tt=Z(U,function(St){return xe(St,Qe)});if(tt)throw new TypeError('Conflicting signatures "'+d(tt.params)+'" and "'+d(Qe.params)+'".');U.push(Qe)});var k=He(U,function(Qe){var tt=Qe?Q(Qe.params,!1):[];return tt.map(function(St){return{params:St,fn:Qe.fn}})}).filter(Ze);k.sort(V);var $=k[0]&&k[0].params.length<=2&&!b(k[0].params),ne=k[1]&&k[1].params.length<=2&&!b(k[1].params),fe=k[2]&&k[2].params.length<=2&&!b(k[2].params),le=k[3]&&k[3].params.length<=2&&!b(k[3].params),G=k[4]&&k[4].params.length<=2&&!b(k[4].params),me=k[5]&&k[5].params.length<=2&&!b(k[5].params),Je=$&&ne&&fe&&le&&G&&me,et=k.map(function(Qe){return S(Qe.params)}),ut=$?N(k[0].params[0]):t,dn=ne?N(k[1].params[0]):t,Gn=fe?N(k[2].params[0]):t,pr=le?N(k[3].params[0]):t,mr=G?N(k[4].params[0]):t,gr=me?N(k[5].params[0]):t,vr=$?N(k[0].params[1]):t,Hn=ne?N(k[1].params[1]):t,Ue=fe?N(k[2].params[1]):t,qn=le?N(k[3].params[1]):t,g=G?N(k[4].params[1]):t,O=me?N(k[5].params[1]):t,F=k.map(function(Qe){return Te(Qe.params,Qe.fn)}),W=$?F[0]:r,be=ne?F[1]:r,Ie=fe?F[2]:r,xt=le?F[3]:r,yr=G?F[4]:r,is=me?F[5]:r,os=$?k[0].params.length:-1,as=ne?k[1].params.length:-1,ss=fe?k[2].params.length:-1,ls=le?k[3].params.length:-1,us=G?k[4].params.length:-1,fs=me?k[5].params.length:-1,cs=Je?6:0,hs=k.length,ds=function(){for(var tt=cs;tt<hs;tt++)if(et[tt](arguments))return F[tt].apply(null,arguments);throw C(T,arguments,k)},_r=function(tt,St){return arguments.length===os&&ut(tt)&&vr(St)?W.apply(null,arguments):arguments.length===as&&dn(tt)&&Hn(St)?be.apply(null,arguments):arguments.length===ss&&Gn(tt)&&Ue(St)?Ie.apply(null,arguments):arguments.length===ls&&pr(tt)&&qn(St)?xt.apply(null,arguments):arguments.length===us&&mr(tt)&&g(St)?yr.apply(null,arguments):arguments.length===fs&&gr(tt)&&O(St)?is.apply(null,arguments):ds.apply(null,arguments)};try{Object.defineProperty(_r,"name",{value:T})}catch{}return _r.signatures=J(k),_r}function z(T){return u.ignore.indexOf(T)===-1}function ve(T){return T.trim()}function Ae(T){return!!T}function Ze(T){return T!==null}function Re(T){return T.types.length===0}function Pt(T){return T.slice(0,T.length-1)}function dt(T){return T[T.length-1]}function Ve(T,D,U){return Array.prototype.slice.call(T,D,U)}function B(T,D){return T.indexOf(D)!==-1}function K(T,D){for(var U=0;U<T.length;U++)if(B(D,T[U]))return!0;return!1}function Z(T,D){for(var U=0;U<T.length;U++)if(D(T[U]))return T[U]}function Ge(T){for(var D={},U=0;U<T.length;U++)D[T[U]]=!0;return Object.keys(D)}function He(T,D){return Array.prototype.concat.apply([],T.map(D))}function qe(T){for(var D="",U=0;U<T.length;U++){var k=T[U];if((typeof k.signatures=="object"||typeof k.signature=="string")&&k.name!==""){if(D==="")D=k.name;else if(D!==k.name){var $=new Error("Function names do not match (expected: "+D+", actual: "+k.name+")");throw $.data={actual:k.name,expected:D},$}}}return D}function ze(T){var D,U={};function k(le,G){if(U.hasOwnProperty(le)&&G!==U[le])throw D=new Error('Signature "'+le+'" is defined twice'),D.data={signature:le},D}for(var $=0;$<T.length;$++){var ne=T[$];if(typeof ne.signatures=="object")for(var fe in ne.signatures)ne.signatures.hasOwnProperty(fe)&&(k(fe,ne.signatures[fe]),U[fe]=ne.signatures[fe]);else if(typeof ne.signature=="string")k(ne.signature,ne),U[ne.signature]=ne;else throw D=new TypeError("Function is no typed-function (index: "+$+")"),D.data={index:$},D}return U}return u=Se("typed",{"string, Object":Se,Object:function(T){var D=[];for(var U in T)T.hasOwnProperty(U)&&D.push(T[U]);var k=qe(D);return Se(k,T)},"...Function":function(T){return Se(qe(T),ze(T))},"string, ...Function":function(T,D){return Se(T,ze(D))}}),u.create=o,u.types=a,u.conversions=f,u.ignore=s,u.convert=v,u.find=m,u.addType=function(T,D){if(!T||typeof T.name!="string"||typeof T.test!="function")throw new TypeError("Object with properties {name: string, test: function} expected");if(D!==!1){for(var U=0;U<u.types.length;U++)if(u.types[U].name==="Object"){u.types.splice(U,0,T);return}}u.types.push(T)},u.addConversion=function(T){if(!T||typeof T.from!="string"||typeof T.to!="string"||typeof T.convert!="function")throw new TypeError("Object with properties {from: string, to: string, convert: function} expected");u.conversions.push(T)},u}return o()})})(qa);var jn={};(function(n){var e=ot;n.isNumber=function(t){return typeof t=="number"},n.isInteger=function(t){return typeof t=="boolean"?!0:isFinite(t)?t===Math.round(t):!1},n.sign=Math.sign||function(t){return t>0?1:t<0?-1:0},n.format=function(t,r){if(typeof r=="function")return r(t);if(t===1/0)return"Infinity";if(t===-1/0)return"-Infinity";if(isNaN(t))return"NaN";var o="auto",a;switch(r&&(r.notation&&(o=r.notation),n.isNumber(r)?a=r:n.isNumber(r.precision)&&(a=r.precision)),o){case"fixed":return n.toFixed(t,a);case"exponential":return n.toExponential(t,a);case"engineering":return n.toEngineering(t,a);case"auto":if(r&&r.exponential&&(r.exponential.lower!==void 0||r.exponential.upper!==void 0)){var l=e.map(r,function(s){return s});return l.exponential=void 0,r.exponential.lower!==void 0&&(l.lowerExp=Math.round(Math.log(r.exponential.lower)/Math.LN10)),r.exponential.upper!==void 0&&(l.upperExp=Math.round(Math.log(r.exponential.upper)/Math.LN10)),console.warn("Deprecation warning: Formatting options exponential.lower and exponential.upper (minimum and maximum value) are replaced with exponential.lowerExp and exponential.upperExp (minimum and maximum exponent) since version 4.0.0. Replace "+JSON.stringify(r)+" with "+JSON.stringify(l)),n.toPrecision(t,a,l)}return n.toPrecision(t,a,r&&r).replace(/((\.\d*?)(0+))($|e)/,function(){var s=arguments[2],f=arguments[4];return s!=="."?s+f:f});default:throw new Error('Unknown notation "'+o+'". Choose "auto", "exponential", or "fixed".')}},n.splitNumber=function(t){var r=String(t).toLowerCase().match(/^0*?(-?)(\d+\.?\d*)(e([+-]?\d+))?$/);if(!r)throw new SyntaxError("Invalid number "+t);var o=r[1],a=r[2],l=parseFloat(r[4]||"0"),s=a.indexOf(".");l+=s!==-1?s-1:a.length-1;var f=a.replace(".","").replace(/^0*/,function(u){return l-=u.length,""}).replace(/0*$/,"").split("").map(function(u){return parseInt(u)});return f.length===0&&(f.push(0),l++),{sign:o,coefficients:f,exponent:l}},n.toEngineering=function(t,r){if(isNaN(t)||!isFinite(t))return String(t);var o=n.roundDigits(n.splitNumber(t),r),a=o.exponent,l=o.coefficients,s=a%3===0?a:a<0?a-3-a%3:a-a%3;if(n.isNumber(r))for(;r>l.length||a-s+1>l.length;)l.push(0);else for(var f=a>=0?a:Math.abs(s);l.length-1<f;)l.push(0);for(var u=Math.abs(a-s),c=1;u>0;)c++,u--;var h=l.slice(c).join(""),p=n.isNumber(r)&&h.length||h.match(/[1-9]/)?"."+h:"",m=l.slice(0,c).join("")+p+"e"+(a>=0?"+":"")+s.toString();return o.sign+m},n.toFixed=function(t,r){if(isNaN(t)||!isFinite(t))return String(t);var o=n.splitNumber(t),a=typeof r=="number"?n.roundDigits(o,o.exponent+1+r):o,l=a.coefficients,s=a.exponent+1,f=s+(r||0);return l.length<f&&(l=l.concat(i(f-l.length))),s<0&&(l=i(-s+1).concat(l),s=1),s<l.length&&l.splice(s,0,s===0?"0.":"."),a.sign+l.join("")},n.toExponential=function(t,r){if(isNaN(t)||!isFinite(t))return String(t);var o=n.splitNumber(t),a=r?n.roundDigits(o,r):o,l=a.coefficients,s=a.exponent;l.length<r&&(l=l.concat(i(r-l.length)));var f=l.shift();return a.sign+f+(l.length>0?"."+l.join(""):"")+"e"+(s>=0?"+":"")+s},n.toPrecision=function(t,r,o){if(isNaN(t)||!isFinite(t))return String(t);var a=o&&o.lowerExp!==void 0?o.lowerExp:-3,l=o&&o.upperExp!==void 0?o.upperExp:5,s=n.splitNumber(t);if(s.exponent<a||s.exponent>=l)return n.toExponential(t,r);var f=r?n.roundDigits(s,r):s,u=f.coefficients,c=f.exponent;u.length<r&&(u=u.concat(i(r-u.length))),u=u.concat(i(c-u.length+1+(u.length<r?r-u.length:0))),u=i(-c).concat(u);var h=c>0?c:0;return h<u.length-1&&u.splice(h+1,0,"."),f.sign+u.join("")},n.roundDigits=function(t,r){for(var o={sign:t.sign,coefficients:t.coefficients,exponent:t.exponent},a=o.coefficients;r<=0;)a.unshift(0),o.exponent++,r++;if(a.length>r){var l=a.splice(r,a.length-r);if(l[0]>=5){var s=r-1;for(a[s]++;a[s]===10;)a.pop(),s===0&&(a.unshift(0),o.exponent++,s++),s--,a[s]++}}return o};function i(t){for(var r=[],o=0;o<t;o++)r.push(0);return r}n.digits=function(t){return t.toExponential().replace(/e.*$/,"").replace(/^0\.?0*|\./,"").length},n.DBL_EPSILON=Number.EPSILON||2220446049250313e-31,n.nearlyEqual=function(t,r,o){if(o==null)return t===r;if(t===r)return!0;if(isNaN(t)||isNaN(r))return!1;if(isFinite(t)&&isFinite(r)){var a=Math.abs(t-r);return a<n.DBL_EPSILON?!0:a<=Math.max(Math.abs(t),Math.abs(r))*o}return!1}})(jn);var ef=function(e){return e&&e.constructor.prototype.isMatrix||!1};function or(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?or=function(i){return typeof i}:or=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},or(n)}var qi=qa.exports,tf=jn.digits,nf=oi,rf=ef,za=function(){return za=qi.create,qi};Ha.create=function(e){e.isNumber=function(t){return typeof t=="number"},e.isComplex=function(t){return e.Complex&&t instanceof e.Complex||!1},e.isBigNumber=nf,e.isFraction=function(t){return e.Fraction&&t instanceof e.Fraction||!1},e.isUnit=function(t){return t&&t.constructor.prototype.isUnit||!1},e.isString=function(t){return typeof t=="string"},e.isArray=Array.isArray,e.isMatrix=rf,e.isDenseMatrix=function(t){return t&&t.isDenseMatrix&&t.constructor.prototype.isMatrix||!1},e.isSparseMatrix=function(t){return t&&t.isSparseMatrix&&t.constructor.prototype.isMatrix||!1},e.isRange=function(t){return t&&t.constructor.prototype.isRange||!1},e.isIndex=function(t){return t&&t.constructor.prototype.isIndex||!1},e.isBoolean=function(t){return typeof t=="boolean"},e.isResultSet=function(t){return t&&t.constructor.prototype.isResultSet||!1},e.isHelp=function(t){return t&&t.constructor.prototype.isHelp||!1},e.isFunction=function(t){return typeof t=="function"},e.isDate=function(t){return t instanceof Date},e.isRegExp=function(t){return t instanceof RegExp},e.isObject=function(t){return or(t)==="object"&&t.constructor===Object&&!e.isComplex(t)&&!e.isFraction(t)},e.isNull=function(t){return t===null},e.isUndefined=function(t){return t===void 0},e.isAccessorNode=function(t){return t&&t.isAccessorNode&&t.constructor.prototype.isNode||!1},e.isArrayNode=function(t){return t&&t.isArrayNode&&t.constructor.prototype.isNode||!1},e.isAssignmentNode=function(t){return t&&t.isAssignmentNode&&t.constructor.prototype.isNode||!1},e.isBlockNode=function(t){return t&&t.isBlockNode&&t.constructor.prototype.isNode||!1},e.isConditionalNode=function(t){return t&&t.isConditionalNode&&t.constructor.prototype.isNode||!1},e.isConstantNode=function(t){return t&&t.isConstantNode&&t.constructor.prototype.isNode||!1},e.isFunctionAssignmentNode=function(t){return t&&t.isFunctionAssignmentNode&&t.constructor.prototype.isNode||!1},e.isFunctionNode=function(t){return t&&t.isFunctionNode&&t.constructor.prototype.isNode||!1},e.isIndexNode=function(t){return t&&t.isIndexNode&&t.constructor.prototype.isNode||!1},e.isNode=function(t){return t&&t.isNode&&t.constructor.prototype.isNode||!1},e.isObjectNode=function(t){return t&&t.isObjectNode&&t.constructor.prototype.isNode||!1},e.isOperatorNode=function(t){return t&&t.isOperatorNode&&t.constructor.prototype.isNode||!1},e.isParenthesisNode=function(t){return t&&t.isParenthesisNode&&t.constructor.prototype.isNode||!1},e.isRangeNode=function(t){return t&&t.isRangeNode&&t.constructor.prototype.isNode||!1},e.isSymbolNode=function(t){return t&&t.isSymbolNode&&t.constructor.prototype.isNode||!1},e.isChain=function(t){return t&&t.constructor.prototype.isChain||!1};var i=za();return i.types=[{name:"number",test:e.isNumber},{name:"Complex",test:e.isComplex},{name:"BigNumber",test:e.isBigNumber},{name:"Fraction",test:e.isFraction},{name:"Unit",test:e.isUnit},{name:"string",test:e.isString},{name:"Array",test:e.isArray},{name:"Matrix",test:e.isMatrix},{name:"DenseMatrix",test:e.isDenseMatrix},{name:"SparseMatrix",test:e.isSparseMatrix},{name:"Range",test:e.isRange},{name:"Index",test:e.isIndex},{name:"boolean",test:e.isBoolean},{name:"ResultSet",test:e.isResultSet},{name:"Help",test:e.isHelp},{name:"function",test:e.isFunction},{name:"Date",test:e.isDate},{name:"RegExp",test:e.isRegExp},{name:"null",test:e.isNull},{name:"undefined",test:e.isUndefined},{name:"OperatorNode",test:e.isOperatorNode},{name:"ConstantNode",test:e.isConstantNode},{name:"SymbolNode",test:e.isSymbolNode},{name:"ParenthesisNode",test:e.isParenthesisNode},{name:"FunctionNode",test:e.isFunctionNode},{name:"FunctionAssignmentNode",test:e.isFunctionAssignmentNode},{name:"ArrayNode",test:e.isArrayNode},{name:"AssignmentNode",test:e.isAssignmentNode},{name:"BlockNode",test:e.isBlockNode},{name:"ConditionalNode",test:e.isConditionalNode},{name:"IndexNode",test:e.isIndexNode},{name:"RangeNode",test:e.isRangeNode},{name:"Node",test:e.isNode},{name:"Object",test:e.isObject}],i.conversions=[{from:"number",to:"BigNumber",convert:function(r){if(tf(r)>15)throw new TypeError("Cannot implicitly convert a number with >15 significant digits to BigNumber (value: "+r+"). Use function bignumber(x) to convert to BigNumber.");return new e.BigNumber(r)}},{from:"number",to:"Complex",convert:function(r){return new e.Complex(r,0)}},{from:"number",to:"string",convert:function(r){return r+""}},{from:"BigNumber",to:"Complex",convert:function(r){return new e.Complex(r.toNumber(),0)}},{from:"Fraction",to:"BigNumber",convert:function(r){throw new TypeError("Cannot implicitly convert a Fraction to BigNumber or vice versa. Use function bignumber(x) to convert to BigNumber or fraction(x) to convert to Fraction.")}},{from:"Fraction",to:"Complex",convert:function(r){return new e.Complex(r.valueOf(),0)}},{from:"number",to:"Fraction",convert:function(r){var o=new e.Fraction(r);if(o.valueOf()!==r)throw new TypeError("Cannot implicitly convert a number to a Fraction when there will be a loss of precision (value: "+r+"). Use function fraction(x) to convert to Fraction.");return new e.Fraction(r)}},{from:"string",to:"number",convert:function(r){var o=Number(r);if(isNaN(o))throw new Error('Cannot convert "'+r+'" to a number');return o}},{from:"string",to:"BigNumber",convert:function(r){try{return new e.BigNumber(r)}catch{throw new Error('Cannot convert "'+r+'" to BigNumber')}}},{from:"string",to:"Fraction",convert:function(r){try{return new e.Fraction(r)}catch{throw new Error('Cannot convert "'+r+'" to Fraction')}}},{from:"string",to:"Complex",convert:function(r){try{return new e.Complex(r)}catch{throw new Error('Cannot convert "'+r+'" to Complex')}}},{from:"boolean",to:"number",convert:function(r){return+r}},{from:"boolean",to:"BigNumber",convert:function(r){return new e.BigNumber(+r)}},{from:"boolean",to:"Fraction",convert:function(r){return new e.Fraction(+r)}},{from:"boolean",to:"string",convert:function(r){return+r}},{from:"Array",to:"Matrix",convert:function(r){return new e.DenseMatrix(r)}},{from:"Matrix",to:"Array",convert:function(r){return r.valueOf()}}],i};var Xa={},ai={exports:{}};function si(){}si.prototype={on:function(n,e,i){var t=this.e||(this.e={});return(t[n]||(t[n]=[])).push({fn:e,ctx:i}),this},once:function(n,e,i){var t=this;function r(){t.off(n,r),e.apply(i,arguments)}return r._=e,this.on(n,r,i)},emit:function(n){var e=[].slice.call(arguments,1),i=((this.e||(this.e={}))[n]||[]).slice(),t=0,r=i.length;for(t;t<r;t++)i[t].fn.apply(i[t].ctx,e);return this},off:function(n,e){var i=this.e||(this.e={}),t=i[n],r=[];if(t&&e)for(var o=0,a=t.length;o<a;o++)t[o].fn!==e&&t[o].fn._!==e&&r.push(t[o]);return r.length?i[n]=r:delete i[n],this}};ai.exports=si;ai.exports.TinyEmitter=si;var of=ai.exports;Xa.mixin=function(n){var e=new of;return n.on=e.on.bind(e),n.off=e.off.bind(e),n.once=e.once.bind(e),n.emit=e.emit.bind(e),n};var Vn={};function ln(n,e,i,t){if(!(this instanceof ln))throw new SyntaxError("Constructor must be called with the new operator");this.fn=n,this.count=e,this.min=i,this.max=t,this.message="Wrong number of arguments in function "+n+" ("+e+" provided, "+i+(t!=null?"-"+t:"")+" expected)",this.stack=new Error().stack}ln.prototype=new Error;ln.prototype.constructor=Error;ln.prototype.name="ArgumentsError";ln.prototype.isArgumentsError=!0;var Wa=ln;function Cn(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Cn=function(i){return typeof i}:Cn=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Cn(n)}var zi=ot.lazy,Xi=ot.isFactory,af=ot.traverse,sf=Wa;function lf(n,e,i,t,r){function o(d,_){var y=arguments.length;if(y!==1&&y!==2)throw new sf("import",y,1,2);if(_||(_={}),Xi(d))u(d,_);else if(Array.isArray(d))d.forEach(function(N){o(N,_)});else if(Cn(d)==="object"){for(var b in d)if(d.hasOwnProperty(b)){var E=d[b];c(E)?a(b,E,_):Xi(d)?u(d,_):o(E,_)}}else if(!_.silent)throw new TypeError("Factory, Object, or Array expected")}function a(d,_,y){if(y.wrap&&typeof _=="function"&&(_=f(_)),h(r[d])&&h(_)){y.override?_=t(d,_.signatures):_=t(r[d],_),r[d]=_,l(d,_),r.emit("import",d,function(){return _});return}if(r[d]===void 0||y.override){r[d]=_,l(d,_),r.emit("import",d,function(){return _});return}if(!y.silent)throw new Error('Cannot import "'+d+'": already exists')}function l(d,_){_&&typeof _.transform=="function"?(r.expression.transform[d]=_.transform,p(d)&&(r.expression.mathWithTransform[d]=_.transform)):(delete r.expression.transform[d],p(d)&&(r.expression.mathWithTransform[d]=_))}function s(d){delete r.expression.transform[d],p(d)?r.expression.mathWithTransform[d]=r[d]:delete r.expression.mathWithTransform[d]}function f(d){var _=function(){for(var b=[],E=0,N=arguments.length;E<N;E++){var S=arguments[E];b[E]=S&&S.valueOf()}return d.apply(r,b)};return d.transform&&(_.transform=d.transform),_}function u(d,_){if(typeof d.name=="string"){var y=d.name,b=y in r.expression.transform,E=d.path?af(r,d.path):r,N=E.hasOwnProperty(y)?E[y]:void 0,S=function(){var x=i(d);if(x&&typeof x.transform=="function")throw new Error('Transforms cannot be attached to factory functions. Please create a separate function for it with exports.path="expression.transform"');if(h(N)&&h(x))return _.override||(x=t(N,x)),x;if(N===void 0||_.override)return x;if(!_.silent)throw new Error('Cannot import "'+y+'": already exists')};d.lazy!==!1?(zi(E,y,S),b?s(y):(d.path==="expression.transform"||m(d))&&zi(r.expression.mathWithTransform,y,S)):(E[y]=S(),b?s(y):(d.path==="expression.transform"||m(d))&&(r.expression.mathWithTransform[y]=S())),r.emit("import",y,S,d.path)}else i(d)}function c(d){return typeof d=="function"||typeof d=="number"||typeof d=="string"||typeof d=="boolean"||d===null||d&&n.isUnit(d)||d&&n.isComplex(d)||d&&n.isBigNumber(d)||d&&n.isFraction(d)||d&&n.isMatrix(d)||d&&Array.isArray(d)}function h(d){return typeof d=="function"&&Cn(d.signatures)==="object"}function p(d){return!v.hasOwnProperty(d)}function m(d){return d.path===void 0&&!v.hasOwnProperty(d.name)}var v={expression:!0,type:!0,docs:!0,error:!0,json:!0,chain:!0};return o}Vn.math=!0;Vn.name="import";Vn.factory=lf;Vn.lazy=!0;var dr={},It=ot;function uf(n,e,i,t,r){var o=["Matrix","Array"],a=["number","BigNumber","Fraction"];function l(s){if(s){var f=It.map(e,It.clone);Wi(s,"matrix",o),Wi(s,"number",a),It.deepExtend(e,s);var u=It.map(e,It.clone),c=It.map(s,It.clone);return r.emit("config",u,f,c),u}else return It.map(e,It.clone)}return l.MATRIX=o,l.NUMBER=a,l}function ff(n,e){return n.indexOf(e)!==-1}function cf(n,e){return n.map(function(i){return i.toLowerCase()}).indexOf(e.toLowerCase())}function Wi(n,e,i){if(n[e]!==void 0&&!ff(i,n[e])){var t=cf(i,n[e]);t!==-1?(console.warn('Warning: Wrong casing for configuration option "'+e+'", should be "'+i[t]+'" instead of "'+n[e]+'".'),n[e]=i[t]):console.warn('Warning: Unknown value "'+n[e]+'" for configuration option "'+e+'". Available options: '+i.map(JSON.stringify).join(", ")+".")}}dr.name="config";dr.math=!0;dr.factory=uf;var hf=ot.isFactory,df=Ha,pf=Xa,mf=Vn,gf=dr;Ga.create=function(e){if(typeof Object.create!="function")throw new Error("ES5 not supported by this JavaScript engine. Please load the es5-shim and es5-sham library for compatibility.");var i=[],t=[],r=pf.mixin({});r.type={},r.expression={transform:{},mathWithTransform:{}},r.typed=df.create(r.type);var o={epsilon:1e-12,matrix:"Matrix",number:"number",precision:64,predictable:!1,randomSeed:null};function a(l){if(!hf(l))throw new Error("Factory object with properties `type`, `name`, and `factory` expected");var s=i.indexOf(l),f;return s===-1?(l.math===!0?f=l.factory(r.type,o,a,r.typed,r):f=l.factory(r.type,o,a,r.typed),i.push(l),t.push(f)):f=t[s],f}return r.import=a(mf),r.config=a(gf),r.expression.mathWithTransform.config=r.config,e&&r.config(e),r};(function(n){n.exports=Ga})(Va);var Xn={},pn={},wr,Yi;function un(){return Yi||(Yi=1,wr=function n(e,i,t){return e&&typeof e.map=="function"?e.map(function(r){return n(r,i)}):i(e)}),wr}var mn={},Wn={},Ji;function li(){if(Ji)return Wn;Ji=1;function n(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?n=function(r){return typeof r}:n=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},n(i)}function e(i,t,r,o){var a=o("_typeof",{any:function(s){var f=n(s);return f==="object"?s===null?"null":Array.isArray(s)?"Array":s instanceof Date?"Date":s instanceof RegExp?"RegExp":i.isBigNumber(s)?"BigNumber":i.isComplex(s)?"Complex":i.isFraction(s)?"Fraction":i.isMatrix(s)?"Matrix":i.isUnit(s)?"Unit":i.isIndex(s)?"Index":i.isRange(s)?"Range":i.isResultSet(s)?"ResultSet":i.isNode(s)?s.type:i.isChain(s)?"Chain":i.isHelp(s)?"Help":"Object":f==="function"?"Function":f}});return a.toTex=void 0,a}return Wn.name="typeof",Wn.factory=e,Wn}var Yn={},Ki;function vf(){if(Ki)return Yn;Ki=1;var n=un();function e(i,t,r,o){var a=o("number",{"":function(){return 0},number:function(s){return s},string:function(s){if(s==="NaN")return NaN;var f=Number(s);if(isNaN(f))throw new SyntaxError('String "'+s+'" is no valid number');return f},BigNumber:function(s){return s.toNumber()},Fraction:function(s){return s.valueOf()},Unit:function(s){throw new Error("Second argument with valueless unit expected")},null:function(s){return 0},"Unit, string | Unit":function(s,f){return s.toNumber(f)},"Array | Matrix":function(s){return n(s,a)}});return a.toTex={0:"0",1:"\\left(${args[0]}\\right)",2:"\\left(\\left(${args[0]}\\right)${args[1]}\\right)"},a}return Yn.name="number",Yn.factory=e,Yn}var Jn={},Zi;function yf(){if(Zi)return Jn;Zi=1;var n=un();function e(i,t,r,o){var a=o("bignumber",{"":function(){return new i.BigNumber(0)},number:function(s){return new i.BigNumber(s+"")},string:function(s){return new i.BigNumber(s)},BigNumber:function(s){return s},Fraction:function(s){return new i.BigNumber(s.n).div(s.d).times(s.s)},null:function(s){return new i.BigNumber(0)},"Array | Matrix":function(s){return n(s,a)}});return a.toTex={0:"0",1:"\\left(${args[0]}\\right)"},a}return Jn.name="bignumber",Jn.factory=e,Jn}var Kn={},Qi;function _f(){if(Qi)return Kn;Qi=1;var n=un();function e(i,t,r,o){var a=o("fraction",{number:function(s){if(!isFinite(s)||isNaN(s))throw new Error(s+" cannot be represented as a fraction");return new i.Fraction(s)},string:function(s){return new i.Fraction(s)},"number, number":function(s,f){return new i.Fraction(s,f)},null:function(s){return new i.Fraction(0)},BigNumber:function(s){return new i.Fraction(s.toString())},Fraction:function(s){return s},Object:function(s){return new i.Fraction(s)},"Array | Matrix":function(s){return n(s,a)}});return a}return Kn.name="fraction",Kn.factory=e,Kn}var $i;function bf(){if($i)return mn;$i=1;function n(e,i,t,r){var o=t(li()),a={string:!0,number:!0,BigNumber:!0,Fraction:!0},l={number:t(vf()),BigNumber:t(yf()),Fraction:t(_f())},s=function(u,c){var h=o(u);if(!(h in a))throw new TypeError("Cannot convert "+u+' of type "'+h+'"; valid input types are '+Object.keys(a).join(", "));if(!(c in l))throw new TypeError("Cannot convert "+u+' to type "'+c+'"; valid output types are '+Object.keys(l).join(", "));return c===h?u:l[c](u)};return s.toTex=function(f,u){return f.args[0].toTex()},s}return mn.path="type",mn.name="_numeric",mn.factory=n,mn}var gn={},Ct={},eo;function at(){if(eo)return Ct;eo=1;function n(u){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?n=function(h){return typeof h}:n=function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},n(u)}var e=ot.hasOwnProperty;function i(u,c){if(l(u)&&r(u,c))return u[c];throw typeof u[c]=="function"&&a(u,c)?new Error('Cannot access method "'+c+'" as a property'):new Error('No access to property "'+c+'"')}function t(u,c,h){if(l(u)&&r(u,c))return u[c]=h,h;throw new Error('No access to property "'+c+'"')}function r(u,c){return!u||n(u)!=="object"?!1:e(s,c)?!0:!(c in Object.prototype||c in Function.prototype)}function o(u,c){if(!a(u,c))throw new Error('No access to method "'+c+'"')}function a(u,c){return!u||typeof u[c]!="function"||e(u,c)&&Object.getPrototypeOf&&c in Object.getPrototypeOf(u)?!1:e(f,c)?!0:!(c in Object.prototype||c in Function.prototype)}function l(u){return n(u)==="object"&&u&&u.constructor===Object}var s={length:!0,name:!0},f={toString:!0,valueOf:!0,toLocaleString:!0};return Ct.getSafeProperty=i,Ct.setSafeProperty=t,Ct.isSafeProperty=r,Ct.validateSafeMethod=o,Ct.isSafeMethod=a,Ct.isPlainObject=l,Ct}var Wt={},Er,to;function Ya(){return to||(to=1,Er={end:!0}),Er}var no;function st(){if(no)return Wt;no=1;function n(o){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?n=function(l){return typeof l}:n=function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l},n(o)}var e=Ya(),i=ot.deepEqual,t=ot.hasOwnProperty;function r(o,a,l,s,f){function u(){if(!(this instanceof u))throw new SyntaxError("Constructor must be called with the new operator")}u.prototype.eval=function(h){return this.compile().eval(h)},u.prototype.type="Node",u.prototype.isNode=!0,u.prototype.comment="",u.prototype.compile=function(){var h=this._compile(f.expression.mathWithTransform,{}),p={},m=null;return{eval:function(d){var _=d||{};return c(_),h(_,p,m)}}},u.prototype._compile=function(h,p){throw new Error("Method _compile should be implemented by type "+this.type)},u.prototype.forEach=function(h){throw new Error("Cannot run forEach on a Node interface")},u.prototype.map=function(h){throw new Error("Cannot run map on a Node interface")},u.prototype._ifNode=function(h){if(!o.isNode(h))throw new TypeError("Callback function must return a Node");return h},u.prototype.traverse=function(h){h(this,null,null);function p(m,v){m.forEach(function(d,_,y){v(d,_,y),p(d,v)})}p(this,h)},u.prototype.transform=function(h){function p(v,d){return v.map(function(_,y,b){var E=d(_,y,b);return p(E,d)})}var m=h(this,null,null);return p(m,h)},u.prototype.filter=function(h){var p=[];return this.traverse(function(m,v,d){h(m,v,d)&&p.push(m)}),p},u.prototype.find=function(){throw new Error("Function Node.find is deprecated. Use Node.filter instead.")},u.prototype.match=function(){throw new Error("Function Node.match is deprecated. See functions Node.filter, Node.transform, Node.traverse.")},u.prototype.clone=function(){throw new Error("Cannot clone a Node interface")},u.prototype.cloneDeep=function(){return this.map(function(h){return h.cloneDeep()})},u.prototype.equals=function(h){return h?i(this,h):!1},u.prototype.toString=function(h){var p;if(h&&n(h)==="object")switch(n(h.handler)){case"object":case"undefined":break;case"function":p=h.handler(this,h);break;default:throw new TypeError("Object or function expected as callback")}return typeof p<"u"?p:this._toString(h)},u.prototype.toJSON=function(){throw new Error("Cannot serialize object: toJSON not implemented by "+this.type)},u.prototype.toHTML=function(h){var p;if(h&&n(h)==="object")switch(n(h.handler)){case"object":case"undefined":break;case"function":p=h.handler(this,h);break;default:throw new TypeError("Object or function expected as callback")}return typeof p<"u"?p:this.toHTML(h)},u.prototype._toString=function(){throw new Error("_toString not implemented for "+this.type)},u.prototype.toTex=function(h){var p;if(h&&n(h)==="object")switch(n(h.handler)){case"object":case"undefined":break;case"function":p=h.handler(this,h);break;default:throw new TypeError("Object or function expected as callback")}return typeof p<"u"?p:this._toTex(h)},u.prototype._toTex=function(h){throw new Error("_toTex not implemented for "+this.type)},u.prototype.getIdentifier=function(){return this.type},u.prototype.getContent=function(){return this};function c(h){for(var p in h)if(t(h,p)&&p in e)throw new Error('Scope contains an illegal symbol, "'+p+'" is a reserved keyword')}return u}return Wt.name="Node",Wt.path="expression.node",Wt.math=!0,Wt.factory=r,Wt}var Nr={},Sr={},xr,ro;function Ja(){if(ro)return xr;ro=1;function n(e,i,t){if(!(this instanceof n))throw new SyntaxError("Constructor must be called with the new operator");this.index=e,arguments.length<3?(this.min=0,this.max=i):(this.min=i,this.max=t),this.min!==void 0&&this.index<this.min?this.message="Index out of range ("+this.index+" < "+this.min+")":this.max!==void 0&&this.index>=this.max?this.message="Index out of range ("+this.index+" > "+(this.max-1)+")":this.message="Index out of range ("+this.index+")",this.stack=new Error().stack}return n.prototype=new RangeError,n.prototype.constructor=RangeError,n.prototype.name="IndexError",n.prototype.isIndexError=!0,xr=n,xr}var io;function Ka(){if(io)return Sr;io=1;var n=Ja();return Sr.transform=function(e){return e&&e.isIndexError?new n(e.index+1,e.min+1,e.max!==void 0?e.max+1:void 0):e},Sr}var Zn={},$e={},Ir={},Or={},oo;function wf(){return oo||(oo=1,function(n){var e=ot;n.format=function(i,t){if(typeof t=="function")return t(i);if(!i.isFinite())return i.isNaN()?"NaN":i.gt(0)?"Infinity":"-Infinity";var r="auto",o;switch(t!==void 0&&(t.notation&&(r=t.notation),typeof t=="number"?o=t:t.precision&&(o=t.precision)),r){case"fixed":return n.toFixed(i,o);case"exponential":return n.toExponential(i,o);case"engineering":return n.toEngineering(i,o);case"auto":if(t&&t.exponential&&(t.exponential.lower!==void 0||t.exponential.upper!==void 0)){var a=e.map(t,function(c){return c});return a.exponential=void 0,t.exponential.lower!==void 0&&(a.lowerExp=Math.round(Math.log(t.exponential.lower)/Math.LN10)),t.exponential.upper!==void 0&&(a.upperExp=Math.round(Math.log(t.exponential.upper)/Math.LN10)),console.warn("Deprecation warning: Formatting options exponential.lower and exponential.upper (minimum and maximum value) are replaced with exponential.lowerExp and exponential.upperExp (minimum and maximum exponent) since version 4.0.0. Replace "+JSON.stringify(t)+" with "+JSON.stringify(a)),n.format(i,a)}var l=t&&t.lowerExp!==void 0?t.lowerExp:-3,s=t&&t.upperExp!==void 0?t.upperExp:5;if(i.isZero())return"0";var f,u=i.e;return u>=l&&u<s?f=i.toSignificantDigits(o).toFixed():f=n.toExponential(i,o),f.replace(/((\.\d*?)(0+))($|e)/,function(){var c=arguments[2],h=arguments[4];return c!=="."?c+h:h});default:throw new Error('Unknown notation "'+r+'". Choose "auto", "exponential", or "fixed".')}},n.toEngineering=function(i,t){var r=i.e,o=r%3===0?r:r<0?r-3-r%3:r-r%3,a=i.mul(Math.pow(10,-o)),l=a.toPrecision(t);return l.indexOf("e")!==-1&&(l=a.toString()),l+"e"+(r>=0?"+":"")+o.toString()},n.toExponential=function(i,t){return t!==void 0?i.toExponential(t-1):i.toExponential()},n.toFixed=function(i,t){return i.toFixed(t)}}(Or)),Or}var ao;function wt(){return ao||(ao=1,function(n){function e(l){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?e=function(f){return typeof f}:e=function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},e(l)}var i=jn.format,t=wf().format,r=oi;n.isString=function(l){return typeof l=="string"},n.endsWith=function(l,s){var f=l.length-s.length,u=l.length;return l.substring(f,u)===s},n.format=function(l,s){if(typeof l=="number")return i(l,s);if(r(l))return t(l,s);if(a(l))return!s||s.fraction!=="decimal"?l.s*l.n+"/"+l.d:l.toString();if(Array.isArray(l))return o(l,s);if(n.isString(l))return'"'+l+'"';if(typeof l=="function")return l.syntax?String(l.syntax):"function";if(l&&e(l)==="object"){if(typeof l.format=="function")return l.format(s);if(l&&l.toString()!=={}.toString())return l.toString();var f=[];for(var u in l)l.hasOwnProperty(u)&&f.push('"'+u+'": '+n.format(l[u],s));return"{"+f.join(", ")+"}"}return String(l)},n.stringify=function(l){for(var s=String(l),f="",u=0;u<s.length;){var c=s.charAt(u);c==="\\"?(f+=c,u++,c=s.charAt(u),(c===""||'"\\/bfnrtu'.indexOf(c)===-1)&&(f+="\\"),f+=c):c==='"'?f+='\\"':f+=c,u++}return'"'+f+'"'},n.escape=function(l){var s=String(l);return s=s.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),s};function o(l,s){if(Array.isArray(l)){for(var f="[",u=l.length,c=0;c<u;c++)c!==0&&(f+=", "),f+=o(l[c],s);return f+="]",f}else return n.format(l,s)}function a(l){return l&&e(l)==="object"&&typeof l.s=="number"&&typeof l.n=="number"&&typeof l.d=="number"||!1}}(Ir)),Ir}var Tr,so;function Za(){if(so)return Tr;so=1;function n(e,i,t){if(!(this instanceof n))throw new SyntaxError("Constructor must be called with the new operator");this.actual=e,this.expected=i,this.relation=t,this.message="Dimension mismatch ("+(Array.isArray(e)?"["+e.join(", ")+"]":e)+" "+(this.relation||"!=")+" "+(Array.isArray(i)?"["+i.join(", ")+"]":i)+")",this.stack=new Error().stack}return n.prototype=new RangeError,n.prototype.constructor=RangeError,n.prototype.name="DimensionError",n.prototype.isDimensionError=!0,Tr=n,Tr}var lo;function Mt(){if(lo)return $e;lo=1,Object.defineProperty($e,"__esModule",{value:!0}),$e.size=o,$e.validate=l,$e.validateIndex=s,$e.resize=f,$e.reshape=c,$e.squeeze=p,$e.unsqueeze=v,$e.flatten=_,$e.map=y,$e.forEach=b,$e.filter=E,$e.filterRegExp=N,$e.join=S,$e.identify=A,$e.generalize=x;var n=r(jn),e=r(wt()),i=r(Za()),t=r(Ja());function r(w){return w&&w.__esModule?w:{default:w}}function o(w){for(var I=[];Array.isArray(w);)I.push(w.length),w=w[0];return I}function a(w,I,L){var C,j=w.length;if(j!==I[L])throw new i.default(j,I[L]);if(L<I.length-1){var Y=L+1;for(C=0;C<j;C++){var ae=w[C];if(!Array.isArray(ae))throw new i.default(I.length-1,I.length,"<");a(w[C],I,Y)}}else for(C=0;C<j;C++)if(Array.isArray(w[C]))throw new i.default(I.length+1,I.length,">")}function l(w,I){var L=I.length===0;if(L){if(Array.isArray(w))throw new i.default(w.length,0)}else a(w,I,0)}function s(w,I){if(!n.default.isNumber(w)||!n.default.isInteger(w))throw new TypeError("Index must be an integer (value: "+w+")");if(w<0||typeof I=="number"&&w>=I)throw new t.default(w,I)}function f(w,I,L){if(!Array.isArray(w)||!Array.isArray(I))throw new TypeError("Array expected");if(I.length===0)throw new Error("Resizing to scalar is not supported");I.forEach(function(j){if(!n.default.isNumber(j)||!n.default.isInteger(j)||j<0)throw new TypeError("Invalid size, must contain positive integers (size: "+e.default.format(I)+")")});var C=L!==void 0?L:0;return u(w,I,0,C),w}function u(w,I,L,C){var j,Y,ae=w.length,V=I[L],se=Math.min(ae,V);if(w.length=V,L<I.length-1){var Te=L+1;for(j=0;j<se;j++)Y=w[j],Array.isArray(Y)||(Y=[Y],w[j]=Y),u(Y,I,Te,C);for(j=se;j<V;j++)Y=[],w[j]=Y,u(Y,I,Te,C)}else{for(j=0;j<se;j++)for(;Array.isArray(w[j]);)w[j]=w[j][0];for(j=se;j<V;j++)w[j]=C}}function c(w,I){var L=_(w),C;function j(V){return V.reduce(function(se,Te){return se*Te})}if(!Array.isArray(w)||!Array.isArray(I))throw new TypeError("Array expected");if(I.length===0)throw new i.default(0,j(o(w)),"!=");for(var Y=1,ae=0;ae<I.length;ae++)Y*=I[ae];if(L.length!==Y)throw new i.default(j(I),j(o(w)),"!=");try{C=h(L,I)}catch(V){throw V instanceof i.default?new i.default(j(I),j(o(w)),"!="):V}return C}function h(w,I){for(var L=w,C,j=I.length-1;j>0;j--){var Y=I[j];C=[];for(var ae=L.length/Y,V=0;V<ae;V++)C.push(L.slice(V*Y,(V+1)*Y));L=C}return L}function p(w,I){for(var L=I||o(w);Array.isArray(w)&&w.length===1;)w=w[0],L.shift();for(var C=L.length;L[C-1]===1;)C--;return C<L.length&&(w=m(w,C,0),L.length=C),w}function m(w,I,L){var C,j;if(L<I){var Y=L+1;for(C=0,j=w.length;C<j;C++)w[C]=m(w[C],I,Y)}else for(;Array.isArray(w);)w=w[0];return w}function v(w,I,L,C){var j=C||o(w);if(L)for(var Y=0;Y<L;Y++)w=[w],j.unshift(1);for(w=d(w,I,0);j.length<I;)j.push(1);return w}function d(w,I,L){var C,j;if(Array.isArray(w)){var Y=L+1;for(C=0,j=w.length;C<j;C++)w[C]=d(w[C],I,Y)}else for(var ae=L;ae<I;ae++)w=[w];return w}function _(w){if(!Array.isArray(w))return w;var I=[];return w.forEach(function L(C){Array.isArray(C)?C.forEach(L):I.push(C)}),I}function y(w,I){return Array.prototype.map.call(w,I)}function b(w,I){Array.prototype.forEach.call(w,I)}function E(w,I){if(o(w).length!==1)throw new Error("Only one dimensional matrices supported");return Array.prototype.filter.call(w,I)}function N(w,I){if(o(w).length!==1)throw new Error("Only one dimensional matrices supported");return Array.prototype.filter.call(w,function(L){return I.test(L)})}function S(w,I){return Array.prototype.join.call(w,I)}function A(w){if(!Array.isArray(w))throw new TypeError("Array input expected");if(w.length===0)return w;var I=[],L=0;I[0]={value:w[0],identifier:0};for(var C=1;C<w.length;C++)w[C]===w[C-1]?L++:L=0,I.push({value:w[C],identifier:L});return I}function x(w){if(!Array.isArray(w))throw new TypeError("Array input expected");if(w.length===0)return w;for(var I=[],L=0;L<w.length;L++)I.push(w[L].value);return I}return $e}var Qn={},uo;function Qa(){if(uo)return Qn;uo=1;function n(e,i,t,r){var o=r("matrix",{"":function(){return a([])},string:function(s){return a([],s)},"string, string":function(s,f){return a([],s,f)},Array:function(s){return a(s)},Matrix:function(s){return a(s,s.storage())},"Array | Matrix, string":a,"Array | Matrix, string, string":a});return o.toTex={0:"\\begin{bmatrix}\\end{bmatrix}",1:"\\left(${args[0]}\\right)",2:"\\left(${args[0]}\\right)"},o;function a(l,s,f){var u=e.Matrix.storage(s||"default");return new u(l,f)}}return Qn.name="matrix",Qn.factory=n,Qn}var fo;function $a(){if(fo)return Zn;fo=1;var n=ot.clone,e=Mt().validateIndex,i=at().getSafeProperty,t=at().setSafeProperty,r=Za();function o(s,f,u,c){var h=u(Qa()),p=c("subset",{"Array, Index":function(_,y){var b=h(_),E=b.subset(y);return y.isScalar()?E:E.valueOf()},"Matrix, Index":function(_,y){return _.subset(y)},"Object, Index":a,"string, Index":m,"Array, Index, any":function(_,y,b){return h(n(_)).subset(y,b,void 0).valueOf()},"Array, Index, any, any":function(_,y,b,E){return h(n(_)).subset(y,b,E).valueOf()},"Matrix, Index, any":function(_,y,b){return _.clone().subset(y,b)},"Matrix, Index, any, any":function(_,y,b,E){return _.clone().subset(y,b,E)},"string, Index, string":v,"string, Index, string, string":v,"Object, Index, any":l});return p.toTex=void 0,p;function m(d,_){if(!s.isIndex(_))throw new TypeError("Index expected");if(_.size().length!==1)throw new r(_.size().length,1);var y=d.length;e(_.min()[0],y),e(_.max()[0],y);var b=_.dimension(0),E="";return b.forEach(function(N){E+=d.charAt(N)}),E}function v(d,_,y,b){if(!_||_.isIndex!==!0)throw new TypeError("Index expected");if(_.size().length!==1)throw new r(_.size().length,1);if(b!==void 0){if(typeof b!="string"||b.length!==1)throw new TypeError("Single character expected as defaultValue")}else b=" ";var E=_.dimension(0),N=E.size()[0];if(N!==y.length)throw new r(E.size()[0],y.length);var S=d.length;e(_.min()[0]),e(_.max()[0]);for(var A=[],x=0;x<S;x++)A[x]=d.charAt(x);if(E.forEach(function(L,C){A[L]=y.charAt(C[0])}),A.length>S)for(var w=S-1,I=A.length;w<I;w++)A[w]||(A[w]=b);return A.join("")}}function a(s,f){if(f.size().length!==1)throw new r(f.size(),1);var u=f.dimension(0);if(typeof u!="string")throw new TypeError("String expected as index to retrieve an object property");return i(s,u)}function l(s,f,u){if(f.size().length!==1)throw new r(f.size(),1);var c=f.dimension(0);if(typeof c!="string")throw new TypeError("String expected as index to retrieve an object property");var h=n(s);return t(h,c,u),h}return Zn.name="subset",Zn.factory=o,Zn}var co;function es(){if(co)return Nr;co=1;function n(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?n=function(a){return typeof a}:n=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},n(r)}var e=Ka().transform,i=at().getSafeProperty;function t(r,o,a,l){var s=a($a());return function(u,c){try{if(Array.isArray(u))return s(u,c);if(u&&typeof u.subset=="function")return u.subset(c);if(typeof u=="string")return s(u,c);if(n(u)==="object"){if(!c.isObjectProperty())throw new TypeError("Cannot apply a numeric index as object property");return i(u,c.getObjectProperty())}else throw new TypeError("Cannot apply index: unsupported type of object")}catch(h){throw e(h)}}}return Nr.factory=t,Nr}var ho;function Ef(){if(ho)return gn;ho=1;var n=at().getSafeProperty;function e(i,t,r,o){var a=r(st()),l=r(es());function s(u,c){if(!(this instanceof s))throw new SyntaxError("Constructor must be called with the new operator");if(!i.isNode(u))throw new TypeError('Node expected for parameter "object"');if(!i.isIndexNode(c))throw new TypeError('IndexNode expected for parameter "index"');this.object=u||null,this.index=c,Object.defineProperty(this,"name",{get:function(){return this.index?this.index.isObjectProperty()?this.index.getObjectProperty():"":this.object.name||""}.bind(this),set:function(){throw new Error("Cannot assign a new name, name is read-only")}})}s.prototype=new a,s.prototype.type="AccessorNode",s.prototype.isAccessorNode=!0,s.prototype._compile=function(u,c){var h=this.object._compile(u,c),p=this.index._compile(u,c);if(this.index.isObjectProperty()){var m=this.index.getObjectProperty();return function(d,_,y){return n(h(d,_,y),m)}}else return function(d,_,y){var b=h(d,_,y),E=p(d,_,b);return l(b,E)}},s.prototype.forEach=function(u){u(this.object,"object",this),u(this.index,"index",this)},s.prototype.map=function(u){return new s(this._ifNode(u(this.object,"object",this)),this._ifNode(u(this.index,"index",this)))},s.prototype.clone=function(){return new s(this.object,this.index)},s.prototype._toString=function(u){var c=this.object.toString(u);return f(this.object)&&(c="("+c+")"),c+this.index.toString(u)},s.prototype.toHTML=function(u){var c=this.object.toHTML(u);return f(this.object)&&(c='<span class="math-parenthesis math-round-parenthesis">(</span>'+c+'<span class="math-parenthesis math-round-parenthesis">)</span>'),c+this.index.toHTML(u)},s.prototype._toTex=function(u){var c=this.object.toTex(u);return f(this.object)&&(c="\\left(' + object + '\\right)"),c+this.index.toTex(u)},s.prototype.toJSON=function(){return{mathjs:"AccessorNode",object:this.object,index:this.index}},s.fromJSON=function(u){return new s(u.object,u.index)};function f(u){return!(i.isAccessorNode(u)||i.isArrayNode(u)||i.isConstantNode(u)||i.isFunctionNode(u)||i.isObjectNode(u)||i.isParenthesisNode(u)||i.isSymbolNode(u))}return s}return gn.name="AccessorNode",gn.path="expression.node",gn.factory=e,gn}var vn={},po;function Nf(){if(po)return vn;po=1;var n=Mt().map;function e(i,t,r,o){var a=r(st());function l(s){if(!(this instanceof l))throw new SyntaxError("Constructor must be called with the new operator");if(this.items=s||[],!Array.isArray(this.items)||!this.items.every(i.isNode))throw new TypeError("Array containing Nodes expected");var f=function(){throw new Error("Property `ArrayNode.nodes` is deprecated, use `ArrayNode.items` instead")};Object.defineProperty(this,"nodes",{get:f,set:f})}return l.prototype=new a,l.prototype.type="ArrayNode",l.prototype.isArrayNode=!0,l.prototype._compile=function(s,f){var u=n(this.items,function(p){return p._compile(s,f)}),c=s.config().matrix!=="Array";if(c){var h=s.matrix;return function(m,v,d){return h(n(u,function(_){return _(m,v,d)}))}}else return function(m,v,d){return n(u,function(_){return _(m,v,d)})}},l.prototype.forEach=function(s){for(var f=0;f<this.items.length;f++){var u=this.items[f];s(u,"items["+f+"]",this)}},l.prototype.map=function(s){for(var f=[],u=0;u<this.items.length;u++)f[u]=this._ifNode(s(this.items[u],"items["+u+"]",this));return new l(f)},l.prototype.clone=function(){return new l(this.items.slice(0))},l.prototype._toString=function(s){var f=this.items.map(function(u){return u.toString(s)});return"["+f.join(", ")+"]"},l.prototype.toJSON=function(){return{mathjs:"ArrayNode",items:this.items}},l.fromJSON=function(s){return new l(s.items)},l.prototype.toHTML=function(s){var f=this.items.map(function(u){return u.toHTML(s)});return'<span class="math-parenthesis math-square-parenthesis">[</span>'+f.join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-square-parenthesis">]</span>'},l.prototype._toTex=function(s){var f="\\begin{bmatrix}";return this.items.forEach(function(u){u.items?f+=u.items.map(function(c){return c.toTex(s)}).join("&"):f+=u.toTex(s),f+="\\\\"}),f+="\\end{bmatrix}",f},l}return vn.name="ArrayNode",vn.path="expression.node",vn.factory=e,vn}var yn={},Ar={},mo;function Sf(){if(mo)return Ar;mo=1;function n(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?n=function(a){return typeof a}:n=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},n(r)}var e=Ka().transform,i=at().setSafeProperty;function t(r,o,a,l){var s=a($a()),f=a(Qa());return function(c,h,p){try{if(Array.isArray(c))return f(c).subset(h,p).valueOf();if(c&&typeof c.subset=="function")return c.subset(h,p);if(typeof c=="string")return s(c,h,p);if(n(c)==="object"){if(!h.isObjectProperty())throw TypeError("Cannot apply a numeric index as object property");return i(c,h.getObjectProperty(),p),c}else throw new TypeError("Cannot apply index: unsupported type of object")}catch(m){throw e(m)}}}return Ar.factory=t,Ar}var Yt={},go;function fn(){if(go)return Yt;go=1;var n=[{AssignmentNode:{},FunctionAssignmentNode:{}},{ConditionalNode:{latexLeftParens:!1,latexRightParens:!1,latexParens:!1}},{"OperatorNode:or":{associativity:"left",associativeWith:[]}},{"OperatorNode:xor":{associativity:"left",associativeWith:[]}},{"OperatorNode:and":{associativity:"left",associativeWith:[]}},{"OperatorNode:bitOr":{associativity:"left",associativeWith:[]}},{"OperatorNode:bitXor":{associativity:"left",associativeWith:[]}},{"OperatorNode:bitAnd":{associativity:"left",associativeWith:[]}},{"OperatorNode:equal":{associativity:"left",associativeWith:[]},"OperatorNode:unequal":{associativity:"left",associativeWith:[]},"OperatorNode:smaller":{associativity:"left",associativeWith:[]},"OperatorNode:larger":{associativity:"left",associativeWith:[]},"OperatorNode:smallerEq":{associativity:"left",associativeWith:[]},"OperatorNode:largerEq":{associativity:"left",associativeWith:[]},RelationalNode:{associativity:"left",associativeWith:[]}},{"OperatorNode:leftShift":{associativity:"left",associativeWith:[]},"OperatorNode:rightArithShift":{associativity:"left",associativeWith:[]},"OperatorNode:rightLogShift":{associativity:"left",associativeWith:[]}},{"OperatorNode:to":{associativity:"left",associativeWith:[]}},{RangeNode:{}},{"OperatorNode:add":{associativity:"left",associativeWith:["OperatorNode:add","OperatorNode:subtract"]},"OperatorNode:subtract":{associativity:"left",associativeWith:[]}},{"OperatorNode:multiply":{associativity:"left",associativeWith:["OperatorNode:multiply","OperatorNode:divide","Operator:dotMultiply","Operator:dotDivide"]},"OperatorNode:divide":{associativity:"left",associativeWith:[],latexLeftParens:!1,latexRightParens:!1,latexParens:!1},"OperatorNode:dotMultiply":{associativity:"left",associativeWith:["OperatorNode:multiply","OperatorNode:divide","OperatorNode:dotMultiply","OperatorNode:doDivide"]},"OperatorNode:dotDivide":{associativity:"left",associativeWith:[]},"OperatorNode:mod":{associativity:"left",associativeWith:[]}},{"OperatorNode:unaryPlus":{associativity:"right"},"OperatorNode:unaryMinus":{associativity:"right"},"OperatorNode:bitNot":{associativity:"right"},"OperatorNode:not":{associativity:"right"}},{"OperatorNode:pow":{associativity:"right",associativeWith:[],latexRightParens:!1},"OperatorNode:dotPow":{associativity:"right",associativeWith:[]}},{"OperatorNode:factorial":{associativity:"left"}},{"OperatorNode:transpose":{associativity:"left"}}];function e(r,o){var a=r;o!=="keep"&&(a=r.getContent());for(var l=a.getIdentifier(),s=0;s<n.length;s++)if(l in n[s])return s;return null}function i(r,o){var a=r;o!=="keep"&&(a=r.getContent());var l=a.getIdentifier(),s=e(a,o);if(s===null)return null;var f=n[s][l];if(f.hasOwnProperty("associativity")){if(f.associativity==="left")return"left";if(f.associativity==="right")return"right";throw Error("'"+l+"' has the invalid associativity '"+f.associativity+"'.")}return null}function t(r,o,a){var l=a!=="keep"?r.getContent():r,s=a!=="keep"?r.getContent():o,f=l.getIdentifier(),u=s.getIdentifier(),c=e(l,a);if(c===null)return null;var h=n[c][f];if(h.hasOwnProperty("associativeWith")&&h.associativeWith instanceof Array){for(var p=0;p<h.associativeWith.length;p++)if(h.associativeWith[p]===u)return!0;return!1}return null}return Yt.properties=n,Yt.getPrecedence=e,Yt.getAssociativity=i,Yt.isAssociativeWith=t,Yt}var vo;function xf(){if(vo)return yn;vo=1;var n=at().getSafeProperty,e=at().setSafeProperty;function i(t,r,o,a){var l=o(st()),s=o(Sf()),f=o(es()),u=fn();function c(p,m,v){if(!(this instanceof c))throw new SyntaxError("Constructor must be called with the new operator");if(this.object=p,this.index=v?m:null,this.value=v||m,!t.isSymbolNode(p)&&!t.isAccessorNode(p))throw new TypeError('SymbolNode or AccessorNode expected as "object"');if(t.isSymbolNode(p)&&p.name==="end")throw new Error('Cannot assign to symbol "end"');if(this.index&&!t.isIndexNode(this.index))throw new TypeError('IndexNode expected as "index"');if(!t.isNode(this.value))throw new TypeError('Node expected as "value"');Object.defineProperty(this,"name",{get:function(){return this.index?this.index.isObjectProperty()?this.index.getObjectProperty():"":this.object.name||""}.bind(this),set:function(){throw new Error("Cannot assign a new name, name is read-only")}})}c.prototype=new l,c.prototype.type="AssignmentNode",c.prototype.isAssignmentNode=!0,c.prototype._compile=function(p,m){var v=this.object._compile(p,m),d=this.index?this.index._compile(p,m):null,_=this.value._compile(p,m),y=this.object.name;if(this.index)if(this.index.isObjectProperty()){var b=this.index.getObjectProperty();return function(x,w,I){var L=v(x,w,I),C=_(x,w,I);return e(L,b,C)}}else{if(t.isSymbolNode(this.object))return function(x,w,I){var L=v(x,w,I),C=_(x,w,I),j=d(x,w,L);return e(x,y,s(L,j,C)),C};var E=this.object.object._compile(p,m);if(this.object.index.isObjectProperty()){var N=this.object.index.getObjectProperty();return function(x,w,I){var L=E(x,w,I),C=n(L,N),j=d(x,w,C),Y=_(x,w,I);return e(L,N,s(C,j,Y)),Y}}else{var S=this.object.index._compile(p,m);return function(x,w,I){var L=E(x,w,I),C=S(x,w,L),j=f(L,C),Y=d(x,w,j),ae=_(x,w,I);return s(L,C,s(j,Y,ae)),ae}}}else{if(!t.isSymbolNode(this.object))throw new TypeError("SymbolNode expected as object");return function(x,w,I){return e(x,y,_(x,w,I))}}},c.prototype.forEach=function(p){p(this.object,"object",this),this.index&&p(this.index,"index",this),p(this.value,"value",this)},c.prototype.map=function(p){var m=this._ifNode(p(this.object,"object",this)),v=this.index?this._ifNode(p(this.index,"index",this)):null,d=this._ifNode(p(this.value,"value",this));return new c(m,v,d)},c.prototype.clone=function(){return new c(this.object,this.index,this.value)};function h(p,m){m||(m="keep");var v=u.getPrecedence(p,m),d=u.getPrecedence(p.value,m);return m==="all"||d!==null&&d<=v}return c.prototype._toString=function(p){var m=this.object.toString(p),v=this.index?this.index.toString(p):"",d=this.value.toString(p);return h(this,p&&p.parenthesis)&&(d="("+d+")"),m+v+" = "+d},c.prototype.toJSON=function(){return{mathjs:"AssignmentNode",object:this.object,index:this.index,value:this.value}},c.fromJSON=function(p){return new c(p.object,p.index,p.value)},c.prototype.toHTML=function(p){var m=this.object.toHTML(p),v=this.index?this.index.toHTML(p):"",d=this.value.toHTML(p);return h(this,p&&p.parenthesis)&&(d='<span class="math-paranthesis math-round-parenthesis">(</span>'+d+'<span class="math-paranthesis math-round-parenthesis">)</span>'),m+v+'<span class="math-operator math-assignment-operator math-variable-assignment-operator math-binary-operator">=</span>'+d},c.prototype._toTex=function(p){var m=this.object.toTex(p),v=this.index?this.index.toTex(p):"",d=this.value.toTex(p);return h(this,p&&p.parenthesis)&&(d="\\left(".concat(d,"\\right)")),m+v+":="+d},c}return yn.name="AssignmentNode",yn.path="expression.node",yn.factory=i,yn}var _n={},bn={},yo;function If(){if(yo)return bn;yo=1;function n(e,i,t,r){function o(a){if(!(this instanceof o))throw new SyntaxError("Constructor must be called with the new operator");this.entries=a||[]}return o.prototype.type="ResultSet",o.prototype.isResultSet=!0,o.prototype.valueOf=function(){return this.entries},o.prototype.toString=function(){return"["+this.entries.join(", ")+"]"},o.prototype.toJSON=function(){return{mathjs:"ResultSet",entries:this.entries}},o.fromJSON=function(a){return new o(a.entries)},o}return bn.name="ResultSet",bn.path="type",bn.factory=n,bn}var _o;function Of(){if(_o)return _n;_o=1;var n=Mt().forEach,e=Mt().map;function i(t,r,o,a){var l=o(st()),s=o(If());function f(u){if(!(this instanceof f))throw new SyntaxError("Constructor must be called with the new operator");if(!Array.isArray(u))throw new Error("Array expected");this.blocks=u.map(function(c){var h=c&&c.node,p=c&&c.visible!==void 0?c.visible:!0;if(!t.isNode(h))throw new TypeError('Property "node" must be a Node');if(typeof p!="boolean")throw new TypeError('Property "visible" must be a boolean');return{node:h,visible:p}})}return f.prototype=new l,f.prototype.type="BlockNode",f.prototype.isBlockNode=!0,f.prototype._compile=function(u,c){var h=e(this.blocks,function(p){return{eval:p.node._compile(u,c),visible:p.visible}});return function(m,v,d){var _=[];return n(h,function(b){var E=b.eval(m,v,d);b.visible&&_.push(E)}),new s(_)}},f.prototype.forEach=function(u){for(var c=0;c<this.blocks.length;c++)u(this.blocks[c].node,"blocks["+c+"].node",this)},f.prototype.map=function(u){for(var c=[],h=0;h<this.blocks.length;h++){var p=this.blocks[h],m=this._ifNode(u(p.node,"blocks["+h+"].node",this));c[h]={node:m,visible:p.visible}}return new f(c)},f.prototype.clone=function(){var u=this.blocks.map(function(c){return{node:c.node,visible:c.visible}});return new f(u)},f.prototype._toString=function(u){return this.blocks.map(function(c){return c.node.toString(u)+(c.visible?"":";")}).join(`
`)},f.prototype.toJSON=function(){return{mathjs:"BlockNode",blocks:this.blocks}},f.fromJSON=function(u){return new f(u.blocks)},f.prototype.toHTML=function(u){return this.blocks.map(function(c){return c.node.toHTML(u)+(c.visible?"":'<span class="math-separator">;</span>')}).join('<span class="math-separator"><br /></span>')},f.prototype._toTex=function(u){return this.blocks.map(function(c){return c.node.toTex(u)+(c.visible?"":";")}).join(`\\;\\;
`)},f}return _n.name="BlockNode",_n.path="expression.node",_n.factory=i,_n}var wn={},bo;function Tf(){if(bo)return wn;bo=1;var n=fn();function e(i,t,r,o){var a=r(st()),l=r(li());function s(u,c,h){if(!(this instanceof s))throw new SyntaxError("Constructor must be called with the new operator");if(!i.isNode(u))throw new TypeError("Parameter condition must be a Node");if(!i.isNode(c))throw new TypeError("Parameter trueExpr must be a Node");if(!i.isNode(h))throw new TypeError("Parameter falseExpr must be a Node");this.condition=u,this.trueExpr=c,this.falseExpr=h}s.prototype=new a,s.prototype.type="ConditionalNode",s.prototype.isConditionalNode=!0,s.prototype._compile=function(u,c){var h=this.condition._compile(u,c),p=this.trueExpr._compile(u,c),m=this.falseExpr._compile(u,c);return function(d,_,y){return f(h(d,_,y))?p(d,_,y):m(d,_,y)}},s.prototype.forEach=function(u){u(this.condition,"condition",this),u(this.trueExpr,"trueExpr",this),u(this.falseExpr,"falseExpr",this)},s.prototype.map=function(u){return new s(this._ifNode(u(this.condition,"condition",this)),this._ifNode(u(this.trueExpr,"trueExpr",this)),this._ifNode(u(this.falseExpr,"falseExpr",this)))},s.prototype.clone=function(){return new s(this.condition,this.trueExpr,this.falseExpr)},s.prototype._toString=function(u){var c=u&&u.parenthesis?u.parenthesis:"keep",h=n.getPrecedence(this,c),p=this.condition.toString(u),m=n.getPrecedence(this.condition,c);(c==="all"||this.condition.type==="OperatorNode"||m!==null&&m<=h)&&(p="("+p+")");var v=this.trueExpr.toString(u),d=n.getPrecedence(this.trueExpr,c);(c==="all"||this.trueExpr.type==="OperatorNode"||d!==null&&d<=h)&&(v="("+v+")");var _=this.falseExpr.toString(u),y=n.getPrecedence(this.falseExpr,c);return(c==="all"||this.falseExpr.type==="OperatorNode"||y!==null&&y<=h)&&(_="("+_+")"),p+" ? "+v+" : "+_},s.prototype.toJSON=function(){return{mathjs:"ConditionalNode",condition:this.condition,trueExpr:this.trueExpr,falseExpr:this.falseExpr}},s.fromJSON=function(u){return new s(u.condition,u.trueExpr,u.falseExpr)},s.prototype.toHTML=function(u){var c=u&&u.parenthesis?u.parenthesis:"keep",h=n.getPrecedence(this,c),p=this.condition.toHTML(u),m=n.getPrecedence(this.condition,c);(c==="all"||this.condition.type==="OperatorNode"||m!==null&&m<=h)&&(p='<span class="math-parenthesis math-round-parenthesis">(</span>'+p+'<span class="math-parenthesis math-round-parenthesis">)</span>');var v=this.trueExpr.toHTML(u),d=n.getPrecedence(this.trueExpr,c);(c==="all"||this.trueExpr.type==="OperatorNode"||d!==null&&d<=h)&&(v='<span class="math-parenthesis math-round-parenthesis">(</span>'+v+'<span class="math-parenthesis math-round-parenthesis">)</span>');var _=this.falseExpr.toHTML(u),y=n.getPrecedence(this.falseExpr,c);return(c==="all"||this.falseExpr.type==="OperatorNode"||y!==null&&y<=h)&&(_='<span class="math-parenthesis math-round-parenthesis">(</span>'+_+'<span class="math-parenthesis math-round-parenthesis">)</span>'),p+'<span class="math-operator math-conditional-operator">?</span>'+v+'<span class="math-operator math-conditional-operator">:</span>'+_},s.prototype._toTex=function(u){return"\\begin{cases} {"+this.trueExpr.toTex(u)+"}, &\\quad{\\text{if }\\;"+this.condition.toTex(u)+"}\\\\{"+this.falseExpr.toTex(u)+"}, &\\quad{\\text{otherwise}}\\end{cases}"};function f(u){if(typeof u=="number"||typeof u=="boolean"||typeof u=="string")return!!u;if(u){if(i.isBigNumber(u))return!u.isZero();if(i.isComplex(u))return!!(u.re||u.im);if(i.isUnit(u))return!!u.value}if(u==null)return!1;throw new TypeError('Unsupported type of condition "'+l(u)+'"')}return s}return wn.name="ConditionalNode",wn.path="expression.node",wn.factory=e,wn}var En={},Rr={},Mr,wo;function Af(){if(wo)return Mr;wo=1;var n=Object.assign||function(r){for(var o=1;o<arguments.length;o++){var a=arguments[o];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(r[l]=a[l])}return r},e={"{":"\\{","}":"\\}","\\":"\\textbackslash{}","#":"\\#",$:"\\$","%":"\\%","&":"\\&","^":"\\textasciicircum{}",_:"\\_","~":"\\textasciitilde{}"},i={"\u2013":"\\--","\u2014":"\\---"," ":"~","	":"\\qquad{}","\r\n":"\\newline{}","\n":"\\newline{}"},t=function(o,a){return n({},o,a)};return Mr=function(r){for(var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=o.preserveFormatting,l=a===void 0?!1:a,s=o.escapeMapFn,f=s===void 0?t:s,u=String(r),c="",h=f(n({},e),l?n({},i):{}),p=Object.keys(h),m=function(){var d=!1;p.forEach(function(_,y){d||u.length>=_.length&&u.slice(0,_.length)===_&&(c+=h[p[y]],u=u.slice(_.length,u.length),d=!0)}),d||(c+=u.slice(0,1),u=u.slice(1,u.length))};u;)m();return c},Mr}var Eo;function cn(){return Eo||(Eo=1,function(n){var e=Af();n.symbols={Alpha:"A",alpha:"\\alpha",Beta:"B",beta:"\\beta",Gamma:"\\Gamma",gamma:"\\gamma",Delta:"\\Delta",delta:"\\delta",Epsilon:"E",epsilon:"\\epsilon",varepsilon:"\\varepsilon",Zeta:"Z",zeta:"\\zeta",Eta:"H",eta:"\\eta",Theta:"\\Theta",theta:"\\theta",vartheta:"\\vartheta",Iota:"I",iota:"\\iota",Kappa:"K",kappa:"\\kappa",varkappa:"\\varkappa",Lambda:"\\Lambda",lambda:"\\lambda",Mu:"M",mu:"\\mu",Nu:"N",nu:"\\nu",Xi:"\\Xi",xi:"\\xi",Omicron:"O",omicron:"o",Pi:"\\Pi",pi:"\\pi",varpi:"\\varpi",Rho:"P",rho:"\\rho",varrho:"\\varrho",Sigma:"\\Sigma",sigma:"\\sigma",varsigma:"\\varsigma",Tau:"T",tau:"\\tau",Upsilon:"\\Upsilon",upsilon:"\\upsilon",Phi:"\\Phi",phi:"\\phi",varphi:"\\varphi",Chi:"X",chi:"\\chi",Psi:"\\Psi",psi:"\\psi",Omega:"\\Omega",omega:"\\omega",true:"\\mathrm{True}",false:"\\mathrm{False}",i:"i",inf:"\\infty",Inf:"\\infty",infinity:"\\infty",Infinity:"\\infty",oo:"\\infty",lim:"\\lim",undefined:"\\mathbf{?}"},n.operators={transpose:"^\\top",ctranspose:"^H",factorial:"!",pow:"^",dotPow:".^\\wedge",unaryPlus:"+",unaryMinus:"-",bitNot:"\\~",not:"\\neg",multiply:"\\cdot",divide:"\\frac",dotMultiply:".\\cdot",dotDivide:".:",mod:"\\mod",add:"+",subtract:"-",to:"\\rightarrow",leftShift:"<<",rightArithShift:">>",rightLogShift:">>>",equal:"=",unequal:"\\neq",smaller:"<",larger:">",smallerEq:"\\leq",largerEq:"\\geq",bitAnd:"\\&",bitXor:"\\underline{|}",bitOr:"|",and:"\\wedge",xor:"\\veebar",or:"\\vee"},n.defaultTemplate="\\mathrm{${name}}\\left(${args}\\right)";var i={deg:"^\\circ"};n.escape=function(t){return e(t,{preserveFormatting:!0})},n.toSymbol=function(t,r){return r=typeof r>"u"?!1:r,r?i.hasOwnProperty(t)?i[t]:"\\mathrm{"+n.escape(t)+"}":n.symbols.hasOwnProperty(t)?n.symbols[t]:n.escape(t)}}(Rr)),Rr}var No;function Rf(){if(No)return En;No=1;var n=wt().format,e=cn().escape;function i(t,r,o,a){var l=o(st()),s=o(li());function f(u){if(!(this instanceof f))throw new SyntaxError("Constructor must be called with the new operator");if(arguments.length===2)throw new SyntaxError("new ConstantNode(valueStr, valueType) is not supported anymore since math v4.0.0. Use new ConstantNode(value) instead, where value is a non-stringified value.");this.value=u}return f.prototype=new l,f.prototype.type="ConstantNode",f.prototype.isConstantNode=!0,f.prototype._compile=function(u,c){var h=this.value;return function(){return h}},f.prototype.forEach=function(u){},f.prototype.map=function(u){return this.clone()},f.prototype.clone=function(){return new f(this.value)},f.prototype._toString=function(u){return n(this.value,u)},f.prototype.toHTML=function(u){var c=this._toString(u);switch(s(this.value)){case"number":case"BigNumber":case"Fraction":return'<span class="math-number">'+c+"</span>";case"string":return'<span class="math-string">'+c+"</span>";case"boolean":return'<span class="math-boolean">'+c+"</span>";case"null":return'<span class="math-null-symbol">'+c+"</span>";case"undefined":return'<span class="math-undefined">'+c+"</span>";default:return'<span class="math-symbol">'+c+"</span>"}},f.prototype.toJSON=function(){return{mathjs:"ConstantNode",value:this.value}},f.fromJSON=function(u){return new f(u.value)},f.prototype._toTex=function(u){var c=this._toString(u);switch(s(this.value)){case"string":return"\\mathtt{"+e(c)+"}";case"number":case"BigNumber":var h=c.toLowerCase().indexOf("e");return h!==-1?c.substring(0,h)+"\\cdot10^{"+c.substring(h+1)+"}":c;case"Fraction":return this.value.toLatex();default:return c}},f}return En.name="ConstantNode",En.path="expression.node",En.factory=i,En}var Nn={},So;function Mf(){if(So)return Nn;So=1;var n=Ya(),e=wt().escape,i=Mt().forEach,t=Mt().join,r=cn(),o=fn(),a=at().setSafeProperty;function l(s,f,u,c){var h=u(st());function p(v,d,_){if(!(this instanceof p))throw new SyntaxError("Constructor must be called with the new operator");if(typeof v!="string")throw new TypeError('String expected for parameter "name"');if(!Array.isArray(d))throw new TypeError('Array containing strings or objects expected for parameter "params"');if(!s.isNode(_))throw new TypeError('Node expected for parameter "expr"');if(v in n)throw new Error('Illegal function name, "'+v+'" is a reserved keyword');this.name=v,this.params=d.map(function(y){return y&&y.name||y}),this.types=d.map(function(y){return y&&y.type||"any"}),this.expr=_}p.prototype=new h,p.prototype.type="FunctionAssignmentNode",p.prototype.isFunctionAssignmentNode=!0,p.prototype._compile=function(v,d){var _=Object.create(d);i(this.params,function(A){_[A]=!0});var y=this.expr._compile(v,_),b=this.name,E=this.params,N=t(this.types,","),S=b+"("+t(this.params,", ")+")";return function(x,w,I){var L={};L[N]=function(){for(var j=Object.create(w),Y=0;Y<E.length;Y++)j[E[Y]]=arguments[Y];return y(x,j,I)};var C=c(b,L);return C.syntax=S,a(x,b,C),C}},p.prototype.forEach=function(v){v(this.expr,"expr",this)},p.prototype.map=function(v){var d=this._ifNode(v(this.expr,"expr",this));return new p(this.name,this.params.slice(0),d)},p.prototype.clone=function(){return new p(this.name,this.params.slice(0),this.expr)};function m(v,d){var _=o.getPrecedence(v,d),y=o.getPrecedence(v.expr,d);return d==="all"||y!==null&&y<=_}return p.prototype._toString=function(v){var d=v&&v.parenthesis?v.parenthesis:"keep",_=this.expr.toString(v);return m(this,d)&&(_="("+_+")"),this.name+"("+this.params.join(", ")+") = "+_},p.prototype.toJSON=function(){var v=this.types;return{mathjs:"FunctionAssignmentNode",name:this.name,params:this.params.map(function(d,_){return{name:d,type:v[_]}}),expr:this.expr}},p.fromJSON=function(v){return new p(v.name,v.params,v.expr)},p.prototype.toHTML=function(v){for(var d=v&&v.parenthesis?v.parenthesis:"keep",_=[],y=0;y<this.params.length;y++)_.push('<span class="math-symbol math-parameter">'+e(this.params[y])+"</span>");var b=this.expr.toHTML(v);return m(this,d)&&(b='<span class="math-parenthesis math-round-parenthesis">(</span>'+b+'<span class="math-parenthesis math-round-parenthesis">)</span>'),'<span class="math-function">'+e(this.name)+'</span><span class="math-parenthesis math-round-parenthesis">(</span>'+_.join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-round-parenthesis">)</span><span class="math-operator math-assignment-operator math-variable-assignment-operator math-binary-operator">=</span>'+b},p.prototype._toTex=function(v){var d=v&&v.parenthesis?v.parenthesis:"keep",_=this.expr.toTex(v);return m(this,d)&&(_="\\left(".concat(_,"\\right)")),"\\mathrm{"+this.name+"}\\left("+this.params.map(r.toSymbol).join(",")+"\\right):="+_},p}return Nn.name="FunctionAssignmentNode",Nn.path="expression.node",Nn.factory=l,Nn}var Sn={},xn={},xo;function Pf(){if(xo)return xn;xo=1;var n=jn;function e(i,t,r,o){function a(l,s,f){if(!(this instanceof a))throw new SyntaxError("Constructor must be called with the new operator");var u=l!=null,c=s!=null,h=f!=null;if(u){if(i.isBigNumber(l))l=l.toNumber();else if(typeof l!="number")throw new TypeError("Parameter start must be a number")}if(c){if(i.isBigNumber(s))s=s.toNumber();else if(typeof s!="number")throw new TypeError("Parameter end must be a number")}if(h){if(i.isBigNumber(f))f=f.toNumber();else if(typeof f!="number")throw new TypeError("Parameter step must be a number")}this.start=u?parseFloat(l):0,this.end=c?parseFloat(s):0,this.step=h?parseFloat(f):1}return a.prototype.type="Range",a.prototype.isRange=!0,a.parse=function(l){if(typeof l!="string")return null;var s=l.split(":"),f=s.map(function(c){return parseFloat(c)}),u=f.some(function(c){return isNaN(c)});if(u)return null;switch(f.length){case 2:return new a(f[0],f[1]);case 3:return new a(f[0],f[2],f[1]);default:return null}},a.prototype.clone=function(){return new a(this.start,this.end,this.step)},a.prototype.size=function(){var l=0,s=this.start,f=this.step,u=this.end,c=u-s;return n.sign(f)===n.sign(c)?l=Math.ceil(c/f):c===0&&(l=0),isNaN(l)&&(l=0),[l]},a.prototype.min=function(){var l=this.size()[0];if(l>0)return this.step>0?this.start:this.start+(l-1)*this.step},a.prototype.max=function(){var l=this.size()[0];if(l>0)return this.step>0?this.start+(l-1)*this.step:this.start},a.prototype.forEach=function(l){var s=this.start,f=this.step,u=this.end,c=0;if(f>0)for(;s<u;)l(s,[c],this),s+=f,c++;else if(f<0)for(;s>u;)l(s,[c],this),s+=f,c++},a.prototype.map=function(l){var s=[];return this.forEach(function(f,u,c){s[u[0]]=l(f,u,c)}),s},a.prototype.toArray=function(){var l=[];return this.forEach(function(s,f){l[f[0]]=s}),l},a.prototype.valueOf=function(){return this.toArray()},a.prototype.format=function(l){var s=n.format(this.start,l);return this.step!==1&&(s+=":"+n.format(this.step,l)),s+=":"+n.format(this.end,l),s},a.prototype.toString=function(){return this.format()},a.prototype.toJSON=function(){return{mathjs:"Range",start:this.start,end:this.end,step:this.step}},a.fromJSON=function(l){return new a(l.start,l.end,l.step)},a}return xn.name="Range",xn.path="type",xn.factory=e,xn}var Io;function kf(){if(Io)return Sn;Io=1;var n=Mt().map,e=wt().escape;function i(t,r,o,a){var l=o(st()),s=o(Pf()),f=Array.isArray;function u(h,p){if(!(this instanceof u))throw new SyntaxError("Constructor must be called with the new operator");if(this.dimensions=h,this.dotNotation=p||!1,!f(h)||!h.every(t.isNode))throw new TypeError('Array containing Nodes expected for parameter "dimensions"');if(this.dotNotation&&!this.isObjectProperty())throw new Error("dotNotation only applicable for object properties");var m=function(){throw new Error("Property `IndexNode.object` is deprecated, use `IndexNode.fn` instead")};Object.defineProperty(this,"object",{get:m,set:m})}u.prototype=new l,u.prototype.type="IndexNode",u.prototype.isIndexNode=!0,u.prototype._compile=function(h,p){var m=n(this.dimensions,function(v,d){if(t.isRangeNode(v))if(v.needsEnd()){var _=Object.create(p);_.end=!0;var y=v.start._compile(h,_),b=v.end._compile(h,_),E=v.step?v.step._compile(h,_):function(){return 1};return function(C,j,Y){var ae=h.size(Y).valueOf(),V=Object.create(j);return V.end=ae[d],c(y(C,V,Y),b(C,V,Y),E(C,V,Y))}}else{var N=v.start._compile(h,p),S=v.end._compile(h,p),A=v.step?v.step._compile(h,p):function(){return 1};return function(C,j,Y){return c(N(C,j,Y),S(C,j,Y),A(C,j,Y))}}else if(t.isSymbolNode(v)&&v.name==="end"){var x=Object.create(p);x.end=!0;var w=v._compile(h,x);return function(C,j,Y){var ae=h.size(Y).valueOf(),V=Object.create(j);return V.end=ae[d],w(C,V,Y)}}else{var I=v._compile(h,p);return function(C,j,Y){return I(C,j,Y)}}});return function(d,_,y){var b=n(m,function(E){return E(d,_,y)});return h.index.apply(h,b)}},u.prototype.forEach=function(h){for(var p=0;p<this.dimensions.length;p++)h(this.dimensions[p],"dimensions["+p+"]",this)},u.prototype.map=function(h){for(var p=[],m=0;m<this.dimensions.length;m++)p[m]=this._ifNode(h(this.dimensions[m],"dimensions["+m+"]",this));return new u(p)},u.prototype.clone=function(){return new u(this.dimensions.slice(0))},u.prototype.isObjectProperty=function(){return this.dimensions.length===1&&t.isConstantNode(this.dimensions[0])&&typeof this.dimensions[0].value=="string"},u.prototype.getObjectProperty=function(){return this.isObjectProperty()?this.dimensions[0].value:null},u.prototype._toString=function(h){return this.dotNotation?"."+this.getObjectProperty():"["+this.dimensions.join(", ")+"]"},u.prototype.toJSON=function(){return{mathjs:"IndexNode",dimensions:this.dimensions,dotNotation:this.dotNotation}},u.fromJSON=function(h){return new u(h.dimensions,h.dotNotation)},u.prototype.toHTML=function(h){for(var p=[],m=0;m<this.dimensions.length;m++)p[m]=this.dimensions[m].toHTML();return this.dotNotation?'<span class="math-operator math-accessor-operator">.</span><span class="math-symbol math-property">'+e(this.getObjectProperty())+"</span>":'<span class="math-parenthesis math-square-parenthesis">[</span>'+p.join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-square-parenthesis">]</span>'},u.prototype._toTex=function(h){var p=this.dimensions.map(function(m){return m.toTex(h)});return this.dotNotation?"."+this.getObjectProperty():"_{"+p.join(",")+"}"};function c(h,p,m){return new s(t.isBigNumber(h)?h.toNumber():h,t.isBigNumber(p)?p.toNumber():p,t.isBigNumber(m)?m.toNumber():m)}return u}return Sn.name="IndexNode",Sn.path="expression.node",Sn.factory=i,Sn}var In={},Oo;function Cf(){if(Oo)return In;Oo=1;function n(a){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?n=function(s){return typeof s}:n=function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},n(a)}var e=wt().stringify,i=wt().escape,t=at().isSafeProperty,r=ot.hasOwnProperty;function o(a,l,s,f){var u=s(st());function c(h){if(!(this instanceof c))throw new SyntaxError("Constructor must be called with the new operator");if(this.properties=h||{},h&&(n(h)!=="object"||!Object.keys(h).every(function(p){return a.isNode(h[p])})))throw new TypeError("Object containing Nodes expected")}return c.prototype=new u,c.prototype.type="ObjectNode",c.prototype.isObjectNode=!0,c.prototype._compile=function(h,p){var m={};for(var v in this.properties)if(r(this.properties,v)){var d=e(v),_=JSON.parse(d);if(!t(this.properties,_))throw new Error('No access to property "'+_+'"');m[_]=this.properties[v]._compile(h,p)}return function(b,E,N){var S={};for(var A in m)r(m,A)&&(S[A]=m[A](b,E,N));return S}},c.prototype.forEach=function(h){for(var p in this.properties)this.properties.hasOwnProperty(p)&&h(this.properties[p],"properties["+e(p)+"]",this)},c.prototype.map=function(h){var p={};for(var m in this.properties)this.properties.hasOwnProperty(m)&&(p[m]=this._ifNode(h(this.properties[m],"properties["+e(m)+"]",this)));return new c(p)},c.prototype.clone=function(){var h={};for(var p in this.properties)this.properties.hasOwnProperty(p)&&(h[p]=this.properties[p]);return new c(h)},c.prototype._toString=function(h){var p=[];for(var m in this.properties)this.properties.hasOwnProperty(m)&&p.push(e(m)+": "+this.properties[m].toString(h));return"{"+p.join(", ")+"}"},c.prototype.toJSON=function(){return{mathjs:"ObjectNode",properties:this.properties}},c.fromJSON=function(h){return new c(h.properties)},c.prototype.toHTML=function(h){var p=[];for(var m in this.properties)this.properties.hasOwnProperty(m)&&p.push('<span class="math-symbol math-property">'+i(m)+'</span><span class="math-operator math-assignment-operator math-property-assignment-operator math-binary-operator">:</span>'+this.properties[m].toHTML(h));return'<span class="math-parenthesis math-curly-parenthesis">{</span>'+p.join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-curly-parenthesis">}</span>'},c.prototype._toTex=function(h){var p=[];for(var m in this.properties)this.properties.hasOwnProperty(m)&&p.push("\\mathbf{"+m+":} & "+this.properties[m].toTex(h)+"\\\\");return"\\left\\{\\begin{array}{ll}".concat(p.join(`
`),"\\end{array}\\right\\}")},c}return In.name="ObjectNode",In.path="expression.node",In.factory=o,In}var On={},To;function Df(){if(To)return On;To=1;var n=cn(),e=Mt().map,i=wt().escape,t=at().isSafeMethod,r=at().getSafeProperty,o=fn();function a(l,s,f,u){var c=f(st());function h(m,v,d,_){if(!(this instanceof h))throw new SyntaxError("Constructor must be called with the new operator");if(typeof m!="string")throw new TypeError('string expected for parameter "op"');if(typeof v!="string")throw new TypeError('string expected for parameter "fn"');if(!Array.isArray(d)||!d.every(l.isNode))throw new TypeError('Array containing Nodes expected for parameter "args"');this.implicit=_===!0,this.op=m,this.fn=v,this.args=d||[]}h.prototype=new c,h.prototype.type="OperatorNode",h.prototype.isOperatorNode=!0,h.prototype._compile=function(m,v){if(typeof this.fn!="string"||!t(m,this.fn))throw m[this.fn]?new Error('No access to function "'+this.fn+'"'):new Error("Function "+this.fn+' missing in provided namespace "math"');var d=r(m,this.fn),_=e(this.args,function(N){return N._compile(m,v)});if(_.length===1){var y=_[0];return function(S,A,x){return d(y(S,A,x))}}else if(_.length===2){var b=_[0],E=_[1];return function(S,A,x){return d(b(S,A,x),E(S,A,x))}}else return function(S,A,x){return d.apply(null,e(_,function(w){return w(S,A,x)}))}},h.prototype.forEach=function(m){for(var v=0;v<this.args.length;v++)m(this.args[v],"args["+v+"]",this)},h.prototype.map=function(m){for(var v=[],d=0;d<this.args.length;d++)v[d]=this._ifNode(m(this.args[d],"args["+d+"]",this));return new h(this.op,this.fn,v,this.implicit)},h.prototype.clone=function(){return new h(this.op,this.fn,this.args.slice(0),this.implicit)},h.prototype.isUnary=function(){return this.args.length===1},h.prototype.isBinary=function(){return this.args.length===2};function p(m,v,d,_,y){var b=o.getPrecedence(m,v),E=o.getAssociativity(m,v);if(v==="all"||_.length>2&&m.getIdentifier()!=="OperatorNode:add"&&m.getIdentifier()!=="OperatorNode:multiply"){var N=_.map(function(_e){switch(_e.getContent().type){case"ArrayNode":case"ConstantNode":case"SymbolNode":case"ParenthesisNode":return!1;default:return!0}});return N}var S;switch(_.length){case 0:S=[];break;case 1:var A=o.getPrecedence(_[0],v);if(y&&A!==null){var x,w;if(v==="keep"?(x=_[0].getIdentifier(),w=m.getIdentifier()):(x=_[0].getContent().getIdentifier(),w=m.getContent().getIdentifier()),o.properties[b][w].latexLeftParens===!1){S=[!1];break}if(o.properties[A][x].latexParens===!1){S=[!1];break}}if(A===null){S=[!1];break}if(A<=b){S=[!0];break}S=[!1];break;case 2:var I,L=o.getPrecedence(_[0],v),C=o.isAssociativeWith(m,_[0],v);L===null?I=!1:L===b&&E==="right"&&!C||L<b?I=!0:I=!1;var j,Y=o.getPrecedence(_[1],v),ae=o.isAssociativeWith(m,_[1],v);if(Y===null?j=!1:Y===b&&E==="left"&&!ae||Y<b?j=!0:j=!1,y){var V,se,Te;v==="keep"?(V=m.getIdentifier(),se=m.args[0].getIdentifier(),Te=m.args[1].getIdentifier()):(V=m.getContent().getIdentifier(),se=m.args[0].getContent().getIdentifier(),Te=m.args[1].getContent().getIdentifier()),L!==null&&(o.properties[b][V].latexLeftParens===!1&&(I=!1),o.properties[L][se].latexParens===!1&&(I=!1)),Y!==null&&(o.properties[b][V].latexRightParens===!1&&(j=!1),o.properties[Y][Te].latexParens===!1&&(j=!1))}S=[I,j];break;default:(m.getIdentifier()==="OperatorNode:add"||m.getIdentifier()==="OperatorNode:multiply")&&(S=_.map(function(_e){var J=o.getPrecedence(_e,v),Q=o.isAssociativeWith(m,_e,v),xe=o.getAssociativity(_e,v);return J===null?!1:b===J&&E===xe&&!Q?!0:J<b}));break}return _.length>=2&&m.getIdentifier()==="OperatorNode:multiply"&&m.implicit&&v==="auto"&&d==="hide"&&(S=_.map(function(_e,J){var Q=_e.getIdentifier()==="ParenthesisNode";return!!(S[J]||Q)})),S}return h.prototype._toString=function(m){var v=m&&m.parenthesis?m.parenthesis:"keep",d=m&&m.implicit?m.implicit:"hide",_=this.args,y=p(this,v,d,_,!1);if(_.length===1){var b=o.getAssociativity(this,v),E=_[0].toString(m);y[0]&&(E="("+E+")");var N=/[a-zA-Z]+/.test(this.op);return b==="right"?this.op+(N?" ":"")+E:b==="left"?E+(N?" ":"")+this.op:E+this.op}else if(_.length===2){var S=_[0].toString(m),A=_[1].toString(m);return y[0]&&(S="("+S+")"),y[1]&&(A="("+A+")"),this.implicit&&this.getIdentifier()==="OperatorNode:multiply"&&d==="hide"?S+" "+A:S+" "+this.op+" "+A}else if(_.length>2&&(this.getIdentifier()==="OperatorNode:add"||this.getIdentifier()==="OperatorNode:multiply")){var x=_.map(function(w,I){return w=w.toString(m),y[I]&&(w="("+w+")"),w});return this.implicit&&this.getIdentifier()==="OperatorNode:multiply"&&d==="hide"?x.join(" "):x.join(" "+this.op+" ")}else return this.fn+"("+this.args.join(", ")+")"},h.prototype.toJSON=function(){return{mathjs:"OperatorNode",op:this.op,fn:this.fn,args:this.args,implicit:this.implicit}},h.fromJSON=function(m){return new h(m.op,m.fn,m.args,m.implicit)},h.prototype.toHTML=function(m){var v=m&&m.parenthesis?m.parenthesis:"keep",d=m&&m.implicit?m.implicit:"hide",_=this.args,y=p(this,v,d,_,!1);if(_.length===1){var b=o.getAssociativity(this,v),E=_[0].toHTML(m);return y[0]&&(E='<span class="math-parenthesis math-round-parenthesis">(</span>'+E+'<span class="math-parenthesis math-round-parenthesis">)</span>'),b==="right"?'<span class="math-operator math-unary-operator math-lefthand-unary-operator">'+i(this.op)+"</span>"+E:E+'<span class="math-operator math-unary-operator math-righthand-unary-operator">'+i(this.op)+"</span>"}else if(_.length===2){var N=_[0].toHTML(m),S=_[1].toHTML(m);return y[0]&&(N='<span class="math-parenthesis math-round-parenthesis">(</span>'+N+'<span class="math-parenthesis math-round-parenthesis">)</span>'),y[1]&&(S='<span class="math-parenthesis math-round-parenthesis">(</span>'+S+'<span class="math-parenthesis math-round-parenthesis">)</span>'),this.implicit&&this.getIdentifier()==="OperatorNode:multiply"&&d==="hide"?N+'<span class="math-operator math-binary-operator math-implicit-binary-operator"></span>'+S:N+'<span class="math-operator math-binary-operator math-explicit-binary-operator">'+i(this.op)+"</span>"+S}else{var A=_.map(function(x,w){return x=x.toHTML(m),y[w]&&(x='<span class="math-parenthesis math-round-parenthesis">(</span>'+x+'<span class="math-parenthesis math-round-parenthesis">)</span>'),x});return _.length>2&&(this.getIdentifier()==="OperatorNode:add"||this.getIdentifier()==="OperatorNode:multiply")?this.implicit&&this.getIdentifier()==="OperatorNode:multiply"&&d==="hide"?A.join('<span class="math-operator math-binary-operator math-implicit-binary-operator"></span>'):A.join('<span class="math-operator math-binary-operator math-explicit-binary-operator">'+i(this.op)+"</span>"):'<span class="math-function">'+i(this.fn)+'</span><span class="math-paranthesis math-round-parenthesis">(</span>'+A.join('<span class="math-separator">,</span>')+'<span class="math-paranthesis math-round-parenthesis">)</span>'}},h.prototype._toTex=function(m){var v=m&&m.parenthesis?m.parenthesis:"keep",d=m&&m.implicit?m.implicit:"hide",_=this.args,y=p(this,v,d,_,!0),b=n.operators[this.fn];if(b=typeof b>"u"?this.op:b,_.length===1){var E=o.getAssociativity(this,v),N=_[0].toTex(m);return y[0]&&(N="\\left(".concat(N,"\\right)")),E==="right"?b+N:N+b}else if(_.length===2){var S=_[0],A=S.toTex(m);y[0]&&(A="\\left(".concat(A,"\\right)"));var x=_[1],w=x.toTex(m);y[1]&&(w="\\left(".concat(w,"\\right)"));var I;switch(v==="keep"?I=S.getIdentifier():I=S.getContent().getIdentifier(),this.getIdentifier()){case"OperatorNode:divide":return b+"{"+A+"}{"+w+"}";case"OperatorNode:pow":switch(A="{"+A+"}",w="{"+w+"}",I){case"ConditionalNode":case"OperatorNode:divide":A="\\left(".concat(A,"\\right)")}break;case"OperatorNode:multiply":if(this.implicit&&d==="hide")return A+"~"+w}return A+b+w}else if(_.length>2&&(this.getIdentifier()==="OperatorNode:add"||this.getIdentifier()==="OperatorNode:multiply")){var L=_.map(function(C,j){return C=C.toTex(m),y[j]&&(C="\\left(".concat(C,"\\right)")),C});return this.getIdentifier()==="OperatorNode:multiply"&&this.implicit?L.join("~"):L.join(b)}else return"\\mathrm{"+this.fn+"}\\left("+_.map(function(C){return C.toTex(m)}).join(",")+"\\right)"},h.prototype.getIdentifier=function(){return this.type+":"+this.fn},h}return On.name="OperatorNode",On.path="expression.node",On.factory=a,On}var Tn={},Ao;function Lf(){if(Ao)return Tn;Ao=1;function n(e,i,t,r){var o=t(st());function a(l){if(!(this instanceof a))throw new SyntaxError("Constructor must be called with the new operator");if(!e.isNode(l))throw new TypeError('Node expected for parameter "content"');this.content=l}return a.prototype=new o,a.prototype.type="ParenthesisNode",a.prototype.isParenthesisNode=!0,a.prototype._compile=function(l,s){return this.content._compile(l,s)},a.prototype.getContent=function(){return this.content.getContent()},a.prototype.forEach=function(l){l(this.content,"content",this)},a.prototype.map=function(l){var s=l(this.content,"content",this);return new a(s)},a.prototype.clone=function(){return new a(this.content)},a.prototype._toString=function(l){return!l||l&&!l.parenthesis||l&&l.parenthesis==="keep"?"("+this.content.toString(l)+")":this.content.toString(l)},a.prototype.toJSON=function(){return{mathjs:"ParenthesisNode",content:this.content}},a.fromJSON=function(l){return new a(l.content)},a.prototype.toHTML=function(l){return!l||l&&!l.parenthesis||l&&l.parenthesis==="keep"?'<span class="math-parenthesis math-round-parenthesis">(</span>'+this.content.toHTML(l)+'<span class="math-parenthesis math-round-parenthesis">)</span>':this.content.toHTML(l)},a.prototype._toTex=function(l){return!l||l&&!l.parenthesis||l&&l.parenthesis==="keep"?"\\left(".concat(this.content.toTex(l),"\\right)"):this.content.toTex(l)},a}return Tn.name="ParenthesisNode",Tn.path="expression.node",Tn.factory=n,Tn}var Jt={},Kt={},Ro;function ts(){if(Ro)return Kt;Ro=1;var n=cn(),e=wt().escape,i=ot.hasOwnProperty,t=at().getSafeProperty;function r(o,a,l,s,f){var u=l(st());function c(m){return o.Unit?o.Unit.isValuelessUnit(m):!1}function h(m){if(!(this instanceof h))throw new SyntaxError("Constructor must be called with the new operator");if(typeof m!="string")throw new TypeError('String expected for parameter "name"');this.name=m}h.prototype=new u,h.prototype.type="SymbolNode",h.prototype.isSymbolNode=!0,h.prototype._compile=function(m,v){var d=this.name;if(i(v,d))return function(y,b,E){return b[d]};if(d in m)return function(y,b,E){return d in y?t(y,d):t(m,d)};var _=c(d);return function(y,b,E){return d in y?t(y,d):_?new o.Unit(null,d):p(d)}},h.prototype.forEach=function(m){},h.prototype.map=function(m){return this.clone()};function p(m){throw new Error("Undefined symbol "+m)}return h.prototype.clone=function(){return new h(this.name)},h.prototype._toString=function(m){return this.name},h.prototype.toHTML=function(m){var v=e(this.name);return v==="true"||v==="false"?'<span class="math-symbol math-boolean">'+v+"</span>":v==="i"?'<span class="math-symbol math-imaginary-symbol">'+v+"</span>":v==="Infinity"?'<span class="math-symbol math-infinity-symbol">'+v+"</span>":v==="NaN"?'<span class="math-symbol math-nan-symbol">'+v+"</span>":v==="null"?'<span class="math-symbol math-null-symbol">'+v+"</span>":v==="undefined"?'<span class="math-symbol math-undefined-symbol">'+v+"</span>":'<span class="math-symbol">'+v+"</span>"},h.prototype.toJSON=function(){return{mathjs:"SymbolNode",name:this.name}},h.fromJSON=function(m){return new h(m.name)},h.prototype._toTex=function(m){var v=!1;typeof f[this.name]>"u"&&c(this.name)&&(v=!0);var d=n.toSymbol(this.name,v);return d[0]==="\\"?d:" "+d},h}return Kt.name="SymbolNode",Kt.path="expression.node",Kt.math=!0,Kt.factory=r,Kt}var Mo;function Ff(){if(Mo)return Jt;Mo=1;function n(f){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?n=function(c){return typeof c}:n=function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},n(f)}function e(){return e=Object.assign||function(f){for(var u=1;u<arguments.length;u++){var c=arguments[u];for(var h in c)Object.prototype.hasOwnProperty.call(c,h)&&(f[h]=c[h])}return f},e.apply(this,arguments)}var i=cn(),t=wt().escape,r=ot.hasOwnProperty,o=Mt().map,a=at().validateSafeMethod,l=at().getSafeProperty;function s(f,u,c,h,p){var m=c(st()),v=c(ts());function d(E,N){if(!(this instanceof d))throw new SyntaxError("Constructor must be called with the new operator");if(typeof E=="string"&&(E=new v(E)),!f.isNode(E))throw new TypeError('Node expected as parameter "fn"');if(!Array.isArray(N)||!N.every(f.isNode))throw new TypeError('Array containing Nodes expected for parameter "args"');this.fn=E,this.args=N||[],Object.defineProperty(this,"name",{get:function(){return this.fn.name||""}.bind(this),set:function(){throw new Error("Cannot assign a new name, name is read-only")}});var S=function(){throw new Error("Property `FunctionNode.object` is deprecated, use `FunctionNode.fn` instead")};Object.defineProperty(this,"object",{get:S,set:S})}d.prototype=new m,d.prototype.type="FunctionNode",d.prototype.isFunctionNode=!0,d.prototype._compile=function(E,N){if(!(this instanceof d))throw new TypeError("No valid FunctionNode");var S=o(this.args,function(_e){return _e._compile(E,N)});if(f.isSymbolNode(this.fn)){var A=this.fn.name,x=A in E?l(E,A):void 0,w=typeof x=="function"&&x.rawArgs===!0;if(w){var I=this.args;return function(J,Q,xe){return(A in J?l(J,A):x)(I,E,e({},J,Q))}}else if(S.length===1){var L=S[0];return function(J,Q,xe){return(A in J?l(J,A):x)(L(J,Q,xe))}}else if(S.length===2){var C=S[0],j=S[1];return function(J,Q,xe){return(A in J?l(J,A):x)(C(J,Q,xe),j(J,Q,xe))}}else return function(J,Q,xe){return(A in J?l(J,A):x).apply(null,o(S,function(Se){return Se(J,Q,xe)}))}}else if(f.isAccessorNode(this.fn)&&f.isIndexNode(this.fn.index)&&this.fn.index.isObjectProperty()){var Y=this.fn.object._compile(E,N),ae=this.fn.index.getObjectProperty(),V=this.args;return function(J,Q,xe){var Se=Y(J,Q,xe);a(Se,ae);var z=Se[ae]&&Se[ae].rawArgs;return z?Se[ae](V,E,e({},J,Q)):Se[ae].apply(Se,o(S,function(ve){return ve(J,Q,xe)}))}}else{var se=this.fn._compile(E,N),Te=this.args;return function(J,Q,xe){var Se=se(J,Q,xe),z=Se&&Se.rawArgs;return z?Se(Te,E,e({},J,Q)):Se.apply(Se,o(S,function(ve){return ve(J,Q,xe)}))}}},d.prototype.forEach=function(E){E(this.fn,"fn",this);for(var N=0;N<this.args.length;N++)E(this.args[N],"args["+N+"]",this)},d.prototype.map=function(E){for(var N=this._ifNode(E(this.fn,"fn",this)),S=[],A=0;A<this.args.length;A++)S[A]=this._ifNode(E(this.args[A],"args["+A+"]",this));return new d(N,S)},d.prototype.clone=function(){return new d(this.fn,this.args.slice(0))};var _=d.prototype.toString;d.prototype.toString=function(E){var N,S=this.fn.toString(E);return E&&n(E.handler)==="object"&&r(E.handler,S)&&(N=E.handler[S](this,E)),typeof N<"u"?N:_.call(this,E)},d.prototype._toString=function(E){var N=this.args.map(function(A){return A.toString(E)}),S=f.isFunctionAssignmentNode(this.fn)?"("+this.fn.toString(E)+")":this.fn.toString(E);return S+"("+N.join(", ")+")"},d.prototype.toJSON=function(){return{mathjs:"FunctionNode",fn:this.fn,args:this.args}},d.fromJSON=function(E){return new d(E.fn,E.args)},d.prototype.toHTML=function(E){var N=this.args.map(function(S){return S.toHTML(E)});return'<span class="math-function">'+t(this.fn)+'</span><span class="math-paranthesis math-round-parenthesis">(</span>'+N.join('<span class="math-separator">,</span>')+'<span class="math-paranthesis math-round-parenthesis">)</span>'};function y(E,N,S){for(var A="",x=new RegExp("\\$(?:\\{([a-z_][a-z_0-9]*)(?:\\[([0-9]+)\\])?\\}|\\$)","ig"),w=0,I;(I=x.exec(E))!==null;)if(A+=E.substring(w,I.index),w=I.index,I[0]==="$$")A+="$",w++;else{w+=I[0].length;var L=N[I[1]];if(!L)throw new ReferenceError("Template: Property "+I[1]+" does not exist.");if(I[2]===void 0)switch(n(L)){case"string":A+=L;break;case"object":if(f.isNode(L))A+=L.toTex(S);else if(Array.isArray(L))A+=L.map(function(C,j){if(f.isNode(C))return C.toTex(S);throw new TypeError("Template: "+I[1]+"["+j+"] is not a Node.")}).join(",");else throw new TypeError("Template: "+I[1]+" has to be a Node, String or array of Nodes");break;default:throw new TypeError("Template: "+I[1]+" has to be a Node, String or array of Nodes")}else if(f.isNode(L[I[2]]&&L[I[2]]))A+=L[I[2]].toTex(S);else throw new TypeError("Template: "+I[1]+"["+I[2]+"] is not a Node.")}return A+=E.slice(w),A}var b=d.prototype.toTex;return d.prototype.toTex=function(E){var N;return E&&n(E.handler)==="object"&&r(E.handler,this.name)&&(N=E.handler[this.name](this,E)),typeof N<"u"?N:b.call(this,E)},d.prototype._toTex=function(E){var N=this.args.map(function(x){return x.toTex(E)}),S;p[this.name]&&(typeof p[this.name].toTex=="function"||n(p[this.name].toTex)==="object"||typeof p[this.name].toTex=="string")&&(S=p[this.name].toTex);var A;switch(n(S)){case"function":A=S(this,E);break;case"string":A=y(S,this,E);break;case"object":switch(n(S[N.length])){case"function":A=S[N.length](this,E);break;case"string":A=y(S[N.length],this,E);break}}return typeof A<"u"?A:y(i.defaultTemplate,this,E)},d.prototype.getIdentifier=function(){return this.type+":"+this.name},d}return Jt.name="FunctionNode",Jt.path="expression.node",Jt.math=!0,Jt.factory=s,Jt}var An={},Po;function Uf(){if(Po)return An;Po=1;var n=fn();function e(i,t,r,o){var a=r(st());function l(f,u,c){if(!(this instanceof l))throw new SyntaxError("Constructor must be called with the new operator");if(!i.isNode(f))throw new TypeError("Node expected");if(!i.isNode(u))throw new TypeError("Node expected");if(c&&!i.isNode(c))throw new TypeError("Node expected");if(arguments.length>3)throw new Error("Too many arguments");this.start=f,this.end=u,this.step=c||null}l.prototype=new a,l.prototype.type="RangeNode",l.prototype.isRangeNode=!0,l.prototype.needsEnd=function(){var f=this.filter(function(u){return i.isSymbolNode(u)&&u.name==="end"});return f.length>0},l.prototype._compile=function(f,u){var c=f.range,h=this.start._compile(f,u),p=this.end._compile(f,u);if(this.step){var m=this.step._compile(f,u);return function(d,_,y){return c(h(d,_,y),p(d,_,y),m(d,_,y))}}else return function(d,_,y){return c(h(d,_,y),p(d,_,y))}},l.prototype.forEach=function(f){f(this.start,"start",this),f(this.end,"end",this),this.step&&f(this.step,"step",this)},l.prototype.map=function(f){return new l(this._ifNode(f(this.start,"start",this)),this._ifNode(f(this.end,"end",this)),this.step&&this._ifNode(f(this.step,"step",this)))},l.prototype.clone=function(){return new l(this.start,this.end,this.step&&this.step)};function s(f,u){var c=n.getPrecedence(f,u),h={},p=n.getPrecedence(f.start,u);if(h.start=p!==null&&p<=c||u==="all",f.step){var m=n.getPrecedence(f.step,u);h.step=m!==null&&m<=c||u==="all"}var v=n.getPrecedence(f.end,u);return h.end=v!==null&&v<=c||u==="all",h}return l.prototype._toString=function(f){var u=f&&f.parenthesis?f.parenthesis:"keep",c=s(this,u),h,p=this.start.toString(f);if(c.start&&(p="("+p+")"),h=p,this.step){var m=this.step.toString(f);c.step&&(m="("+m+")"),h+=":"+m}var v=this.end.toString(f);return c.end&&(v="("+v+")"),h+=":"+v,h},l.prototype.toJSON=function(){return{mathjs:"RangeNode",start:this.start,end:this.end,step:this.step}},l.fromJSON=function(f){return new l(f.start,f.end,f.step)},l.prototype.toHTML=function(f){var u=f&&f.parenthesis?f.parenthesis:"keep",c=s(this,u),h,p=this.start.toHTML(f);if(c.start&&(p='<span class="math-parenthesis math-round-parenthesis">(</span>'+p+'<span class="math-parenthesis math-round-parenthesis">)</span>'),h=p,this.step){var m=this.step.toHTML(f);c.step&&(m='<span class="math-parenthesis math-round-parenthesis">(</span>'+m+'<span class="math-parenthesis math-round-parenthesis">)</span>'),h+='<span class="math-operator math-range-operator">:</span>'+m}var v=this.end.toHTML(f);return c.end&&(v='<span class="math-parenthesis math-round-parenthesis">(</span>'+v+'<span class="math-parenthesis math-round-parenthesis">)</span>'),h+='<span class="math-operator math-range-operator">:</span>'+v,h},l.prototype._toTex=function(f){var u=f&&f.parenthesis?f.parenthesis:"keep",c=s(this,u),h=this.start.toTex(f);if(c.start&&(h="\\left(".concat(h,"\\right)")),this.step){var p=this.step.toTex(f);c.step&&(p="\\left(".concat(p,"\\right)")),h+=":"+p}var m=this.end.toTex(f);return c.end&&(m="\\left(".concat(m,"\\right)")),h+=":"+m,h},l}return An.name="RangeNode",An.path="expression.node",An.factory=e,An}var Rn={},ko;function Bf(){if(ko)return Rn;ko=1;var n=fn(),e=cn(),i=wt().escape;function t(r,o,a,l){var s=a(st()),f=at().getSafeProperty;function u(c,h){if(!(this instanceof u))throw new SyntaxError("Constructor must be called with the new operator");if(!Array.isArray(c))throw new TypeError("Parameter conditionals must be an array");if(!Array.isArray(h))throw new TypeError("Parameter params must be an array");if(c.length!==h.length-1)throw new TypeError("Parameter params must contain exactly one more element than parameter conditionals");this.conditionals=c,this.params=h}return u.prototype=new s,u.prototype.type="RelationalNode",u.prototype.isRelationalNode=!0,u.prototype._compile=function(c,h){var p=this,m=this.params.map(function(v){return v._compile(c,h)});return function(d,_,y){for(var b,E=m[0](d,_,y),N=0;N<p.conditionals.length;N++){b=E,E=m[N+1](d,_,y);var S=f(c,p.conditionals[N]);if(!S(b,E))return!1}return!0}},u.prototype.forEach=function(c){var h=this;this.params.forEach(function(p,m){return c(p,"params["+m+"]",h)},this)},u.prototype.map=function(c){var h=this;return new u(this.conditionals.slice(),this.params.map(function(p,m){return h._ifNode(c(p,"params["+m+"]",h))},this))},u.prototype.clone=function(){return new u(this.conditionals,this.params)},u.prototype._toString=function(c){for(var h=c&&c.parenthesis?c.parenthesis:"keep",p=n.getPrecedence(this,h),m=this.params.map(function(y,b){var E=n.getPrecedence(y,h);return h==="all"||E!==null&&E<=p?"("+y.toString(c)+")":y.toString(c)}),v={equal:"==",unequal:"!=",smaller:"<",larger:">",smallerEq:"<=",largerEq:">="},d=m[0],_=0;_<this.conditionals.length;_++)d+=" "+v[this.conditionals[_]]+" "+m[_+1];return d},u.prototype.toJSON=function(){return{mathjs:"RelationalNode",conditionals:this.conditionals,params:this.params}},u.fromJSON=function(c){return new u(c.conditionals,c.params)},u.prototype.toHTML=function(c){for(var h=c&&c.parenthesis?c.parenthesis:"keep",p=n.getPrecedence(this,h),m=this.params.map(function(y,b){var E=n.getPrecedence(y,h);return h==="all"||E!==null&&E<=p?'<span class="math-parenthesis math-round-parenthesis">(</span>'+y.toHTML(c)+'<span class="math-parenthesis math-round-parenthesis">)</span>':y.toHTML(c)}),v={equal:"==",unequal:"!=",smaller:"<",larger:">",smallerEq:"<=",largerEq:">="},d=m[0],_=0;_<this.conditionals.length;_++)d+='<span class="math-operator math-binary-operator math-explicit-binary-operator">'+i(v[this.conditionals[_]])+"</span>"+m[_+1];return d},u.prototype._toTex=function(c){for(var h=c&&c.parenthesis?c.parenthesis:"keep",p=n.getPrecedence(this,h),m=this.params.map(function(_,y){var b=n.getPrecedence(_,h);return h==="all"||b!==null&&b<=p?"\\left("+_.toTex(c)+"\right)":_.toTex(c)}),v=m[0],d=0;d<this.conditionals.length;d++)v+=e.operators[this.conditionals[d]]+m[d+1];return v},u}return Rn.name="RelationalNode",Rn.path="expression.node",Rn.factory=t,Rn}var Co;function ui(){if(Co)return pn;Co=1;function n(){return n=Object.assign||function(r){for(var o=1;o<arguments.length;o++){var a=arguments[o];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(r[l]=a[l])}return r},n.apply(this,arguments)}var e=Wa,i=un();function t(r,o,a,l){var s=a(bf()),f=a(Ef()),u=a(Nf()),c=a(xf()),h=a(Of()),p=a(Tf()),m=a(Rf()),v=a(Mf()),d=a(kf()),_=a(Cf()),y=a(Df()),b=a(Lf()),E=a(Ff()),N=a(Uf()),S=a(Bf()),A=a(ts());function x(g,O){if(arguments.length!==1&&arguments.length!==2)throw new e("parse",arguments.length,1,2);var F=O&&O.nodes?O.nodes:{};if(typeof g=="string")return z(g,F);if(Array.isArray(g)||g instanceof r.Matrix)return i(g,function(W){if(typeof W!="string")throw new TypeError("String expected");return z(W,F)});throw new TypeError("String or matrix expected")}var w={NULL:0,DELIMITER:1,NUMBER:2,SYMBOL:3,UNKNOWN:4},I={",":!0,"(":!0,")":!0,"[":!0,"]":!0,"{":!0,"}":!0,'"':!0,"'":!0,";":!0,"+":!0,"-":!0,"*":!0,".*":!0,"/":!0,"./":!0,"%":!0,"^":!0,".^":!0,"~":!0,"!":!0,"&":!0,"|":!0,"^|":!0,"=":!0,":":!0,"?":!0,"==":!0,"!=":!0,"<":!0,">":!0,"<=":!0,">=":!0,"<<":!0,">>":!0,">>>":!0},L={mod:!0,to:!0,in:!0,and:!0,xor:!0,or:!0,not:!0},C={true:!0,false:!1,null:null,undefined:void 0},j=["NaN","Infinity"];function Y(){return{extraNodes:{},expression:"",comment:"",index:0,token:"",tokenType:w.NULL,nestingLevel:0,conditionalLevel:null}}function ae(g,O){return g.expression.substr(g.index,O)}function V(g){return ae(g,1)}function se(g){g.index++}function Te(g){return g.expression.charAt(g.index-1)}function _e(g){return g.expression.charAt(g.index+1)}function J(g){for(g.tokenType=w.NULL,g.token="",g.comment="";x.isWhitespace(V(g),g.nestingLevel);)se(g);if(V(g)==="#")for(;V(g)!==`
`&&V(g)!=="";)g.comment+=V(g),se(g);if(V(g)===""){g.tokenType=w.DELIMITER;return}if(V(g)===`
`&&!g.nestingLevel){g.tokenType=w.DELIMITER,g.token=V(g),se(g);return}var O=V(g),F=ae(g,2),W=ae(g,3);if(W.length===3&&I[W]){g.tokenType=w.DELIMITER,g.token=W,se(g),se(g),se(g);return}if(F.length===2&&I[F]){g.tokenType=w.DELIMITER,g.token=F,se(g),se(g);return}if(I[O]){g.tokenType=w.DELIMITER,g.token=O,se(g);return}if(x.isDigitDot(O)){if(g.tokenType=w.NUMBER,V(g)===".")g.token+=V(g),se(g),x.isDigit(V(g))||(g.tokenType=w.DELIMITER);else{for(;x.isDigit(V(g));)g.token+=V(g),se(g);x.isDecimalMark(V(g),_e(g))&&(g.token+=V(g),se(g))}for(;x.isDigit(V(g));)g.token+=V(g),se(g);if(V(g)==="E"||V(g)==="e"){if(x.isDigit(_e(g))||_e(g)==="-"||_e(g)==="+"){if(g.token+=V(g),se(g),(V(g)==="+"||V(g)==="-")&&(g.token+=V(g),se(g)),!x.isDigit(V(g)))throw Ue(g,'Digit expected, got "'+V(g)+'"');for(;x.isDigit(V(g));)g.token+=V(g),se(g);if(x.isDecimalMark(V(g),_e(g)))throw Ue(g,'Digit expected, got "'+V(g)+'"')}else if(_e(g)===".")throw se(g),Ue(g,'Digit expected, got "'+V(g)+'"')}return}if(x.isAlpha(V(g),Te(g),_e(g))){for(;x.isAlpha(V(g),Te(g),_e(g))||x.isDigit(V(g));)g.token+=V(g),se(g);L.hasOwnProperty(g.token)?g.tokenType=w.DELIMITER:g.tokenType=w.SYMBOL;return}for(g.tokenType=w.UNKNOWN;V(g)!=="";)g.token+=V(g),se(g);throw Ue(g,'Syntax error in part "'+g.token+'"')}function Q(g){do J(g);while(g.token===`
`)}function xe(g){g.nestingLevel++}function Se(g){g.nestingLevel--}x.isAlpha=function(O,F,W){return x.isValidLatinOrGreek(O)||x.isValidMathSymbol(O,W)||x.isValidMathSymbol(F,O)},x.isValidLatinOrGreek=function(O){return/^[a-zA-Z_$\u00C0-\u02AF\u0370-\u03FF\u2100-\u214F]$/.test(O)},x.isValidMathSymbol=function(O,F){return/^[\uD835]$/.test(O)&&/^[\uDC00-\uDFFF]$/.test(F)&&/^[^\uDC55\uDC9D\uDCA0\uDCA1\uDCA3\uDCA4\uDCA7\uDCA8\uDCAD\uDCBA\uDCBC\uDCC4\uDD06\uDD0B\uDD0C\uDD15\uDD1D\uDD3A\uDD3F\uDD45\uDD47-\uDD49\uDD51\uDEA6\uDEA7\uDFCC\uDFCD]$/.test(F)},x.isWhitespace=function(O,F){return O===" "||O==="	"||O===`
`&&F>0},x.isDecimalMark=function(O,F){return O==="."&&F!=="/"&&F!=="*"&&F!=="^"},x.isDigitDot=function(O){return O>="0"&&O<="9"||O==="."},x.isDigit=function(O){return O>="0"&&O<="9"};function z(g,O){var F=Y();n(F,{expression:g,extraNodes:O}),J(F);var W=ve(F);if(F.token!=="")throw F.tokenType===w.DELIMITER?qn(F,"Unexpected operator "+F.token):Ue(F,'Unexpected part "'+F.token+'"');return W}function ve(g){var O,F=[],W;for(g.token!==""&&g.token!==`
`&&g.token!==";"&&(O=Ae(g),O.comment=g.comment);g.token===`
`||g.token===";";)F.length===0&&O&&(W=g.token!==";",F.push({node:O,visible:W})),J(g),g.token!==`
`&&g.token!==";"&&g.token!==""&&(O=Ae(g),O.comment=g.comment,W=g.token!==";",F.push({node:O,visible:W}));return F.length>0?new h(F):(O||(O=new m(void 0),O.comment=g.comment),O)}function Ae(g){var O,F,W,be,Ie=Ze(g);if(g.token==="="){if(r.isSymbolNode(Ie))return O=Ie.name,Q(g),W=Ae(g),new c(new A(O),W);if(r.isAccessorNode(Ie))return Q(g),W=Ae(g),new c(Ie.object,Ie.index,W);if(r.isFunctionNode(Ie)&&r.isSymbolNode(Ie.fn)&&(be=!0,F=[],O=Ie.name,Ie.args.forEach(function(xt,yr){r.isSymbolNode(xt)?F[yr]=xt.name:be=!1}),be))return Q(g),W=Ae(g),new v(O,F,W);throw Ue(g,"Invalid left hand side of assignment operator =")}return Ie}function Ze(g){for(var O=Re(g);g.token==="?";){var F=g.conditionalLevel;g.conditionalLevel=g.nestingLevel,Q(g);var W=O,be=Ae(g);if(g.token!==":")throw Ue(g,"False part of conditional expression expected");g.conditionalLevel=null,Q(g);var Ie=Ae(g);O=new p(W,be,Ie),g.conditionalLevel=F}return O}function Re(g){for(var O=Pt(g);g.token==="or";)Q(g),O=new y("or","or",[O,Pt(g)]);return O}function Pt(g){for(var O=dt(g);g.token==="xor";)Q(g),O=new y("xor","xor",[O,dt(g)]);return O}function dt(g){for(var O=Ve(g);g.token==="and";)Q(g),O=new y("and","and",[O,Ve(g)]);return O}function Ve(g){for(var O=B(g);g.token==="|";)Q(g),O=new y("|","bitOr",[O,B(g)]);return O}function B(g){for(var O=K(g);g.token==="^|";)Q(g),O=new y("^|","bitXor",[O,K(g)]);return O}function K(g){for(var O=Z(g);g.token==="&";)Q(g),O=new y("&","bitAnd",[O,Z(g)]);return O}function Z(g){for(var O=[Ge(g)],F=[],W={"==":"equal","!=":"unequal","<":"smaller",">":"larger","<=":"smallerEq",">=":"largerEq"};W.hasOwnProperty(g.token);){var be={name:g.token,fn:W[g.token]};F.push(be),Q(g),O.push(Ge(g))}return O.length===1?O[0]:O.length===2?new y(F[0].name,F[0].fn,O):new S(F.map(function(Ie){return Ie.fn}),O)}function Ge(g){var O,F,W,be,Ie;for(O=He(g),F={"<<":"leftShift",">>":"rightArithShift",">>>":"rightLogShift"};F.hasOwnProperty(g.token);)W=g.token,be=F[W],Q(g),Ie=[O,He(g)],O=new y(W,be,Ie);return O}function He(g){var O,F,W,be,Ie;for(O=qe(g),F={to:"to",in:"to"};F.hasOwnProperty(g.token);)W=g.token,be=F[W],Q(g),W==="in"&&g.token===""?O=new y("*","multiply",[O,new A("in")],!0):(Ie=[O,qe(g)],O=new y(W,be,Ie));return O}function qe(g){var O,F=[];if(g.token===":"?O=new m(1):O=ze(g),g.token===":"&&g.conditionalLevel!==g.nestingLevel){for(F.push(O);g.token===":"&&F.length<3;)Q(g),g.token===")"||g.token==="]"||g.token===","||g.token===""?F.push(new A("end")):F.push(ze(g));F.length===3?O=new N(F[0],F[2],F[1]):O=new N(F[0],F[1])}return O}function ze(g){var O,F,W,be,Ie;for(O=T(g),F={"+":"add","-":"subtract"};F.hasOwnProperty(g.token);)W=g.token,be=F[W],Q(g),Ie=[O,T(g)],O=new y(W,be,Ie);return O}function T(g){var O,F,W,be,Ie;for(O=D(g),F=O,W={"*":"multiply",".*":"dotMultiply","/":"divide","./":"dotDivide","%":"mod",mod:"mod"};W.hasOwnProperty(g.token);)be=g.token,Ie=W[be],Q(g),F=D(g),O=new y(be,Ie,[O,F]);return O}function D(g){var O,F;for(O=U(g),F=O;g.tokenType===w.SYMBOL||g.token==="in"&&r.isConstantNode(O)||g.tokenType===w.NUMBER&&!r.isConstantNode(F)&&(!r.isOperatorNode(F)||F.op==="!")||g.token==="(";)F=U(g),O=new y("*","multiply",[O,F],!0);return O}function U(g){for(var O=k(g),F=O,W=[];g.token==="/"&&r.isConstantNode(F);)if(W.push(n({},g)),Q(g),g.tokenType===w.NUMBER)if(W.push(n({},g)),Q(g),g.tokenType===w.SYMBOL||g.token==="(")n(g,W.pop()),W.pop(),F=k(g),O=new y("/","divide",[O,F]);else{W.pop(),n(g,W.pop());break}else{n(g,W.pop());break}return O}function k(g){var O,F,W,be={"-":"unaryMinus","+":"unaryPlus","~":"bitNot",not:"not"};return be.hasOwnProperty(g.token)?(W=be[g.token],O=g.token,Q(g),F=[k(g)],new y(O,W,F)):$(g)}function $(g){var O,F,W,be;return O=ne(g),(g.token==="^"||g.token===".^")&&(F=g.token,W=F==="^"?"pow":"dotPow",Q(g),be=[O,k(g)],O=new y(F,W,be)),O}function ne(g){var O,F,W,be,Ie;for(O=fe(g),F={"!":"factorial","'":"ctranspose"};F.hasOwnProperty(g.token);)W=g.token,be=F[W],J(g),Ie=[O],O=new y(W,be,Ie),O=G(g,O);return O}function fe(g){var O=[];if(g.tokenType===w.SYMBOL&&g.extraNodes.hasOwnProperty(g.token)){var F=g.extraNodes[g.token];if(J(g),g.token==="("){if(O=[],xe(g),J(g),g.token!==")")for(O.push(Ae(g));g.token===",";)J(g),O.push(Ae(g));if(g.token!==")")throw Ue(g,"Parenthesis ) expected");Se(g),J(g)}return new F(O)}return le(g)}function le(g){var O,F;return g.tokenType===w.SYMBOL||g.tokenType===w.DELIMITER&&g.token in L?(F=g.token,J(g),C.hasOwnProperty(F)?O=new m(C[F]):j.indexOf(F)!==-1?O=new m(s(F,"number")):O=new A(F),O=G(g,O),O):me(g)}function G(g,O,F){for(var W;(g.token==="("||g.token==="["||g.token===".")&&(!F||F.indexOf(g.token)!==-1);)if(W=[],g.token==="(")if(r.isSymbolNode(O)||r.isAccessorNode(O)){if(xe(g),J(g),g.token!==")")for(W.push(Ae(g));g.token===",";)J(g),W.push(Ae(g));if(g.token!==")")throw Ue(g,"Parenthesis ) expected");Se(g),J(g),O=new E(O,W)}else return O;else if(g.token==="["){if(xe(g),J(g),g.token!=="]")for(W.push(Ae(g));g.token===",";)J(g),W.push(Ae(g));if(g.token!=="]")throw Ue(g,"Parenthesis ] expected");Se(g),J(g),O=new f(O,new d(W))}else{if(J(g),g.tokenType!==w.SYMBOL)throw Ue(g,"Property name expected after dot");W.push(new m(g.token)),J(g);var be=!0;O=new f(O,new d(W,be))}return O}function me(g){var O,F;return g.token==='"'?(F=Je(g),O=new m(F),O=G(g,O),O):et(g)}function Je(g){for(var O="";V(g)!==""&&V(g)!=='"';)V(g)==="\\"&&(O+=V(g),se(g)),O+=V(g),se(g);if(J(g),g.token!=='"')throw Ue(g,'End of string " expected');return J(g),JSON.parse('"'+O+'"')}function et(g){var O,F;return g.token==="'"?(F=ut(g),O=new m(F),O=G(g,O),O):dn(g)}function ut(g){for(var O="";V(g)!==""&&V(g)!=="'";)V(g)==="\\"&&(O+=V(g),se(g)),O+=V(g),se(g);if(J(g),g.token!=="'")throw Ue(g,"End of string ' expected");return J(g),JSON.parse('"'+O+'"')}function dn(g){var O,F,W,be;if(g.token==="["){if(xe(g),J(g),g.token!=="]"){var Ie=Gn(g);if(g.token===";"){for(W=1,F=[Ie];g.token===";";)J(g),F[W]=Gn(g),W++;if(g.token!=="]")throw Ue(g,"End of matrix ] expected");Se(g),J(g),be=F[0].items.length;for(var xt=1;xt<W;xt++)if(F[xt].items.length!==be)throw qn(g,"Column dimensions mismatch ("+F[xt].items.length+" !== "+be+")");O=new u(F)}else{if(g.token!=="]")throw Ue(g,"End of matrix ] expected");Se(g),J(g),O=Ie}}else Se(g),J(g),O=new u([]);return G(g,O)}return pr(g)}function Gn(g){for(var O=[Ae(g)],F=1;g.token===",";)J(g),O[F]=Ae(g),F++;return new u(O)}function pr(g){if(g.token==="{"){xe(g);var O,F={};do if(J(g),g.token!=="}"){if(g.token==='"')O=Je(g);else if(g.token==="'")O=ut(g);else if(g.tokenType===w.SYMBOL)O=g.token,J(g);else throw Ue(g,"Symbol or string expected as object key");if(g.token!==":")throw Ue(g,"Colon : expected after object key");J(g),F[O]=Ae(g)}while(g.token===",");if(g.token!=="}")throw Ue(g,"Comma , or bracket } expected after object value");Se(g),J(g);var W=new _(F);return W=G(g,W),W}return mr(g)}function mr(g){var O;return g.tokenType===w.NUMBER?(O=g.token,J(g),new m(s(O,o.number))):gr(g)}function gr(g){var O;if(g.token==="("){if(xe(g),J(g),O=Ae(g),g.token!==")")throw Ue(g,"Parenthesis ) expected");return Se(g),J(g),O=new b(O),O=G(g,O),O}return vr(g)}function vr(g){throw g.token===""?Ue(g,"Unexpected end of expression"):Ue(g,"Value expected")}function Hn(g){return g.index-g.token.length+1}function Ue(g,O){var F=Hn(g),W=new SyntaxError(O+" (char "+F+")");return W.char=F,W}function qn(g,O){var F=Hn(g),W=new SyntaxError(O+" (char "+F+")");return W.char=F,W}return x}return pn.name="parse",pn.path="expression",pn.factory=t,pn}var Do;function jf(){if(Do)return Xn;Do=1;function n(e,i,t,r){var o=t(ui());return r("parse",{"string | Array | Matrix":o,"string | Array | Matrix, Object":o})}return Xn.name="parse",Xn.factory=n,Xn}var $n={},Lo;function Vf(){if(Lo)return $n;Lo=1;var n=un();function e(i,t,r,o){var a=r(ui());return o("compile",{string:function(s){return a(s).compile()},"Array | Matrix":function(s){return n(s,function(f){return a(f).compile()})}})}return $n.name="compile",$n.factory=e,$n}var er={},Fo;function Gf(){if(Fo)return er;Fo=1;var n=un();function e(i,t,r,o){var a=r(ui());return o("compile",{string:function(s){var f={};return a(s).compile().eval(f)},"string, Object":function(s,f){return a(s).compile().eval(f)},"Array | Matrix":function(s){var f={};return n(s,function(u){return a(u).compile().eval(f)})},"Array | Matrix, Object":function(s,f){return n(s,function(u){return a(u).compile().eval(f)})}})}return er.name="eval",er.factory=e,er}var tr={},Uo;function Hf(){if(Uo)return tr;Uo=1;var n=wt();function e(i,t,r,o){var a=o("format",{any:n.format,"any, Object | function | number":n.format});return a.toTex=void 0,a}return tr.name="format",tr.factory=e,tr}var qf=Va.exports,qt=qf.create();qt.import(jf());qt.import(Vf());qt.import(Gf());qt.import(Hf());qt.import({add:function(n,e){return n+e},subtract:function(n,e){return n-e},multiply:function(n,e){return n*e},divide:function(n,e){return n/e},mod:function(n,e){return n%e},unaryPlus:function(n){return n},unaryMinus:function(n){return-n},bitOr:function(n,e){return n|e},bitXor:function(n,e){return n^e},bitAnd:function(n,e){return n&e},bitNot:function(n){return~n},leftShift:function(n,e){return n<<e},rightArithShift:function(n,e){return n>>e},rightLogShift:function(n,e){return n>>>e},or:function(n,e){return!!(n||e)},xor:function(n,e){return!!n!=!!e},and:function(n,e){return!!(n&&e)},not:function(n){return!n},equal:function(n,e){return n==e},unequal:function(n,e){return n!=e},smaller:function(n,e){return n<e},larger:function(n,e){return n>e},smallerEq:function(n,e){return n<=e},largerEq:function(n,e){return n>=e},matrix:function(){throw new Error("Matrices not supported")},index:function(){throw new Error("Matrix indexes not supported")},pi:Math.PI,e:Math.E,true:!0,false:!1,null:null});var ns={};Object.getOwnPropertyNames(Math).forEach(function(n){Object.prototype.hasOwnProperty(n)||(ns[n]=Math[n])});qt.import(ns);var zf=qt;const fi=function(e){this.gl=e,this.textureIndex=0};fi.prototype.newTextureIndex=function(){const e=this.textureIndex;return this.textureIndex+=1,e};fi.prototype.reset=function(){this.textureIndex=0};function Ft(n,e,i){this.gl=n,this.vShader=this.createShader(e,this.gl.VERTEX_SHADER),this.fShader=this.createShader(i,this.gl.FRAGMENT_SHADER),this.program=this.createProgram(this.vShader,this.fShader),this.locations={}}Ft.prototype.use=function(){try{this.gl.useProgram(this.program)}catch(e){console.error(e),console.error(this.gl.getError())}};Ft.prototype.getUniformLocation=function(e){return this.gl.getUniformLocation(this.program,e)};Ft.prototype.bindVertices=function(){this.use();const e=this.gl.getAttribLocation(this.program,"isf_position");this.buffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer);const i=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);this.gl.bufferData(this.gl.ARRAY_BUFFER,i,this.gl.STATIC_DRAW),this.gl.enableVertexAttribArray(e),this.gl.vertexAttribPointer(e,2,this.gl.FLOAT,!1,0,0)};Ft.prototype.cleanup=function(){this.gl.deleteShader(this.fShader),this.gl.deleteShader(this.vShader),this.gl.deleteProgram(this.program),this.gl.deleteBuffer(this.buffer)};Ft.prototype.createShader=function(e,i){const t=this.gl.createShader(i);this.gl.shaderSource(t,e),this.gl.compileShader(t);const r=this.gl.getShaderParameter(t,this.gl.COMPILE_STATUS);if(window.shaderSrc=e,!r){const o=this.gl.getShaderInfoLog(t),a=e.split(`
`);throw console.log(o),o.split(`
`).forEach(l=>{var c,h,p;l=l.substring(9);const s=parseInt(((c=l.split(":"))==null?void 0:c[0])||0),f=((h=l.split(":"))==null?void 0:h[1])||"N/A";console.error(`${f} ${(p=l.split(":"))==null?void 0:p[2]}`);let u="";for(let m=s-1;m<s+1;m++)u+=`${m}: ${a[m].replaceAll("	","").replaceAll(`
`,"")}
`;console.log(u)}),new Error({message:o,type:"shader"})}return t};Ft.prototype.createProgram=function(e,i){const t=this.gl.createProgram();if(this.gl.attachShader(t,e),this.gl.attachShader(t,i),this.gl.linkProgram(t),!this.gl.getProgramParameter(t,this.gl.LINK_STATUS)){const o=this.gl.getProgramInfoLog(t);throw console.log("Error in program linking",o),new Error({message:o,type:"program"})}return t};function an(n,e){n==null&&(n={}),this.contextState=e,this.float=n.float,this.gl=this.contextState.gl,this.texture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0),this.gl.bindTexture(this.gl.TEXTURE_2D,null)}an.prototype.bind=function(e){e==null&&(e=-1);const i=this.contextState.newTextureIndex();this.gl.activeTexture(this.gl.TEXTURE0+i),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),e!==-1&&this.gl.uniform1i(e,i)};an.prototype.setSize=function(e,i){if(this.width!==e||this.height!==i){this.width=e,this.height=i;const t=this.float?this.gl.FLOAT:this.gl.UNSIGNED_BYTE;this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,e,i,0,this.gl.RGBA,t,null)}};an.prototype.destroy=function(){this.gl.deleteTexture(this.texture)};function hn(n,e){this.contextState=e,this.gl=this.contextState.gl,this.persistent=n.persistent,this.name=n.target,this.textures=[],this.textures.push(new an(n,this.contextState)),this.textures.push(new an(n,this.contextState)),this.flipFlop=!1,this.fbo=this.gl.createFramebuffer(),this.flipFlop=!1}hn.prototype.setSize=function(e,i){if(this.width!==e||this.height!==i){this.width=e,this.height=i;for(let t=0;t<this.textures.length;t++)this.textures[t].setSize(e,i)}};hn.prototype.readTexture=function(){return this.flipFlop?this.textures[1]:this.textures[0]};hn.prototype.writeTexture=function(){return this.flipFlop?this.textures[0]:this.textures[1]};hn.prototype.flip=function(){this.flipFlop=!this.flipFlop};hn.prototype.destroy=function(){for(let e=0;e<this.textures.length;e++)this.textures[e].destroy();this.gl.deleteFramebuffer(this.fbo)};const Xf=function(){var n,e,i={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},t,r=function(p){throw{name:"SyntaxError",message:p,at:n,text:t}},o=function(p){return p&&p!==e&&r("Expected '"+p+"' instead of '"+e+"'"),e=t.charAt(n),n+=1,e},a=function(){var p,m="";for(e==="-"&&(m="-",o("-"));e>="0"&&e<="9";)m+=e,o();if(e===".")for(m+=".";o()&&e>="0"&&e<="9";)m+=e;if(e==="e"||e==="E")for(m+=e,o(),(e==="-"||e==="+")&&(m+=e,o());e>="0"&&e<="9";)m+=e,o();if(p=+m,!isFinite(p))r("Bad number");else return p},l=function(){var p,m,v="",d;if(e==='"')for(;o();){if(e==='"')return o(),v;if(e==="\\")if(o(),e==="u"){for(d=0,m=0;m<4&&(p=parseInt(o(),16),!!isFinite(p));m+=1)d=d*16+p;v+=String.fromCharCode(d)}else if(typeof i[e]=="string")v+=i[e];else break;else v+=e}r("Bad string")},s=function(){for(;e&&e<=" ";)o()},f=function(){switch(e){case"t":return o("t"),o("r"),o("u"),o("e"),!0;case"f":return o("f"),o("a"),o("l"),o("s"),o("e"),!1;case"n":return o("n"),o("u"),o("l"),o("l"),null}r("Unexpected '"+e+"'")},u,c=function(){var p=[];if(e==="["){if(o("["),s(),e==="]")return o("]"),p;for(;e;){if(p.push(u()),s(),e==="]")return o("]"),p;o(","),s()}}r("Bad array")},h=function(){var p,m={};if(e==="{"){if(o("{"),s(),e==="}")return o("}"),m;for(;e;){if(p=l(),s(),o(":"),Object.hasOwnProperty.call(m,p)&&r("Duplicate key '"+p+"'"),m[p]=u(),s(),e==="}")return o("}"),m;o(","),s()}}r("Bad object")};return u=function(){switch(s(),e){case"{":return h();case"[":return c();case'"':return l();case"-":return a();default:return e>="0"&&e<="9"?a():f()}},function(p,m){var v;return t=p,n=0,e=" ",v=u(),s(),e&&r("Syntax error"),typeof m=="function"?function d(_,y){var b,E,N=_[y];if(N&&typeof N=="object")for(b in N)Object.prototype.hasOwnProperty.call(N,b)&&(E=d(N,b),E!==void 0?N[b]=E:delete N[b]);return m.call(_,y,N)}({"":v},""):v}}(),Bo="Something is wrong with your ISF metadata";function Wf(n){const i=/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*+/.exec(n);if(!i)throw new Error("There is no metadata here.");let t=i[0];t=t.substring(1,t.length-1);let r;try{r=Xf(t)}catch(l){const s=l.at,f=l.message||"Invalid JSON";if(s){const u=(t||"").substring(0,s).split(/\r\n|\r|\n/),c=u.length,h=u[c-1].length,p=`${Bo}: ${f}        at line ${c} and position ${h}`,m=new Error(p);throw m.lineNumber=c,m.position=h,m}throw new Error(`${Bo}: ${f}`)}const o=n.indexOf("/*"),a=n.indexOf("*/");return{objectValue:r,stringValue:t,startIndex:o,endIndex:a}}const Yf={float:"float",image:"sampler2D",bool:"bool",event:"bool",long:"int",color:"vec4",point2D:"vec2"},We=function(){};We.prototype.parse=function(e,i){try{this.valid=!0,this.rawFragmentShader=e,this.rawVertexShader=i||We.vertexShaderDefault,this.error=null;const t=Wf(this.rawFragmentShader),r=t.objectValue,o=t.stringValue;this.metadata=r,this.credit=r.CREDIT,this.categories=r.CATEGORIES,this.inputs=r.INPUTS,this.imports=r.IMPORTED||{},this.description=r.DESCRIPTION;const a=r.PASSES||[{}];this.passes=this.parsePasses(a);const l=this.rawFragmentShader.indexOf(o)+o.length+2;this.rawFragmentMain=this.rawFragmentShader.substring(l),this.generateShaders(),this.inferFilterType(),this.isfVersion=this.inferISFVersion()}catch(t){this.valid=!1,this.error=t,this.inputs=[],this.categories=[],this.credit="",this.errorLine=t.lineNumber}};We.prototype.parsePasses=function(e){const i=[];for(let t=0;t<e.length;++t){const r=e[t],o={};r.TARGET&&(o.target=r.TARGET),o.persistent=!!r.PERSISTENT,o.width=r.WIDTH||"$WIDTH",o.height=r.HEIGHT||"$HEIGHT",o.float=!!r.FLOAT,i.push(o)}return i};We.prototype.generateShaders=function(){this.uniformDefs="";for(let e=0;e<this.inputs.length;++e)this.addUniform(this.inputs[e]);for(let e=0;e<this.passes.length;++e)this.passes[e].target&&this.addUniform({NAME:this.passes[e].target,TYPE:"image"});for(const e in this.imports)({}).hasOwnProperty.call(this.imports,e)&&this.addUniform({NAME:e,TYPE:"image"});this.fragmentShader=this.buildFragmentShader(),this.vertexShader=this.buildVertexShader()};We.prototype.addUniform=function(e){const i=this.inputToType(e.TYPE);this.addUniformLine(`uniform ${i} ${e.NAME};`),i==="sampler2D"&&this.addUniformLine(this.samplerUniforms(e))};We.prototype.addUniformLine=function(e){this.uniformDefs+=`${e}
`};We.prototype.samplerUniforms=function(e){const i=e.NAME;let t="";return t+=`uniform vec4 _${i}_imgRect;
`,t+=`uniform vec2 _${i}_imgSize;
`,t+=`uniform bool _${i}_flip;
`,t+=`varying vec2 _${i}_normTexCoord;
`,t+=`varying vec2 _${i}_texCoord;
`,t+=`
`,t};We.prototype.buildFragmentShader=function(){const e=this.replaceSpecialFunctions(this.rawFragmentMain);return We.fragmentShaderSkeleton.replace("[[uniforms]]",this.uniformDefs).replace("[[main]]",e)};We.prototype.replaceSpecialFunctions=function(e){let i;return i=/IMG_THIS_PIXEL\((.+?)\)/g,e=e.replace(i,(t,r)=>`texture2D(${r}, isf_FragNormCoord)`),i=/IMG_THIS_NORM_PIXEL\((.+?)\)/g,e=e.replace(i,(t,r)=>`texture2D(${r}, isf_FragNormCoord)`),i=/IMG_PIXEL\((.+?)\)/g,e=e.replace(i,(t,r)=>{const o=r.split(","),a=o[0].trim(),l=o[1].trim();return`texture2D(${a}, (${l}) / RENDERSIZE)`}),i=/IMG_NORM_PIXEL\((.+?)\)/g,e=e.replace(i,(t,r)=>{const o=r.split(","),a=o[0].trim(),l=o[1].trim();return`texture2D(${a}, (${l}))`}),i=/IMG_SIZE\((.+?)\)/g,e=e.replace(i,(t,r)=>`_${r}_imgSize`),e};We.prototype.buildVertexShader=function(){let e=`
`;for(let i=0;i<this.inputs.length;++i){const t=this.inputs[i];t.TYPE==="image"&&(e+=`${this.texCoordFunctions(t)}
`)}return We.vertexShaderSkeleton.replace("[[functions]]",e).replace("[[uniforms]]",this.uniformDefs).replace("[[main]]",this.rawVertexShader)};We.prototype.texCoordFunctions=function(e){const i=e.NAME;return["_[[name]]_texCoord =","    vec2(((isf_fragCoord.x / _[[name]]_imgSize.x * _[[name]]_imgRect.z) + _[[name]]_imgRect.x), ","          (isf_fragCoord.y / _[[name]]_imgSize.y * _[[name]]_imgRect.w) + _[[name]]_imgRect.y);","","_[[name]]_normTexCoord =","  vec2((((isf_FragNormCoord.x * _[[name]]_imgSize.x) / _[[name]]_imgSize.x * _[[name]]_imgRect.z) + _[[name]]_imgRect.x),","          ((isf_FragNormCoord.y * _[[name]]_imgSize.y) / _[[name]]_imgSize.y * _[[name]]_imgRect.w) + _[[name]]_imgRect.y);"].join(`
`).replace(/\[\[name\]\]/g,i)};We.prototype.inferFilterType=function(){function e(r,o){return r.filter(o).length>0}const i=e(this.inputs,r=>r.TYPE==="image"&&r.NAME==="inputImage"),t=e(this.inputs,r=>r.TYPE==="image"&&r.NAME==="startImage")&&e(this.inputs,r=>r.TYPE==="image"&&r.NAME==="endImage")&&e(this.inputs,r=>r.TYPE==="float"&&r.NAME==="progress");i?this.type="filter":t?this.type="transition":this.type="generator"};We.prototype.inferISFVersion=function(){let e=2;return(this.metadata.PERSISTENT_BUFFERS||this.rawFragmentShader.indexOf("vv_FragNormCoord")!==-1||this.rawVertexShader.indexOf("vv_vertShaderInit")!==-1||this.rawVertexShader.indexOf("vv_FragNormCoord")!==-1)&&(e=1),e};We.prototype.inputToType=function(e){const i=Yf[e];if(!i)throw new Error(`Unknown input type [${e}]`);return i};We.fragmentShaderSkeleton=`
precision highp float;
precision highp int;

uniform int PASSINDEX;
uniform vec2 RENDERSIZE;
varying vec2 isf_FragNormCoord;
varying vec2 isf_FragCoord;
uniform float TIME;
uniform float TIMEDELTA;
uniform int FRAMEINDEX;
uniform vec4 DATE;

[[uniforms]]

// We don't need 2DRect functions since we control all inputs.  Don't need flip either, but leaving
// for consistency sake.
vec4 VVSAMPLER_2DBYPIXEL(sampler2D sampler, vec4 samplerImgRect, vec2 samplerImgSize, bool samplerFlip, vec2 loc) {
  return (samplerFlip)
    ? texture2D   (sampler,vec2(((loc.x/samplerImgSize.x*samplerImgRect.z)+samplerImgRect.x), (samplerImgRect.w-(loc.y/samplerImgSize.y*samplerImgRect.w)+samplerImgRect.y)))
    : texture2D   (sampler,vec2(((loc.x/samplerImgSize.x*samplerImgRect.z)+samplerImgRect.x), ((loc.y/samplerImgSize.y*samplerImgRect.w)+samplerImgRect.y)));
}
vec4 VVSAMPLER_2DBYNORM(sampler2D sampler, vec4 samplerImgRect, vec2 samplerImgSize, bool samplerFlip, vec2 normLoc)  {
  vec4    returnMe = VVSAMPLER_2DBYPIXEL(   sampler,samplerImgRect,samplerImgSize,samplerFlip,vec2(normLoc.x*samplerImgSize.x, normLoc.y*samplerImgSize.y));
  return returnMe;
}

[[main]]

`;We.vertexShaderDefault=`
void main() {
  isf_vertShaderInit();
}
`;We.vertexShaderSkeleton=`
precision highp float;
precision highp int;
void isf_vertShaderInit();

attribute vec2 isf_position; // -1..1

uniform int     PASSINDEX;
uniform vec2    RENDERSIZE;
varying vec2    isf_FragNormCoord; // 0..1
vec2    isf_fragCoord; // Pixel Space

[[uniforms]]

[[main]]
void isf_vertShaderInit(void)  {
gl_Position = vec4( isf_position, 0.0, 1.0 );
  isf_FragNormCoord = vec2((gl_Position.x+1.0)/2.0, (gl_Position.y+1.0)/2.0);
  isf_fragCoord = floor(isf_FragNormCoord * RENDERSIZE);
  [[functions]]
}
`;function jo(n){const e=n.split(`
`);for(let i=0;i<e.length;i++)if(e[i].indexOf("main()")!==-1)return i;return-1}function Jf(n,e,i){const t=jo(e),r=jo(i),a=/ERROR: (\d+):(\d+): (.*)/g.exec(n.message),l=a==null?void 0:a[2];return parseInt(l,10)+r-t}const Kf=(n,e)=>null,Zf=zf.eval;function Be(n){this.ctx=n,this.gl=n,this.uniforms=[],this.contextState=new fi(this.ctx),this.setupPaintToScreen(),this.startTime=Date.now(),this.lastRenderTime=Date.now(),this.frameIndex=0,this.parser={}}Be.prototype.loadSource=function(e,i){this.parser=new We,this.parser.parse(e,i),this.sourceChanged(this.parser.fragmentShader,this.parser.vertexShader,this.parser)};Be.prototype.sourceChanged=function(e,i,t){if(this.fragmentShader=e,this.vertexShader=i,this.model=t,!this.model.valid){this.valid=!1,this.error=this.model.error,this.errorLine=this.model.errorLine,console.error(this.valid,this.error,this.errorLine);return}try{this.valid=!0,this.error=null,this.errorLine=null,this.setupGL(),this.initUniforms();for(let r=0;r<t.inputs.length;r++){const o=t.inputs[r];o.DEFAULT!==void 0&&this.setValue(o.NAME,o.DEFAULT)}}catch(r){this.valid=!1,this.error=r,this.errorLine=Jf(r,this.fragmentShader,this.model.rawFragmentShader)}};Be.prototype.initUniforms=function(){this.uniforms=this.findUniforms(this.fragmentShader);const e=this.model.inputs;for(let i=0;i<e.length;++i){const t=e[i],r=this.uniforms[t.NAME];!r||(r.value=this.model[t.NAME],r.type==="t"&&(r.texture=new an({},this.contextState)))}this.pushTextures()};Be.prototype.setValue=function(e,i){this.program.use();const t=this.uniforms[e];if(!t){console.error(`No uniform named ${e}`);return}t.value=i,t.type==="t"&&(t.textureLoaded=!1),this.pushUniform(t)};Be.prototype.getValue=function(e){return this.uniforms[e]};Be.prototype.setNormalizedValue=function(e,i){const t=this.model.inputs;let r=null;for(let o=0;o<t.length;o++){const a=t[o];if(a.NAME===e){r=a;break}}r&&r.MIN!==void 0&&r.MAX!==void 0&&this.setValue(e,r.MIN+(r.MAX-r.MIN)*i)};Be.prototype.setupPaintToScreen=function(){return this.paintProgram=new Ft(this.ctx,this.basicVertexShader,this.basicFragmentShader),this.paintProgram.bindVertices()};Be.prototype.setupGL=function(){this.cleanup(),this.program=new Ft(this.ctx,this.vertexShader,this.fragmentShader),this.program.bindVertices(),this.generatePersistentBuffers()};Be.prototype.generatePersistentBuffers=function(){this.renderBuffers=[];const e=this.model.passes;for(let i=0;i<e.length;++i){const t=e[i],r=new hn(t,this.contextState);t.buffer=r,this.renderBuffers.push(r)}};Be.prototype.paintToScreen=function(e,i){this.paintProgram.use(),this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,null),this.ctx.viewport(0,0,e.width,e.height);const t=this.paintProgram.getUniformLocation("tex");i.readTexture().bind(t),this.ctx.drawArrays(this.ctx.TRIANGLES,0,6),this.program.use()};Be.prototype.pushTextures=function(){Object.keys(this.uniforms).forEach(e=>{const i=this.uniforms[e];i.type==="t"&&this.pushTexture(i)})};Be.prototype.pushTexture=function(e){if(!e.value||e.value.constructor.name!=="OffscreenCanvas"&&e.value.tagName!=="CANVAS"&&!e.value.complete&&e.value.readyState!==4)return;const i=this.program.getUniformLocation(e.name);if(e.texture.bind(i),this.ctx.texImage2D(this.ctx.TEXTURE_2D,0,this.ctx.RGBA,this.ctx.RGBA,this.ctx.UNSIGNED_BYTE,e.value),!e.textureLoaded){const t=e.value;e.textureLoaded=!0;const r=t.naturalWidth||t.width||t.videoWidth,o=t.naturalHeight||t.height||t.videoHeight;this.setValue(`_${e.name}_imgSize`,[r,o]),this.setValue(`_${e.name}_imgRect`,[0,0,1,1]),this.setValue(`_${e.name}_flip`,!1)}};Be.prototype.pushUniforms=function(){for(const e of this.uniforms)this.pushUniform(e)};Be.prototype.pushUniform=function(e){const i=this.program.getUniformLocation(e.name);if(i!==-1){if(e.type==="t"){this.pushTexture(e);return}const t=e.value;switch(e.type){case"f":this.ctx.uniform1f(i,t);break;case"v2":this.ctx.uniform2f(i,t[0],t[1]);break;case"v3":this.ctx.uniform3f(i,t[0],t[1],t[2]);break;case"v4":this.ctx.uniform4f(i,t[0],t[1],t[2],t[3]);break;case"i":this.ctx.uniform1i(i,t);break;case"color":this.ctx.uniform4f(i,t[0],t[1],t[2],t[3]);break;default:Kf(`Unknown type for uniform setting ${e.type}`);break}}};Be.prototype.findUniforms=function(e){const i=e.split(`
`),t={},r=i.length;for(let o=0;o<r;++o){const a=i[o].trim();if(a.indexOf("uniform")===0){const l=a.split(" "),s=l[2].substring(0,l[2].length-1),f=this.typeToUniform(l[1]);f.name=s,t[s]=f}}return t};Be.prototype.typeToUniform=function(e){switch(e){case"float":return{type:"f",value:0};case"vec2":return{type:"v2",value:[0,0]};case"vec3":return{type:"v3",value:[0,0,0]};case"vec4":return{type:"v4",value:[0,0,0,0]};case"bool":return{type:"i",value:0};case"int":return{type:"i",value:0};case"color":return{type:"v4",value:[0,0,0,0]};case"point2D":return{type:"v2",value:[0,0],isPoint:!0};case"sampler2D":return{type:"t",value:{complete:!1,readyState:0},texture:null,textureUnit:null};default:throw new Error(`Unknown uniform type in ISFRenderer.typeToUniform: ${e}`)}};Be.prototype.setDateUniforms=function(){const e=Date.now();this.setValue("TIME",(e-this.startTime)/1e3),this.setValue("TIMEDELTA",(e-this.lastRenderTime)/1e3),this.setValue("FRAMEINDEX",this.frameIndex++);const i=new Date;this.setValue("DATE",[i.getFullYear(),i.getMonth()+1,i.getDate(),i.getHours()*3600+i.getMinutes()*60+i.getSeconds()]),this.lastRenderTime=e};Be.prototype.draw=function(e){this.contextState.reset(),this.program.use(),this.setDateUniforms();const i=this.renderBuffers;for(let o=0;o<i.length;++o){const a=i[o],l=a.readTexture(),s=this.program.getUniformLocation(a.name);l.bind(s),a.name&&(this.setValue(`_${a.name}_imgSize`,[a.width,a.height]),this.setValue(`_${a.name}_imgRect`,[0,0,1,1]),this.setValue(`_${a.name}_flip`,!1))}let t=null;const r=this.model.passes;for(let o=0;o<r.length;++o){const a=r[o];this.setValue("PASSINDEX",o);const l=a.buffer;if(a.target){const s=this.evaluateSize(e,a.width),f=this.evaluateSize(e,a.height);l.setSize(s,f);const u=l.writeTexture();this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,l.fbo),this.ctx.framebufferTexture2D(this.ctx.FRAMEBUFFER,this.ctx.COLOR_ATTACHMENT0,this.ctx.TEXTURE_2D,u.texture,0),this.setValue("RENDERSIZE",[l.width,l.height]),t=l,this.ctx.viewport(0,0,s,f)}else{const s=e.width,f=e.height;this.ctx.bindTexture(this.ctx.TEXTURE_2D,null),this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,null),this.setValue("RENDERSIZE",[s,f]),t=null,this.ctx.viewport(0,0,s,f)}this.ctx.drawArrays(this.ctx.TRIANGLES,0,6),this.ctx.bindTexture(this.ctx.TEXTURE_2D,null),this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,null)}for(let o=0;o<i.length;++o)i[o].flip();t&&this.paintToScreen(e,t)};Be.prototype.evaluateSize=function(e,i){i+="";let t=i.replace("$WIDTH",(e==null?void 0:e.offsetWidth)||(e==null?void 0:e.width)).replace("$HEIGHT",(e==null?void 0:e.offsetHeight)||(e==null?void 0:e.height));for(const r in this.uniforms)if({}.hasOwnProperty.call(this.uniforms,r)){const o=this.uniforms[r];t=t.replace(`$${r}`,o.value)}return Zf(t)};Be.prototype.cleanup=function(){if(this.contextState.reset(),this.renderBuffers)for(let e=0;e<this.renderBuffers.length;++e)this.renderBuffers[e].destroy()};Be.prototype.basicVertexShader=`precision mediump float;
precision mediump int;
attribute vec2 isf_position; // -1..1
varying vec2 texCoord;

void main(void) {
  // Since webctx doesn't support ftransform, we do this by hand.
  gl_Position = vec4(isf_position, 0, 1);
  texCoord = isf_position;
}
`;Be.prototype.basicFragmentShader=`precision mediump float;
uniform sampler2D tex;
varying vec2 texCoord;
void main()
{
  gl_FragColor = texture2D(tex, texCoord * 0.5 + 0.5);
  //gl_FragColor = vec4(texCoord.x);
}`;const Qf="isf_vertShaderInit();",ft={texcoord:"isf_FragNormCoord",width:"RENDERSIZE.x"},$f=`

varying vec2 VTC_11;
varying vec2 VTC_00;
varying vec2 VTC_02;
varying vec2 VTC_20;
varying vec2 VTC_22;

void main() {
  ${Qf}

  VTC_11 = ${ft.texcoord};
  VTC_00 = ${ft.texcoord} + vec2(-${ft.width}, -${ft.width});
  VTC_02 = ${ft.texcoord} + vec2( ${ft.width}, -${ft.width});
  VTC_20 = ${ft.texcoord} + vec2( ${ft.width},  ${ft.width});
  VTC_22 = ${ft.texcoord} + vec2(-${ft.width},  ${ft.width});
}`,ec=window;async function tc(){let n=ye(en),e=ye(Vt);if(n)return n.close(),en.set(null),yt.set(Tt.COMPILE),null;const i=`toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=no,resizable=yes,width=${e.width},height=${e.height},top=0,left=0`;n=await ec.open("","MXZ",i),n.document.body.style="margin:0;padding:0;background:black;";const t=document.createElement("canvas");return t.id="canvas",t.width=e.width,t.height=e.height,t.style="position:fixed;top:0;left:0;width:100%;height:100%;",n.document.body.appendChild(t),n.document.title="MXZ",en.set(n),yt.set(Tt.COMPILE),n.addEventListener("beforeunload",r=>{en.set(null),yt.set(Tt.COMPILE)}),n}var rs={exports:{}};/*! file-extension v4.0.5 | (c) silverwind | BSD license */(function(n,e){(function(i){n.exports=i()})(function(){return function(t,r){if(r||(r={}),!t)return"";var o=(/[^./\\]*$/.exec(t)||[""])[0];return r.preserveCase?o:o.toLowerCase()}})})(rs);const nc=rs.exports;function rc(n){const e=nc(n);return["mkv"].includes(e)?"video/x-matroska;codecs=avc1":"video/webm"}function ic(n,e={}){const i=new Date;let t=null;const{filename:r=`Recording ${i.toISOString().slice(0,10)} at ${i.toTimeString().slice(0,8).replace(/:/g,".")}.webm`,frameRate:o=25,download:a=!0,recorderOptions:l={audioBitsPerSecond:128e3,videoBitsPerSecond:25e5}}={...e},s=l.mimeType||rc(r);a&&(t=t||document.createElement("a"),t.download=r);let f=[],u=n.captureStream(o),c=new MediaRecorder(u,{mimeType:s,...l});return c.ondataavailable=h=>{h.data.size&&f.push(h.data)},c.onstop=()=>{if(a&&f.length){const h=new Blob(f,{type:s}),p=URL.createObjectURL(h);t.href=p;const m=new MouseEvent("click");t.dispatchEvent(m),setTimeout(()=>{URL.revokeObjectURL(p)},1)}},{start(h){f=[],c.start(h)},set filename(h){t.download=h},step(){u.getVideoTracks()[0].requestFrame()},stop(){return c.stop(),f},dispose(){c=null,u=null},stream:u,recorder:c}}const{window:oc}=cr;function Vo(n,e,i){const t=n.slice();return t[4]=e[i][0],t[52]=e[i][1],t[53]=e,t[54]=i,t}function Go(n,e,i){const t=n.slice();return t[55]=e[i],t[56]=e,t[57]=i,t}function Ho(n,e,i){const t=n.slice();return t[58]=e[i],t[59]=e,t[4]=i,t}function qo(n){let e,i,t,r,o,a,l,s;function f(p){n[28](p,n[4])}let u={min:-1,max:1,step:.001};n[0][n[4]][0]!==void 0&&(u.value=n[0][n[4]][0]),i=new Ot({props:u}),Ke.push(()=>pt(i,"value",f));function c(p){n[29](p,n[4])}let h={min:-1,max:1,step:.001};return n[0][n[4]][1]!==void 0&&(h.value=n[0][n[4]][1]),o=new Ot({props:h}),Ke.push(()=>pt(o,"value",c)),{c(){e=H("div"),we(i.$$.fragment),r=re(),we(o.$$.fragment),l=re(),this.h()},l(p){e=q(p,"DIV",{class:!0});var m=X(e);Oe(i.$$.fragment,m),r=ie(m),Oe(o.$$.fragment,m),l=ie(m),m.forEach(M),this.h()},h(){R(e,"class","maxw50pc grow")},m(p,m){te(p,e,m),Ee(i,e,null),P(e,r),Ee(o,e,null),P(e,l),s=!0},p(p,m){n=p;const v={};!t&&m[0]&1&&(t=!0,v.value=n[0][n[4]][0],vt(()=>t=!1)),i.$set(v);const d={};!a&&m[0]&1&&(a=!0,d.value=n[0][n[4]][1],vt(()=>a=!1)),o.$set(d)},i(p){s||(ee(i.$$.fragment,p),ee(o.$$.fragment,p),s=!0)},o(p){oe(i.$$.fragment,p),oe(o.$$.fragment,p),s=!1},d(p){p&&M(e),Ne(i),Ne(o)}}}function zo(n){var a,l,s,f;let e,i,t;function r(u){n[30](u,n[4],n[57])}let o={min:(l=(a=n[15])==null?void 0:a[n[4]])==null?void 0:l.min,max:(f=(s=n[15])==null?void 0:s[n[4]])==null?void 0:f.max,step:.001};return n[11][n[4]][n[57]]!==void 0&&(o.value=n[11][n[4]][n[57]]),e=new Ot({props:o}),Ke.push(()=>pt(e,"value",r)),{c(){we(e.$$.fragment)},l(u){Oe(e.$$.fragment,u)},m(u,c){Ee(e,u,c),t=!0},p(u,c){var p,m,v,d;n=u;const h={};c[0]&2048&&(h.min=(m=(p=n[15])==null?void 0:p[n[4]])==null?void 0:m.min),c[0]&2048&&(h.max=(d=(v=n[15])==null?void 0:v[n[4]])==null?void 0:d.max),!i&&c[0]&2048&&(i=!0,h.value=n[11][n[4]][n[57]],vt(()=>i=!1)),e.$set(h)},i(u){t||(ee(e.$$.fragment,u),t=!0)},o(u){oe(e.$$.fragment,u),t=!1},d(u){Ne(e,u)}}}function Xo(n){let e,i,t=n[4]+"",r,o,a,l,s=n[52]||[],f=[];for(let c=0;c<s.length;c+=1)f[c]=zo(Go(n,s,c));const u=c=>oe(f[c],1,1,()=>{f[c]=null});return{c(){e=H("div"),i=H("div"),r=de(t),o=re();for(let c=0;c<f.length;c+=1)f[c].c();a=re(),this.h()},l(c){e=q(c,"DIV",{class:!0});var h=X(e);i=q(h,"DIV",{class:!0});var p=X(i);r=pe(p,t),p.forEach(M),o=ie(h);for(let m=0;m<f.length;m+=1)f[m].l(h);a=ie(h),h.forEach(M),this.h()},h(){R(i,"class","mb0-5"),R(e,"class","maxw50pc grow")},m(c,h){te(c,e,h),P(e,i),P(i,r),P(e,o);for(let p=0;p<f.length;p+=1)f[p].m(e,null);P(e,a),l=!0},p(c,h){if((!l||h[0]&2048)&&t!==(t=c[4]+"")&&Me(r,t),h[0]&34816){s=c[52]||[];let p;for(p=0;p<s.length;p+=1){const m=Go(c,s,p);f[p]?(f[p].p(m,h),ee(f[p],1)):(f[p]=zo(m),f[p].c(),ee(f[p],1),f[p].m(e,a))}for(rt(),p=s.length;p<f.length;p+=1)u(p);it()}},i(c){if(!l){for(let h=0;h<s.length;h+=1)ee(f[h]);l=!0}},o(c){f=f.filter(Boolean);for(let h=0;h<f.length;h+=1)oe(f[h]);l=!1},d(c){c&&M(e),Xe(f,c)}}}function ac(n){let e,i,t,r,o,a,l,s,f,u=n[6]?"\u25CF":"\u25CB",c,h,p,m,v=n[10]?"Recording...":"Record",d,_,y,b=(1e3/n[9]).toFixed(0)+"",E,N,S,A,x,w,I,L,C,j,Y,ae,V,se,Te,_e,J,Q,xe,Se,z=n[0],ve=[];for(let B=0;B<z.length;B+=1)ve[B]=qo(Ho(n,z,B));const Ae=B=>oe(ve[B],1,1,()=>{ve[B]=null});let Ze=Object.entries(n[11]),Re=[];for(let B=0;B<Ze.length;B+=1)Re[B]=Xo(Vo(n,Ze,B));const Pt=B=>oe(Re[B],1,1,()=>{Re[B]=null}),dt=n[24].default,Ve=la(dt,n,n[23],null);return{c(){e=H("div"),i=H("div"),t=H("button"),r=de("Popup"),o=re(),a=H("button"),l=de("Grab"),s=re(),f=H("button"),c=de(u),h=de(" Fullscreen"),p=re(),m=H("button"),d=de(v),_=re(),y=H("span"),E=de(b),N=re(),S=H("div"),A=H("canvas"),I=re(),L=H("canvas"),Y=re(),ae=H("div"),V=H("div");for(let B=0;B<ve.length;B+=1)ve[B].c();se=re(),Te=H("div");for(let B=0;B<Re.length;B+=1)Re[B].c();_e=re(),Ve&&Ve.c(),this.h()},l(B){e=q(B,"DIV",{class:!0,style:!0});var K=X(e);i=q(K,"DIV",{class:!0});var Z=X(i);t=q(Z,"BUTTON",{});var Ge=X(t);r=pe(Ge,"Popup"),Ge.forEach(M),o=ie(Z),a=q(Z,"BUTTON",{});var He=X(a);l=pe(He,"Grab"),He.forEach(M),s=ie(Z),f=q(Z,"BUTTON",{});var qe=X(f);c=pe(qe,u),h=pe(qe," Fullscreen"),qe.forEach(M),p=ie(Z),m=q(Z,"BUTTON",{});var ze=X(m);d=pe(ze,v),ze.forEach(M),_=ie(Z),y=q(Z,"SPAN",{class:!0});var T=X(y);E=pe(T,b),T.forEach(M),Z.forEach(M),N=ie(K),S=q(K,"DIV",{style:!0,class:!0});var D=X(S);A=q(D,"CANVAS",{class:!0,width:!0,height:!0}),X(A).forEach(M),I=ie(D),L=q(D,"CANVAS",{id:!0,class:!0,style:!0,width:!0,height:!0}),X(L).forEach(M),D.forEach(M),Y=ie(K),ae=q(K,"DIV",{class:!0,style:!0});var U=X(ae);V=q(U,"DIV",{class:!0});var k=X(V);for(let ne=0;ne<ve.length;ne+=1)ve[ne].l(k);k.forEach(M),se=ie(U),Te=q(U,"DIV",{class:!0});var $=X(Te);for(let ne=0;ne<Re.length;ne+=1)Re[ne].l($);$.forEach(M),U.forEach(M),_e=ie(K),Ve&&Ve.l(K),K.forEach(M),this.h()},h(){Fe(m,"active",n[10]),R(y,"class","fps"),R(i,"class","actions bb"),R(A,"class","w100pc h100pc"),R(A,"width",x=n[7].width),R(A,"height",w=n[7].height),R(L,"id",n[2]),R(L,"class","w100pc h100pc fill"),ke(L,"transform",n[16](n[11])),R(L,"width",C=n[7].width),R(L,"height",j=n[7].height),ke(S,"top","0px"),ke(S,"left","0px"),ke(S,"background","black"),ke(S,"z-index","999999999"),R(S,"class","rel t0pc l0pc w100pc h100pc overflow-hidden"),Fe(S,"fixed",n[6]),R(V,"class","flex wrap grow w100pc"),R(Te,"class","flex wrap grow w100pc"),R(ae,"class","flex column-stretch-flex-start bg bt p1"),ke(ae,"background","var(--blue5-0)"),ke(ae,"z-index","99999"),R(e,"class",J="renderer bb "+n[3]),ke(e,"height","auto"),ke(e,"min-width",n[1]+"px"),ke(e,"max-width",n[1]+"px")},m(B,K){te(B,e,K),P(e,i),P(i,t),P(t,r),P(i,o),P(i,a),P(a,l),P(i,s),P(i,f),P(f,c),P(f,h),P(i,p),P(i,m),P(m,d),P(i,_),P(i,y),P(y,E),P(e,N),P(e,S),P(S,A),P(S,I),P(S,L),n[26](L),n[27](S),P(e,Y),P(e,ae),P(ae,V);for(let Z=0;Z<ve.length;Z+=1)ve[Z].m(V,null);P(ae,se),P(ae,Te);for(let Z=0;Z<Re.length;Z+=1)Re[Z].m(Te,null);P(e,_e),Ve&&Ve.m(e,null),Q=!0,xe||(Se=[ce(oc,"resize",n[14]),ce(t,"click",tc),ce(a,"click",n[12]),ce(f,"click",n[25]),ce(m,"click",n[13])],xe=!0)},p(B,K){if((!Q||K[0]&64)&&u!==(u=B[6]?"\u25CF":"\u25CB")&&Me(c,u),(!Q||K[0]&1024)&&v!==(v=B[10]?"Recording...":"Record")&&Me(d,v),(!Q||K[0]&1024)&&Fe(m,"active",B[10]),(!Q||K[0]&512)&&b!==(b=(1e3/B[9]).toFixed(0)+"")&&Me(E,b),(!Q||K[0]&128&&x!==(x=B[7].width))&&R(A,"width",x),(!Q||K[0]&128&&w!==(w=B[7].height))&&R(A,"height",w),(!Q||K[0]&4)&&R(L,"id",B[2]),(!Q||K[0]&2048)&&ke(L,"transform",B[16](B[11])),(!Q||K[0]&128&&C!==(C=B[7].width))&&R(L,"width",C),(!Q||K[0]&128&&j!==(j=B[7].height))&&R(L,"height",j),(!Q||K[0]&64)&&Fe(S,"fixed",B[6]),K[0]&1){z=B[0];let Z;for(Z=0;Z<z.length;Z+=1){const Ge=Ho(B,z,Z);ve[Z]?(ve[Z].p(Ge,K),ee(ve[Z],1)):(ve[Z]=qo(Ge),ve[Z].c(),ee(ve[Z],1),ve[Z].m(V,null))}for(rt(),Z=z.length;Z<ve.length;Z+=1)Ae(Z);it()}if(K[0]&34816){Ze=Object.entries(B[11]);let Z;for(Z=0;Z<Ze.length;Z+=1){const Ge=Vo(B,Ze,Z);Re[Z]?(Re[Z].p(Ge,K),ee(Re[Z],1)):(Re[Z]=Xo(Ge),Re[Z].c(),ee(Re[Z],1),Re[Z].m(Te,null))}for(rt(),Z=Ze.length;Z<Re.length;Z+=1)Pt(Z);it()}Ve&&Ve.p&&(!Q||K[0]&8388608)&&ua(Ve,dt,B,B[23],Q?ca(dt,B[23],K,null):fa(B[23]),null),(!Q||K[0]&8&&J!==(J="renderer bb "+B[3]))&&R(e,"class",J),(!Q||K[0]&2)&&ke(e,"min-width",B[1]+"px"),(!Q||K[0]&2)&&ke(e,"max-width",B[1]+"px")},i(B){if(!Q){for(let K=0;K<z.length;K+=1)ee(ve[K]);for(let K=0;K<Ze.length;K+=1)ee(Re[K]);ee(Ve,B),Q=!0}},o(B){ve=ve.filter(Boolean);for(let K=0;K<ve.length;K+=1)oe(ve[K]);Re=Re.filter(Boolean);for(let K=0;K<Re.length;K+=1)oe(Re[K]);oe(Ve,B),Q=!1},d(B){B&&M(e),n[26](null),n[27](null),Xe(ve,B),Xe(Re,B),Ve&&Ve.d(B),xe=!1,mt(Se)}}}function sc(n,e,i){let t,r,o,a,l,s;he(n,lr,B=>i(11,t=B)),he(n,Pn,B=>i(6,r=B)),he(n,Vt,B=>i(7,o=B)),he(n,yt,B=>i(41,a=B)),he(n,ue,B=>i(42,l=B)),he(n,en,B=>i(43,s=B));let{$$slots:f={},$$scope:u}=e,{width:c=320}=e,{preview:h}=e,{key:p}=e,{capture:m=!1}=e,{fullscreen:v=!1}=e,{id:d}=e,{style:_=""}=e,{class:y=""}=e;const b=window;let E,N;const S=(B,K)=>console.log(`[Renderer] ${B}`,K||"");let A;function x(){return s?(A||(A=s.document.getElementById("canvas")),A):E}ps(async B=>{s&&(await s.close(),ge(en,s=null,s))});let w;function I(B){a==Tt.COMPILE&&Br&&(w&&clearTimeout(w),w=setTimeout(K=>{S("\u{1F3DE} recompiling"),b.requestAnimationFrame(async Z=>{const Ge=x();N||(N=ic(Ge,{recorderOptions:{audioBitsPerSecond:128e3,videoBitsPerSecond:25e5*10}})),b.RNDRS||(b.RNDRS={});const He=Ge.getContext("webgl2",{preserveDrawingBuffer:!0});b.RNDRS[p]=new Be(He),b.ISF=ur(),b.VTX="// hello world?",b.RNDRS[p].loadSource(b.ISF,$f);const qe=document.getElementById("ISF");qe&&(qe.innerText=b.RNDRS[p].parser.fragmentShader),ge(ue,l={...l},l),ge(yt,a=Tt.DONE,a)})},1))}yt.subscribe(I);let L,C=30;const j=B=>{var He;const K=new Date;L||(L=K);const Z=.98,Ge=K-L;i(9,C=C*Z+Ge*(1-Z));try{(He=b.RNDRS)!=null&&He[p]&&b.RNDRS[p].draw(x())}catch(qe){throw console.log("\u274C renderer error:",qe.message),qe}L=new Date,requestAnimationFrame(j)};sn(async B=>{_e(),j()});function Y(){b.requestAnimationFrame(async B=>{const K=document.createElement("a");K.setAttribute("download","_MXZ.png");const Z=(await E.toDataURL("image/png",1)).replace(/^data:image\/png/,"data:application/octet-stream");K.setAttribute("href",Z),K.click()})}window.captureImage=Y;let ae=!1;function V(){i(10,ae=!ae),ae?N.start():(N.stop(),N.dispose()),window.recorder=N}let se,Te;function _e(){i(21,se=b.innerWidth),i(22,Te=b.innerHeight)}let{ctrlPoints:J=[[0,0],[0,0],[0,0],[0,0]]}=e;const Q=[[0,0],[0,1],[1,0],[1,1]];let xe;function Se(B,K,Z,Ge){if(!o||!Z)return{from:[],to:[],matrix:[]};const He=[],qe=[];let ze=[],T=[];const D=r?window.innerWidth:Z.offsetWidth,U=r?window.innerHeight:Z.offsetHeight;for(let G=0;G<B.length;G++)T.push([(Q[G][0]+B[G][0])*D,(Q[G][1]+B[G][1])*U]),ze.push([Q[G][0]*D,Q[G][1]*U]);for(let G=0;G<4;G++)He.push([ze[G][0],ze[G][1],1,0,0,0,-ze[G][0]*T[G][0],-ze[G][1]*T[G][0]]),He.push([0,0,0,ze[G][0],ze[G][1],1,-ze[G][0]*T[G][1],-ze[G][1]*T[G][1]]),qe.push(T[G][0]),qe.push(T[G][1]);const k=window.numeric.solve(He,qe),$=[[k[0],k[1],0,k[2]],[k[3],k[4],0,k[5]],[0,0,1,0],[k[6],k[7],0,1]];let ne,fe;fe=[];for(let G=ne=0;ne<4;G=++ne)fe.push(function(){var me,Je;Je=[];for(let et=me=0;me<4;et=++me)Je.push($[et][G].toFixed(20));return Je}());const le=`matrix3d(${fe.join(",")})`;return{from:ze,to:T,matrix:fe,matrix3d:le}}const z={translate:{unit:"%",min:-15,max:15},rotate:{unit:"deg",min:-15,max:15},scale:{unit:" ",min:.5,max:1},skew:{unit:"deg",min:-15,max:15}};function ve(B){let K="";for(const[Z,Ge]of Object.entries(t)){let He=0;const qe=["X","Y","Z"];K+=`${Ge.map(ze=>{var D,U;let T=(D=z==null?void 0:z[Z])!=null&&D.unit?qe[He]:"";return He+=1,`${Z}${T}( ${ze||0}${((U=z==null?void 0:z[Z])==null?void 0:U.unit)||""} )`}).join(" ")} `}return K}const Ae=B=>ge(Pn,r=!r,r);function Ze(B){Ke[B?"unshift":"push"](()=>{E=B,i(8,E)})}function Re(B){Ke[B?"unshift":"push"](()=>{xe=B,i(5,xe)})}function Pt(B,K){n.$$.not_equal(J[K][0],B)&&(J[K][0]=B,i(0,J))}function dt(B,K){n.$$.not_equal(J[K][1],B)&&(J[K][1]=B,i(0,J))}function Ve(B,K,Z){n.$$.not_equal(t[K][Z],B)&&(t[K][Z]=B,lr.set(t))}return n.$$set=B=>{"width"in B&&i(1,c=B.width),"preview"in B&&i(17,h=B.preview),"key"in B&&i(4,p=B.key),"capture"in B&&i(18,m=B.capture),"fullscreen"in B&&i(19,v=B.fullscreen),"id"in B&&i(2,d=B.id),"style"in B&&i(20,_=B.style),"class"in B&&i(3,y=B.class),"ctrlPoints"in B&&i(0,J=B.ctrlPoints),"$$scope"in B&&i(23,u=B.$$scope)},n.$$.update=()=>{n.$$.dirty[0]&6291648&&r&&(se/o.width,Te/o.height),n.$$.dirty[0]&225&&Se(J,o,xe)},[J,c,d,y,p,xe,r,o,E,C,ae,t,Y,V,_e,z,ve,h,m,v,_,se,Te,u,f,Ae,Ze,Re,Pt,dt,Ve]}class lc extends Ce{constructor(e){super(),De(this,e,sc,ac,Le,{width:1,preview:17,key:4,capture:18,fullscreen:19,id:2,style:20,class:3,ctrlPoints:0},null,[-1,-1])}}function uc(n){let e=n.split(":");return e[2]=parseInt(e[2]),e[4]=parseInt(e[4]),e}async function fc(){const n={echNm2:"Launch Control XL-Launch Control XL",echo:!0,src:"/MIDI/ch. 9/note [41]",tog:!0,wantsEnbl:!0},e={echNm2:"Launch Control XL-Launch Control XL",endM:5,echo:!0,src:"/MIDI/ch. 9/ctrl [77]",tog:!0,wantsEnbl:!0};let t={...{VVGridSize:"{-1, -1}",classArray:[],keyArray:[],uiBuilder:{}}};const r=ye(bt);let o=Object.keys(r);o=o.sort((l,s)=>(l=ir(l),s=ir(s),l.x-s.x||l.y-s.y)),console.log("HEY!");for(const l of o){const s=r[l];for(const f of s){const u=uc(f),c=`${u[1]-u[1]}`,h=ir(l),p=ti(h,l.substring(4));u[3]=="note"?(t.classArray.push("Button"),t.keyArray.push(p),t.uiBuilder[p]={...n,rcvrs:[{...n}]},t.uiBuilder[p].rcvrs[0].echNm2=c,t.uiBuilder[p].rcvrs[0].src=`/MIDI/ch. ${u[2]}/note [${u[4]}]`):u[3]=="controlchange"&&(t.classArray.push("Slider"),t.keyArray.push(p),t.uiBuilder[p]={...e,rcvrs:[{...e}]},t.uiBuilder[p].rcvrs[0].echNm2=c,t.uiBuilder[p].rcvrs[0].src=`/MIDI/ch. ${u[2]}/ctrl [${u[4]}]`)}}return JSON.stringify(t,null,"	")}function Wo(n,e,i){const t=n.slice();return t[10]=e[i][0],t[11]=e[i][1],t}function Yo(n){let e,i=n[10]+"",t,r,o,a;return{c(){e=H("button"),t=de(i),r=re(),this.h()},l(l){e=q(l,"BUTTON",{class:!0});var s=X(e);t=pe(s,i),r=ie(s),s.forEach(M),this.h()},h(){R(e,"class","br plr1 grow f0 ptb0-5")},m(l,s){te(l,e,s),P(e,t),P(e,r),o||(a=ce(e,"mousedown",n[11]),o=!0)},p(l,s){n=l},d(l){l&&M(e),o=!1,a()}}}function cc(n){let e,i=Object.entries(n[0]),t=[];for(let r=0;r<i.length;r+=1)t[r]=Yo(Wo(n,i,r));return{c(){for(let r=0;r<t.length;r+=1)t[r].c();e=je()},l(r){for(let o=0;o<t.length;o+=1)t[o].l(r);e=je()},m(r,o){for(let a=0;a<t.length;a+=1)t[a].m(r,o);te(r,e,o)},p(r,[o]){if(o&1){i=Object.entries(r[0]);let a;for(a=0;a<i.length;a+=1){const l=Wo(r,i,a);t[a]?t[a].p(l,o):(t[a]=Yo(l),t[a].c(),t[a].m(e.parentNode,e))}for(;a<t.length;a+=1)t[a].d(1);t.length=i.length}},i:Pe,o:Pe,d(r){Xe(t,r),r&&M(e)}}}const Pr="MXZ";function hc(n,e,i){const t=window,r=(p,m)=>console.log(`[FileSave] ${p}`,m||"");function o(){const p=jr();t.localStorage.setItem(Pr,p),r("\u{1F4BE} saved",JSON.parse(p))}function a(){t.confirm("Clear?")&&t.localStorage.removeItem(Pr)}function l(){r("loading from local storage"),vi(t.localStorage.getItem(Pr))}function s(){const p=document.createElement("a");p.setAttribute("href",`data:application/plain;charset=utf-8,${encodeURIComponent(ur({hide:!0,isf:!0}))}`),p.setAttribute("download","__MXZ.fs"),p.click()}async function f(){const p={types:[{description:"Shaders",accept:{"text/*":[".fs",".glsl"]}}],excludeAcceptAllOption:!0,multiple:!1},[m]=await window.showOpenFilePicker(p);try{const v=await(await m.getFile()).text(),d=v.indexOf(Mn.START),_=v.indexOf(Mn.END),y=v.substring(d+Mn.START.length,_);vi(y)}catch(v){alert(`Could not open project: ${v.message}`)}}async function u(){t.confirm("Clear?")&&bt.set({})}async function c(){console.log("save assignments");const p=document.createElement("a"),m=await fc();p.setAttribute("href",`data:application/plain;charset=utf-8,${encodeURIComponent(m)}`),p.setAttribute("download","__MXZ_Controls.json"),p.click()}return sn(l),[{"L: Load":l,"L: Save":o,"L: Clear":a,"P: Open":f,"P: Save":s,"M: Clear":u,"M: Save":c},o,a,l,s,f,u,c]}class dc extends Ce{constructor(e){super(),De(this,e,hc,cc,Le,{saveLocally:1,clearLocally:2,loadLocally:3,saveProject:4,openProject:5,clearAssignments:6,saveAssignments:7})}get saveLocally(){return this.$$.ctx[1]}get clearLocally(){return this.$$.ctx[2]}get loadLocally(){return this.$$.ctx[3]}get saveProject(){return this.$$.ctx[4]}get openProject(){return this.$$.ctx[5]}get clearAssignments(){return this.$$.ctx[6]}get saveAssignments(){return this.$$.ctx[7]}}function Jo(n,e,i){const t=n.slice();return t[13]=e[i][0],t[14]=e[i][1],t}function Ko(n,e,i){const t=n.slice();return t[17]=e[i],t}function Zo(n){let e,i,t=n[17]+"",r,o,a;function l(...f){return n[8](n[17],...f)}function s(...f){return n[9](n[17],...f)}return{c(){e=H("div"),i=H("span"),r=de(t),this.h()},l(f){e=q(f,"DIV",{id:!0,"data-drag-type":!0,"data-drag-unit":!0,draggable:!0,class:!0});var u=X(e);i=q(u,"SPAN",{class:!0});var c=X(i);r=pe(c,t),c.forEach(M),u.forEach(M),this.h()},h(){R(i,"class","f0"),R(e,"id","menu_"+n[17].toLowerCase()),R(e,"data-drag-type",lt.MOVE),R(e,"data-drag-unit",n[17]),R(e,"draggable",!0),R(e,"class","plr0-5 grabbable br bt f3 flex row-center-center pop ptb0-5 grow")},m(f,u){te(f,e,u),P(e,i),P(i,r),o||(a=[ce(e,"mousedown",l),ce(e,"mouseup",s)],o=!0)},p(f,u){n=f},d(f){f&&M(e),o=!1,mt(a)}}}function Qo(n){let e,i=Object.keys(n[14]),t=[];for(let r=0;r<i.length;r+=1)t[r]=Zo(Ko(n,i,r));return{c(){for(let r=0;r<t.length;r+=1)t[r].c();e=je()},l(r){for(let o=0;o<t.length;o+=1)t[o].l(r);e=je()},m(r,o){for(let a=0;a<t.length;a+=1)t[a].m(r,o);te(r,e,o)},p(r,o){if(o&14){i=Object.keys(r[14]);let a;for(a=0;a<i.length;a+=1){const l=Ko(r,i,a);t[a]?t[a].p(l,o):(t[a]=Zo(l),t[a].c(),t[a].m(e.parentNode,e))}for(;a<t.length;a+=1)t[a].d(1);t.length=i.length}},d(r){Xe(t,r),r&&M(e)}}}function pc(n){let e,i,t,r,o,a,l,s,f,u,c,h,p,m,v,d,_;t=new dc({});const y=n[5].default,b=la(y,n,n[4],null);let E=Object.entries(n[3]),N=[];for(let S=0;S<E.length;S+=1)N[S]=Qo(Jo(n,E,S));return{c(){e=H("aside"),i=H("div"),we(t.$$.fragment),r=re(),o=H("input"),a=re(),l=H("input"),s=re(),b&&b.c(),f=re(),u=H("div");for(let S=0;S<N.length;S+=1)N[S].c();c=re(),h=H("a"),p=H("img"),this.h()},l(S){e=q(S,"ASIDE",{style:!0,class:!0});var A=X(e);i=q(A,"DIV",{style:!0,class:!0});var x=X(i);Oe(t.$$.fragment,x),r=ie(x),o=q(x,"INPUT",{type:!0,class:!0}),a=ie(x),l=q(x,"INPUT",{type:!0,class:!0}),s=ie(x),b&&b.l(x),x.forEach(M),f=ie(A),u=q(A,"DIV",{style:!0,class:!0});var w=X(u);for(let L=0;L<N.length;L+=1)N[L].l(w);c=ie(w),h=q(w,"A",{href:!0,class:!0,style:!0});var I=X(h);p=q(I,"IMG",{style:!0,class:!0,src:!0}),I.forEach(M),w.forEach(M),A.forEach(M),this.h()},h(){R(o,"type","number"),R(o,"class","br ptb0-5 plr1 minw0px"),R(l,"type","number"),R(l,"class","br ptb0-5 plr1 minw0px"),ke(i,"background","var(--blue5-0)"),R(i,"class","flex row-center-stretch fixed t0 l0 w100pc bb z-index99"),ke(p,"background","none"),ke(p,"height","2.4em"),R(p,"class","pt0-4 pb0-3 plr0-5"),Gt(p.src,m="/liberatedinterfaces.png")||R(p,"src",m),R(h,"href","https://liberatedinterfaces.tv"),R(h,"class","bt"),ke(h,"padding","0"),ke(h,"line-height","0em"),ke(u,"background","var(--blue5-0)"),R(u,"class","flex row fixed l0 b0 w100pc z-index98"),ke(e,"background","var(--blue5-0)"),R(e,"class","flex column")},m(S,A){te(S,e,A),P(e,i),Ee(t,i,null),P(i,r),P(i,o),Lt(o,n[0].width),P(i,a),P(i,l),Lt(l,n[0].height),P(i,s),b&&b.m(i,null),P(e,f),P(e,u);for(let x=0;x<N.length;x+=1)N[x].m(u,null);P(u,c),P(u,h),P(h,p),v=!0,d||(_=[ce(o,"input",n[6]),ce(l,"input",n[7])],d=!0)},p(S,[A]){if(A&1&&rn(o.value)!==S[0].width&&Lt(o,S[0].width),A&1&&rn(l.value)!==S[0].height&&Lt(l,S[0].height),b&&b.p&&(!v||A&16)&&ua(b,y,S,S[4],v?ca(y,S[4],A,null):fa(S[4]),null),A&14){E=Object.entries(S[3]);let x;for(x=0;x<E.length;x+=1){const w=Jo(S,E,x);N[x]?N[x].p(w,A):(N[x]=Qo(w),N[x].c(),N[x].m(u,c))}for(;x<N.length;x+=1)N[x].d(1);N.length=E.length}},i(S){v||(ee(t.$$.fragment,S),ee(b,S),v=!0)},o(S){oe(t.$$.fragment,S),oe(b,S),v=!1},d(S){S&&M(e),Ne(t),b&&b.d(S),Xe(N,S),d=!1,mt(_)}}}function mc(n,e,i){let t,r,o;he(n,At,v=>i(10,t=v)),he(n,nt,v=>i(11,r=v)),he(n,Vt,v=>i(0,o=v));let{$$slots:a={},$$scope:l}=e;function s(v){ge(nt,r=[Ca(v)],r),ge(At,t=!0,t)}function f(v){ge(nt,r=[-1,-1,-1,-1],r),ge(At,t=!1,t)}const u={ops:on};function c(){o.width=rn(this.value),Vt.set(o)}function h(){o.height=rn(this.value),Vt.set(o)}const p=(v,d)=>s(v),m=(v,d)=>f();return n.$$set=v=>{"$$scope"in v&&i(4,l=v.$$scope)},[o,s,f,u,l,a,c,h,p,m]}class gc extends Ce{constructor(e){super(),De(this,e,mc,pc,Le,{})}}const vc=window;function Fn(n){if(!ye(At))return;n=n.detail?n.detail:n;let i=n.composedPath().find(t=>t.getAttribute("data-drag-type"));for(const t of document.querySelectorAll(".draggedover"))t.classList.remove("draggedover");i&&i.classList.add("draggedover"),n.preventDefault()}function Un(n){if(!ye(At))return;n=n.detail?n.detail:n;let i=n.composedPath().find(s=>s.getAttribute("data-drag-type")),t=i.getAttribute("data-drag-type"),r=parseInt(i.getAttribute("data-drag-colIdx")),o=parseInt(i.getAttribute("data-drag-rowIdx"));for(const s of document.querySelectorAll(".draggedover"))s.classList.remove("draggedover");const a=ye(nt),l=typeof(a==null?void 0:a[0])=="string"?a:[];yt.set(Tt.PAUSE),ri(t,o,r,l),At.set(!1),nt.set(null),Qr(),vc.requestAnimationFrame(s=>{yt.set(Tt.COMPILE)})}function yc(n){let e;return{c(){e=de("NO SUCH OPERATOR")},l(i){e=pe(i,"NO SUCH OPERATOR")},m(i,t){te(i,e,t)},p:Pe,i:Pe,o:Pe,d(i){i&&M(e)}}}function _c(n){let e,i,t;var r=on[n[0]].COMPONENT;function o(a){return{props:{uuid:a[4],name:a[0],rowIdx:a[1],colIdx:a[2]}}}return r&&(e=new r(o(n))),{c(){e&&we(e.$$.fragment),i=je()},l(a){e&&Oe(e.$$.fragment,a),i=je()},m(a,l){e&&Ee(e,a,l),te(a,i,l),t=!0},p(a,l){const s={};if(l&16&&(s.uuid=a[4]),l&1&&(s.name=a[0]),l&2&&(s.rowIdx=a[1]),l&4&&(s.colIdx=a[2]),r!==(r=on[a[0]].COMPONENT)){if(e){rt();const f=e;oe(f.$$.fragment,1,0,()=>{Ne(f,1)}),it()}r?(e=new r(o(a)),we(e.$$.fragment),ee(e.$$.fragment,1),Ee(e,i.parentNode,i)):e=null}else r&&e.$set(s)},i(a){t||(e&&ee(e.$$.fragment,a),t=!0)},o(a){e&&oe(e.$$.fragment,a),t=!1},d(a){a&&M(i),e&&Ne(e,a)}}}function bc(n){let e,i,t,r,o,a=Ln(n[1])+"",l,s=n[2]+1+"",f,u,c,h,p,m=(n[4]||"")+"",v,d,_,y,b,E,N,S,A,x;const w=[_c,yc],I=[];function L(C,j){return on[C[0]]?0:1}return y=L(n),b=I[y]=w[y](n),{c(){e=H("div"),i=H("header"),t=H("div"),r=H("div"),o=H("div"),l=de(a),f=de(s),u=re(),c=de(n[0]),h=re(),p=H("div"),v=de(m),d=re(),_=H("div"),b.c(),this.h()},l(C){e=q(C,"DIV",{"data-drag-type":!0,"data-drag-rowidx":!0,"data-drag-colidx":!0,class:!0});var j=X(e);i=q(j,"HEADER",{draggable:!0,class:!0});var Y=X(i);t=q(Y,"DIV",{class:!0});var ae=X(t);r=q(ae,"DIV",{class:!0});var V=X(r);o=q(V,"DIV",{class:!0});var se=X(o);l=pe(se,a),f=pe(se,s),u=ie(se),c=pe(se,n[0]),se.forEach(M),h=ie(V),p=q(V,"DIV",{class:!0});var Te=X(p);v=pe(Te,m),Te.forEach(M),V.forEach(M),ae.forEach(M),Y.forEach(M),d=ie(j),_=q(j,"DIV",{class:!0});var _e=X(_);b.l(_e),_e.forEach(M),j.forEach(M),this.h()},h(){R(o,"class","bold"),R(p,"class","f0"),R(r,"class","grabbable flex grow row-space-between-center rel p0-5"),R(t,"class","flex row-space-between-center w100pc "),R(i,"draggable",n[6]),R(i,"class","flex column w100pc "),R(_,"class","inner"),R(e,"data-drag-type",lt.MOVE),R(e,"data-drag-rowidx",n[1]),R(e,"data-drag-colidx",E=n[2]-1),R(e,"class",N="op op-"+n[0].toLowerCase()+" global"),Fe(e,"pop",n[5]),Fe(e,"invisible",n[3]&&!n[5])},m(C,j){te(C,e,j),P(e,i),P(i,t),P(t,r),P(r,o),P(o,l),P(o,f),P(o,u),P(o,c),P(r,h),P(r,p),P(p,v),P(e,d),P(e,_),I[y].m(_,null),S=!0,A||(x=[ce(r,"mousedown",n[12]),ce(i,"dragstart",n[10]),ce(e,"drop",n[13]),ce(e,"dragover",n[14]),ce(e,"dragenter",n[15]),ce(e,"dragleave",n[16]),ce(e,"mouseup",n[9]),ce(e,"mousedown",n[8])],A=!0)},p(C,[j]){(!S||j&2)&&a!==(a=Ln(C[1])+"")&&Me(l,a),(!S||j&4)&&s!==(s=C[2]+1+"")&&Me(f,s),(!S||j&1)&&Me(c,C[0]),(!S||j&16)&&m!==(m=(C[4]||"")+"")&&Me(v,m),(!S||j&64)&&R(i,"draggable",C[6]);let Y=y;y=L(C),y===Y?I[y].p(C,j):(rt(),oe(I[Y],1,1,()=>{I[Y]=null}),it(),b=I[y],b?b.p(C,j):(b=I[y]=w[y](C),b.c()),ee(b,1),b.m(_,null)),(!S||j&2)&&R(e,"data-drag-rowidx",C[1]),(!S||j&4&&E!==(E=C[2]-1))&&R(e,"data-drag-colidx",E),(!S||j&1&&N!==(N="op op-"+C[0].toLowerCase()+" global"))&&R(e,"class",N),(!S||j&33)&&Fe(e,"pop",C[5]),(!S||j&41)&&Fe(e,"invisible",C[3]&&!C[5])},i(C){S||(ee(b),S=!0)},o(C){oe(b),S=!1},d(C){C&&M(e),I[y].d(),A=!1,mt(x)}}}function wc(n,e,i){let t,r,o,a,l,s;he(n,nt,w=>i(17,r=w)),he(n,Dt,w=>i(18,o=w)),he(n,At,w=>i(6,a=w)),he(n,jt,w=>i(19,l=w)),he(n,ue,w=>i(20,s=w));const f=(w,I)=>console.log(`[Unit] ${w}`,I||"");let{name:u}=e,{rowIdx:c}=e,{colIdx:h}=e,{index:p}=e,{clone:m=!1}=e,{uuid:v}=e;const d=ms();function _(w){if(l&&(l==null?void 0:l.uuid)!=v){const I=parseInt(v.substring(1));f(`\u{1F447} setting OpSelect ${l.uuid} to ${v} ${I}`),ge(ue,s[l.key]=I,s),ge(jt,l=null,l)}}function y(w){ge(At,a=!1,a),r||ge(nt,r=[[-1,-1],[-1,-1]],r);let I=r;if(o[Rs])I[1][0]=c,I[1][1]=h;else try{I[0][0]=I[1][0]=c,I[0][1]=I[1][1]=h}catch{}I=I.sort((L,C)=>L[0]==C[0]?L[1]-C[1]:L[0]-C[0]),console.log(`[Unit] on touchup, setting selected tp ${r}`),ge(nt,r=I,r)}const b=w=>{t||(r||ge(nt,r=[[-1,-1],[-1,-1]],r),console.log(`[Unit] resetting selected ${r} to [${c},${h}]`),ge(nt,r=[[c,h],[c,h]],r));const I=document.getElementById("drag-visualiser");w.dataTransfer.setDragImage(I,80,ni().length*40)},E=w=>ge(At,a=!0,a),N=w=>d(lt.DROP,w),S=w=>d(lt.DRAGOVER,w),A=w=>d(lt.DRAGENTER,w),x=w=>d(lt.DRAGLEAVE,w);return n.$$set=w=>{"name"in w&&i(0,u=w.name),"rowIdx"in w&&i(1,c=w.rowIdx),"colIdx"in w&&i(2,h=w.colIdx),"index"in w&&i(11,p=w.index),"clone"in w&&i(3,m=w.clone),"uuid"in w&&i(4,v=w.uuid)},n.$$.update=()=>{n.$$.dirty&6&&i(5,t=$r([c,h]))},[u,c,h,m,v,t,a,d,_,y,b,p,E,N,S,A,x]}class Ec extends Ce{constructor(e){super(),De(this,e,wc,bc,Le,{name:0,rowIdx:1,colIdx:2,index:11,clone:3,uuid:4})}}function $o(n,e,i){const t=n.slice();return t[10]=e[i],t[12]=i,t}function ea(n,e,i){const t=n.slice();return t[13]=e[i],t[15]=i,t}function ta(n){let e,i;return e=new Ec({props:{name:n[13].split(":")[0],uuid:n[13].split(":")[1],rowIdx:n[12],colIdx:n[15],type:Us.UNIT,index:Pa(n[12],n[15])}}),e.$on("drop",Un),e.$on("dragover",Fn),{c(){we(e.$$.fragment)},l(t){Oe(e.$$.fragment,t)},m(t,r){Ee(e,t,r),i=!0},p(t,r){const o={};r&2&&(o.name=t[13].split(":")[0]),r&2&&(o.uuid=t[13].split(":")[1]),e.$set(o)},i(t){i||(ee(e.$$.fragment,t),i=!0)},o(t){oe(e.$$.fragment,t),i=!1},d(t){Ne(e,t)}}}function na(n){let e,i,t,r,o,a,l,s,f,u,c=n[10],h=[];for(let m=0;m<c.length;m+=1)h[m]=ta(ea(n,c,m));const p=m=>oe(h[m],1,1,()=>{h[m]=null});return{c(){e=H("span"),t=re(),r=H("section");for(let m=0;m<h.length;m+=1)h[m].c();o=re(),this.h()},l(m){e=q(m,"SPAN",{id:!0,"data-drag-type":!0,"data-drag-rowidx":!0,"data-drag-colidx":!0,class:!0}),X(e).forEach(M),t=ie(m),r=q(m,"SECTION",{id:!0,"data-drag-type":!0,"data-drag-rowidx":!0,"data-drag-colidx":!0,class:!0});var v=X(r);for(let d=0;d<h.length;d+=1)h[d].l(v);o=ie(v),v.forEach(M),this.h()},h(){R(e,"id",i=[n[0],n[12],"gutter"].join("_")),R(e,"data-drag-type",lt.INSERT),R(e,"data-drag-rowidx",n[12]),R(e,"data-drag-colidx",0),R(e,"class","w2em minw2em z-index99 minh100pc h100pc t0 l0"),R(r,"id",a=[n[0],n[12]].join("_")),R(r,"data-drag-type",lt.MOVE),R(r,"data-drag-rowidx",n[12]),R(r,"data-drag-colidx",l=n[10].length-1),R(r,"class","channel global")},m(m,v){te(m,e,v),te(m,t,v),te(m,r,v);for(let d=0;d<h.length;d+=1)h[d].m(r,null);P(r,o),s=!0,f||(u=[ce(e,"drop",Un),ce(e,"dragover",Fn),ce(r,"drop",Un),ce(r,"dragover",Fn)],f=!0)},p(m,v){if((!s||v&1&&i!==(i=[m[0],m[12],"gutter"].join("_")))&&R(e,"id",i),v&2){c=m[10];let d;for(d=0;d<c.length;d+=1){const _=ea(m,c,d);h[d]?(h[d].p(_,v),ee(h[d],1)):(h[d]=ta(_),h[d].c(),ee(h[d],1),h[d].m(r,o))}for(rt(),d=c.length;d<h.length;d+=1)p(d);it()}(!s||v&1&&a!==(a=[m[0],m[12]].join("_")))&&R(r,"id",a),(!s||v&2&&l!==(l=m[10].length-1))&&R(r,"data-drag-colidx",l)},i(m){if(!s){for(let v=0;v<c.length;v+=1)ee(h[v]);s=!0}},o(m){h=h.filter(Boolean);for(let v=0;v<h.length;v+=1)oe(h[v]);s=!1},d(m){m&&M(e),m&&M(t),m&&M(r),Xe(h,m),f=!1,mt(u)}}}function Nc(n){let e,i,t,r,o,a,l,s,f,u,c,h,p,m,v=n[1],d=[];for(let y=0;y<v.length;y+=1)d[y]=na($o(n,v,y));const _=y=>oe(d[y],1,1,()=>{d[y]=null});return{c(){e=H("div"),i=H("div");for(let y=0;y<d.length;y+=1)d[y].c();t=re(),r=H("span"),l=re(),s=H("span"),f=de("BIN"),this.h()},l(y){e=q(y,"DIV",{class:!0});var b=X(e);i=q(b,"DIV",{style:!0,class:!0});var E=X(i);for(let S=0;S<d.length;S+=1)d[S].l(E);t=ie(E),r=q(E,"SPAN",{id:!0,"data-drag-type":!0,"data-drag-rowidx":!0,"data-drag-colidx":!0,style:!0,class:!0}),X(r).forEach(M),E.forEach(M),l=ie(b),s=q(b,"SPAN",{id:!0,"data-drag-type":!0,"data-drag-rowidx":!0,"data-drag-colidx":!0,class:!0});var N=X(s);f=pe(N,"BIN"),N.forEach(M),b.forEach(M),this.h()},h(){var y,b,E,N;R(r,"id",o=[n[0],"tundra"].join("_")),R(r,"data-drag-type",lt.APPEND),R(r,"data-drag-rowidx",a=n[1].length),R(r,"data-drag-colidx",0),ke(r,"padding-right","50vw"),R(r,"class","flex grow h100pc minw16em"),ke(i,"overflow-x","auto"),R(i,"class","flex row-flex-start-stretch grow minw100pc"),R(s,"id","bin"),R(s,"data-drag-type",lt.BIN),R(s,"data-drag-rowidx",u=(b=(y=n[3])==null?void 0:y[0])==null?void 0:b[0]),R(s,"data-drag-colidx",c=(N=(E=n[3])==null?void 0:E[0])==null?void 0:N[1]),R(s,"class","flex row-center-center h4em abs t100pc l100pc border w8em fixed bg z-index99"),R(e,"class","flex row-flex-start-stretch ptb6 grow overflow-hidden rel w100pc")},m(y,b){te(y,e,b),P(e,i);for(let E=0;E<d.length;E+=1)d[E].m(i,null);P(i,t),P(i,r),P(e,l),P(e,s),P(s,f),n[4](e),h=!0,p||(m=[ce(r,"drop",Un),ce(r,"dragover",Fn),ce(s,"drop",Un),ce(s,"dragover",Fn)],p=!0)},p(y,[b]){var E,N,S,A;if(b&3){v=y[1];let x;for(x=0;x<v.length;x+=1){const w=$o(y,v,x);d[x]?(d[x].p(w,b),ee(d[x],1)):(d[x]=na(w),d[x].c(),ee(d[x],1),d[x].m(i,t))}for(rt(),x=v.length;x<d.length;x+=1)_(x);it()}(!h||b&1&&o!==(o=[y[0],"tundra"].join("_")))&&R(r,"id",o),(!h||b&2&&a!==(a=y[1].length))&&R(r,"data-drag-rowidx",a),(!h||b&8&&u!==(u=(N=(E=y[3])==null?void 0:E[0])==null?void 0:N[0]))&&R(s,"data-drag-rowidx",u),(!h||b&8&&c!==(c=(A=(S=y[3])==null?void 0:S[0])==null?void 0:A[1]))&&R(s,"data-drag-colidx",c)},i(y){if(!h){for(let b=0;b<v.length;b+=1)ee(d[b]);h=!0}},o(y){d=d.filter(Boolean);for(let b=0;b<d.length;b+=1)oe(d[b]);h=!1},d(y){y&&M(e),Xe(d,y),n[4](null),p=!1,mt(m)}}}function Sc(n,e,i){let t,r;he(n,_t,s=>i(1,t=s)),he(n,jt,s=>i(5,s)),he(n,ue,s=>i(6,s)),he(n,nt,s=>i(3,r=s));let{id:o="editor"}=e;const a=window;function l(s){Ke[s?"unshift":"push"](()=>{a[o]=s,i(2,a)})}return n.$$set=s=>{"id"in s&&i(0,o=s.id)},n.$$.update=()=>{n.$$.dirty&2&&Ra()},[o,t,a,r,l]}class xc extends Ce{constructor(e){super(),De(this,e,Sc,Nc,Le,{id:0})}}const{window:Ic}=cr;function Oc(n){let e,i;return e=new lc({props:{width:n[0],id:"main",key:"main",class:"abs t100pc r0",capture:!0}}),{c(){we(e.$$.fragment)},l(t){Oe(e.$$.fragment,t)},m(t,r){Ee(e,t,r),i=!0},p:Pe,i(t){i||(ee(e.$$.fragment,t),i=!0)},o(t){oe(e.$$.fragment,t),i=!1},d(t){Ne(e,t)}}}function Tc(n){let e,i,t,r,o,a,l,s,f,u,c;return e=new ha({props:{shortcuts:n[1]}}),o=new xc({props:{id:"editor"}}),s=new gc({props:{$$slots:{default:[Oc]},$$scope:{ctx:n}}}),{c(){we(e.$$.fragment),i=re(),t=H("div"),r=H("div"),we(o.$$.fragment),a=re(),l=H("div"),we(s.$$.fragment),this.h()},l(h){Oe(e.$$.fragment,h),i=ie(h),t=q(h,"DIV",{class:!0});var p=X(t);r=q(p,"DIV",{id:!0,class:!0});var m=X(r);Oe(o.$$.fragment,m),m.forEach(M),a=ie(p),l=q(p,"DIV",{class:!0});var v=X(l);Oe(s.$$.fragment,v),v.forEach(M),p.forEach(M),this.h()},h(){R(r,"id","editor"),R(r,"class","grow flex column overflow-hidden"),R(l,"class","flex column"),R(t,"class","flex row grow")},m(h,p){Ee(e,h,p),te(h,i,p),te(h,t,p),P(t,r),Ee(o,r,null),P(t,a),P(t,l),Ee(s,l,null),f=!0,u||(c=ce(Ic,"resize",Ac),u=!0)},p(h,[p]){const m={};p&32&&(m.$$scope={dirty:p,ctx:h}),s.$set(m)},i(h){f||(ee(e.$$.fragment,h),ee(o.$$.fragment,h),ee(s.$$.fragment,h),f=!0)},o(h){oe(e.$$.fragment,h),oe(o.$$.fragment,h),oe(s.$$.fragment,h),f=!1},d(h){Ne(e,h),h&&M(i),h&&M(t),Ne(o),Ne(s),u=!1,c()}}}function Ac(){}function Rc(n){const e=(o,a)=>console.log(`[MXF] ${o}`,a||"");let i=360;sn(t);async function t(){e("\u{1F44D} inited")}return[i,[]]}class Mc extends Ce{constructor(e){super(),De(this,e,Rc,Tc,Le,{})}}function Pc(n){let e,i;return e=new $u({props:{application:Mc}}),{c(){we(e.$$.fragment)},l(t){Oe(e.$$.fragment,t)},m(t,r){Ee(e,t,r),i=!0},p:Pe,i(t){i||(ee(e.$$.fragment,t),i=!0)},o(t){oe(e.$$.fragment,t),i=!1},d(t){Ne(e,t)}}}let Uc=!0;function kc(n,e,i){return[!1]}class Bc extends Ce{constructor(e){super(),De(this,e,kc,Pc,Le,{prerender:0})}get prerender(){return this.$$.ctx[0]}}export{Bc as default,Uc as prerender};
