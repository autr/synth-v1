import{S as Ce,i as De,s as Le,e as Ve,b as oe,R as ce,A as Pe,h as k,V as mt,G as he,k as q,q as de,a as re,l as z,m as W,r as pe,c as ie,n as D,F as P,u as Me,N as Xe,a4 as ye,p as ke,Q as Fe,g as rt,t as le,d as it,f as te,a5 as ge,a2 as cr,a3 as nn,_ as ra,O as $e,P as pt,v as Ne,w as Te,x as Se,T as vt,y as xe,X as Lt,H as ia,L as oa,U as aa,Y as sa,Z as ar,o as an,a6 as Cn,B as fs,C as cs,D as hs,E as ds,a7 as ps,a1 as ms}from"../../chunks/index-f5a154de.js";import{w as Ye}from"../../chunks/index-892500ad.js";import{_ as gs}from"../../chunks/preload-helper-aa6bc0ce.js";import{T as vs,e as Ot}from"../../chunks/Toggle-3ca16f02.js";let ys=!1;const Br=!0,_s=!1,bs=Object.freeze(Object.defineProperty({__proto__:null,browser:Br,dev:_s,prerendering:ys},Symbol.toStringTag,{value:"Module"}));var ws=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Es={macOS:[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],windows:[/microsoft\s(windows)\s(vista|xp)/i],linux:[/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i,/(cros)\s[\w]+\s([\w\.]+\w)/i,/(sunos)\s?([\w\.]+\d)*/i,/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i,/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i]},ci={name:"Control",abbreviation:"Ctrl",symbol:"^"},hi={name:"Alt",abbreviation:"Alt",symbol:""},di={name:"Windows Key",abbreviation:"Win",symbol:"\u229E"},Ns={macOS:{os:"Mac OS",primaryMeta:!0,meta:{name:"Command",abbreviation:"Cmd",symbol:"\u2318"},ctrl:{name:"Control",abbreviation:"Ctrl",symbol:"\u2303"},alt:{name:"Option (alt)",abbreviation:"Alt",symbol:"\u2325"}},windows:{os:"Windows",primaryMeta:!1,meta:di,ctrl:ci,alt:hi},linux:{os:"Linux",primaryMeta:!1,meta:di,ctrl:ci,alt:hi}};function Ss(n,e){for(var i in e)for(var t=e[i],r=0;r<t.length;r++)if(n.match(t[r]))return i}function xs(n){var e=Ss(n,Es);if(e)return Ns[e]}var Is=xs;const Os=window.navigator,Ts=Is(Os.userAgent),As="UniversalCommand",Rs="Shift",Ms="Escape",Bt=Ts.primaryMeta?"Meta":"Control",Dt=Ye({});function pi(n,e,i){const t=n.slice();return t[9]=e[i],t}function mi(n){let e,i,t,r=Object.keys(n[2]).join("+")+"",o,a,l,s,f,u,c=n[1],p=[];for(let d=0;d<c.length;d+=1)p[d]=gi(pi(n,c,d));return{c(){e=q("div"),i=de("Keys"),t=re(),o=de(r),a=re(),l=q("div"),s=de("Shortcuts"),f=re();for(let d=0;d<p.length;d+=1)p[d].c();u=Ve(),this.h()},l(d){e=z(d,"DIV",{class:!0});var g=W(e);i=pe(g,"Keys"),g.forEach(k),t=ie(d),o=pe(d,r),a=ie(d),l=z(d,"DIV",{class:!0});var y=W(l);s=pe(y,"Shortcuts"),y.forEach(k),f=ie(d);for(let h=0;h<p.length;h+=1)p[h].l(d);u=Ve(),this.h()},h(){D(e,"class","italic"),D(l,"class","italic")},m(d,g){oe(d,e,g),P(e,i),oe(d,t,g),oe(d,o,g),oe(d,a,g),oe(d,l,g),P(l,s),oe(d,f,g);for(let y=0;y<p.length;y+=1)p[y].m(d,g);oe(d,u,g)},p(d,g){if(g&4&&r!==(r=Object.keys(d[2]).join("+")+"")&&Me(o,r),g&2){c=d[1];let y;for(y=0;y<c.length;y+=1){const h=pi(d,c,y);p[y]?p[y].p(h,g):(p[y]=gi(h),p[y].c(),p[y].m(u.parentNode,u))}for(;y<p.length;y+=1)p[y].d(1);p.length=c.length}},d(d){d&&k(e),d&&k(t),d&&k(o),d&&k(a),d&&k(l),d&&k(f),Xe(p,d),d&&k(u)}}}function gi(n){let e,i=n[9].command.join("+")+"",t;return{c(){e=q("div"),t=de(i)},l(r){e=z(r,"DIV",{});var o=W(e);t=pe(o,i),o.forEach(k)},m(r,o){oe(r,e,o),P(e,t)},p(r,o){o&2&&i!==(i=r[9].command.join("+")+"")&&Me(t,i)},d(r){r&&k(e)}}}function Ps(n){let e,i,t,r=n[0]&&mi(n);return{c(){r&&r.c(),e=Ve()},l(o){r&&r.l(o),e=Ve()},m(o,a){r&&r.m(o,a),oe(o,e,a),i||(t=[ce(window,"keydown",n[3]),ce(window,"keyup",n[4])],i=!0)},p(o,[a]){o[0]?r?r.p(o,a):(r=mi(o),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null)},i:Pe,o:Pe,d(o){r&&r.d(o),o&&k(e),i=!1,mt(t)}}}function ks(n,e,i){let t;he(n,Dt,p=>i(2,t=p));let{debug:r=!1}=e,o,{shortcuts:a=[]}=e,l=[],s={};function f(p){let d=ye(Dt);Dt.update(y=>(y[p.key]=!0,y)),d[Bt]&&(o={...d});let g=0;for(const y of l||[]){let h=!0;for(let _ of y.command)_==As&&(_=Bt),d[_]||(h=!1);h&&(y==null?void 0:y.action)&&(!s[g]&&y.command.find(_=>_==p.key)&&y.action(p),y.command.find(_=>_==Bt)),g+=1}}function u(p){if(Dt.update(d=>(delete d[p.key],d)),p.key==Bt&&o){for(const d of Object.keys(o))Dt.update(g=>(delete g[d],g));s={},o=null}Dt.set({...ye(Dt)})}function c(p){!Array.isArray(p)&&typeof p=="object"?Object.keys(p).forEach(d=>{l.push({command:d.split("+"),action:p[d]})}):l=[...l,...p],l=l.map(d=>(d.command=d.command.map(g=>g+""),d))}return n.$$set=p=>{"debug"in p&&i(0,r=p.debug),"shortcuts"in p&&i(1,a=p.shortcuts)},[r,a,t,f,u,c]}class la extends Ce{constructor(e){super(),De(this,e,ks,Ps,Le,{debug:0,shortcuts:1,addBindings:5})}get addBindings(){return this.$$.ctx[5]}}const sr=n=>{const e=(i,t)=>({prepend:"vec3",type:"function",name:i,body:t,arguments:[{type:"vec3",name:"a"},{type:"vec3",name:"b"}]});return[e("NORM","return b;"),e("ADD","return min(a + b, vec3(1.0));"),e("DARKEN","return COLOR_MAP(DARKEN, a, b);"),e("SCREEN","return COLOR_MAP(SCREEN, a, b);"),e("OVERLAY","return COLOR_MAP(OVERLAY, a, b);"),e("HARD","return OVERLAY(b, a);"),e("SOFT","return COLOR_MAP(SOFT, a, b);"),e("PIN","return COLOR_MAP(PIN, a, b);"),e("DIFFERENCE","return abs(a - b);"),e("REFLECT","return COLOR_MAP(REFLECT, a, b);"),e("LIGHTEN","return COLOR_MAP(LIGHTEN, a, b);"),e("VIVID","return COLOR_MAP(VIVID, a, b);"),e("SUBTRACT","return max(a + b - vec3(1.0), vec3(0.0));"),e("MULTI","return a * b;"),e("AVERAGE","return (a + b) / 2.0;"),e("COLORBURN","return COLOR_MAP(COLORBURN, a, b);"),e("COLORDODGE","return COLOR_MAP(COLORDODGE, a, b);"),e("EXCLUSION","return a + b - 2.0 * a * b;"),e("GLOW","return REFLECT(b, a);"),e("HARD_MIX","return COLOR_MAP(HARD_MIX, a, b);"),e("BURN","return max(a + b - vec3(1.0), vec3(0.0));"),e("DODGE","return min(a + b, vec3(1.0));"),e("LINEAR","return COLOR_MAP(LINEAR, a, b);"),e("NEGATE","return vec3(1.0) - abs(vec3(1.0) - a - b);"),e("PHOENIX","return min(a, b) - max(a, b) + vec3(1.0);")]},Cs=sr().map(n=>n.name),qt={APPLICATION:"application",ASSIGNMENTS:"assignments",DEBUG_SHADER:"debug_shader",DEBUG_SYSTEM:"debug_system",MIXER:"mixer"},Ds={float:"float",image:"sampler2D",bool:"bool",event:"bool",long:"int",color:"vec4",point2D:"vec2"},Ls={OpSelect:"vec4"},Rn={START:`
/*--BEGIN_PROJECT--`,END:`--END_PROJECT--*/
`},Zt={BL_MODE:"BlendMode",BL_AMT:"BlendAmt"},ct={DEF:"define",VAR:"variable",FUNC:"function",COMMENT:"comment"},Tt={PAUSE:"pause",COMPILE:"compile",DONE:"done"},ht={IMAGE:"image",VIDEO:"video",CAMERA:"camera",FEEDBACK:"feedback"};let Fs=n=>new Promise((e,i)=>{let t=[{type:ht.IMAGE,path:"mxz/testcards/transparent.png"},{type:ht.IMAGE,path:"mxz/testcards/bw.jpg"},{type:ht.IMAGE,path:"mxz/testcards/testcard.png"},{type:ht.IMAGE,path:"mxz/testcards/grid.png"},{type:ht.FEEDBACK}];gs(()=>Promise.resolve().then(()=>bs),void 0,import.meta.url).then(r=>{const{browser:o}=r;o?navigator.mediaDevices.enumerateDevices().then(function(a){a.forEach(l=>{l.kind=="videoinput"&&t.push({type:ht.CAMERA,path:l.label})}),e(t)}):e(t)}).catch(r=>{e(t)})});const Us={SOURCE:"source",UNIT:"unit"},lt={APPEND:"append",INSERT:"insert",MOVE:"move",BIN:"bin"},Dn=Ye(null),ua=Ye({}),fa=Ye([]),_t=Ye([]),ue=Ye({}),tn=Ye("application"),Vt=Ye({width:720,height:576}),bt=Ye({}),ca={rotate:[0,0,0],skew:[0,0],scale:[1,1],translate:[0,0]},lr=Ye(ca),Gt=Ye({}),kr=Ye({}),yt=Ye("compile"),nt=Ye(null),At=Ye(!1),jt=Ye(null),Kt=Ye(!1),Qt=Ye(!1),$t=Ye(null),Mn=Ye(!1),br=(n,e)=>console.log(`[Store] ${n}`,e||"");function vi(n){try{const e=JSON.parse(n);br("\u{1F4BE} loading stores from text",e==null?void 0:e._UNIFORMS),Dn.set((e==null?void 0:e._PREVIEW)||null),ua.set((e==null?void 0:e._TITLES)||{}),lr.set((e==null?void 0:e._PROJECTION)||ca),fa.set((e==null?void 0:e._SOURCES)||[]),_t.set((e==null?void 0:e._SEQUENCE)||[]),ue.set((e==null?void 0:e._UNIFORMS)||{}),tn.set((e==null?void 0:e._CURRENT_VIEW)||"application"),Vt.set((e==null?void 0:e._DIMENSIONS)||{width:720,height:576}),bt.set((e==null?void 0:e._ASSIGNMENTS)||{}),Gt.set((e==null?void 0:e._HIDDEN)||{}),Br&&window.requestAnimationFrame(i=>{br("\u{1F3A8} setting uniforms and recompiling",(e==null?void 0:e._UNIFORMS)||"\u274C NO UNIFORMS"),ue.set((e==null?void 0:e._UNIFORMS)||{}),yt.set("compile")})}catch(e){br("\u274C could not load stores",e.message)}}function jr(n){return JSON.stringify({_PREVIEW:ye(Dn),_PROJECTION:ye(lr),_TITLES:ye(ua),_SOURCES:ye(fa),_SEQUENCE:ye(_t),_UNIFORMS:ye(ue),_CURRENT_VIEW:ye(tn),_DIMENSIONS:ye(Vt),_ASSIGNMENTS:ye(bt),_HIDDEN:ye(Gt)},null,n)}var ha=`const int hardMax = 99999;
float cap = 0.;
float battery = 0.;
bool discharging = false;
vec3 outpix = vec3(0.);
vec2 pos = gl_FragCoord.xy;

float xx = direction == 1 ? pos.x :  center.x * RENDERSIZE.x;
float yy = direction == 0 ? pos.y :  center.y * RENDERSIZE.y;

vec2 centerPix = vec2(xx,yy);
int dist = int( distance(centerPix, pos) );
float angle = ANGLE(centerPix, pos) + 180.;
float res = resistance;
if (type ==0) res *= 2.;

for (int i = 0; i < hardMax; i++) {

	
	

	vec2 lookup = vec2(xx,yy);
	vec3 rgb = IMG_PIXEL( TEXTURE, lookup ).rgb;
	float pix = length(rgb)/3.;
	pix = (rgb.r + rgb.g + rgb.b)/3.;
	pix = pow(pix, power);
	
	if (type == 0) { 
	
		cap += pix;
		if (cap > res) cap -= res;

		
	} else if (type == 1) { 
	
		if (battery < res && !discharging) battery += pix;
		if (battery > res) discharging = true;
		if (battery < 0.) discharging = false;
		
		if (discharging) {
			cap = battery;
			battery -= ((discharge.x * 20.)+0.05) + (discharge.y / 5.);
		} else {
			cap = 0.;
		}
	} else if (type == 2) { 
		cap += pix;
		cap -= discharge.x;
	}
	
	/* LOOP */
	
	int idx = direction == 3 ? dist - i : i;
	vec2 outward = VEC2_FROM_ANGLE(centerPix, angle, float(idx));
	
	xx = direction == 1 ? gl_FragCoord.x : outward.x;
	yy = direction == 0 ? gl_FragCoord.y : outward.y;
	
	if (i >= dist) break;
	
}

cap /= res;

return vec4( HSL_TO_RGB(vec3(hue,saturation,cap*lightness)), INPUT.a);`,da="return INPUT;",pa=`vec2 pos = POS_NORM;
float amt = Amt;
float Amount = Amt;

if (TYPE == 0) { 

	/*
		LumaSharpen 1.4.1

		original hlsl by Christian Cann Schuldt Jensen ~ CeeJay.dk
		port to glsl by Anon

		It blurs the original pixel with the surrounding pixels and then subtracts this blur to sharpen the image.
		It does this in luma to avoid color artifacts and allows limiting the maximum sharpning to avoid or lessen halo artifacts.

		This is similar to using Unsharp Mask in Photoshop.
	*/

	float sharp_strength = Amount;
	float sharp_clamp = sharp_strength;
	float offset_bias = Radius * 10.0;
	
	#define COEFLUMA vec3(0.299, 0.587, 0.114)       
	

	vec4 colorInput = IMG_NORM_PIXEL(TEXTURE, POS_NORM);
	
	vec3 ori = colorInput.rgb;
	vec3 sharp_strength_luma = (COEFLUMA * sharp_strength);
	
	
	

	float px = 1.0/RENDERSIZE.x;
	float py = 1.0/RENDERSIZE.y;
	vec2 xy = gl_FragCoord.xy;

	

	vec3 blur_ori = IMG_NORM_PIXEL(TEXTURE, POS_NORM.xy + vec2(px,-py) * 0.5 * offset_bias).rgb; 
	blur_ori += IMG_NORM_PIXEL(TEXTURE, POS_NORM.xy + vec2(-px,-py) * 0.5 * offset_bias).rgb;  
	blur_ori += IMG_NORM_PIXEL(TEXTURE, POS_NORM.xy + vec2(px,py) * 0.5 * offset_bias).rgb; 
	blur_ori += IMG_NORM_PIXEL(TEXTURE, POS_NORM.xy + vec2(-px,py) * 0.5 * offset_bias).rgb; 
	blur_ori *= 0.25;
	vec3 sharp = ori - blur_ori;
	vec4 sharp_strength_luma_clamp = vec4(sharp_strength_luma * (0.5 / sharp_clamp),0.5);
	float sharp_luma = clamp((dot(vec4(sharp,1.0), sharp_strength_luma_clamp)), 0.0,1.0 );
	sharp_luma = (sharp_clamp * 2.0) * sharp_luma - sharp_clamp;
	colorInput.rgb = colorInput.rgb + sharp_luma;

	return clamp(colorInput, 0.0,1.0);

	

	for (int i = 0; i < 4; i++) {

		float blur_ori = IMG_NORM_PIXEL(TEXTURE, POS_NORM.xy + vec2(px,-py) * 0.5 * offset_bias)[i]; 
		blur_ori += IMG_NORM_PIXEL(TEXTURE, POS_NORM.xy + vec2(-px,-py) * 0.5 * offset_bias)[i];  
		blur_ori += IMG_NORM_PIXEL(TEXTURE, POS_NORM.xy + vec2(px,py) * 0.5 * offset_bias)[i]; 
		blur_ori += IMG_NORM_PIXEL(TEXTURE, POS_NORM.xy + vec2(-px,py) * 0.5 * offset_bias)[i]; 

		blur_ori *= 0.25;  

		
		float sharp = ori[i] - blur_ori;  

		
		float sharp_strength_luma_clamp = sharp_strength_luma[i] * (0.5 / sharp_clamp); 

		float sharp_luma = clamp((sharp + sharp_strength_luma_clamp), 0.0,1.0 ); 
		sharp_luma = (sharp_clamp * 2.0) * sharp_luma - sharp_clamp; 

		

		colorInput[i] = colorInput[i] + sharp_luma;    
	}

	return clamp(colorInput, 0.0,1.0);
	
} else if (TYPE == 1) {

	

	vec3 res = vec3(RENDERSIZE, 1.);
	float time = TIME;

	const vec2 blurdir = vec2( 1.0, 0.0 );

	float blurdist_px = float(RENDERSIZE.x*Radius);
	vec2 POS = POS_FRAG;
	vec2 suv = POS / res.xy; 
	vec2 uv = POS / res.xy;

	float blur = 10. * amt * blurdist_px;
	blur *= .1; 

	float da = 6.283;
	float a = 1.0;

    if (Jitter) { 
    	a = da * HASH12N(uv+(time)); 
	} else { 
		a = da * HASH12N(uv); 
	}

	vec3 sumcol = vec3(0.0);

	for (int i=0;i<10;++i) {
		vec2 ofs = vec2( cos(a), sin(a) ) / res.xy * blur*float(i+1)*.31;
		vec2 p = uv+(ofs/10.);
		vec3 pix = IMG_NORM_PIXEL(TEXTURE, p).rgb;
		sumcol = sumcol+SRGB2LIN(pix);
		a += da;
	}

	sumcol = sumcol / 10.;
	sumcol = max( sumcol, 0.0 );

	return vec4( LIN2SRGB( sumcol ), INPUT.a);
} else {

	
	return IMG_NORM_PIXEL(TEXTURE, pos );

}`,ma=`vec2 pos = POS_NORM;
vec2 center = vec2( 0.5, 0.5 );
float off = Offset;
float all = mix(SUM_RGBA(Src)/3.0,1.0,1.0-SrcAmount);
if (Invert) all = 1.0 - all;
float bb = (all*2.0)-1.0;
bb += off;

float mini = Mini ? 0.02 : 1.;

vec2 xy = XY * vec2(mini,mini);
vec2 zoom = Zoom * vec2(mini,mini);

float angle = ANGLE(center, pos);

pos.x += xy.x * bb;
pos.y += xy.y * bb;
pos.x += (((pos.x * 2.0) - 1.0) * zoom.x) * bb;
pos.y += ((pos.y * 2.0) - 1.0) * (zoom.y * bb);
if (Rotate) pos = ROTATE_VEC2(Origin, pos, 	Degree * bb * 180. * mini);

return IMG_NORM_PIXEL(TEXTURE,pos);`,ga=`float MINI = Mini ? 0.2 : 1.; 

vec3 hsl = RGB_TO_HSL( INPUT.rgb );

if (ColorMode == 3) {

	

	float maxDelta = sqrt(hsl.y) - hsl.y;
	hsl.y += (maxDelta * Vibrance);

} else if (ColorMode == 1) {

	

	vec3 tint = vec3(TintHue / 360.0,1.0,0.5);
	hsl = RGB_TO_HSL(mix(HSL_TO_RGB(hsl),HSL_TO_RGB(tint),TintAmount * hsl.z * MINI));

} else if (ColorMode == 2) {

	

	
	
	
	
	
	

	
	

	
	
	

	float space = 1./Levels;
	float snapped = hsl.z - FMOD(hsl.z,space); 
	float blend = FMOD(hsl.z,space)*Levels; 
	if (blend > 0.5) blend -= blend - 0.5;
	blend *= 2.;

	float h1 = snapped * Spacing;
	float h2 = (snapped + space) * Spacing;
	vec3 rgb1 = HSL_TO_RGB(vec3(h1, 1.0, 0.5));
	vec3 rgb2 = HSL_TO_RGB(vec3(h2, 1.0, 0.5));

	hsl = RGB_TO_HSL(mix(rgb1,rgb2,blend*Smooth));

}

/*------------ SATURATION ------------*/

hsl.y += Saturation * MINI;
hsl.y = clamp( hsl.y, 0.0, 1.0 );
hsl.x = FMOD( hsl.x + (Shift * MINI), 1.0);

/*------------ LIGHT / RGB ------------*/

vec3 rgb = HSL_TO_RGB(hsl);
vec3 final;

if (LightMode == 0) {

	

	vec3 hsl = RGB_TO_HSL(rgb);
	hsl.z += Light * MINI;
	final = HSL_TO_RGB(hsl);

} else if (LightMode == 1) {

	

	final = rgb * pow(2.0, Light * MINI);

} else if (LightMode == 2) {

	

	vec3 hsv = RGB_TO_HSV(rgb);
	hsv.z += Light * MINI;
	final = HSV_TO_RGB(hsv);

}

/*------------ INVERT ------------*/

if (Invert) final = RGB_SHIFT( vec3(1.0,1.0,1.0) - final, 0.5);

/*------------ LOW / HIGH ------------*/

float low = Low * (MINI/2.);
float high = 1.0 - (High * (MINI/2.));

/*------------ NOISE ------------*/

return vec4( LEVELS(final.rgb, Low, 1.0, High).rgb, INPUT.a );`,va=`vec3 mask = INPUT.rgb;
vec3 foreground = INPUT.rgb;

if (Mode == 1) {
	mask = Mask.rgb;
	foreground = Foreground.rgb;
}

float amt;
float sat = RGB_TO_HSL(mask).y;

if (LightMode == 0) {
	
	amt = RGB_TO_HSL(mask).z;
} else if (LightMode == 1) {
	
	amt = RGB_TO_HSV(mask).z;
} else {
	
	amt = mask.r + mask.g + mask.b;
}

if (Invert) amt = 1.0 - amt;

float ll = MAP(Threshold.x,0.0,1.0,-0.1,1.1);
float hh = MAP(Threshold.y,0.0,1.0,-0.1,1.1);

float low = MAP(amt,ll, ll+Smooth.x,1.0,0.0, true);
float high = MAP(amt,hh-Smooth.y,hh,0.0,1.0, false);
float blend = CLAMP(max(low,high),-1.0,1.0);
blend = MAP(blend,0.0,1.0,-1.0,1.0);

blend *= 1.0 + (sat * SatInfluence * 1.);
blend = (blend+1.0)/2.0;

return vec4( mix(foreground,Background.rgb,blend), 1.0);`,ya=`if (Mode == 0) {
	return INPUT;
} else if (Mode == 1) {
	return IMG_NORM_PIXEL( u999, POS_NORM ).rgb;
} else if (Mode == 2) {
	return Src;
}`,_a=`bool SnapShape = true; 
float Skew = 0.5; 

vec2 pos = POS_FRAG;
float ratio = RENDERSIZE.y / RENDERSIZE.x;

vec2 center = Center * RENDERSIZE;
vec2 trueCenter = vec2( 0.5, 0.5 ) * RENDERSIZE;

vec3 rgb = INPUT.rgb;
bool inv = false;

pos = ROTATE_VEC2( center, pos, Rotate * 360.0 );

if (Fit) pos.x = (pos.x * ratio) + (( RENDERSIZE.x - RENDERSIZE.y) / 2.0);

float shape = float(Shape);
float pointsTotal = shape + 1.0;
float segmentAng = 360.0 / pointsTotal;
float miniAngle = segmentAng * mod( pointsTotal, 1. );

float flip = 90.;
int p = int( floor( pointsTotal ) );
if (p == 2) {
    flip +=  miniAngle / 2. ;
    flip += 180.;
} else if (p == 3) {
    flip +=  miniAngle / 2. ;
} else if (p == 4) {
    flip -= (segmentAng / 2.0);
    flip - (miniAngle / 2.);
    inv = !inv;
} else if (p == 5) {
    flip += 180.;
    flip +=  miniAngle / 2. ;
    inv = !inv;
} else if (p == 6) {
    flip -= (segmentAng / 2.0);
    flip +=  miniAngle / 2. ;
    inv = !inv;
} else if (p == 7) {
    flip +=  miniAngle / 2. ;
    inv = !inv;
} else if (p == 8) {
    flip -= (segmentAng / 2.0);
    flip +=  miniAngle / 2. ;
} else if (p == 9) {
    flip +=  miniAngle / 2. ;
} else if (p == 10) {
    flip -= (segmentAng / 2.0);
    flip +=  miniAngle / 2. ;
    inv = !inv;
} else if (p == 11) {
    inv = !inv;
}

pos = ROTATE_VEC2( center, pos, flip );

float posAngle = ANGLE( center, pos );
float centerDist = distance(center, pos);
bool isMini = posAngle > 360.0 - miniAngle && posAngle < 360.;

float prevAngle = posAngle -mod( posAngle, segmentAng );
float midpointAngle;

if (!isMini) {

    

    midpointAngle = prevAngle + (segmentAng / 2.0);

} else {

    midpointAngle = -( (miniAngle) / 2.0 );

}

vec2 rotatedLoc = ROTATE_VEC2( center, pos, midpointAngle );
vec2 rotatePrev = ROTATE_VEC2( center, pos, midpointAngle);

float ogDist2Center = distance( rotatedLoc.x, center.x );
float dist2Center = ogDist2Center;
float DIST = RENDERSIZE.x * Size;
float HDIST = DIST / 2.0;

    

float alter = (ShapeMode == 1) ? Alternate : 0.0;
bool ODD = mod( posAngle, segmentAng * (1.0 + alter) ) > segmentAng;
if (ODD) dist2Center += DIST / 2.0;

dist2Center -= TIME * Scroll * DIST;
centerDist -= TIME * Scroll * DIST;

float skew = MAP( Skew, 0.0, 1.0, -1.0, 1.0);
float pointy = abs( center.y - rotatePrev.y  ) * skew * 10.;

float idxDist = mix( dist2Center, centerDist, Circular) + pointy;
float idxMod = mod( idxDist, DIST );
int idx = int( (idxDist - idxMod) / DIST );

vec3 red = vec3(0.0);

float wipe = Recursion * DIST;
float smo = (DIST * Smooth);
bool isRecur = ShapeMode == 1;
if (!isRecur) idxMod = idxDist;
red.r = MAP(idxMod, wipe, wipe + smo, 1.0, 0.0);
red.r = clamp(red.r, 0.0, 1.0);

if (Invert) red.r = 1.0 - red.r;

vec3 black = vec3(0.0,0.0,0.0);
vec3 white = vec3(1.0,1.0,1.0);

if ( Mode == 0 ) {

    return vec4( HSL_TO_RGB( Color[0], Color[1], Color[2] * red.r ), 1.0);

} else if (Mode == 1) {
    vec3 invt = RGB_SHIFT(vec3(1.0,1.0,1.0)-rgb,0.5);
    vec3 mixed = (invt * red.r) + (rgb * (1.0-red.r));
    return vec4( mixed, 1.0);
} else if (Mode == 2) {
    return vec4( mix(Mask.rgb,rgb,red.r), 1.0);
} else {
    return vec4( mix(Mask.rgb,rgb,red.r), 1.0);
}`,ba="return INPUT;",wa=`vec3 src = INPUT.rgb;
vec2 frag = POS_FRAG;
vec2 norm = POS_NORM;
vec2 center = CENTER();
float ratio = RENDERSIZE.y / RENDERSIZE.x;

float mask = SUM_RGB( Mode != 1 ? vec3(.5) : Src.rgb ) / 3.0;
mask = pow(mask, SmoothExp);
if (Invert) mask = 1.0 - mask;

float width = RENDERSIZE.x;
float height = RENDERSIZE.y;
float total = width*height;

/* define sizes */

float pixel = (frag.y * RENDERSIZE.x) + frag.x;
float scanline = MAP(pixel,0.,total, 0.,1.);

/* set frequencies */

float count = 30.; 
float freq = float(int((Freq * count) + 1.));

/* SYNC */

freq += Sync * 0.1;
freq += mask * ExtSync * 0.1;

/* MISC */

float space = Lock == 0 ? width/freq : total/freq;

/* do scrolls here */

frag.y -= RENDERSIZE.y / 2.0;

/* OFFSET */

pixel += Offset * TIME * ( Lock == 0 ? width : width * height );
pixel += mask * ExtOffset * ( Lock == 0 ? width : width * height );

float wave = clamp( MAP( FMOD(pixel,space),0.0, space * Ramp, 0.0, PI), 0.0, PI);
float r = WAVE( wave, 1., Amp, Exp );
if (Mask) r *= mask;

return vec4( HSL_TO_RGB( Color[0], Color[1], Color[2] * r ), 1.0);`,Ea=`vec2 pos = POS_NORM;
vec2 xy = POS_FRAG;
float idx = ( xy.y * RENDERSIZE.x ) + ( xy.x );

if (Mode == 1) {
	idx = distance(pos,Origin) * (RENDERSIZE.x * RENDERSIZE.y);
}

float freq = (Frequency.x * 0.01) + (Frequency.y * 0.0001);
float wobble = sin((TIME * Speed) + (idx * freq));

pos = VEC2_FROM_ANGLE( pos, Angle, wobble * Amount * 0.5 );

pos.x = FMOD(pos.x, 1.);
pos.y = FMOD(pos.y, 1.);

return IMG_NORM_PIXEL(TEXTURE,pos);`;const Bs=!0,js={type:{type:"long",default:2,values:[0,1,2],labels:["DIGITAL","ANALOG","ADDITIVE"]},direction:{type:"long",default:0,values:[0,1,2,3],labels:["X","Y","XY","XYREV"]},resistance:{type:"float",default:10,min:1,max:100},power:{type:"float",default:1,min:1,max:4},discharge:{type:"point2D",default:[.2,0],min:[0,-1],max:[1,1]},center:{type:"point2D",default:[0,0],min:[0,0],max:[1,1]},blend:{type:"float",default:.2,min:0,max:1},hue:{type:"float",default:0,min:0,max:1},saturation:{type:"float",default:0,min:0,max:1},lightness:{type:"float",default:1,min:0,max:2}},Vr={PASS:Bs,INPUTS:js},Vs=!0,Gs={},Gr={CHANNEL:Vs,INPUTS:Gs},Hs=!0,qs={TYPE:{type:"long",default:0,gui:"MultiClick",labels:["SHARPEN","DITHER"]},Amt:{type:"float",min:0,max:1,default:0},Threshold:{type:"float",min:0,max:1,default:.2},Radius:{type:"float",min:0,max:1,default:.2},Jitter:{type:"bool",default:!1}},Hr={PASS:Hs,INPUTS:qs},zs=!0,Xs={Mini:{type:"bool",default:!0},Src:{type:"long",min:-1,default:-1,gui:"OpSelect"},SrcAmount:{type:"float",min:0,max:1,default:0},Invert:{type:"bool",default:!1},Offset:{type:"float",default:0,min:-1,max:1},XY:{type:"point2D",default:[0,0],min:[-1,-1],max:[1,1]},Zoom:{type:"point2D",default:[0,0],min:[-1,-1],max:[1,1]},Rotate:{type:"bool",default:!1},Degree:{type:"float",default:0,min:-1,max:1},Origin:{type:"point2D",default:[.5,.5],min:[0,0],max:[1,1]}},qr={PASS:zs,INPUTS:Xs},Ws={Mini:{type:"bool",default:!1},Invert:{type:"bool",default:!1},LightMode:{type:"long",default:0,labels:["Lightness","Exposure","Brightness"],gui:"MultiClick"},Low:{type:"float",default:0,min:0,max:1},Light:{type:"float",default:0,min:-1,max:1},High:{type:"float",default:1,min:0,max:1},Saturation:{type:"float",default:0,min:-1,max:1},Shift:{type:"float",default:0,min:-.5,max:.5,position:-1,smooth:0,degrees:359},ColorMode:{type:"long",default:0,labels:["Basic","Tint","Colorise","Tweak"],gui:"MultiClick"},TintAmount:{type:"float",default:0,min:0,max:1,link:"ColorMode:1"},TintHue:{type:"float",default:0,min:-180,max:180,degrees:359,link:"ColorMode:1"},Levels:{type:"float",default:0,min:0,max:10,link:"ColorMode:2"},Spacing:{type:"float",default:.5,min:0,max:1,link:"ColorMode:2"},Smooth:{type:"float",default:0,min:0,max:1,link:"ColorMode:2"},Flip:{type:"bool",default:!1},Vibrance:{type:"float",default:0,min:0,max:1,link:"ColorMode:3"}},zr={INPUTS:Ws},Ys={Mode:{type:"long",default:0,labels:["Basic","Advanced"],gui:"MultiClick"},Background:{type:"long",min:-1,default:-1,gui:"OpSelect"},Foreground:{type:"long",min:-1,default:-1,gui:"OpSelect",link:"Mode:1"},Mask:{type:"long",min:-1,default:-1,gui:"OpSelect",link:"Mode:1"},LightMode:{type:"long",default:0,labels:["Lightness","Brightness","RGB"],gui:"MultiClick",link:"Mode:1"},Invert:{type:"bool",default:!1},Threshold:{type:"point2D",default:[0,1],min:[0,0],max:[1,1]},Smooth:{type:"point2D",default:[0,0],min:[0,0],max:[1,1]},SatInfluence:{type:"float",default:0,min:-1,max:1}},Xr={INPUTS:Ys},Js={Mode:{type:"long",default:0,labels:["Anchor","Output","Teleport"],gui:"MultiClick"},Src:{gui:"OpSelect",link:"Mode:2"}},Wr={INPUTS:Js},Ks={Mode:{type:"long",default:0,labels:["MATTE","INVERT","MASK","ALPHA"],gui:"MultiClick"},ShapeMode:{type:"long",default:0,labels:["SHAPE","RECURSIVE"],gui:"MultiClick"},Mask:{type:"long",default:-1,gui:"OpSelect",link:"Mode:2"},Shape:{type:"long",default:3,labels:["Horizontal","Vertical","Triangle","Square","Pentagon","Hexagon","Heptagon","Octagon"]},Circular:{type:"float",default:0,min:0,max:1},Smooth:{type:"float",default:0,min:0,max:1},Size:{type:"float",default:.5,min:0,max:1.5},Center:{type:"point2D",default:[.5,.5],min:[0,0],max:[1,1]},Rotate:{type:"float",default:.5,min:0,max:1},Invert:{type:"bool",default:!1},Fit:{type:"bool",default:!1},Recursion:{type:"float",default:.5,min:0,max:1,link:"ShapeMode:1"},Scroll:{type:"float",default:0,min:-1,max:1,link:"ShapeMode:1"},Alternate:{type:"float",default:0,min:0,max:1,link:"ShapeMode:1"},Color:{type:"color",min:[0,0,0],max:[1,1,1],default:[1,1,1]},Alpha:{type:"bool",default:!1}},Yr={INPUTS:Ks},Zs={Src:{type:"image",gui:"ExtSource",default:{type:"image",path:"mxz/testcards/transparent.png"}},Rows:{type:"long",default:1},Columns:{type:"long",default:1},Index:{type:"long",default:0}},Jr={INPUTS:Zs},Qs={Mode:{type:"long",min:0,default:0,gui:"MultiClick",labels:["BASIC","DEFORM"]},Lock:{type:"long",default:0,labels:["Horizontal","Vertical"],gui:"MultiClick"},Ramp:{type:"float",default:1,min:0,max:2},Amp:{type:"float",default:0,min:0,max:2},Exp:{type:"float",default:1,min:1,max:8},Freq:{type:"float",min:0,max:1,default:.45},Sync:{type:"float",min:-1,max:1,default:0},Offset:{type:"float",min:-1,max:1,default:0},Src:{type:"long",min:-1,default:-1,gui:"OpSelect",link:"Mode:1"},SmoothExp:{type:"float",min:0,max:2,default:1,link:"Mode:1"},Mask:{type:"bool",default:!1,link:"Mode:1"},Invert:{type:"bool",default:!1,link:"Mode:1"},ExtSync:{type:"float",min:-1,max:1,default:0,link:"Mode:1"},ExtOffset:{type:"float",min:-1,max:1,default:0,link:"Mode:1"},Color:{type:"color",min:[0,0,0],max:[1,1,1],default:[1,1,1]}},Kr={INPUTS:Qs},$s=!0,el={Frequency:{type:"point2D",default:[0,0],min:[-1,-1],max:[1,1]},Speed:{type:"float",default:0,min:-10,max:10},Angle:{type:"float",default:0,min:0,max:360},Amount:{type:"float",default:.5,min:0,max:1},Mode:{type:"long",default:0,labels:["Scanline","Origin"],gui:"MultiClick"},Origin:{type:"point2D",default:[0,0],min:[0,0],max:[1,1],link:"Mode:1"}},Zr={PASS:$s,INPUTS:el},{window:tl}=cr;function yi(n,e,i){const t=n.slice();return t[37]=e[i],t[39]=i,t}function nl(n){let e;return{c(){e=de("NONE")},l(i){e=pe(i,"NONE")},m(i,t){oe(i,e,t)},p:Pe,i:Pe,o:Pe,d(i){i&&k(e)}}}function rl(n){let e,i,t;function r(a){n[32](a)}let o={};return n[4][n[1]]!==void 0&&(o.value=n[4][n[1]]),e=new vs({props:o}),$e.push(()=>pt(e,"value",r)),e.$on("contextmenu",n[8]),{c(){Ne(e.$$.fragment)},l(a){Te(e.$$.fragment,a)},m(a,l){Se(e,a,l),t=!0},p(a,l){const s={};!i&&l[0]&18&&(i=!0,s.value=a[4][a[1]],vt(()=>i=!1)),e.$set(s)},i(a){t||(te(e.$$.fragment,a),t=!0)},o(a){le(e.$$.fragment,a),t=!1},d(a){xe(e,a)}}}function il(n){let e,i,t=n[4][n[1]]&&_i(n);return{c(){t&&t.c(),e=Ve()},l(r){t&&t.l(r),e=Ve()},m(r,o){t&&t.m(r,o),oe(r,e,o),i=!0},p(r,o){r[4][r[1]]?t?(t.p(r,o),o[0]&18&&te(t,1)):(t=_i(r),t.c(),te(t,1),t.m(e.parentNode,e)):t&&(rt(),le(t,1,1,()=>{t=null}),it())},i(r){i||(te(t),i=!0)},o(r){le(t),i=!1},d(r){t&&t.d(r),r&&k(e)}}}function ol(n){let e,i,t=n[4][n[1]]&&bi(n);return{c(){t&&t.c(),e=Ve()},l(r){t&&t.l(r),e=Ve()},m(r,o){t&&t.m(r,o),oe(r,e,o),i=!0},p(r,o){r[4][r[1]]?t?(t.p(r,o),o[0]&18&&te(t,1)):(t=bi(r),t.c(),te(t,1),t.m(e.parentNode,e)):t&&(rt(),le(t,1,1,()=>{t=null}),it())},i(r){i||(te(t),i=!0)},o(r){le(t),i=!1},d(r){t&&t.d(r),r&&k(e)}}}function al(n){let e,i,t;return{c(){e=q("input"),this.h()},l(r){e=z(r,"INPUT",{id:!0,class:!0,type:!0,name:!0}),this.h()},h(){D(e,"id",n[1]),D(e,"class","w100pc radius100pc"),D(e,"type","text"),D(e,"name",n[2])},m(r,o){oe(r,e,o),Lt(e,n[4][n[1]]),i||(t=[ce(e,"contextmenu",n[8]),ce(e,"input",n[21])],i=!0)},p(r,o){o[0]&2&&D(e,"id",r[1]),o[0]&4&&D(e,"name",r[2]),o[0]&18&&e.value!==r[4][r[1]]&&Lt(e,r[4][r[1]])},i:Pe,o:Pe,d(r){r&&k(e),i=!1,mt(t)}}}function sl(n){let e;function i(o,a){return!o[0].max&&!o[0].labels?cl:fl}let t=i(n),r=t(n);return{c(){r.c(),e=Ve()},l(o){r.l(o),e=Ve()},m(o,a){r.m(o,a),oe(o,e,a)},p(o,a){t===(t=i(o))&&r?r.p(o,a):(r.d(1),r=t(o),r&&(r.c(),r.m(e.parentNode,e)))},i:Pe,o:Pe,d(o){r.d(o),o&&k(e)}}}function ll(n){let e,i,t;const r=[{name:n[2]},{id:n[1]},n[0],{step:n[0].type=="float"?0:1},{class:"mb0 pop"}];function o(l){n[18](l)}let a={};for(let l=0;l<r.length;l+=1)a=ia(a,r[l]);return n[4][n[1]]!==void 0&&(a.value=n[4][n[1]]),e=new Ot({props:a}),$e.push(()=>pt(e,"value",o)),e.$on("contextmenu",n[8]),{c(){Ne(e.$$.fragment)},l(l){Te(e.$$.fragment,l)},m(l,s){Se(e,l,s),t=!0},p(l,s){const f=s[0]&7?oa(r,[s[0]&4&&{name:l[2]},s[0]&2&&{id:l[1]},s[0]&1&&aa(l[0]),s[0]&1&&{step:l[0].type=="float"?0:1},r[4]]):{};!i&&s[0]&18&&(i=!0,f.value=l[4][l[1]],vt(()=>i=!1)),e.$set(f)},i(l){t||(te(e.$$.fragment,l),t=!0)},o(l){le(e.$$.fragment,l),t=!1},d(l){xe(e,l)}}}function ul(n){let e,i,t,r;const o=[{name:n[2]},{id:n[1]},n[0]];function a(f){n[17](f)}var l=n[3];function s(f){let u={};for(let c=0;c<o.length;c+=1)u=ia(u,o[c]);return f[4][f[1]]!==void 0&&(u.value=f[4][f[1]]),{props:u}}return l&&(e=new l(s(n)),$e.push(()=>pt(e,"value",a)),e.$on("contextmenu",n[8])),{c(){e&&Ne(e.$$.fragment),t=Ve()},l(f){e&&Te(e.$$.fragment,f),t=Ve()},m(f,u){e&&Se(e,f,u),oe(f,t,u),r=!0},p(f,u){const c=u[0]&7?oa(o,[u[0]&4&&{name:f[2]},u[0]&2&&{id:f[1]},u[0]&1&&aa(f[0])]):{};if(!i&&u[0]&18&&(i=!0,c.value=f[4][f[1]],vt(()=>i=!1)),l!==(l=f[3])){if(e){rt();const p=e;le(p.$$.fragment,1,0,()=>{xe(p,1)}),it()}l?(e=new l(s(f)),$e.push(()=>pt(e,"value",a)),e.$on("contextmenu",f[8]),Ne(e.$$.fragment),te(e.$$.fragment,1),Se(e,t.parentNode,t)):e=null}else l&&e.$set(c)},i(f){r||(e&&te(e.$$.fragment,f),r=!0)},o(f){e&&le(e.$$.fragment,f),r=!1},d(f){f&&k(t),e&&xe(e,f)}}}function _i(n){let e,i,t,r,o,a,l,s,f;function u(h){n[26](h)}let c={class:"mb0-5 pop",min:n[0].min[0],max:n[0].max[0]};n[4][n[1]][0]!==void 0&&(c.value=n[4][n[1]][0]),e=new Ot({props:c}),$e.push(()=>pt(e,"value",u)),e.$on("contextmenu",n[27]);function p(h){n[28](h)}let d={class:"mb0-5 pop",min:n[0].min[1],max:n[0].max[1]};n[4][n[1]][1]!==void 0&&(d.value=n[4][n[1]][1]),r=new Ot({props:d}),$e.push(()=>pt(r,"value",p)),r.$on("contextmenu",n[29]);function g(h){n[30](h)}let y={class:"mb0 pop",min:n[0].min[2],max:n[0].max[2]};return n[4][n[1]][2]!==void 0&&(y.value=n[4][n[1]][2]),l=new Ot({props:y}),$e.push(()=>pt(l,"value",g)),l.$on("contextmenu",n[31]),{c(){Ne(e.$$.fragment),t=re(),Ne(r.$$.fragment),a=re(),Ne(l.$$.fragment)},l(h){Te(e.$$.fragment,h),t=ie(h),Te(r.$$.fragment,h),a=ie(h),Te(l.$$.fragment,h)},m(h,_){Se(e,h,_),oe(h,t,_),Se(r,h,_),oe(h,a,_),Se(l,h,_),f=!0},p(h,_){const v={};_[0]&1&&(v.min=h[0].min[0]),_[0]&1&&(v.max=h[0].max[0]),!i&&_[0]&18&&(i=!0,v.value=h[4][h[1]][0],vt(()=>i=!1)),e.$set(v);const b={};_[0]&1&&(b.min=h[0].min[1]),_[0]&1&&(b.max=h[0].max[1]),!o&&_[0]&18&&(o=!0,b.value=h[4][h[1]][1],vt(()=>o=!1)),r.$set(b);const E={};_[0]&1&&(E.min=h[0].min[2]),_[0]&1&&(E.max=h[0].max[2]),!s&&_[0]&18&&(s=!0,E.value=h[4][h[1]][2],vt(()=>s=!1)),l.$set(E)},i(h){f||(te(e.$$.fragment,h),te(r.$$.fragment,h),te(l.$$.fragment,h),f=!0)},o(h){le(e.$$.fragment,h),le(r.$$.fragment,h),le(l.$$.fragment,h),f=!1},d(h){xe(e,h),h&&k(t),xe(r,h),h&&k(a),xe(l,h)}}}function bi(n){let e,i,t,r,o,a;function l(c){n[22](c)}let s={class:"mb0-5 pop",min:n[0].min[0],max:n[0].max[0]};n[4][n[1]][0]!==void 0&&(s.value=n[4][n[1]][0]),e=new Ot({props:s}),$e.push(()=>pt(e,"value",l)),e.$on("contextmenu",n[23]);function f(c){n[24](c)}let u={class:"mb0 pop",min:n[0].min[1],max:n[0].max[1]};return n[4][n[1]][1]!==void 0&&(u.value=n[4][n[1]][1]),r=new Ot({props:u}),$e.push(()=>pt(r,"value",f)),r.$on("contextmenu",n[25]),{c(){Ne(e.$$.fragment),t=re(),Ne(r.$$.fragment)},l(c){Te(e.$$.fragment,c),t=ie(c),Te(r.$$.fragment,c)},m(c,p){Se(e,c,p),oe(c,t,p),Se(r,c,p),a=!0},p(c,p){const d={};p[0]&1&&(d.min=c[0].min[0]),p[0]&1&&(d.max=c[0].max[0]),!i&&p[0]&18&&(i=!0,d.value=c[4][c[1]][0],vt(()=>i=!1)),e.$set(d);const g={};p[0]&1&&(g.min=c[0].min[1]),p[0]&1&&(g.max=c[0].max[1]),!o&&p[0]&18&&(o=!0,g.value=c[4][c[1]][1],vt(()=>o=!1)),r.$set(g)},i(c){a||(te(e.$$.fragment,c),te(r.$$.fragment,c),a=!0)},o(c){le(e.$$.fragment,c),le(r.$$.fragment,c),a=!1},d(c){xe(e,c),c&&k(t),xe(r,c)}}}function fl(n){let e,i,t,r=n[0].labels||[],o=[];for(let a=0;a<r.length;a+=1)o[a]=wi(yi(n,r,a));return{c(){e=q("select");for(let a=0;a<o.length;a+=1)o[a].c();this.h()},l(a){e=z(a,"SELECT",{id:!0,class:!0,type:!0});var l=W(e);for(let s=0;s<o.length;s+=1)o[s].l(l);l.forEach(k),this.h()},h(){D(e,"id",n[1]),D(e,"class","w100pc text-center italic maxw1000pc overflow-hidden"),D(e,"type","text"),n[4][n[1]]===void 0&&sa(()=>n[20].call(e))},m(a,l){oe(a,e,l);for(let s=0;s<o.length;s+=1)o[s].m(e,null);ar(e,n[4][n[1]]),i||(t=[ce(e,"contextmenu",n[8]),ce(e,"change",n[20])],i=!0)},p(a,l){if(l[0]&1){r=a[0].labels||[];let s;for(s=0;s<r.length;s+=1){const f=yi(a,r,s);o[s]?o[s].p(f,l):(o[s]=wi(f),o[s].c(),o[s].m(e,null))}for(;s<o.length;s+=1)o[s].d(1);o.length=r.length}l[0]&2&&D(e,"id",a[1]),l[0]&18&&ar(e,a[4][a[1]])},d(a){a&&k(e),Xe(o,a),i=!1,mt(t)}}}function cl(n){let e,i,t;return{c(){e=q("input"),this.h()},l(r){e=z(r,"INPUT",{class:!0,type:!0}),this.h()},h(){D(e,"class","input button"),D(e,"type","number")},m(r,o){oe(r,e,o),Lt(e,n[4][n[1]]),i||(t=ce(e,"input",n[19]),i=!0)},p(r,o){o[0]&18&&nn(e.value)!==r[4][r[1]]&&Lt(e,r[4][r[1]])},d(r){r&&k(e),i=!1,t()}}}function wi(n){let e,i=n[37]+"",t,r;return{c(){e=q("option"),t=de(i),this.h()},l(o){e=z(o,"OPTION",{name:!0});var a=W(e);t=pe(a,i),a.forEach(k),this.h()},h(){D(e,"name",r=n[37]),e.__value=n[39],e.value=e.__value},m(o,a){oe(o,e,a),P(e,t)},p(o,a){a[0]&1&&i!==(i=o[37]+"")&&Me(t,i),a[0]&1&&r!==(r=o[37])&&D(e,"name",r)},d(o){o&&k(e)}}}function hl(n){let e,i,t,r=n[6]?"Learning...":"MIDI Learn",o,a,l,s,f,u,c,p,d,g;const y=[ul,ll,sl,al,ol,il,rl,nl],h=[];function _(v,b){return v[3]?0:v[0].type=="float"||v[0].type=="int"?1:v[0].type=="long"?2:v[0].type=="string"?3:v[0].type=="point2D"?4:v[0].type=="color"?5:v[0].type=="bool"?6:7}return u=_(n),c=h[u]=y[u](n),{c(){e=q("div"),i=q("div"),t=q("div"),o=de(r),a=re(),l=q("div"),s=de("Remove Assignments"),f=re(),c.c(),this.h()},l(v){e=z(v,"DIV",{class:!0});var b=W(e);i=z(b,"DIV",{style:!0,class:!0});var E=W(i);t=z(E,"DIV",{class:!0});var N=W(t);o=pe(N,r),N.forEach(k),a=ie(E),l=z(E,"DIV",{class:!0});var T=W(l);s=pe(T,"Remove Assignments"),T.forEach(k),E.forEach(k),f=ie(b),c.l(b),b.forEach(k),this.h()},h(){D(t,"class","bb clickable"),D(l,"class","bb clickable"),ke(i,"transform","translate("+n[5].offsetX+"px, "+n[5].offsetY+"px)"),D(i,"class","z-index2 bg abs t0 l0 border bt bl br cplr1 cptb0-5"),Fe(i,"none",(n[7]||"").indexOf(n[1])==-1),D(e,"class","auto-element rel")},m(v,b){oe(v,e,b),P(e,i),P(i,t),P(t,o),P(i,a),P(i,l),P(l,s),P(e,f),h[u].m(e,null),p=!0,d||(g=[ce(tl,"click",n[9]),ce(t,"click",n[10]),ce(l,"click",n[11]),ce(e,"click",dl)],d=!0)},p(v,b){(!p||b[0]&64)&&r!==(r=v[6]?"Learning...":"MIDI Learn")&&Me(o,r),(!p||b[0]&32)&&ke(i,"transform","translate("+v[5].offsetX+"px, "+v[5].offsetY+"px)"),(!p||b[0]&130)&&Fe(i,"none",(v[7]||"").indexOf(v[1])==-1);let E=u;u=_(v),u===E?h[u].p(v,b):(rt(),le(h[E],1,1,()=>{h[E]=null}),it(),c=h[u],c?c.p(v,b):(c=h[u]=y[u](v),c.c()),te(c,1),c.m(e,null))},i(v){p||(te(c),p=!0)},o(v){le(c),p=!1},d(v){v&&k(e),h[u].d(),d=!1,mt(g)}}}function dl(n){n.stopPropagation()}function pl(n,e,i){let t,r,o,a,l;he(n,kr,X=>i(33,t=X)),he(n,Qt,X=>i(6,r=X)),he(n,Kt,X=>i(7,o=X)),he(n,bt,X=>i(34,a=X)),he(n,ue,X=>i(4,l=X));let{def:s}=e,{key:f}=e,{parentName:u}=e,{name:c}=e,{uuid:p}=e,{rowIdx:d}=e,{colIdx:g}=e;const y=window,h=(X,ve)=>console.log(`[Auto] ${X}`,ve||"");let{component:_=null}=e,v={offsetX:0,offsetY:0};function b(X,ve){ge(Kt,o=f,o),ve!=null&&ge(Kt,o+=":"+ve,o),h(`opening context menu with ${o}`);const{offsetX:Ae,offsetY:Ke}=X;i(5,v={offsetX:Ae,offsetY:Ke}),X.preventDefault()}function E(X){ge(Kt,o=null,o),ge(Qt,r=null,r)}function N(X){ge(Qt,r=r?null:o,r)}function T(X){delete a[o],bt.set(a),ge(Kt,o=null,o),ge(Qt,r=null,r)}let R;function I(X){n.$$.not_equal(l[f],X)&&(l[f]=X,ue.set(l))}function w(X){n.$$.not_equal(l[f],X)&&(l[f]=X,ue.set(l))}function S(){l[f]=nn(this.value),ue.set(l)}function M(){l[f]=ra(this),ue.set(l)}function A(){l[f]=this.value,ue.set(l)}function F(X){n.$$.not_equal(l[f][0],X)&&(l[f][0]=X,ue.set(l))}const V=X=>b(X,0);function ee(X){n.$$.not_equal(l[f][1],X)&&(l[f][1]=X,ue.set(l))}const G=X=>b(X,1);function ae(X){n.$$.not_equal(l[f][0],X)&&(l[f][0]=X,ue.set(l))}const we=X=>b(X,0);function _e(X){n.$$.not_equal(l[f][1],X)&&(l[f][1]=X,ue.set(l))}const J=X=>b(X,1);function Q(X){n.$$.not_equal(l[f][2],X)&&(l[f][2]=X,ue.set(l))}const Ie=X=>b(X,2);function Ee(X){n.$$.not_equal(l[f],X)&&(l[f]=X,ue.set(l))}return n.$$set=X=>{"def"in X&&i(0,s=X.def),"key"in X&&i(1,f=X.key),"parentName"in X&&i(12,u=X.parentName),"name"in X&&i(2,c=X.name),"uuid"in X&&i(13,p=X.uuid),"rowIdx"in X&&i(14,d=X.rowIdx),"colIdx"in X&&i(15,g=X.colIdx),"component"in X&&i(3,_=X.component)},n.$$.update=()=>{n.$$.dirty[0]&19&&(X=>{if(l[f]==null&&s.default!=null&&ge(ue,l[f]=JSON.parse(JSON.stringify(s.default)),l),!!y.RNDRS){for(const[ve,Ae]of Object.entries(y.RNDRS))if(Ae.getValue()!=l[f]&&!s.ignore)try{Ae.uniforms[f]&&Ae.setValue(f,l[f])}catch(Ke){console.log("\u274C error setting value in Auto",Ke)}}})(),n.$$.dirty[0]&65539&&(X=>{R!=f&&(ge(kr,t[f]=s,t),i(16,R=f))})()},[s,f,c,_,l,v,r,o,b,E,N,T,u,p,d,g,R,I,w,S,M,A,F,V,ee,G,ae,we,_e,J,Q,Ie,Ee]}class Cr extends Ce{constructor(e){super(),De(this,e,pl,hl,Le,{def:0,key:1,parentName:12,name:2,uuid:13,rowIdx:14,colIdx:15,component:3},null,[-1,-1])}}function Ei(n,e,i){const t=n.slice();return t[2]=e[i],t}function Ni(n){let e,i=n[2].type+"",t,r,o=(n[2].path||"")+"",a,l,s;return{c(){e=q("option"),t=de(i),r=re(),a=de(o),l=re(),this.h()},l(f){e=z(f,"OPTION",{});var u=W(e);t=pe(u,i),r=ie(u),a=pe(u,o),l=ie(u),u.forEach(k),this.h()},h(){e.__value=s=n[2],e.value=e.__value},m(f,u){oe(f,e,u),P(e,t),P(e,r),P(e,a),P(e,l)},p(f,u){u&32&&i!==(i=f[2].type+"")&&Me(t,i),u&32&&o!==(o=(f[2].path||"")+"")&&Me(a,o),u&32&&s!==(s=f[2])&&(e.__value=s,e.value=e.__value)},d(f){f&&k(e)}}}function ml(n){let e;return{c(){e=q("video"),this.h()},l(i){e=z(i,"VIDEO",{}),W(e).forEach(k),this.h()},h(){e.autoplay=!0,e.loop=!0,e.controls=!0},m(i,t){oe(i,e,t),n[17](e)},p:Pe,d(i){i&&k(e),n[17](null)}}}function gl(n){let e,i;return{c(){e=q("video"),this.h()},l(t){e=z(t,"VIDEO",{volume:!0,src:!0}),W(e).forEach(k),this.h()},h(){var t;e.autoplay=!0,D(e,"volume","0"),e.muted=!0,e.loop=!0,e.controls=!0,Cn(e.src,i=(t=n[4][n[1]])==null?void 0:t.path)||D(e,"src",i)},m(t,r){oe(t,e,r),n[16](e)},p(t,r){var o;r&18&&!Cn(e.src,i=(o=t[4][t[1]])==null?void 0:o.path)&&D(e,"src",i)},d(t){t&&k(e),n[16](null)}}}function vl(n){let e,i;return{c(){e=q("img"),this.h()},l(t){e=z(t,"IMG",{src:!0}),this.h()},h(){var t;Cn(e.src,i=(t=n[4][n[1]])==null?void 0:t.path)||D(e,"src",i)},m(t,r){oe(t,e,r),n[15](e)},p(t,r){var o;r&18&&!Cn(e.src,i=(o=t[4][t[1]])==null?void 0:o.path)&&D(e,"src",i)},d(t){t&&k(e),n[15](null)}}}function yl(n){let e,i,t,r,o,a,l,s,f,u,c=n[5],p=[];for(let h=0;h<c.length;h+=1)p[h]=Ni(Ei(n,c,h));function d(h,_){var v,b,E;if(((v=h[4][h[1]])==null?void 0:v.type)==ht.IMAGE)return vl;if(((b=h[4][h[1]])==null?void 0:b.type)==ht.VIDEO)return gl;if(((E=h[4][h[1]])==null?void 0:E.type)==ht.CAMERA)return ml}let g=d(n),y=g&&g(n);return{c(){e=q("div"),i=q("div"),t=q("div"),r=de(n[0]),o=re(),a=q("select");for(let h=0;h<p.length;h+=1)p[h].c();l=re(),s=q("div"),y&&y.c(),this.h()},l(h){e=z(h,"DIV",{class:!0});var _=W(e);i=z(_,"DIV",{class:!0});var v=W(i);t=z(v,"DIV",{class:!0});var b=W(t);r=pe(b,n[0]),b.forEach(k),o=ie(v),a=z(v,"SELECT",{class:!0});var E=W(a);for(let T=0;T<p.length;T+=1)p[T].l(E);E.forEach(k),v.forEach(k),l=ie(_),s=z(_,"DIV",{class:!0});var N=W(s);y&&y.l(N),N.forEach(k),_.forEach(k),this.h()},h(){D(t,"class","plr0-5 flex row-flex-start-center"),D(a,"class","invisible abs l0 t0"),n[6]===void 0&&sa(()=>n[14].call(a)),D(i,"class","select bl bt br bb rel maxw100pc overflow-hidden 100pc"),D(s,"class","w100pc filled minh2em sticky t0 l0"),D(e,"class","flex column sticky t0 l0")},m(h,_){oe(h,e,_),P(e,i),P(i,t),P(t,r),P(i,o),P(i,a);for(let v=0;v<p.length;v+=1)p[v].m(a,null);ar(a,n[6]),P(e,l),P(e,s),y&&y.m(s,null),f||(u=[ce(a,"change",n[7]),ce(a,"change",n[14]),ce(e,"dragover",_l),ce(e,"drop",n[8])],f=!0)},p(h,[_]){if(_&1&&Me(r,h[0]),_&32){c=h[5];let v;for(v=0;v<c.length;v+=1){const b=Ei(h,c,v);p[v]?p[v].p(b,_):(p[v]=Ni(b),p[v].c(),p[v].m(a,null))}for(;v<p.length;v+=1)p[v].d(1);p.length=c.length}_&96&&ar(a,h[6]),g===(g=d(h))&&y?y.p(h,_):(y&&y.d(1),y=g&&g(h),y&&(y.c(),y.m(s,null)))},i:Pe,o:Pe,d(h){h&&k(e),Xe(p,h),y&&y.d(),f=!1,mt(u)}}}function _l(n){n.preventDefault()}function bl(n,e,i){let t;he(n,ue,I=>i(4,t=I));let{def:r}=e,{key:o}=e,{parentName:a}=e,{name:l}=e,{uuid:s}=e,{rowIdx:f}=e,{colIdx:u}=e;const c=window;let p=[];function d(){var I;if(c.RNDRS){for(const[w,S]of Object.entries(c.RNDRS))if(S&&h)S.setValue(o,h);else if(((I=t[o])==null?void 0:I.type)==ht.FEEDBACK){const M=document.getElementById("main");S.setValue(o,M)}}c.requestAnimationFrame(d)}an(async I=>{i(5,p=await Fs()),d()});let g=!1;function y(I){i(13,g=!0),navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then((w,S)=>{console.log("\u2705 ------------ camera opened",w),i(3,h.srcObject=w,h)})}let h,_;function v(I){window.requestAnimationFrame(w=>{_&&ge(ue,t[o]=_,t)})}async function b(I){var F,V;I.preventDefault();const w=(V=(F=I==null?void 0:I.dataTransfer)==null?void 0:F.items)==null?void 0:V[0];if(!w)return;const S=await w.getAsFileSystemHandle(),M=S.name.split(".").pop().toLowerCase(),{name:A}=S;if(S.kind=="file"){const ee=URL.createObjectURL(await S.getFile()),G=["mp4","mov","avi","mkv"],ae=["jpg","png","gif","jpeg"];G.indexOf(M)!=-1?ge(ue,t[o]={type:ht.VIDEO,path:ee,name:A},t):ae.indexOf(M)!=-1&&ge(ue,t[o]={type:ht.IMAGE,path:ee,name:A},t)}}function E(){_=ra(this),i(6,_),i(5,p)}function N(I){$e[I?"unshift":"push"](()=>{h=I,i(3,h)})}function T(I){$e[I?"unshift":"push"](()=>{h=I,i(3,h)})}function R(I){$e[I?"unshift":"push"](()=>{h=I,i(3,h)})}return n.$$set=I=>{"def"in I&&i(2,r=I.def),"key"in I&&i(1,o=I.key),"parentName"in I&&i(9,a=I.parentName),"name"in I&&i(0,l=I.name),"uuid"in I&&i(10,s=I.uuid),"rowIdx"in I&&i(11,f=I.rowIdx),"colIdx"in I&&i(12,u=I.colIdx)},n.$$.update=()=>{var I,w;n.$$.dirty&22&&(S=>{if(t[o]==null&&r.default!=null&&ge(ue,t[o]=JSON.parse(JSON.stringify(r.default)),t),!!c.RNDRS)for(const[M,A]of Object.entries(c.RNDRS));})(),n.$$.dirty&8218&&(S=>{var M;((M=t[o])==null?void 0:M.type)==ht.CAMERA?g||y():i(13,g=!1)})(),n.$$.dirty&18&&i(0,l=(I=t==null?void 0:t[o])!=null&&I.name?t[o].name:(w=t==null?void 0:t[o])!=null&&w.path?t[o].path.split("/").pop():"N/A")},[l,o,r,h,t,p,_,v,b,a,s,f,u,g,E,N,T,R]}class wl extends Ce{constructor(e){super(),De(this,e,bl,yl,Le,{def:2,key:1,parentName:9,name:0,uuid:10,rowIdx:11,colIdx:12})}}function El(n){let e,i=n[0].labels[n[2][n[1]]]+"",t,r,o;return{c(){e=q("button"),t=de(i),this.h()},l(a){e=z(a,"BUTTON",{class:!0});var l=W(e);t=pe(l,i),l.forEach(k),this.h()},h(){D(e,"class","italic")},m(a,l){oe(a,e,l),P(e,t),r||(o=ce(e,"mousedown",n[3]),r=!0)},p(a,[l]){l&7&&i!==(i=a[0].labels[a[2][a[1]]]+"")&&Me(t,i)},i:Pe,o:Pe,d(a){a&&k(e),r=!1,o()}}}function Nl(n,e,i){let t;he(n,ue,d=>i(2,t=d));let{def:r}=e,{key:o}=e,{parentName:a}=e,{name:l}=e,{uuid:s}=e,{rowIdx:f}=e,{colIdx:u}=e;const c=window;function p(d){ge(ue,t[o]+=1,t),t[o]>=r.labels.length&&ge(ue,t[o]=0,t)}return n.$$set=d=>{"def"in d&&i(0,r=d.def),"key"in d&&i(1,o=d.key),"parentName"in d&&i(4,a=d.parentName),"name"in d&&i(5,l=d.name),"uuid"in d&&i(6,s=d.uuid),"rowIdx"in d&&i(7,f=d.rowIdx),"colIdx"in d&&i(8,u=d.colIdx)},n.$$.update=()=>{n.$$.dirty&7&&(d=>{if(t[o]==null&&r.default!=null&&ge(ue,t[o]=JSON.parse(JSON.stringify(r.default)),t),!!c.RNDRS){for(const[g,y]of Object.entries(c.RNDRS))if(y.getValue()!=t[o]&&!r.ignore)try{y.uniforms[o]&&y.setValue(o,t[o])}catch(h){console.log("\u274C error setting value in MultiClick",h)}}})()},[r,o,t,p,a,l,s,f,u]}class Sl extends Ce{constructor(e){super(),De(this,e,Nl,El,Le,{def:0,key:1,parentName:4,name:5,uuid:6,rowIdx:7,colIdx:8})}}const{window:xl}=cr;function Il(n){let e,i,t,r,o,a,l;return{c(){e=q("div"),i=q("button"),t=de(n[2]),r=re(),o=q("button"),this.h()},l(s){e=z(s,"DIV",{class:!0});var f=W(e);i=z(f,"BUTTON",{class:!0});var u=W(i);t=pe(u,n[2]),u.forEach(k),r=ie(f),o=z(f,"BUTTON",{class:!0}),W(o).forEach(k),f.forEach(k),this.h()},h(){D(i,"class","italic"),Fe(i,"fade",n[1][n[0]]==-1),Fe(i,"error",n[1][n[0]]!=-1),D(o,"class","italic"),D(e,"class","flex")},m(s,f){oe(s,e,f),P(e,i),P(i,t),P(e,r),P(e,o),a||(l=[ce(xl,"mousedown",n[5]),ce(i,"mousedown",n[3]),ce(o,"click",n[4])],a=!0)},p(s,[f]){f&4&&Me(t,s[2]),f&3&&Fe(i,"fade",s[1][s[0]]==-1),f&3&&Fe(i,"error",s[1][s[0]]!=-1)},i:Pe,o:Pe,d(s){s&&k(e),a=!1,mt(l)}}}function Ol(n,e,i){let t,r;he(n,jt,b=>i(13,t=b)),he(n,ue,b=>i(1,r=b));let{def:o}=e,{key:a}=e,{parentName:l}=e,{name:s}=e,{uuid:f}=e,{rowIdx:u}=e,{colIdx:c}=e;const p=window,d=(b,E)=>console.log(`[OpSelect] ${b}`,E||"");let g=null,y;function h(b){if((t==null?void 0:t.key)==a){ge(jt,t=null,t);return}d(`initiating selection for ${a}`),ge(jt,t={key:a,uuid:f},t),b.stopPropagation()}function _(){ge(ue,r[a]=-1,r)}function v(b){p.requestAnimationFrame(E=>{t&&(d("no source was selected"),ge(jt,t=null,t))})}return n.$$set=b=>{"def"in b&&i(6,o=b.def),"key"in b&&i(0,a=b.key),"parentName"in b&&i(7,l=b.parentName),"name"in b&&i(8,s=b.name),"uuid"in b&&i(9,f=b.uuid),"rowIdx"in b&&i(10,u=b.rowIdx),"colIdx"in b&&i(11,c=b.colIdx)},n.$$.update=()=>{n.$$.dirty&67&&(b=>{if(r[a]==null&&o.default!=null&&ge(ue,r[a]=JSON.parse(JSON.stringify(o.default)),r),!!p.RNDRS){for(const[E,N]of Object.entries(p.RNDRS))if(N.getValue()!=r[a]&&!o.ignore)try{N.uniforms[a]&&N.setValue(a,r[a])}catch(T){console.log("\u274C error setting value in OpSelect",T)}}})(),n.$$.dirty&4099&&(b=>{if(y!=r[a]){if(i(12,y=r[a]),r[a]>=0&&r[a]<99)i(2,g=`${Ln(r[a])} (${r[a]})`);else{const E=ei(r[a]),N=Rt().find(T=>T.uuid==E);i(2,g=`${(N==null?void 0:N.name)||"\u21E9"} ${(N==null?void 0:N.uuid)||""}`)}yt.set(Tt.COMPILE)}})(r[a])},[a,r,g,h,_,v,o,l,s,f,u,c,y]}class Tl extends Ce{constructor(e){super(),De(this,e,Ol,Il,Le,{def:6,key:0,parentName:7,name:8,uuid:9,rowIdx:10,colIdx:11})}}const Al=Cr,Rl=wl,Ml=Sl,Pl=Tl,Si=Object.freeze(Object.defineProperty({__proto__:null,Auto:Al,ExtSource:Rl,MultiClick:Ml,OpSelect:Pl},Symbol.toStringTag,{value:"Module"}));function xi(n,e,i){const t=n.slice();return t[7]=e[i][0],t[8]=e[i][1],t}function Ii(n){let e,i,t=(n[8].label||n[7])+"",r,o,a,l,s;var f=Si[n[8].gui]||Cr;function u(c){return{props:{def:c[8],uuid:c[1],rowIdx:c[3],colIdx:c[4],parentName:c[2],name:c[7],key:c[1]+c[7]}}}return f&&(a=new f(u(n))),{c(){e=q("div"),i=q("div"),r=de(t),o=re(),a&&Ne(a.$$.fragment),l=re(),this.h()},l(c){e=z(c,"DIV",{class:!0});var p=W(e);i=z(p,"DIV",{class:!0});var d=W(i);r=pe(d,t),d.forEach(k),o=ie(p),a&&Te(a.$$.fragment,p),l=ie(p),p.forEach(k),this.h()},h(){D(i,"class","grow monospace f0 bold uppercase"),D(e,"class","flex row-stretch-center wrap"),Fe(e,"none",n[5][n[1]+n[7]])},m(c,p){oe(c,e,p),P(e,i),P(i,r),P(e,o),a&&Se(a,e,null),P(e,l),s=!0},p(c,p){(!s||p&1)&&t!==(t=(c[8].label||c[7])+"")&&Me(r,t);const d={};if(p&1&&(d.def=c[8]),p&2&&(d.uuid=c[1]),p&8&&(d.rowIdx=c[3]),p&16&&(d.colIdx=c[4]),p&4&&(d.parentName=c[2]),p&1&&(d.name=c[7]),p&3&&(d.key=c[1]+c[7]),f!==(f=Si[c[8].gui]||Cr)){if(a){rt();const g=a;le(g.$$.fragment,1,0,()=>{xe(g,1)}),it()}f?(a=new f(u(c)),Ne(a.$$.fragment),te(a.$$.fragment,1),Se(a,e,l)):a=null}else f&&a.$set(d);(!s||p&35)&&Fe(e,"none",c[5][c[1]+c[7]])},i(c){s||(a&&te(a.$$.fragment,c),s=!0)},o(c){a&&le(a.$$.fragment,c),s=!1},d(c){c&&k(e),a&&xe(a)}}}function kl(n){let e,i,t=Object.entries(n[0].INPUTS),r=[];for(let a=0;a<t.length;a+=1)r[a]=Ii(xi(n,t,a));const o=a=>le(r[a],1,1,()=>{r[a]=null});return{c(){for(let a=0;a<r.length;a+=1)r[a].c();e=Ve()},l(a){for(let l=0;l<r.length;l+=1)r[l].l(a);e=Ve()},m(a,l){for(let s=0;s<r.length;s+=1)r[s].m(a,l);oe(a,e,l),i=!0},p(a,[l]){if(l&63){t=Object.entries(a[0].INPUTS);let s;for(s=0;s<t.length;s+=1){const f=xi(a,t,s);r[s]?(r[s].p(f,l),te(r[s],1)):(r[s]=Ii(f),r[s].c(),te(r[s],1),r[s].m(e.parentNode,e))}for(rt(),s=t.length;s<r.length;s+=1)o(s);it()}},i(a){if(!i){for(let l=0;l<t.length;l+=1)te(r[l]);i=!0}},o(a){r=r.filter(Boolean);for(let l=0;l<r.length;l+=1)le(r[l]);i=!1},d(a){Xe(r,a),a&&k(e)}}}function Cl(n,e,i){let t;he(n,Gt,u=>i(5,t=u));let{schema:r}=e,{uuid:o}=e,{name:a}=e,{shader:l}=e,{rowIdx:s}=e,{colIdx:f}=e;return n.$$set=u=>{"schema"in u&&i(0,r=u.schema),"uuid"in u&&i(1,o=u.uuid),"name"in u&&i(2,a=u.name),"shader"in u&&i(6,l=u.shader),"rowIdx"in u&&i(3,s=u.rowIdx),"colIdx"in u&&i(4,f=u.colIdx)},[r,o,a,s,f,t,l]}class Et extends Ce{constructor(e){super(),De(this,e,Cl,kl,Le,{schema:0,uuid:1,name:2,shader:6,rowIdx:3,colIdx:4})}}function Dl(n){let e,i;return e=new Et({props:{name:n[0],uuid:n[1],schema:Vr,shader:ha,colIdx:n[2],rowIdx:n[3]}}),{c(){Ne(e.$$.fragment)},l(t){Te(e.$$.fragment,t)},m(t,r){Se(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(te(e.$$.fragment,t),i=!0)},o(t){le(e.$$.fragment,t),i=!1},d(t){xe(e,t)}}}function Ll(n,e,i){let t;he(n,ue,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>gt({name:r,uuid:o,schema:Vr}))()},[r,o,a,l,t]}class Fl extends Ce{constructor(e){super(),De(this,e,Ll,Dl,Le,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function Ul(n){let e,i;return e=new Et({props:{name:n[0],uuid:n[1],schema:Gr,shader:da,colIdx:n[2],rowIdx:n[3]}}),{c(){Ne(e.$$.fragment)},l(t){Te(e.$$.fragment,t)},m(t,r){Se(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(te(e.$$.fragment,t),i=!0)},o(t){le(e.$$.fragment,t),i=!1},d(t){xe(e,t)}}}function Bl(n,e,i){let t;he(n,ue,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>gt({name:r,uuid:o,schema:Gr}))()},[r,o,a,l,t]}class jl extends Ce{constructor(e){super(),De(this,e,Bl,Ul,Le,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function Vl(n){let e,i;return e=new Et({props:{name:n[0],uuid:n[1],schema:Hr,shader:pa,colIdx:n[2],rowIdx:n[3]}}),{c(){Ne(e.$$.fragment)},l(t){Te(e.$$.fragment,t)},m(t,r){Se(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(te(e.$$.fragment,t),i=!0)},o(t){le(e.$$.fragment,t),i=!1},d(t){xe(e,t)}}}function Gl(n,e,i){let t;he(n,ue,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>gt({name:r,uuid:o,schema:Hr}))()},[r,o,a,l,t]}class Hl extends Ce{constructor(e){super(),De(this,e,Gl,Vl,Le,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function ql(n){let e,i;return e=new Et({props:{name:n[0],uuid:n[1],schema:qr,shader:ma,colIdx:n[2],rowIdx:n[3]}}),{c(){Ne(e.$$.fragment)},l(t){Te(e.$$.fragment,t)},m(t,r){Se(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(te(e.$$.fragment,t),i=!0)},o(t){le(e.$$.fragment,t),i=!1},d(t){xe(e,t)}}}function zl(n,e,i){let t;he(n,ue,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>gt({name:r,uuid:o,schema:qr}))()},[r,o,a,l,t]}class Xl extends Ce{constructor(e){super(),De(this,e,zl,ql,Le,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function Wl(n){let e,i;return e=new Et({props:{name:n[0],uuid:n[1],schema:zr,shader:ga,colIdx:n[2],rowIdx:n[3]}}),{c(){Ne(e.$$.fragment)},l(t){Te(e.$$.fragment,t)},m(t,r){Se(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(te(e.$$.fragment,t),i=!0)},o(t){le(e.$$.fragment,t),i=!1},d(t){xe(e,t)}}}function Yl(n,e,i){let t;he(n,ue,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>gt({name:r,uuid:o,schema:zr}))()},[r,o,a,l,t]}class Jl extends Ce{constructor(e){super(),De(this,e,Yl,Wl,Le,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function Kl(n){let e,i;return e=new Et({props:{name:n[0],uuid:n[1],schema:Xr,shader:va,colIdx:n[2],rowIdx:n[3]}}),{c(){Ne(e.$$.fragment)},l(t){Te(e.$$.fragment,t)},m(t,r){Se(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(te(e.$$.fragment,t),i=!0)},o(t){le(e.$$.fragment,t),i=!1},d(t){xe(e,t)}}}function Zl(n,e,i){let t;he(n,ue,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>gt({name:r,uuid:o,schema:Xr}))()},[r,o,a,l,t]}class Ql extends Ce{constructor(e){super(),De(this,e,Zl,Kl,Le,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function $l(n){let e,i;return e=new Et({props:{name:n[0],uuid:n[1],schema:Wr,shader:ya,colIdx:n[2],rowIdx:n[3]}}),{c(){Ne(e.$$.fragment)},l(t){Te(e.$$.fragment,t)},m(t,r){Se(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(te(e.$$.fragment,t),i=!0)},o(t){le(e.$$.fragment,t),i=!1},d(t){xe(e,t)}}}function eu(n,e,i){let t;he(n,ue,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>gt({name:r,uuid:o,schema:Wr}))()},[r,o,a,l,t]}class tu extends Ce{constructor(e){super(),De(this,e,eu,$l,Le,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function nu(n){let e,i;return e=new Et({props:{name:n[0],uuid:n[1],schema:Yr,shader:_a,colIdx:n[2],rowIdx:n[3]}}),{c(){Ne(e.$$.fragment)},l(t){Te(e.$$.fragment,t)},m(t,r){Se(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(te(e.$$.fragment,t),i=!0)},o(t){le(e.$$.fragment,t),i=!1},d(t){xe(e,t)}}}function ru(n,e,i){let t;he(n,ue,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>gt({name:r,uuid:o,schema:Yr}))()},[r,o,a,l,t]}class iu extends Ce{constructor(e){super(),De(this,e,ru,nu,Le,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function ou(n){let e,i;return e=new Et({props:{name:n[0],uuid:n[1],schema:Jr,shader:ba,colIdx:n[2],rowIdx:n[3]}}),{c(){Ne(e.$$.fragment)},l(t){Te(e.$$.fragment,t)},m(t,r){Se(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(te(e.$$.fragment,t),i=!0)},o(t){le(e.$$.fragment,t),i=!1},d(t){xe(e,t)}}}function au(n,e,i){let t;he(n,ue,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>gt({name:r,uuid:o,schema:Jr}))()},[r,o,a,l,t]}class su extends Ce{constructor(e){super(),De(this,e,au,ou,Le,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function lu(n){let e,i;return e=new Et({props:{name:n[0],uuid:n[1],schema:Kr,shader:wa,colIdx:n[2],rowIdx:n[3]}}),{c(){Ne(e.$$.fragment)},l(t){Te(e.$$.fragment,t)},m(t,r){Se(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(te(e.$$.fragment,t),i=!0)},o(t){le(e.$$.fragment,t),i=!1},d(t){xe(e,t)}}}function uu(n,e,i){let t;he(n,ue,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>gt({name:r,uuid:o,schema:Kr}))()},[r,o,a,l,t]}class fu extends Ce{constructor(e){super(),De(this,e,uu,lu,Le,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function cu(n){let e,i;return e=new Et({props:{name:n[0],uuid:n[1],schema:Zr,shader:Ea,colIdx:n[2],rowIdx:n[3]}}),{c(){Ne(e.$$.fragment)},l(t){Te(e.$$.fragment,t)},m(t,r){Se(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(te(e.$$.fragment,t),i=!0)},o(t){le(e.$$.fragment,t),i=!1},d(t){xe(e,t)}}}function hu(n,e,i){let t;he(n,ue,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>gt({name:r,uuid:o,schema:Zr}))()},[r,o,a,l,t]}class du extends Ce{constructor(e){super(),De(this,e,hu,cu,Le,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function Nt(n,e){e.INPUTS={BlendMode:{type:"long",label:"Blend Mode",min:0,max:sr().length,default:0,labels:sr().map(i=>i.name)},BlendAmt:{type:"float",label:"Blend Amount",min:0,max:1,default:1},...e.INPUTS};for(let[i,t]of Object.entries(e.INPUTS))t.gui=="OpSelect"&&(e.INPUTS[i]={...t,gui:"OpSelect",type:"float",min:-1,max:999});return e}const pu={COMPONENT:Fl,GLSL:ha,SCHEMA:Nt("Capacitor",Vr)},mu={COMPONENT:jl,GLSL:da,SCHEMA:Nt("Channel",Gr)},gu={COMPONENT:Hl,GLSL:pa,SCHEMA:Nt("Convolution",Hr)},vu={COMPONENT:Xl,GLSL:ma,SCHEMA:Nt("Deform",qr)},yu={COMPONENT:Jl,GLSL:ga,SCHEMA:Nt("Light",zr)},_u={COMPONENT:Ql,GLSL:va,SCHEMA:Nt("Mask",Xr)},bu={COMPONENT:tu,GLSL:ya,SCHEMA:Nt("Mix",Wr)},wu={COMPONENT:iu,GLSL:_a,SCHEMA:Nt("Shape",Yr)},Eu={COMPONENT:su,GLSL:ba,SCHEMA:Nt("Source",Jr)},Nu={COMPONENT:fu,GLSL:wa,SCHEMA:Nt("Synth",Kr)},Su={COMPONENT:du,GLSL:Ea,SCHEMA:Nt("Wobbulate",Zr)},rn=Object.freeze(Object.defineProperty({__proto__:null,Capacitor:pu,Channel:mu,Convolution:gu,Deform:vu,Light:yu,Mask:_u,Mix:bu,Shape:wu,Source:Eu,Synth:Nu,Wobbulate:Su},Symbol.toStringTag,{value:"Module"})),Na=(n,e)=>console.log(`[API] ${n}`,e||""),Sa=n=>{let e=[{type:"vec4",name:"INPUT"},{type:"int",name:"IN_PASS"},{type:"vec2",name:"POS_NORM"},{type:"vec2",name:"POS_FRAG"}];for(const[i,t]of Object.entries(n)){let{ignore:r,type:o}=t;const a=i==Zt.BL_AMT||i==Zt.BL_MODE;!r&&!a&&(o=Ls[t.gui]||Ds[t.type]||o,e.push({type:o,name:i}))}return e};function nr(n,e,i,t,r){const o=r-t,a=i-e;return(n-e)*o/a+t}const xa="Channel";function Ia(){Na("\u{1F39E} sequence changed");let n=!1;console.log("skipping channel adjustments (TODO)");const e=ye(_t);let i=[];for(const t of e)t.length==1&&t[0].indexOf(xa)!=-1?(console.log("EMPTY CHANNEL"),n=!0):i.push(t);return n&&_t.set(i),n}function Qr(){Na("\u{1F5D1} clearing up uniforms");const n=ye(ue);let e={};for(const i of Rt())for(const[t,r]of Object.entries(i.schema.INPUTS)){const o=i.uuid+t;e[o]=n[o]}ue.set(e)}function Oa(n,e){try{if(e=="float")return n.toFixed(3);if(e=="int"||e=="long")return parseInt(n)+"";if(e=="vec2"||e=="vec3"||e=="vec4")return`${e}(${n.map(i=>i.toFixed(3)).join(",")})`}catch{}return n+""}function Ta(n,e){let i=0;for(const t of ye(_t).slice(0,n))i+=t.length;return i+e}function $r(n){const e=n,i=ye(nt);if(!!i)return(e[0]==i[0][0]?e[1]>=i[0][1]:e[0]>i[0][0])&&(e[0]==i[1][0]?e[1]<=i[1][1]:e[0]<=i[0][0])}function Dr(n,e){return e||(e=-1),n?parseInt(n.substring(1)):e}function ei(n,e){return"u"+(n+"").padStart(3,"0")}function gt(n){const{name:e,uuid:i,schema:t}=n;let r=ye(ue);for(const[o,a]of Object.entries(t.INPUTS)){const l=i+o;if(a.link!=null){const s=a.link.split(":")[0],f=parseInt(a.link.split(":")[1]);Gt.update(u=>(u[l]=r[i+s]!=f,u))}}}const rr=n=>`${Math.floor(Math.random()*9)+1}`[0];function Aa(){const n=Rt().map(e=>e.uuid);for(let e=0;e<1e3;e++){const i=`u${rr()}${rr()}${rr()}`;if(n.indexOf(i)==-1)return i}alert("error generating uuid")}function Ra(n){return n+":"+Aa()}function ti(n,e){return`${Ln(n.x)}${n.y+1} ${n.name} ${e}`}function Lr(n){const e=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg,i=/([^\s,]+)/g;let t=n.toString().replace(e,""),r=t.slice(t.indexOf("(")+1,t.indexOf(")")).match(i);return r===null&&(r=[]),r}function Ma(n){let e,i=Object.keys(n),t=i.length,r={};for(;t--;)e=i[t],r[e.toUpperCase()]=n[e];for(const[o,a]of Object.entries(r))a.constructor;return r}function Ln(n){return String.fromCharCode(97+n).toUpperCase()}function ni(){var t;const n=ye(nt),e=ye(_t);if(!n)return[];if(n.length!=2)return[];let i=[];for(let r=n[0][0];r<=n[1][0];r++)for(let o=n[0][1];o<=n[1][1];o++){const a=(t=e==null?void 0:e[r])==null?void 0:t[o];a&&i.push(a)}return i}function ri(n,e,i,t){console.log(`[API] \u{1F4A7} ${n} with [${e},${i}]`);let r=[],o=[];t&&(o=t);let a=0;for(const l of ye(_t)){let s=0;r.push([]);for(const f of l){let u=$r([a,s]);u&&o.push(f),u||r[a].push(f),s+=1}a+=1}return n==lt.MOVE&&(r[e]=[...r[e].slice(0,i+1),...o,...r[e].slice(i+1)]),n==lt.INSERT&&(r=[...r.slice(0,e),o,...r.slice(e)]),n==lt.APPEND&&(r=[...r,o]),_t.set(r),r}function Pa(n){return["Image","Video","Source","Media","Camera"].indexOf(n)!=-1}function ka(){return ye(_t).map(n=>n.length).reduce((n,e)=>n+e,0)}function Bn(n){const e=ye(_t);let i=0;for(const t of e){let r=0;for(const o of t){const a=o.split(":")[0],l=o.split(":")[1],s=rn[a].SCHEMA,f=Pa(a);n({name:a,schema:s,x:i,y:r,source:f,uuid:l}),r+=1}i+=1}}function Rt(){let n=[];return Bn(e=>n.push(e)),n}function hr(){var i;let n,e=[];for(const t of Rt()){const r=((i=t==null?void 0:t.schema)==null?void 0:i.PASS)&&n,o=(n==null?void 0:n.name)==xa;(r||o)&&e.indexOf(n.uuid)==-1&&e.push(n.uuid),n=t}return e}function ir(n){return n=n.substring(0,4),Rt().find(e=>e.uuid==n)}function ii(n){let e=ye(Gt);if(!n)return e;for(const i of Rt())for(const[t,r]of Object.entries(i.schema.INPUTS))r.gui=="OpSelect"&&(e[i.uuid+r.name]=!0);return e}const Oi=Object.freeze(Object.defineProperty({__proto__:null,GetISFFunctionArgsFromSchema:Sa,ScaleValue:nr,SequenceUpdatedCallback:Ia,ClearUpUniforms:Qr,ConvertVariableToString:Oa,IndexFromRowAndCol:Ta,IsRowColSelected:$r,UuidToInt:Dr,IntToUuid:ei,SetOpCallback:gt,R:rr,GenerateUuid:Aa,GenerateUuidWithName:Ra,GetLabelFromOp:ti,GetFunctionArgumentNames:Lr,MakeJsonKeysUppercase:Ma,GetLetterFromIdx:Ln,GetSelectedSequenceList:ni,MakeSequenceAdjustment:ri,IsSource:Pa,TotalSequenceLength:ka,LoopThroughSequence:Bn,GetSequenceAsList:Rt,GetUuidsForPasses:hr,GetOpByUuid:ir,GetExpandedHiddenUniforms:ii},Symbol.toStringTag,{value:"Module"}));function Ti(n,e,i){const t=n.slice();return t[7]=e[i][0],t[8]=e[i][1],t[9]=e,t[10]=i,t}function Ai(n,e,i){const t=n.slice();return t[11]=e[i],t[13]=i,t}function xu(n){let e=n[8]+"",i;return{c(){i=de(e)},l(t){i=pe(t,e)},m(t,r){oe(t,i,r)},p(t,r){r&8&&e!==(e=t[8]+"")&&Me(i,e)},d(t){t&&k(i)}}}function Iu(n){let e=n[8].toFixed(2)+"",i;return{c(){i=de(e)},l(t){i=pe(t,e)},m(t,r){oe(t,i,r)},p(t,r){r&8&&e!==(e=t[8].toFixed(2)+"")&&Me(i,e)},d(t){t&&k(i)}}}function Ou(n){let e,i=n[8],t=[];for(let r=0;r<i.length;r+=1)t[r]=Ri(Ai(n,i,r));return{c(){for(let r=0;r<t.length;r+=1)t[r].c();e=Ve()},l(r){for(let o=0;o<t.length;o+=1)t[o].l(r);e=Ve()},m(r,o){for(let a=0;a<t.length;a+=1)t[a].m(r,o);oe(r,e,o)},p(r,o){if(o&8){i=r[8];let a;for(a=0;a<i.length;a+=1){const l=Ai(r,i,a);t[a]?t[a].p(l,o):(t[a]=Ri(l),t[a].c(),t[a].m(e.parentNode,e))}for(;a<t.length;a+=1)t[a].d(1);t.length=i.length}},d(r){Xe(t,r),r&&k(e)}}}function Ri(n){let e=(n[11]?n[11].toFixed(2):"null")+"",i;return{c(){i=de(e)},l(t){i=pe(t,e)},m(t,r){oe(t,i,r)},p(t,r){r&8&&e!==(e=(t[11]?t[11].toFixed(2):"null")+"")&&Me(i,e)},d(t){t&&k(i)}}}function Mi(n){let e,i,t,r,o,a,l=n[7]+"",s,f,u,c,p,d,g;function y(){n[6].call(t,n[7])}function h(b,E){return E&8&&(c=null),c==null&&(c=!!Array.isArray(b[8])),c?Ou:typeof b[8]=="number"?Iu:xu}let _=h(n,-1),v=_(n);return{c(){e=q("div"),i=q("label"),t=q("input"),r=re(),o=q("span"),a=re(),s=de(l),f=re(),u=q("span"),v.c(),p=re(),this.h()},l(b){e=z(b,"DIV",{class:!0});var E=W(e);i=z(E,"LABEL",{class:!0});var N=W(i);t=z(N,"INPUT",{type:!0}),r=ie(N),o=z(N,"SPAN",{}),W(o).forEach(k),a=ie(N),s=pe(N,l),N.forEach(k),f=ie(E),u=z(E,"SPAN",{});var T=W(u);v.l(T),T.forEach(k),p=ie(E),E.forEach(k),this.h()},h(){D(t,"type","checkbox"),D(i,"class","checkbox"),D(e,"class","flex row-space-between-flex-start minw16em")},m(b,E){oe(b,e,E),P(e,i),P(i,t),t.checked=n[4][n[7]],P(i,r),P(i,o),P(i,a),P(i,s),P(e,f),P(e,u),v.m(u,null),P(e,p),d||(g=ce(t,"change",y),d=!0)},p(b,E){n=b,E&24&&(t.checked=n[4][n[7]]),E&8&&l!==(l=n[7]+"")&&Me(s,l),_===(_=h(n,E))&&v?v.p(n,E):(v.d(1),v=_(n),v&&(v.c(),v.m(u,null)))},d(b){b&&k(e),v.d(),d=!1,g()}}}function Tu(n){let e,i,t,r,o,a,l,s,f,u,c,p,d,g,y,h,_,v,b,E=n[0].trim()+"",N,T=Object.entries(n[3]),R=[];for(let I=0;I<T.length;I+=1)R[I]=Mi(Ti(n,T,I));return{c(){e=q("div"),i=q("div"),t=q("div"),r=de("PREVIEW"),o=re(),a=q("div"),l=de(n[1]),s=re(),f=q("div"),u=de("selected"),c=re(),p=q("div"),d=de(n[2]),g=re(),y=q("div"),h=de("uniforms"),_=re();for(let I=0;I<R.length;I+=1)R[I].c();v=re(),b=q("pre"),N=de(E),this.h()},l(I){e=z(I,"DIV",{class:!0});var w=W(e);i=z(w,"DIV",{class:!0});var S=W(i);t=z(S,"DIV",{class:!0});var M=W(t);r=pe(M,"PREVIEW"),M.forEach(k),o=ie(S),a=z(S,"DIV",{class:!0});var A=W(a);l=pe(A,n[1]),A.forEach(k),s=ie(S),f=z(S,"DIV",{class:!0});var F=W(f);u=pe(F,"selected"),F.forEach(k),c=ie(S),p=z(S,"DIV",{class:!0});var V=W(p);d=pe(V,n[2]),V.forEach(k),g=ie(S),y=z(S,"DIV",{class:!0});var ee=W(y);h=pe(ee,"uniforms"),ee.forEach(k),_=ie(S);for(let ae=0;ae<R.length;ae+=1)R[ae].l(S);S.forEach(k),v=ie(w),b=z(w,"PRE",{class:!0});var G=W(b);N=pe(G,E),G.forEach(k),w.forEach(k),this.h()},h(){D(t,"class","bold"),D(a,"class",""),D(f,"class","bold"),D(p,"class",""),D(y,"class","bold"),D(i,"class","flex column p1"),D(b,"class","monospace p1 pl3 grow filled overflow-auto f2 rel"),D(e,"class","flex row")},m(I,w){oe(I,e,w),P(e,i),P(i,t),P(t,r),P(i,o),P(i,a),P(a,l),P(i,s),P(i,f),P(f,u),P(i,c),P(i,p),P(p,d),P(i,g),P(i,y),P(y,h),P(i,_);for(let S=0;S<R.length;S+=1)R[S].m(i,null);P(e,v),P(e,b),P(b,N)},p(I,[w]){if(w&2&&Me(l,I[1]),w&4&&Me(d,I[2]),w&24){T=Object.entries(I[3]);let S;for(S=0;S<T.length;S+=1){const M=Ti(I,T,S);R[S]?R[S].p(M,w):(R[S]=Mi(M),R[S].c(),R[S].m(i,null))}for(;S<R.length;S+=1)R[S].d(1);R.length=T.length}w&1&&E!==(E=I[0].trim()+"")&&Me(N,E)},i:Pe,o:Pe,d(I){I&&k(e),Xe(R,I)}}}function Au(n,e,i){let t,r,o,a,l;he(n,tn,u=>i(5,t=u)),he(n,Dn,u=>i(1,r=u)),he(n,nt,u=>i(2,o=u)),he(n,ue,u=>i(3,a=u)),he(n,Gt,u=>i(4,l=u));let s="";function f(u){l[u]=this.checked,Gt.set(l)}return n.$$.update=()=>{n.$$.dirty&32&&(u=>{i(0,s=jr("	"))})()},[s,r,o,a,l,t,f]}class Ru extends Ce{constructor(e){super(),De(this,e,Au,Tu,Le,{})}}const Mu=n=>{const e=ye(ue),i=hr();let t=[];return Bn(r=>{var o,a,l,s;if(((a=(o=r.schema)==null?void 0:o.PASSES)==null?void 0:a.length)>0)for(let f=0;f<((s=(l=r.schema)==null?void 0:l.PASSES)==null?void 0:s.length);f++)t.push({...r,uuid:r.uuid,pass:f});t.push(r)}),[{type:ct.FUNC,name:"main",prepend:"void",body:(r=>{let o="";o+=`vec2 POS_NORM = POSITION_NORM();
`,o+=`vec2 POS_FRAG = POSITION_FRAG();
`,o+=`vec4 BG = vec4(0.0); // GRID(0.02, POS_FRAG);
`,o+=`vec4 temp = BG;
`;let a=0,l,s;return t.forEach((f,u)=>{var b,E;const c=u==t.length-1,p=i.indexOf(f.uuid)!=-1||c,d=f.name=="Channel",g=Dr((b=t[s])==null?void 0:b.uuid),y=Dr((E=t[l])==null?void 0:E.uuid),h=d?g:y,_=N=>{if(N<0||N==null)return"BG";const T=ei(N);return i.indexOf(T)!=-1?`IMG_NORM_PIXEL(${T}, POS_NORM)`:T},v=N=>{let T="";if(f.source){const R=f.uuid+"Index",I=f.uuid+"Rows";f.uuid+"";const w=`(1. / float(${I} ))`,S=`(${w} * float(${R}) )`;T+="texture2D(",T+=f.uuid+"Src",T+=`, (POS_NORM * vec2( ${w}, 1.0) + vec2(${S},0.0) ))`}else{let R=[_(y),a,"POS_NORM","POS_FRAG"];for(const[I,w]of Object.entries(f.schema.INPUTS)){const S=I==Zt.BL_AMT||I==Zt.BL_MODE;if(!w.ignore&&!S)if(w.gui=="OpSelect"){const M=e[f.uuid+I],A=_(M);R.push(A)}else R.push(f.uuid+I)}T+=f.name,f.schema.PASS&&(T+=f.uuid),T+="(",T+=R.join(","),T+=")"}return T};o+=`
/* ${p?"PASS":""} ${d?"CHANNEL	":""} ${f.name} ${f.uuid}  */
`,o+=`temp = ${v()};
`,o+=p?"gl_FragColor = ":f.uuid+" = ",o+="MAKE_PASS( ",o+=`${f.uuid}${Zt.BL_MODE}`,o+=`, ${h?_(h):BG}`,o+=", temp",o+=`, ${f.uuid}${Zt.BL_AMT})`,o+=`;
`,p&&(o+=`if ( PASSINDEX == ${a} ) { return; }
`,a+=1),l=u,d&&(s=u)}),o})()}]},Pu=n=>`



float CLAMP( float v, float min, float max ) {

    if (v > max) v = max;
    if (v < min) v = min;
    return v;
}


// wenn yu perfekt lieber Gott boese (Nam june Paik 1963)

#define COLOR_MAP(f, a, b) vec3(f(a.r, b.r), f(a.g, b.g), f(a.b, b.b))
#define PI 3.14159265358979323846264338327
#define HPI 1.5707963267948966

/*  EXPERIMENTAL CONVOLUTION

varying vec2 VTC_11;
varying vec2 VTC_00;
varying vec2 VTC_02;
varying vec2 VTC_20;
varying vec2 VTC_22;
*/


vec3 SRGB2LIN(vec3 c) { return c*c; }
vec3 LIN2SRGB(vec3 c) { return sqrt(c); }

//note: uniform pdf rand [0;1]

float HASH12N(vec2 p)
{
    p  = fract(p * vec2(5.3987, 5.4421));
    p += dot(p.yx, p.xy + vec2(21.5351, 14.3137));
    return fract(p.x * p.y * 95.4307);
}

vec2 PIXELATE( vec2 coord, vec2 size ) {
    return floor( coord / size ) * size;
}

float ADD(float a, float b) { return min(a + b, 1.0); }
float COLORBURN(float a, float b) { return (b == 0.0) ? b : max((1.0 - ((1.0 - a) / b)), 0.0); }
float DARKEN(float a, float b) { return min(b, a); }
float LIGHTEN(float a, float b) { return max(b, a); }
float PIN(float a, float b) { return (b < 0.5) ? DARKEN(a, (2.0 * b)) : LIGHTEN(a , (2.0 * (b - 0.5))); }
float COLORDODGE(float a, float b) { return (b == 1.0) ? b : min(a / (1.0 - b), 1.0); }
float REFLECT(float a, float b) { return (b == 1.0) ? b : min(a * a / (1.0 - b), 1.0); }
float VIVID(float a, float b) { return (b < 0.5) ? COLORBURN(a, (2.0 * b)) : COLORDODGE(a, (2.0 * (b - 0.5))); }
float HARD_MIX(float a, float b) { return (VIVID(a, b) < 0.5) ? 0.0 : 1.0; }
float OVERLAY(float a, float b) { return a < 0.5 ? (2.0 * a * b) : (1.0 - 2.0 * (1.0 - a) * (1.0 - b)); }
float DODGE(float a, float b) { return min(a + b, 1.0); }
float SCREEN(float a, float b) { return 1.0 - ((1.0 - a) * (1.0 - b)); }
float SOFT(float a, float b) { return (b < 0.5) ? (2.0 * a * b + a * a * (1.0 - 2.0 * b)) : (sqrt(a) * (2.0 * b - 1.0) + 2.0 * a * (1.0 - b)); }
float SUBTRACT(float a, float b) { return max(a + b - 1.0, 0.0); }
float LINEAR(float a, float b) { return b < 0.5 ? SUBTRACT(a, (2.0 * b)) : DODGE(a, (2.0 * (b - 0.5))); }

float SUM_RGBA( vec4 v ) {
    return v.r + v.g + v.b;
}

float SUM_RGB( vec3 v ) {
    return v.r + v.g + v.b;
}

float PHI = 1.61803398874989484820459;  // \u03A6 = Golden Ratio  


float HASH(float n) { return fract(sin(n) * 1e4); }
float HASH(vec2 p) { return fract(1e4 * sin(17.0 * p.x + p.y * 0.1) * (0.1 + abs(sin(p.y * 13.0 + p.x)))); }


vec3 GAMMA_CORRECT(vec3 color, float gamma){
    return pow(color, vec3(1.0/gamma));
}

vec3 LEVEL_RANGE(vec3 color, float minInput, float maxInput){
    return min(max(color - vec3(minInput), vec3(0.0)) / (vec3(maxInput) - vec3(minInput)), vec3(1.0));
}

vec3 LEVELS(vec3 color, float minInput, float gamma, float maxInput){
    return GAMMA_CORRECT(LEVEL_RANGE(color, minInput, maxInput), gamma);
}

float RANDOM(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

vec2 NORM_TO_VEC2( vec2 xy ) {

    xy.x = ( ( xy.x * 2.0 ) - 1.0 );
    xy.y = ( ( xy.y * 2.0 ) - 1.0 );
    return xy;
}
vec2 NORM_TO_VEC2( float x, float y ) {


    x = ( ( x * 2.0 ) - 1.0 );
    y = ( ( y * 2.0 ) - 1.0 );
    return vec2(x,y);
}

float BRIGHT( vec4 xyz ) {

    return (xyz.r + xyz.g + xyz.b)/3.0;
}

float MAP(float oldValue, float oldMin, float oldMax, float newMin, float newMax) {
    float oldRange = oldMax - oldMin;
    float newRange = newMax - newMin;

    float newVal = ((oldValue - oldMin) * newRange / oldRange) + newMin;
    return newVal;
}

float MAP(float oldValue, float oldMin, float oldMax, float newMin, float newMax, bool clamp) {
    float oldRange = oldMax - oldMin;
    float newRange = newMax - newMin;

    float newVal = ((oldValue - oldMin) * newRange / oldRange) + newMin;
    if (clamp) return CLAMP(newVal, min(newMin,newMax), max(newMin,newMax));
    return newVal;
}


float FMOD( float a, float b ) {
    return a - b * floor(a/b);
}


int WITHIN(float value, float low, float high) {
  bool a = value > low && value < high;
  bool b = value + 1.0 > low && value + 1.0 < high;
  bool c = value - 1.0 > low && value - 1.0 < high;
  if (a) return 1;
  if (b) return 2;
  if (c) return 3;
  return 0;
}


vec2 INTERSECTION(vec2 a,vec2 b,vec2 c,vec2 d) {
    float ua, ub, denom = (d.y - c.y)*(b.x - a.x) - (d.x - c.x)*(b.y - a.y);
    if (denom == 0.0) return vec2(-1.0,-1.0);
    ua = ((d.x - c.x)*(a.y - c.y) - (d.y - c.y)*(a.x - c.x))/denom;
    ub = ((b.x - a.x)*(a.y - c.y) - (b.y - a.y)*(a.x - c.x))/denom;
    return vec2(
        a.x + ua * (b.x - a.x),
        a.y + ua * (b.y - a.y)
    );
}
vec2 INTERLACE_VEC2(vec2 pointA, vec2 pointB, vec2 pointC, vec2 pointD) {

  float z1 = (pointA.x - pointB.x);
  float z2 = (pointC.x - pointD.x);
  float z3 = (pointA.y - pointB.y);
  float z4 = (pointC.y - pointD.y);
  float dist = z1 * z4 - z3 * z2;
  vec2 blank = vec2(-1.0,-1.0);
  if (dist == 0.0) {
    return blank;
  }
  float tempA = (pointA.x * pointB.y - pointA.y * pointB.x);
  float tempB = (pointC.x * pointD.y - pointC.y * pointD.x);
  float xCoor = (tempA * z2 - z1 * tempB) / dist;
  float yCoor = (tempA * z4 - z3 * tempB) / dist;

  return vec2(xCoor, yCoor);
}

vec2 ROTATE_VEC2(vec2 origin, vec2 point, float angle) {
  float rad = (PI / 180.0) * angle;
  float _cos = cos(rad);
  float _sin = sin(rad);
  float run = point.x - origin.x;
  float rise = point.y - origin.y;
  float cx = (_cos * run) + (_sin * rise) + origin.x;
  float cy = (_cos * rise) - (_sin * run) + origin.y;
  return vec2(
    cx,
    cy
  );
}


float ANGLE( vec2 a, vec2 b ) {
    return ((atan(b.y - a.y, b.x - a.x)  * 360.0 / PI) + 360.0) / 2.0;
}

vec2 VEC2_FROM_ANGLE(vec2 xy, float angle, float dist) {
    float x = cos(angle * PI / 180.0) * dist + xy.x;
    float y = sin(angle * PI / 180.0) * dist + xy.y;
    return vec2(x,y);
}


vec2 VEC2_POLAR( vec2 a, vec2 b, vec2 c) {

    float slope = (a.y - b.y) / (a.x - b.x);
    float m = -1.0 / slope;
    float x = (m * c.x - c.y - slope * a.x + a.y) / (m - slope);
    float y = m * x - m * c.x + c.y;
    return vec2(x,y);
}

float VEC2_POLAR_DIST(vec2 a, vec2 b, vec2 c) {

    return ((c.x - a.x)*(b.x - a.x) + (c.y - a.y)*(b.y - a.y)) /
    (pow(b.x - a.x, 2.0) + pow(b.y - a.y, 2.0));
}



vec3 CMYK_TO_RGB (vec4 cmyk) {
    float c = cmyk.x;
    float m = cmyk.y;
    float y = cmyk.z;
    float k = cmyk.w;

    float invK = 1.0 - k;
    float r = 1.0 - min(1.0, c * invK + k);
    float g = 1.0 - min(1.0, m * invK + k);
    float b = 1.0 - min(1.0, y * invK + k);
    return clamp(vec3(r, g, b), 0.0, 1.0);
}

vec4 RGB_TO_CMYK (vec3 rgb) {
    float r = rgb.r;
    float g = rgb.g;
    float b = rgb.b;
    float k = min(1.0 - r, min(1.0 - g, 1.0 - b));
    vec3 cmy = vec3(0.0);
    float invK = 1.0 - k;
    if (invK != 0.0) {
        cmy.x = (1.0 - r - k) / invK;
        cmy.y = (1.0 - g - k) / invK;
        cmy.z = (1.0 - b - k) / invK;
    }
    return clamp(vec4(cmy, k), 0.0, 1.0);
}

vec3 RGB_TO_HSL(vec3 color) {
    vec3 hsl; // init to 0 to avoid warnings ? (and reverse if + remove first part)

    float fmin = min(min(color.r, color.g), color.b); //Min. value of RGB
    float fmax = max(max(color.r, color.g), color.b); //Max. value of RGB
    float delta = fmax - fmin; //Delta RGB value

    hsl.z = (fmax + fmin) / 2.0; // Luminance

    if (delta == 0.0) //This is a gray, no chroma...
    {
        hsl.x = 0.0; // Hue
        hsl.y = 0.0; // Saturation
    } else //Chromatic data...
    {
        if (hsl.z < 0.5)
            hsl.y = delta / (fmax + fmin); // Saturation
        else
            hsl.y = delta / (2.0 - fmax - fmin); // Saturation

        float deltaR = (((fmax - color.r) / 6.0) + (delta / 2.0)) / delta;
        float deltaG = (((fmax - color.g) / 6.0) + (delta / 2.0)) / delta;
        float deltaB = (((fmax - color.b) / 6.0) + (delta / 2.0)) / delta;

        if (color.r == fmax)
            hsl.x = deltaB - deltaG; // Hue
        else if (color.g == fmax)
            hsl.x = (1.0 / 3.0) + deltaR - deltaB; // Hue
        else if (color.b == fmax)
            hsl.x = (2.0 / 3.0) + deltaG - deltaR; // Hue

        if (hsl.x < 0.0)
            hsl.x += 1.0; // Hue
        else if (hsl.x > 1.0)
            hsl.x -= 1.0; // Hue
    }

    return hsl;
}

float HUE_TO_RGB(float f1, float f2, float hue) {
    if (hue < 0.0)
        hue += 1.0;
    else if (hue > 1.0)
        hue -= 1.0;
    float res;
    if ((6.0 * hue) < 1.0)
        res = f1 + (f2 - f1) * 6.0 * hue;
    else if ((2.0 * hue) < 1.0)
        res = f2;
    else if ((3.0 * hue) < 2.0)
        res = f1 + (f2 - f1) * ((2.0 / 3.0) - hue) * 6.0;
    else
        res = f1;
    return res;
}

vec3 HSL_TO_RGB(vec3 hsl) {
    vec3 rgb;
    
    if (hsl.y == 0.0) {
        rgb = vec3(hsl.z); // Luminance
    } else {
        float f2;
        
        if (hsl.z < 0.5)
            f2 = hsl.z * (1.0 + hsl.y);
        else
            f2 = hsl.z + hsl.y - hsl.y * hsl.z;
            
        float f1 = 2.0 * hsl.z - f2;
        
        rgb.r = HUE_TO_RGB(f1, f2, hsl.x + (1.0/3.0));
        rgb.g = HUE_TO_RGB(f1, f2, hsl.x);
        rgb.b = HUE_TO_RGB(f1, f2, hsl.x - (1.0/3.0));
    }   
    return rgb;
}

vec3 HSL_TO_RGB(float h, float s, float l) {
    return HSL_TO_RGB(vec3(h, s, l));
}


vec3 RGB_SHIFT(vec3 color, float hue) {
    hue *= 6.28318530718;
    const vec3 k = vec3(0.57735, 0.57735, 0.57735);
    float cosAngle = cos(hue);
    return vec3(color * cosAngle + cross(k, color) * sin(hue) + k * dot(k, color) * (1.0 - cosAngle));
}

vec3 HSV_TO_RGB(vec3 c)
{
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}

vec3 RGB_TO_HSV(vec3 rgb) {
    float Cmax = max(rgb.r, max(rgb.g, rgb.b));
    float Cmin = min(rgb.r, min(rgb.g, rgb.b));
    float delta = Cmax - Cmin;

    vec3 hsv = vec3(0., 0., Cmax);

    if (Cmax > Cmin) {
        hsv.y = delta / Cmax;

        if (rgb.r == Cmax)
            hsv.x = (rgb.g - rgb.b) / delta;
        else {
            if (rgb.g == Cmax)
                hsv.x = 2. + (rgb.b - rgb.r) / delta;
            else
                hsv.x = 4. + (rgb.r - rgb.g) / delta;
        }
        hsv.x = fract(hsv.x / 6.);
    }
    return hsv;
}


vec3 GRID( float width, vec2 coord ) {
    float size = width * RENDERSIZE.x;
    vec3 a = HSL_TO_RGB( vec3(0.0,0.0,0.9) );
    vec3 b = HSL_TO_RGB( vec3(0.0,0.0,0.7) );

    if (size == 0.0)    {
        return a;
    } else if ((mod((coord.x / size),2.0) < 1.0)&&(mod((coord.y / size),2.0) > 1.0))  {
        return a;
    } else if ((mod((coord.x / size),2.0) > 1.0)&&(mod((coord.y / size),2.0) < 1.0))  {
        return a;
    }
    
    return b;

}

float SAW( float t ) {
    return 1.0-abs(2.*fract(t/PI)-1.);
}

float WAVE( float t, float shape, float amp, float exp ) {

    float sine = sin(t);
    float saw = SAW(t);
    return pow((mix(sine,saw,shape)*(1.+amp))-(amp/2.),exp);
}



`,ku=n=>{const e=ye(ue),i=ii(n.hide),t=[...hr().map(s=>({TARGET:s,WIDTH:"$WIDTH",HEIGHT:"$HEIGHT",PERSISTENT:!0})),{TARGET:"u999",WIDTH:"$WIDTH",HEIGHT:"$HEIGHT",PERSISTENT:!0}];let r=[],o=[{NAME:"inputImage",TYPE:"image"},{NAME:"Preview",TYPE:"bool",default:!1},{NAME:"PreviewSrc",TYPE:"long",default:-1}];Bn(s=>{let{x:f,y:u,name:c,uuid:p,schema:d,source:g}=s;for(const[y,h]of Object.entries(d.INPUTS)){const _=n.hide?i[p+y]:!1;if(!h.ignore&&!_){let v={...Ma(h),NAME:p+y,LABEL:ti(s,y),DEFAULT:e[p+y]||h.default};h.labels&&(v.VALUES=h.labels.map((b,E)=>E)),o.push(v)}}for(let y of o)y.GUI=="Teleport"&&(y.LABELS=[...t.map(h=>h.TARGET)],y.MAX=t.length);r.indexOf(c)==-1&&r.push(c),u+=1});const a=t.map(s=>s.TARGET);return{DESCRIPTION:"COMPILED: "+new Date().toLocaleString().toUpperCase().replaceAll(/[&\/\\#,+()$~%.'":*?<>{}]/g,"_"),CREDIT:"MX",PERSISTENT_BUFFERS:a,CATEGORIES:r,INPUTS:o,PASSES:t}},Cu=n=>{ye(ue);let e={},i;return Bn(t=>{let{x:r,y:o,name:a,schema:l,source:s,uuid:f}=t,u=a;if(l.PASS&&(a+=f),!e[a]){let c=rn[u].GLSL.split(`
`).map(d=>"	"+d).join(`
`);const p=i?i==null?void 0:i.uuid:"inputImage";c=c.replaceAll("TEXTURE",p),e[a]={type:ct.FUNC,name:a,prepend:"vec4",arguments:Sa(l.INPUTS),body:c}}i=t}),Object.values(e)},kt=(n,e)=>({name:e,type:n}),Du=n=>{const e=ye(ue),i=ii(n.hide),t={float:"float",image:"sampler2D",bool:"bool",event:"bool",long:"int",color:"vec4",point2D:"vec2"};let r=[];if(n.hide)for(const l of Rt()){const{schema:s,uuid:f}=l;for(const[u,c]of Object.entries(s.INPUTS))if(i[f+u]){const p=t[c.type],d=Oa(e[f+u]||c.default,p);r.push({type:ct.VAR,name:f+u,prepend:"const "+p,body:d})}}const o=hr();return[...Rt().filter(l=>o.indexOf(l.uuid)==-1).map(l=>({type:ct.VAR,name:l.uuid,prepend:"vec4"})),...r,{type:ct.VAR,name:"TOTAL_PASSES",prepend:"int",body:`${ka()}`},{type:ct.FUNC,name:"POSITION_FRAG",prepend:"vec2",body:"return gl_FragCoord.xy;"},{type:ct.FUNC,name:"POSITION_NORM",prepend:"vec2",body:`
				vec2 p = isf_FragNormCoord;
				// p *= 2.;
				// if (p.y < 0.5) p.y = p.y * 1.5;
				return p;`},{type:ct.FUNC,name:"CENTER",arguments:[],prepend:"vec2",body:"return vec2( 0.5, 0.5 ) * RENDERSIZE;"},{type:ct.FUNC,name:"BLEND",arguments:[kt("int","mode"),kt("vec3","a"),kt("vec3","b"),kt("float","amount")],prepend:"vec3",body:`vec3 color;
`+Cs.map((l,s)=>`${s==0?"if":"else if"} (mode == ${s}) { color = ${l}(a, b); }`).join(`
`)+`
return mix(a, color, amount);`},{type:ct.FUNC,name:"MAKE_PASS",arguments:[kt("int","blendMode"),kt("vec4","srcA"),kt("vec4","srcB"),kt("float","slider")],prepend:"vec4",body:`
			float amt = slider * srcB.a;
			float first = clamp( amt * 2.0, 0.0, 1.0);
			float second = clamp( (amt - 0.5) * 2.0, 0.0, 1.0);

			vec3 blend = BLEND( blendMode, srcA.rgb, srcB.rgb, first);
			// 0.5 - 1.0 = 0.0 - 1.0
			return vec4( mix( blend, srcB.rgb, second), 1.0);
			`}]},Lu=(n,e)=>console.log(`[Compiler] ${n}`,e||""),Fr={JSON_CONFIG:ku,HELPERS:Pu,BLEND_MODES:sr,UTILS:Du,OPS:Cu,BODY:Mu},Fu=n=>"	"+n.trim().split(`
`).map(e=>e.trim()).join(`
	`),ur=n=>{n||(n={}),n.keys||(n.keys=Object.keys(Fr)),Lu(`\u{1F4DA} parsing ${n.keys.join(" ")}`),ye(ue);let e="";for(const i of n.keys){const t=Fr[i](n);t||SAT(`\u274C no such section called ${i}`),Array.isArray(t)?e+=t.map(r=>{let o="";return o+=`
${r.prepend} ${r.name}`,r.type==ct.VAR&&r.body&&(o+=" = "),r.type==ct.FUNC?(o+="( ",o+=(r.arguments||[]).map(a=>`${a.type} ${a.name}`).join(", "),o+=`) {
`,o+=`${Fu(r.body||"")}`):o+=`${r.body||""};`,r.type==ct.FUNC&&(o+=`
}`),o}).join(`
`):typeof t=="string"?e+=t:e+=`/*
${JSON.stringify(t,null,2)}
*/`}return e+=Rn.START,e+=jr(),e+=Rn.END,e};function Pi(n,e,i){const t=n.slice();return t[6]=e[i],t[8]=i,t}function ki(n,e,i){const t=n.slice();return t[9]=e[i],t}function Ci(n){let e,i=n[9]+"",t,r,o,a;function l(...s){return n[3](n[9],...s)}return{c(){e=q("button"),t=de(i),r=re(),this.h()},l(s){e=z(s,"BUTTON",{});var f=W(e);t=pe(f,i),r=ie(f),f.forEach(k),this.h()},h(){Fe(e,"filled",n[0]==n[9])},m(s,f){oe(s,e,f),P(e,t),P(e,r),o||(a=ce(e,"mousedown",l),o=!0)},p(s,f){n=s,f&5&&Fe(e,"filled",n[0]==n[9])},d(s){s&&k(e),o=!1,a()}}}function Di(n){let e,i;return{c(){e=de(n[8]),i=q("br")},l(t){e=pe(t,n[8]),i=z(t,"BR",{})},m(t,r){oe(t,e,r),oe(t,i,r)},p:Pe,d(t){t&&k(e),t&&k(i)}}}function Uu(n){let e,i,t,r,o,a=n[1].trim()+"",l,s,f,u,c,p=["VERTEX","FRAGMENT","ISF",...n[2],"API"],d=[];for(let h=0;h<p.length;h+=1)d[h]=Ci(ki(n,p,h));let g=new Array(n[1].split(`
`).length),y=[];for(let h=0;h<g.length;h+=1)y[h]=Di(Pi(n,g,h));return{c(){e=q("div"),i=q("nav");for(let h=0;h<d.length;h+=1)d[h].c();t=re(),r=q("div"),o=q("pre"),l=de(a),s=de(`
			`),f=q("pre");for(let h=0;h<y.length;h+=1)y[h].c();u=de(`
			`),c=de(`
		`),this.h()},l(h){e=z(h,"DIV",{class:!0});var _=W(e);i=z(_,"NAV",{class:!0});var v=W(i);for(let T=0;T<d.length;T+=1)d[T].l(v);v.forEach(k),t=ie(_),r=z(_,"DIV",{class:!0});var b=W(r);o=z(b,"PRE",{class:!0});var E=W(o);l=pe(E,a),s=pe(E,`
			`),f=z(E,"PRE",{class:!0,style:!0});var N=W(f);for(let T=0;T<y.length;T+=1)y[T].l(N);u=pe(N,`
			`),N.forEach(k),c=pe(E,`
		`),E.forEach(k),b.forEach(k),_.forEach(k),this.h()},h(){D(i,"class","flex column br"),D(f,"class","abs l0 t0 mt1 plr0-5 fade"),ke(f,"user-select","none",1),D(o,"class","monospace whitespace-prewrap p1 pl3 grow filled overflow-auto f2 rel"),D(r,"class","overflow-auto h100pc"),D(e,"class","row flex")},m(h,_){oe(h,e,_),P(e,i);for(let v=0;v<d.length;v+=1)d[v].m(i,null);P(e,t),P(e,r),P(r,o),P(o,l),P(o,s),P(o,f);for(let v=0;v<y.length;v+=1)y[v].m(f,null);P(f,u),P(o,c)},p(h,[_]){if(_&5){p=["VERTEX","FRAGMENT","ISF",...h[2],"API"];let v;for(v=0;v<p.length;v+=1){const b=ki(h,p,v);d[v]?d[v].p(b,_):(d[v]=Ci(b),d[v].c(),d[v].m(i,null))}for(;v<d.length;v+=1)d[v].d(1);d.length=p.length}if(_&2&&a!==(a=h[1].trim()+"")&&Me(l,a),_&2){g=new Array(h[1].split(`
`).length);let v;for(v=0;v<g.length;v+=1){const b=Pi(h,g,v);y[v]?y[v].p(b,_):(y[v]=Di(b),y[v].c(),y[v].m(f,u))}for(;v<y.length;v+=1)y[v].d(1);y.length=g.length}},i:Pe,o:Pe,d(h){h&&k(e),Xe(d,h),Xe(y,h)}}}function Bu(n,e,i){const t=window;let r="JSON_CONFIG",o="";const a=Object.keys(Fr),l=(s,f)=>i(0,r=s);return n.$$.update=()=>{n.$$.dirty&1&&(s=>{var f,u,c,p;s=="API"?i(1,o=Object.keys(Oi).map(d=>{const g=Oi[d];return console.log(Lr(g)),`${d}( ${Lr(g).join(", ")} )`}).join(`
`)):s=="FRAGMENT"?i(1,o=((u=(f=t==null?void 0:t.renderer)==null?void 0:f.parser)==null?void 0:u.fragmentShader)||(window==null?void 0:window.shaderSrc)||"// None"):s=="VERTEX"?i(1,o=((p=(c=t==null?void 0:t.renderer)==null?void 0:c.parser)==null?void 0:p.vertexShader)||"// None"):s=="ISF"?i(1,o=ur({hide:!0})):a.indexOf(s)!=-1&&i(1,o=ur({keys:[s],hide:!0}))})(r)},[r,o,a,l]}class ju extends Ce{constructor(e){super(),De(this,e,Bu,Uu,Le,{})}}var zt=function(n,e,i){return n<64?e:i},Ut=function(n,e,i){return n===0?e:n===127?i:null},Vu=function(n,e){switch(n){case 0:return"bankselect";case 1:return"modulation";case 2:return"breathcontroller";case 4:return"footcontroller";case 5:return"portamentotime";case 6:return"dataentry";case 7:return"volume";case 8:return"balance";case 10:return"pan";case 11:return"expressioncontroller";case 12:return"effect1";case 13:return"effect2";case 16:return"generalpurposecontroller1";case 17:return"generalpurposecontroller2";case 18:return"generalpurposecontroller3";case 19:return"generalpurposecontroller4";case 32:return"bankselectfine";case 33:return"modulationfine";case 34:return"breathcontrollerfine";case 36:return"footcontrollerfine";case 37:return"portamentotimefine";case 38:return"dataentryfine";case 39:return"volumefine";case 40:return"balancefine";case 42:return"panfine";case 43:return"expressioncontrollerfine";case 44:return"effect1fine";case 45:return"effect2fine";case 48:return"generalpurposecontroller1fine";case 49:return"generalpurposecontroller2fine";case 50:return"generalpurposecontroller3fine";case 51:return"generalpurposecontroller4fine";case 64:return zt(e,"sustainoff","sustainon");case 65:return zt(e,"portamentooff","portamentoon");case 66:return zt(e,"sostenutooff","sostenutoon");case 67:return zt(e,"softoff","softon");case 68:return zt(e,"legatooff","legatoon");case 69:return zt(e,"hold2off","hold2on");case 70:return"soundcontroller1";case 71:return"soundcontroller2";case 72:return"soundcontroller3";case 73:return"soundcontroller4";case 74:return"soundcontroller5";case 75:return"soundcontroller6";case 76:return"soundcontroller7";case 77:return"soundcontroller8";case 78:return"soundcontroller9";case 79:return"soundcontroller10";case 80:return"generalpurposecontroller5";case 81:return"generalpurposecontroller6";case 82:return"generalpurposecontroller7";case 83:return"generalpurposecontroller8";case 84:return"portamentocontrol";case 91:return"effectdepth1";case 92:return"effectdepth2";case 93:return"effectdepth3";case 94:return"effectdepth4";case 95:return"effectdepth5";case 96:return"dataincrement";case 97:return"datadecrement";case 98:return"nonregisteredparameternumberfine";case 99:return"nonregisteredparameternumber";case 100:return"registeredparameternumberfine";case 101:return"registeredparameternumber"}return null},Gu=function(n,e){switch(n){case 120:return Ut(e,"allsoundoff",null);case 121:return Ut(e,"resetallcontrollers",null);case 122:return Ut(e,"localcontroloff","localcontrolon");case 123:return Ut(e,"allnotesoff",null);case 124:return Ut(e,"omnimodeoff",null);case 125:return Ut(e,"omnimodeon",null);case 126:return"monomodeon";case 127:return Ut(e,"polymodeon",null)}return null},Hu=Math.pow(2,7),zn=Math.pow(Hu,2)/2;function Ca(n){var e=n[0],i=n[1],t=n[2],r={messageCode:240&e,channel:1+(15&e)};switch(r.messageCode){case 128:return Object.assign({},r,{messageType:"noteoff",key:i,velocity:t});case 144:return Object.assign({},r,{messageType:t===0?"noteoff":"noteon",key:i,velocity:t});case 160:return Object.assign({},r,{messageType:"keypressure",key:i,pressure:t});case 176:return i<120?Object.assign({},r,{messageType:"controlchange",controlNumber:i,controlFunction:Vu(i,t),controlValue:t}):Object.assign({},r,{messageType:"channelmodechange",controlNumber:i,channelModeMessage:Gu(i,t),controlValue:t});case 192:return Object.assign({},r,{messageType:"programchange",program:i});case 208:return Object.assign({},r,{messageType:"channelpressure",pressure:i});case 224:var o=(t<<7)+i;return Object.assign({},r,{messageType:"pitchbendchange",pitchBend:o,pitchBendMultiplier:(o-zn)/(o<=zn?zn:zn-1)});default:return Object.assign({},r,{messageType:"unknown",data1:i,data2:t})}}const fr=(n,e)=>console.log(`[MIDI] \u{1F39B} ${n}`,e||""),en={CC:"controlchange",NOTE:"note",NOTEON:"noteon",NOTEOFF:"noteoff"};let Pn={},Ur={};const qu=.92;function Da(){const n=ye(bt);for(const[e,i]of Object.entries(n))for(const t of i)if(Ur[t]!=null){let r=qu;Pn[t]=Pn[t]*r+Ur[t]*(1-r),La(e,Pn[t])}window.requestAnimationFrame(Da)}function zu(n){const{manufacturer:e,name:i}=n.target,t=Ca(n.data),{messageCode:r,controlFunction:o,messageType:a,controlNumber:l,controlValue:s,channel:f,key:u,velocity:c}=t;return en.CC==a?[e,i,f,a,l].join(":"):en.NOTEON==a||en.NOTEOFF==a?[e,i,f,en.NOTE,u].join(":"):null}function La(n,e){const i=n.split(":"),t=i[0],r=parseInt(i[1]),o=ye(kr),a=o==null?void 0:o[t];if(!a)return fr(`\u274C no lookup for ${t}`);const{min:l,max:s,type:f}=a;let u=ye(ue);a.type=="float"?u[t]=nr(e,0,127,l,s):a.type=="point2D"||a.type=="color"?(u[t],u[t][r]=nr(e,0,127,l[r],s[r])):a.type=="long"?u[t]=nr(e,0,127,0,a.labels.length):a.type=="bool"&&(u[t]=!u[t]),ue.set(u)}function Xu(n){const e=ye(Qt);let i=ye(bt);const t=zu(n);e&&(i[e]||(i[e]=[]),i[e].indexOf(t)!=-1?alert("this assignment already exists."):(fr(`adding assignment ${t} to ${e}`),i[e]=[...i[e],t]),bt.set(i),Qt.set(!1),Kt.set(!1));for(const[r,o]of Object.entries(i))if(o.indexOf(t)!=-1){const a=Ca(n.data),{messageCode:l,controlFunction:s,messageType:f,controlNumber:u,controlValue:c,channel:p,key:d,velocity:g}=a;en.CC==f?(Pn[t]||(Pn[t]=c),Ur[t]=c):en.NOTEON==f&&La(r,g)}}async function Wu(){const n=await navigator.requestMIDIAccess();fr("requesting MIDI devices");for(const[e,i]of n.inputs)i.onmidimessage=Xu,fr(`\u2705 attached ${i.manufacturer} ${i.name}`);window.requestAnimationFrame(Da)}function Li(n,e,i){const t=n.slice();return t[3]=e[i][0],t[4]=e[i][1],t}function Fi(n){let e,i,t=n[3]+"",r,o,a,l=n[4]+"",s,f,u,c,p,d;function g(...y){return n[2](n[3],...y)}return{c(){e=q("div"),i=q("div"),r=de(t),o=re(),a=q("div"),s=de(l),f=re(),u=q("button"),c=re(),this.h()},l(y){e=z(y,"DIV",{class:!0});var h=W(e);i=z(h,"DIV",{class:!0});var _=W(i);r=pe(_,t),_.forEach(k),o=ie(h),a=z(h,"DIV",{class:!0});var v=W(a);s=pe(v,l),v.forEach(k),f=ie(h),u=z(h,"BUTTON",{class:!0});var b=W(u);b.forEach(k),c=ie(h),h.forEach(k),this.h()},h(){D(i,"class","bold"),D(a,"class",""),D(u,"class","cross h2em"),D(e,"class","flex row-space-between-center")},m(y,h){oe(y,e,h),P(e,i),P(i,r),P(e,o),P(e,a),P(a,s),P(e,f),P(e,u),P(e,c),p||(d=ce(u,"click",g),p=!0)},p(y,h){n=y,h&1&&t!==(t=n[3]+"")&&Me(r,t),h&1&&l!==(l=n[4]+"")&&Me(s,l)},d(y){y&&k(e),p=!1,d()}}}function Yu(n){let e,i=Object.entries(n[0]),t=[];for(let r=0;r<i.length;r+=1)t[r]=Fi(Li(n,i,r));return{c(){e=q("div");for(let r=0;r<t.length;r+=1)t[r].c();this.h()},l(r){e=z(r,"DIV",{id:!0,class:!0});var o=W(e);for(let a=0;a<t.length;a+=1)t[a].l(o);o.forEach(k),this.h()},h(){D(e,"id","assignments"),D(e,"class","flex column-stretch-flex-start p1")},m(r,o){oe(r,e,o);for(let a=0;a<t.length;a+=1)t[a].m(e,null)},p(r,[o]){if(o&3){i=Object.entries(r[0]);let a;for(a=0;a<i.length;a+=1){const l=Li(r,i,a);t[a]?t[a].p(l,o):(t[a]=Fi(l),t[a].c(),t[a].m(e,null))}for(;a<t.length;a+=1)t[a].d(1);t.length=i.length}},i:Pe,o:Pe,d(r){r&&k(e),Xe(t,r)}}}function Ju(n,e,i){let t;he(n,bt,a=>i(0,t=a)),an(async a=>{await Wu()});function r(a){delete t[a],bt.set(t)}return[t,r,(a,l)=>r(a)]}class Ku extends Ce{constructor(e){super(),De(this,e,Ju,Yu,Le,{})}}function Ui(n,e,i){const t=n.slice();return t[12]=e[i][0],t[13]=e[i][1],t}function Bi(n,e,i){const t=n.slice();return t[12]=e[i][0],t[13]=e[i][1],t}function ji(n,e,i){const t=n.slice();return t[12]=e[i],t}function Vi(n){let e,i=n[12].split(":")[0]+"",t,r;return{c(){e=q("div"),t=de(i),r=re(),this.h()},l(o){e=z(o,"DIV",{style:!0,class:!0});var a=W(e);t=pe(a,i),r=ie(a),a.forEach(k),this.h()},h(){ke(e,"background","var(--blue5-0)"),D(e,"class","bt p0-5 bold grow w100pc h40px flex row-flex-start-center")},m(o,a){oe(o,e,a),P(e,t),P(e,r)},p(o,a){a&1&&i!==(i=o[12].split(":")[0]+"")&&Me(t,i)},d(o){o&&k(e)}}}function Gi(n){let e,i=n[13].name+"",t,r,o,a;function l(...s){return n[8](n[12],...s)}return{c(){e=q("button"),t=de(i),r=re(),this.h()},l(s){e=z(s,"BUTTON",{class:!0});var f=W(e);t=pe(f,i),r=ie(f),f.forEach(k),this.h()},h(){D(e,"class","grow"),Fe(e,"filled",n[1]==n[12])},m(s,f){oe(s,e,f),P(e,t),P(e,r),o||(a=ce(e,"click",l),o=!0)},p(s,f){n=s,f&10&&Fe(e,"filled",n[1]==n[12])},d(s){s&&k(e),o=!1,a()}}}function Hi(n){let e,i,t,r;var o=n[13].view;function a(l){return{}}return o&&(i=new o(a())),{c(){e=q("section"),i&&Ne(i.$$.fragment),t=re(),this.h()},l(l){e=z(l,"SECTION",{id:!0,class:!0});var s=W(e);i&&Te(i.$$.fragment,s),t=ie(s),s.forEach(k),this.h()},h(){D(e,"id",n[12]),D(e,"class","flex column grow"),Fe(e,"none",n[12]!=n[1])},m(l,s){oe(l,e,s),i&&Se(i,e,null),P(e,t),r=!0},p(l,s){if(o!==(o=l[13].view)){if(i){rt();const f=i;le(f.$$.fragment,1,0,()=>{xe(f,1)}),it()}o?(i=new o(a()),Ne(i.$$.fragment),te(i.$$.fragment,1),Se(i,e,t)):i=null}(!r||s&10)&&Fe(e,"none",l[12]!=l[1])},i(l){r||(i&&te(i.$$.fragment,l),r=!0)},o(l){i&&le(i.$$.fragment,l),r=!1},d(l){l&&k(e),i&&xe(i)}}}function Zu(n){let e,i,t,r,o,a,l,s,f,u=n[0],c=[];for(let v=0;v<u.length;v+=1)c[v]=Vi(ji(n,u,v));let p={};t=new la({props:p}),n[7](t);let d=Object.entries(n[3]),g=[];for(let v=0;v<d.length;v+=1)g[v]=Gi(Bi(n,d,v));let y=Object.entries(n[3]),h=[];for(let v=0;v<y.length;v+=1)h[v]=Hi(Ui(n,y,v));const _=v=>le(h[v],1,1,()=>{h[v]=null});return{c(){e=q("div");for(let v=0;v<c.length;v+=1)c[v].c();i=re(),Ne(t.$$.fragment),r=re(),o=q("div"),a=q("nav");for(let v=0;v<g.length;v+=1)g[v].c();l=re(),s=q("article");for(let v=0;v<h.length;v+=1)h[v].c();this.h()},l(v){e=z(v,"DIV",{id:!0,style:!0,class:!0});var b=W(e);for(let R=0;R<c.length;R+=1)c[R].l(b);b.forEach(k),i=ie(v),Te(t.$$.fragment,v),r=ie(v),o=z(v,"DIV",{id:!0,class:!0});var E=W(o);a=z(E,"NAV",{style:!0,class:!0});var N=W(a);for(let R=0;R<g.length;R+=1)g[R].l(N);N.forEach(k),l=ie(E),s=z(E,"ARTICLE",{class:!0});var T=W(s);for(let R=0;R<h.length;R+=1)h[R].l(T);T.forEach(k),E.forEach(k),this.h()},h(){D(e,"id","drag-visualiser"),ke(e,"bottom","-100%"),D(e,"class","pop w80px fixed b0 l0 bl bb br flex column-center-center z-index66"),Fe(e,"none",!n[0]),ke(a,"background","var(--blue5-0)"),D(a,"class","flex bb fixed t0 l0 w100pc z-index44 none"),D(s,"class","flex column grow overflow-hidden h100vh w100vw"),D(o,"id","app"),D(o,"class","app mxz dark flex row-stretch-stretch")},m(v,b){oe(v,e,b);for(let E=0;E<c.length;E+=1)c[E].m(e,null);oe(v,i,b),Se(t,v,b),oe(v,r,b),oe(v,o,b),P(o,a);for(let E=0;E<g.length;E+=1)g[E].m(a,null);P(o,l),P(o,s);for(let E=0;E<h.length;E+=1)h[E].m(s,null);f=!0},p(v,[b]){if(b&1){u=v[0];let N;for(N=0;N<u.length;N+=1){const T=ji(v,u,N);c[N]?c[N].p(T,b):(c[N]=Vi(T),c[N].c(),c[N].m(e,null))}for(;N<c.length;N+=1)c[N].d(1);c.length=u.length}(!f||b&1)&&Fe(e,"none",!v[0]);const E={};if(t.$set(E),b&10){d=Object.entries(v[3]);let N;for(N=0;N<d.length;N+=1){const T=Bi(v,d,N);g[N]?g[N].p(T,b):(g[N]=Gi(T),g[N].c(),g[N].m(a,null))}for(;N<g.length;N+=1)g[N].d(1);g.length=d.length}if(b&10){y=Object.entries(v[3]);let N;for(N=0;N<y.length;N+=1){const T=Ui(v,y,N);h[N]?(h[N].p(T,b),te(h[N],1)):(h[N]=Hi(T),h[N].c(),te(h[N],1),h[N].m(s,null))}for(rt(),N=y.length;N<h.length;N+=1)_(N);it()}},i(v){if(!f){te(t.$$.fragment,v);for(let b=0;b<y.length;b+=1)te(h[b]);f=!0}},o(v){le(t.$$.fragment,v),h=h.filter(Boolean);for(let b=0;b<h.length;b+=1)le(h[b]);f=!1},d(v){v&&k(e),Xe(c,v),v&&k(i),n[7](null),xe(t,v),v&&k(r),v&&k(o),Xe(g,v),Xe(h,v)}}}function Qu(n,e,i){let t,r,o,a;he(n,tn,y=>i(1,t=y)),he(n,nt,y=>i(6,r=y)),he(n,Mn,y=>i(9,o=y)),he(n,Dn,y=>i(10,a=y));const l=(y,h)=>console.log(`[App] ${y}`,h||"");let{application:s}=e,f=[],u=!1,c;an(async y=>{l(`getting current view ${t}`),i(5,u=!0),c.addBindings([{command:["Tab"],action:h=>{}},{command:[Bt,"f"],action:h=>{ge(Mn,o=!o,o),h.preventDefault()}},{command:[Bt,"d"],action:h=>{console.log("CAPTURING IMAGE"),window.captureImage(),h.preventDefault(),h.stopPropagation()}},{command:[Ms],action:h=>{o&&ge(Mn,o=!1,o),h.preventDefault()}},...Object.values(qt).map((h,_)=>({command:[Bt,_+1+""],action:v=>{ge(tn,t=Object.values(qt)[_],t),v.preventDefault()}})),{command:["Backspace"],action:h=>{var _,v,b,E;r&&(l("\u{1F6A9} deleting",r),((_=r==null?void 0:r[0])==null?void 0:_[0])!=null&&((v=r==null?void 0:r[0])==null?void 0:v[1])!=null&&(ri(lt.BIN,(b=r==null?void 0:r[0])==null?void 0:b[0],(E=r==null?void 0:r[0])==null?void 0:E[1]),Qr(),window.requestAnimationFrame(N=>{yt.set(Tt.COMPILE)})))}}])});const p={[qt.APPLICATION]:{name:"Application",view:s},[qt.ASSIGNMENTS]:{name:"Assignments",view:Ku},[qt.DEBUG_SHADER]:{name:"Shader (Debug)",view:ju},[qt.DEBUG_SYSTEM]:{name:"System (Debug)",view:Ru}};function d(y){$e[y?"unshift":"push"](()=>{c=y,i(2,c)})}const g=(y,h)=>tn.set(y);return n.$$set=y=>{"application"in y&&i(4,s=y.application)},n.$$.update=()=>{n.$$.dirty&65&&(y=>{i(0,f=ni()),ge(Dn,a=f==null?void 0:f[f.length-1],a)})(),n.$$.dirty&34&&(y=>{u&&(l(`setting view to ${t}`),window.localStorage.setItem("__CURRENT_VIEW",t))})()},[f,t,c,p,s,u,r,d,g]}class $u extends Ce{constructor(e){super(),De(this,e,Qu,Zu,Le,{application:4})}}function ef(n){let e=n.split(":");return e[2]=parseInt(e[2]),e[4]=parseInt(e[4]),e}async function tf(){const n={echNm2:"Launch Control XL-Launch Control XL",echo:!0,src:"/MIDI/ch. 9/note [41]",tog:!0,wantsEnbl:!0},e={echNm2:"Launch Control XL-Launch Control XL",endM:5,echo:!0,src:"/MIDI/ch. 9/ctrl [77]",tog:!0,wantsEnbl:!0};let t={...{VVGridSize:"{-1, -1}",classArray:[],keyArray:[],uiBuilder:{}}};const r=ye(bt);let o=Object.keys(r);o=o.sort((l,s)=>(l=ir(l),s=ir(s),l.x-s.x||l.y-s.y)),console.log("HEY!");for(const l of o){const s=r[l];for(const f of s){const u=ef(f),c=`${u[1]-u[1]}`,p=ir(l),d=ti(p,l.substring(4));u[3]=="note"?(t.classArray.push("Button"),t.keyArray.push(d),t.uiBuilder[d]={...n,rcvrs:[{...n}]},t.uiBuilder[d].rcvrs[0].echNm2=c,t.uiBuilder[d].rcvrs[0].src=`/MIDI/ch. ${u[2]}/note [${u[4]}]`):u[3]=="controlchange"&&(t.classArray.push("Slider"),t.keyArray.push(d),t.uiBuilder[d]={...e,rcvrs:[{...e}]},t.uiBuilder[d].rcvrs[0].echNm2=c,t.uiBuilder[d].rcvrs[0].src=`/MIDI/ch. ${u[2]}/ctrl [${u[4]}]`)}}return JSON.stringify(t,null,"	")}function qi(n,e,i){const t=n.slice();return t[10]=e[i][0],t[11]=e[i][1],t}function zi(n){let e,i=n[10]+"",t,r,o,a;return{c(){e=q("button"),t=de(i),r=re(),this.h()},l(l){e=z(l,"BUTTON",{class:!0});var s=W(e);t=pe(s,i),r=ie(s),s.forEach(k),this.h()},h(){D(e,"class","br plr1 grow f0 ptb0-5")},m(l,s){oe(l,e,s),P(e,t),P(e,r),o||(a=ce(e,"mousedown",n[11]),o=!0)},p(l,s){n=l},d(l){l&&k(e),o=!1,a()}}}function nf(n){let e,i=Object.entries(n[0]),t=[];for(let r=0;r<i.length;r+=1)t[r]=zi(qi(n,i,r));return{c(){for(let r=0;r<t.length;r+=1)t[r].c();e=Ve()},l(r){for(let o=0;o<t.length;o+=1)t[o].l(r);e=Ve()},m(r,o){for(let a=0;a<t.length;a+=1)t[a].m(r,o);oe(r,e,o)},p(r,[o]){if(o&1){i=Object.entries(r[0]);let a;for(a=0;a<i.length;a+=1){const l=qi(r,i,a);t[a]?t[a].p(l,o):(t[a]=zi(l),t[a].c(),t[a].m(e.parentNode,e))}for(;a<t.length;a+=1)t[a].d(1);t.length=i.length}},i:Pe,o:Pe,d(r){Xe(t,r),r&&k(e)}}}const wr="MXZ";function rf(n,e,i){const t=window,r=(d,g)=>console.log(`[FileSave] ${d}`,g||"");function o(){const d=jr();t.localStorage.setItem(wr,d),r("\u{1F4BE} saved",JSON.parse(d))}function a(){t.confirm("Clear?")&&t.localStorage.removeItem(wr)}function l(){r("loading from local storage"),vi(t.localStorage.getItem(wr))}function s(){const d=document.createElement("a");d.setAttribute("href",`data:application/plain;charset=utf-8,${encodeURIComponent(ur({hide:!0,isf:!0}))}`),d.setAttribute("download","__MXZ.fs"),d.click()}async function f(){const d={types:[{description:"Shaders",accept:{"text/*":[".fs",".glsl"]}}],excludeAcceptAllOption:!0,multiple:!1},[g]=await window.showOpenFilePicker(d);try{const y=await(await g.getFile()).text(),h=y.indexOf(Rn.START),_=y.indexOf(Rn.END),v=y.substring(h+Rn.START.length,_);vi(v)}catch(y){alert(`Could not open project: ${y.message}`)}}async function u(){t.confirm("Clear?")&&bt.set({})}async function c(){console.log("save assignments");const d=document.createElement("a"),g=await tf();d.setAttribute("href",`data:application/plain;charset=utf-8,${encodeURIComponent(g)}`),d.setAttribute("download","__MXZ_Controls.json"),d.click()}return an(l),[{"L: Load":l,"L: Save":o,"L: Clear":a,"P: Open":f,"P: Save":s,"M: Clear":u,"M: Save":c},o,a,l,s,f,u,c]}class of extends Ce{constructor(e){super(),De(this,e,rf,nf,Le,{saveLocally:1,clearLocally:2,loadLocally:3,saveProject:4,openProject:5,clearAssignments:6,saveAssignments:7})}get saveLocally(){return this.$$.ctx[1]}get clearLocally(){return this.$$.ctx[2]}get loadLocally(){return this.$$.ctx[3]}get saveProject(){return this.$$.ctx[4]}get openProject(){return this.$$.ctx[5]}get clearAssignments(){return this.$$.ctx[6]}get saveAssignments(){return this.$$.ctx[7]}}var Fa={exports:{}},Ua={};Number.isFinite=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)};Number.isNaN=Number.isNaN||function(n){return n!==n};var ot={},oi=function(e){return e&&e.constructor.prototype.isBigNumber||!1};(function(n){function e(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?e=function(o){return typeof o}:e=function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},e(t)}var i=oi;n.clone=function t(r){var o=e(r);if(o==="number"||o==="string"||o==="boolean"||r===null||r===void 0)return r;if(typeof r.clone=="function")return r.clone();if(Array.isArray(r))return r.map(function(a){return t(a)});if(r instanceof Date)return new Date(r.valueOf());if(i(r))return r;if(r instanceof RegExp)throw new TypeError("Cannot clone "+r);return n.map(r,t)},n.map=function(t,r){var o={};for(var a in t)n.hasOwnProperty(t,a)&&(o[a]=r(t[a]));return o},n.extend=function(t,r){for(var o in r)n.hasOwnProperty(r,o)&&(t[o]=r[o]);return t},n.deepExtend=function t(r,o){if(Array.isArray(o))throw new TypeError("Arrays are not supported by deepExtend");for(var a in o)if(n.hasOwnProperty(o,a))if(o[a]&&o[a].constructor===Object)r[a]===void 0&&(r[a]={}),r[a].constructor===Object?t(r[a],o[a]):r[a]=o[a];else{if(Array.isArray(o[a]))throw new TypeError("Arrays are not supported by deepExtend");r[a]=o[a]}return r},n.deepEqual=function(r,o){var a,l,s;if(Array.isArray(r)){if(!Array.isArray(o)||r.length!==o.length)return!1;for(l=0,s=r.length;l<s;l++)if(!n.deepEqual(r[l],o[l]))return!1;return!0}else if(r instanceof Object){if(Array.isArray(o)||!(o instanceof Object))return!1;for(a in r)if(!n.deepEqual(r[a],o[a]))return!1;for(a in o)if(!n.deepEqual(r[a],o[a]))return!1;return!0}else return r===o},n.canDefineProperty=function(){try{if(Object.defineProperty)return Object.defineProperty({},"x",{get:function(){}}),!0}catch{}return!1},n.lazy=function(t,r,o){if(n.canDefineProperty()){var a=!0,l;Object.defineProperty(t,r,{get:function(){return a&&(l=o(),a=!1),l},set:function(f){l=f,a=!1},configurable:!0,enumerable:!0})}else t[r]=o()},n.traverse=function(t,r){var o=t;if(r)for(var a=r.split("."),l=0;l<a.length;l++){var s=a[l];s in o||(o[s]={}),o=o[s]}return o},n.hasOwnProperty=function(t,r){return t&&Object.hasOwnProperty.call(t,r)},n.isFactory=function(t){return t&&typeof t.factory=="function"}})(ot);var Ba={},ja={exports:{}};(function(n,e){(function(i,t){n.exports=t()})(ws,function(){function i(){return!0}function t(){return!1}function r(){}function o(){var a=[{name:"number",test:function(O){return typeof O=="number"}},{name:"string",test:function(O){return typeof O=="string"}},{name:"boolean",test:function(O){return typeof O=="boolean"}},{name:"Function",test:function(O){return typeof O=="function"}},{name:"Array",test:Array.isArray},{name:"Date",test:function(O){return O instanceof Date}},{name:"RegExp",test:function(O){return O instanceof RegExp}},{name:"Object",test:function(O){return typeof O=="object"&&O.constructor===Object}},{name:"null",test:function(O){return O===null}},{name:"undefined",test:function(O){return O===void 0}}],l={name:"any",test:i},s=[],f=[],u={types:a,conversions:f,ignore:s};function c(O){var L=Z(u.types,function(C){return C.name===O});if(L)return L;if(O==="any")return l;var B=Z(u.types,function(C){return C.name.toLowerCase()===O.toLowerCase()});throw new TypeError('Unknown type "'+O+'"'+(B?'. Did you mean "'+B.name+'"?':""))}function p(O){return O===l?999:u.types.indexOf(O)}function d(O){var L=Z(u.types,function(B){return B.test(O)});if(L)return L.name;throw new TypeError("Value has unknown type. Value: "+O)}function g(O,L){if(!O.signatures)throw new TypeError("Function is no typed-function");var B;if(typeof L=="string"){B=L.split(",");for(var C=0;C<B.length;C++)B[C]=B[C].trim()}else if(Array.isArray(L))B=L;else throw new TypeError("String array or a comma separated string expected");var $=B.join(","),ne=O.signatures[$];if(ne)return ne;throw new TypeError("Signature not found (signature: "+(O.name||"unnamed")+"("+B.join(", ")+"))")}function y(O,L){var B=d(O);if(L===B)return O;for(var C=0;C<u.conversions.length;C++){var $=u.conversions[C];if($.from===B&&$.to===L)return $.convert(O)}throw new Error("Cannot convert from "+B+" to "+L)}function h(O){return O.map(function(L){var B=L.types.map(w);return(L.restParam?"...":"")+B.join("|")}).join(",")}function _(O,L){var B=O.indexOf("...")===0,C=B?O.length>3?O.slice(3):"any":O,$=C.split("|").map(ve).filter(Ae).filter(X),ne=ae(L,$),fe=$.map(function(H){var me=c(H);return{name:H,typeIndex:p(me),test:me.test,conversion:null,conversionIndex:-1}}),se=ne.map(function(H){var me=c(H.from);return{name:H.from,typeIndex:p(me),test:me.test,conversion:H,conversionIndex:L.indexOf(H)}});return{types:fe.concat(se),restParam:B}}function v(O,L,B){var C=[];return O.trim()!==""&&(C=O.split(",").map(ve).map(function($,ne,fe){var se=_($,B);if(se.restParam&&ne!==fe.length-1)throw new SyntaxError('Unexpected rest parameter "'+$+'": only allowed for the last parameter');return se})),C.some(Re)?null:{params:C,fn:L}}function b(O){var L=dt(O);return L?L.restParam:!1}function E(O){return O.types.some(function(L){return L.conversion!=null})}function N(O){if(!O||O.types.length===0)return i;if(O.types.length===1)return c(O.types[0].name).test;if(O.types.length===2){var L=c(O.types[0].name).test,B=c(O.types[1].name).test;return function(ne){return L(ne)||B(ne)}}else{var C=O.types.map(function($){return c($.name).test});return function(ne){for(var fe=0;fe<C.length;fe++)if(C[fe](ne))return!0;return!1}}}function T(O){var L,B,C;if(b(O)){L=Pt(O).map(N);var $=L.length,ne=N(dt(O)),fe=function(se){for(var H=$;H<se.length;H++)if(!ne(se[H]))return!1;return!0};return function(H){for(var me=0;me<L.length;me++)if(!L[me](H[me]))return!1;return fe(H)&&H.length>=$+1}}else return O.length===0?function(H){return H.length===0}:O.length===1?(B=N(O[0]),function(H){return B(H[0])&&H.length===1}):O.length===2?(B=N(O[0]),C=N(O[1]),function(H){return B(H[0])&&C(H[1])&&H.length===2}):(L=O.map(N),function(H){for(var me=0;me<L.length;me++)if(!L[me](H[me]))return!1;return H.length===L.length})}function R(O,L){return L<O.params.length?O.params[L]:b(O.params)?dt(O.params):null}function I(O,L,B){var C=R(O,L),$=C?B?C.types.filter(S):C.types:[];return $.map(w)}function w(O){return O.name}function S(O){return O.conversion===null||O.conversion===void 0}function M(O,L){var B=He(je(O,function(C){return I(C,L,!1)}));return B.indexOf("any")!==-1?["any"]:B}function A(O,L,B){var C,$,ne=O||"unnamed",fe=B,se;for(se=0;se<L.length;se++){var H=fe.filter(function(ut){var hn=N(R(ut,se));return(se<ut.params.length||b(ut.params))&&hn(L[se])});if(H.length===0){if($=M(fe,se),$.length>0){var me=d(L[se]);return C=new TypeError("Unexpected type of argument in function "+ne+" (expected: "+$.join(" or ")+", actual: "+me+", index: "+se+")"),C.data={category:"wrongType",fn:ne,index:se,actual:me,expected:$},C}}else fe=H}var Je=fe.map(function(ut){return b(ut.params)?1/0:ut.params.length});if(L.length<Math.min.apply(null,Je))return $=M(fe,se),C=new TypeError("Too few arguments in function "+ne+" (expected: "+$.join(" or ")+", index: "+L.length+")"),C.data={category:"tooFewArgs",fn:ne,index:L.length,expected:$},C;var et=Math.max.apply(null,Je);return L.length>et?(C=new TypeError("Too many arguments in function "+ne+" (expected: "+et+", actual: "+L.length+")"),C.data={category:"tooManyArgs",fn:ne,index:L.length,expectedLength:et},C):(C=new TypeError('Arguments of type "'+L.join(", ")+'" do not match any of the defined signatures of function '+ne+"."),C.data={category:"mismatch",actual:L.map(d)},C)}function F(O){for(var L=999,B=0;B<O.types.length;B++)S(O.types[B])&&(L=Math.min(L,O.types[B].typeIndex));return L}function V(O){for(var L=999,B=0;B<O.types.length;B++)S(O.types[B])||(L=Math.min(L,O.types[B].conversionIndex));return L}function ee(O,L){var B;return B=O.restParam-L.restParam,B!==0||(B=E(O)-E(L),B!==0)||(B=F(O)-F(L),B!==0)?B:V(O)-V(L)}function G(O,L){var B=Math.min(O.params.length,L.params.length),C,$;if($=O.params.some(E)-L.params.some(E),$!==0)return $;for(C=0;C<B;C++)if($=E(O.params[C])-E(L.params[C]),$!==0)return $;for(C=0;C<B;C++)if($=ee(O.params[C],L.params[C]),$!==0)return $;return O.params.length-L.params.length}function ae(O,L){var B={};return O.forEach(function(C){L.indexOf(C.from)===-1&&L.indexOf(C.to)!==-1&&!B[C.from]&&(B[C.from]=C)}),Object.keys(B).map(function(C){return B[C]})}function we(O,L){var B=L;if(O.some(E)){var C=b(O),$=O.map(_e);B=function(){for(var H=[],me=C?arguments.length-1:arguments.length,Je=0;Je<me;Je++)H[Je]=$[Je](arguments[Je]);return C&&(H[me]=arguments[me].map($[me])),L.apply(null,H)}}var ne=B;if(b(O)){var fe=O.length-1;ne=function(){return B.apply(null,Ge(arguments,0,fe).concat([Ge(arguments,fe)]))}}return ne}function _e(O){var L,B,C,$,ne=[],fe=[];switch(O.types.forEach(function(se){se.conversion&&(ne.push(c(se.conversion.from).test),fe.push(se.conversion.convert))}),fe.length){case 0:return function(H){return H};case 1:return L=ne[0],C=fe[0],function(H){return L(H)?C(H):H};case 2:return L=ne[0],B=ne[1],C=fe[0],$=fe[1],function(H){return L(H)?C(H):B(H)?$(H):H};default:return function(H){for(var me=0;me<fe.length;me++)if(ne[me](H))return fe[me](H);return H}}}function J(O){var L={};return O.forEach(function(B){B.params.some(E)||Q(B.params,!0).forEach(function(C){L[h(C)]=B.fn})}),L}function Q(O,L){function B(C,$,ne){if($<C.length){var fe=C[$],se=L?fe.types.filter(S):fe.types,H;if(fe.restParam){var me=se.filter(S);H=me.length<se.length?[me,se]:[se]}else H=se.map(function(et){return[et]});return je(H,function(et){return B(C,$+1,ne.concat([et]))})}else{var Je=ne.map(function(et,ut){return{types:et,restParam:ut===C.length-1&&b(C)}});return[Je]}}return B(O,0,[])}function Ie(O,L){for(var B=Math.max(O.params.length,L.params.length),C=0;C<B;C++){var $=I(O,C,!0),ne=I(L,C,!0);if(!K($,ne))return!1}var fe=O.params.length,se=L.params.length,H=b(O.params),me=b(L.params);return H?me?fe===se:se>=fe:me?fe>=se:fe===se}function Ee(O,L){if(Object.keys(L).length===0)throw new SyntaxError("No signatures provided");var B=[];Object.keys(L).map(function(Ze){return v(Ze,L[Ze],u.conversions)}).filter(Ke).forEach(function(Ze){var tt=Z(B,function(St){return Ie(St,Ze)});if(tt)throw new TypeError('Conflicting signatures "'+h(tt.params)+'" and "'+h(Ze.params)+'".');B.push(Ze)});var C=je(B,function(Ze){var tt=Ze?Q(Ze.params,!1):[];return tt.map(function(St){return{params:St,fn:Ze.fn}})}).filter(Ke);C.sort(G);var $=C[0]&&C[0].params.length<=2&&!b(C[0].params),ne=C[1]&&C[1].params.length<=2&&!b(C[1].params),fe=C[2]&&C[2].params.length<=2&&!b(C[2].params),se=C[3]&&C[3].params.length<=2&&!b(C[3].params),H=C[4]&&C[4].params.length<=2&&!b(C[4].params),me=C[5]&&C[5].params.length<=2&&!b(C[5].params),Je=$&&ne&&fe&&se&&H&&me,et=C.map(function(Ze){return T(Ze.params)}),ut=$?N(C[0].params[0]):t,hn=ne?N(C[1].params[0]):t,Gn=fe?N(C[2].params[0]):t,pr=se?N(C[3].params[0]):t,mr=H?N(C[4].params[0]):t,gr=me?N(C[5].params[0]):t,vr=$?N(C[0].params[1]):t,Hn=ne?N(C[1].params[1]):t,Ue=fe?N(C[2].params[1]):t,qn=se?N(C[3].params[1]):t,m=H?N(C[4].params[1]):t,x=me?N(C[5].params[1]):t,U=C.map(function(Ze){return we(Ze.params,Ze.fn)}),Y=$?U[0]:r,be=ne?U[1]:r,Oe=fe?U[2]:r,xt=se?U[3]:r,yr=H?U[4]:r,es=me?U[5]:r,ts=$?C[0].params.length:-1,ns=ne?C[1].params.length:-1,rs=fe?C[2].params.length:-1,is=se?C[3].params.length:-1,os=H?C[4].params.length:-1,as=me?C[5].params.length:-1,ss=Je?6:0,ls=C.length,us=function(){for(var tt=ss;tt<ls;tt++)if(et[tt](arguments))return U[tt].apply(null,arguments);throw A(O,arguments,C)},_r=function(tt,St){return arguments.length===ts&&ut(tt)&&vr(St)?Y.apply(null,arguments):arguments.length===ns&&hn(tt)&&Hn(St)?be.apply(null,arguments):arguments.length===rs&&Gn(tt)&&Ue(St)?Oe.apply(null,arguments):arguments.length===is&&pr(tt)&&qn(St)?xt.apply(null,arguments):arguments.length===os&&mr(tt)&&m(St)?yr.apply(null,arguments):arguments.length===as&&gr(tt)&&x(St)?es.apply(null,arguments):us.apply(null,arguments)};try{Object.defineProperty(_r,"name",{value:O})}catch{}return _r.signatures=J(C),_r}function X(O){return u.ignore.indexOf(O)===-1}function ve(O){return O.trim()}function Ae(O){return!!O}function Ke(O){return O!==null}function Re(O){return O.types.length===0}function Pt(O){return O.slice(0,O.length-1)}function dt(O){return O[O.length-1]}function Ge(O,L,B){return Array.prototype.slice.call(O,L,B)}function j(O,L){return O.indexOf(L)!==-1}function K(O,L){for(var B=0;B<O.length;B++)if(j(L,O[B]))return!0;return!1}function Z(O,L){for(var B=0;B<O.length;B++)if(L(O[B]))return O[B]}function He(O){for(var L={},B=0;B<O.length;B++)L[O[B]]=!0;return Object.keys(L)}function je(O,L){return Array.prototype.concat.apply([],O.map(L))}function qe(O){for(var L="",B=0;B<O.length;B++){var C=O[B];if((typeof C.signatures=="object"||typeof C.signature=="string")&&C.name!==""){if(L==="")L=C.name;else if(L!==C.name){var $=new Error("Function names do not match (expected: "+L+", actual: "+C.name+")");throw $.data={actual:C.name,expected:L},$}}}return L}function ze(O){var L,B={};function C(se,H){if(B.hasOwnProperty(se)&&H!==B[se])throw L=new Error('Signature "'+se+'" is defined twice'),L.data={signature:se},L}for(var $=0;$<O.length;$++){var ne=O[$];if(typeof ne.signatures=="object")for(var fe in ne.signatures)ne.signatures.hasOwnProperty(fe)&&(C(fe,ne.signatures[fe]),B[fe]=ne.signatures[fe]);else if(typeof ne.signature=="string")C(ne.signature,ne),B[ne.signature]=ne;else throw L=new TypeError("Function is no typed-function (index: "+$+")"),L.data={index:$},L}return B}return u=Ee("typed",{"string, Object":Ee,Object:function(O){var L=[];for(var B in O)O.hasOwnProperty(B)&&L.push(O[B]);var C=qe(L);return Ee(C,O)},"...Function":function(O){return Ee(qe(O),ze(O))},"string, ...Function":function(O,L){return Ee(O,ze(L))}}),u.create=o,u.types=a,u.conversions=f,u.ignore=s,u.convert=y,u.find=g,u.addType=function(O,L){if(!O||typeof O.name!="string"||typeof O.test!="function")throw new TypeError("Object with properties {name: string, test: function} expected");if(L!==!1){for(var B=0;B<u.types.length;B++)if(u.types[B].name==="Object"){u.types.splice(B,0,O);return}}u.types.push(O)},u.addConversion=function(O){if(!O||typeof O.from!="string"||typeof O.to!="string"||typeof O.convert!="function")throw new TypeError("Object with properties {from: string, to: string, convert: function} expected");u.conversions.push(O)},u}return o()})})(ja);var jn={};(function(n){var e=ot;n.isNumber=function(t){return typeof t=="number"},n.isInteger=function(t){return typeof t=="boolean"?!0:isFinite(t)?t===Math.round(t):!1},n.sign=Math.sign||function(t){return t>0?1:t<0?-1:0},n.format=function(t,r){if(typeof r=="function")return r(t);if(t===1/0)return"Infinity";if(t===-1/0)return"-Infinity";if(isNaN(t))return"NaN";var o="auto",a;switch(r&&(r.notation&&(o=r.notation),n.isNumber(r)?a=r:n.isNumber(r.precision)&&(a=r.precision)),o){case"fixed":return n.toFixed(t,a);case"exponential":return n.toExponential(t,a);case"engineering":return n.toEngineering(t,a);case"auto":if(r&&r.exponential&&(r.exponential.lower!==void 0||r.exponential.upper!==void 0)){var l=e.map(r,function(s){return s});return l.exponential=void 0,r.exponential.lower!==void 0&&(l.lowerExp=Math.round(Math.log(r.exponential.lower)/Math.LN10)),r.exponential.upper!==void 0&&(l.upperExp=Math.round(Math.log(r.exponential.upper)/Math.LN10)),console.warn("Deprecation warning: Formatting options exponential.lower and exponential.upper (minimum and maximum value) are replaced with exponential.lowerExp and exponential.upperExp (minimum and maximum exponent) since version 4.0.0. Replace "+JSON.stringify(r)+" with "+JSON.stringify(l)),n.toPrecision(t,a,l)}return n.toPrecision(t,a,r&&r).replace(/((\.\d*?)(0+))($|e)/,function(){var s=arguments[2],f=arguments[4];return s!=="."?s+f:f});default:throw new Error('Unknown notation "'+o+'". Choose "auto", "exponential", or "fixed".')}},n.splitNumber=function(t){var r=String(t).toLowerCase().match(/^0*?(-?)(\d+\.?\d*)(e([+-]?\d+))?$/);if(!r)throw new SyntaxError("Invalid number "+t);var o=r[1],a=r[2],l=parseFloat(r[4]||"0"),s=a.indexOf(".");l+=s!==-1?s-1:a.length-1;var f=a.replace(".","").replace(/^0*/,function(u){return l-=u.length,""}).replace(/0*$/,"").split("").map(function(u){return parseInt(u)});return f.length===0&&(f.push(0),l++),{sign:o,coefficients:f,exponent:l}},n.toEngineering=function(t,r){if(isNaN(t)||!isFinite(t))return String(t);var o=n.roundDigits(n.splitNumber(t),r),a=o.exponent,l=o.coefficients,s=a%3===0?a:a<0?a-3-a%3:a-a%3;if(n.isNumber(r))for(;r>l.length||a-s+1>l.length;)l.push(0);else for(var f=a>=0?a:Math.abs(s);l.length-1<f;)l.push(0);for(var u=Math.abs(a-s),c=1;u>0;)c++,u--;var p=l.slice(c).join(""),d=n.isNumber(r)&&p.length||p.match(/[1-9]/)?"."+p:"",g=l.slice(0,c).join("")+d+"e"+(a>=0?"+":"")+s.toString();return o.sign+g},n.toFixed=function(t,r){if(isNaN(t)||!isFinite(t))return String(t);var o=n.splitNumber(t),a=typeof r=="number"?n.roundDigits(o,o.exponent+1+r):o,l=a.coefficients,s=a.exponent+1,f=s+(r||0);return l.length<f&&(l=l.concat(i(f-l.length))),s<0&&(l=i(-s+1).concat(l),s=1),s<l.length&&l.splice(s,0,s===0?"0.":"."),a.sign+l.join("")},n.toExponential=function(t,r){if(isNaN(t)||!isFinite(t))return String(t);var o=n.splitNumber(t),a=r?n.roundDigits(o,r):o,l=a.coefficients,s=a.exponent;l.length<r&&(l=l.concat(i(r-l.length)));var f=l.shift();return a.sign+f+(l.length>0?"."+l.join(""):"")+"e"+(s>=0?"+":"")+s},n.toPrecision=function(t,r,o){if(isNaN(t)||!isFinite(t))return String(t);var a=o&&o.lowerExp!==void 0?o.lowerExp:-3,l=o&&o.upperExp!==void 0?o.upperExp:5,s=n.splitNumber(t);if(s.exponent<a||s.exponent>=l)return n.toExponential(t,r);var f=r?n.roundDigits(s,r):s,u=f.coefficients,c=f.exponent;u.length<r&&(u=u.concat(i(r-u.length))),u=u.concat(i(c-u.length+1+(u.length<r?r-u.length:0))),u=i(-c).concat(u);var p=c>0?c:0;return p<u.length-1&&u.splice(p+1,0,"."),f.sign+u.join("")},n.roundDigits=function(t,r){for(var o={sign:t.sign,coefficients:t.coefficients,exponent:t.exponent},a=o.coefficients;r<=0;)a.unshift(0),o.exponent++,r++;if(a.length>r){var l=a.splice(r,a.length-r);if(l[0]>=5){var s=r-1;for(a[s]++;a[s]===10;)a.pop(),s===0&&(a.unshift(0),o.exponent++,s++),s--,a[s]++}}return o};function i(t){for(var r=[],o=0;o<t;o++)r.push(0);return r}n.digits=function(t){return t.toExponential().replace(/e.*$/,"").replace(/^0\.?0*|\./,"").length},n.DBL_EPSILON=Number.EPSILON||2220446049250313e-31,n.nearlyEqual=function(t,r,o){if(o==null)return t===r;if(t===r)return!0;if(isNaN(t)||isNaN(r))return!1;if(isFinite(t)&&isFinite(r)){var a=Math.abs(t-r);return a<n.DBL_EPSILON?!0:a<=Math.max(Math.abs(t),Math.abs(r))*o}return!1}})(jn);var af=function(e){return e&&e.constructor.prototype.isMatrix||!1};function or(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?or=function(i){return typeof i}:or=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},or(n)}var Xi=ja.exports,sf=jn.digits,lf=oi,uf=af,Va=function(){return Va=Xi.create,Xi};Ba.create=function(e){e.isNumber=function(t){return typeof t=="number"},e.isComplex=function(t){return e.Complex&&t instanceof e.Complex||!1},e.isBigNumber=lf,e.isFraction=function(t){return e.Fraction&&t instanceof e.Fraction||!1},e.isUnit=function(t){return t&&t.constructor.prototype.isUnit||!1},e.isString=function(t){return typeof t=="string"},e.isArray=Array.isArray,e.isMatrix=uf,e.isDenseMatrix=function(t){return t&&t.isDenseMatrix&&t.constructor.prototype.isMatrix||!1},e.isSparseMatrix=function(t){return t&&t.isSparseMatrix&&t.constructor.prototype.isMatrix||!1},e.isRange=function(t){return t&&t.constructor.prototype.isRange||!1},e.isIndex=function(t){return t&&t.constructor.prototype.isIndex||!1},e.isBoolean=function(t){return typeof t=="boolean"},e.isResultSet=function(t){return t&&t.constructor.prototype.isResultSet||!1},e.isHelp=function(t){return t&&t.constructor.prototype.isHelp||!1},e.isFunction=function(t){return typeof t=="function"},e.isDate=function(t){return t instanceof Date},e.isRegExp=function(t){return t instanceof RegExp},e.isObject=function(t){return or(t)==="object"&&t.constructor===Object&&!e.isComplex(t)&&!e.isFraction(t)},e.isNull=function(t){return t===null},e.isUndefined=function(t){return t===void 0},e.isAccessorNode=function(t){return t&&t.isAccessorNode&&t.constructor.prototype.isNode||!1},e.isArrayNode=function(t){return t&&t.isArrayNode&&t.constructor.prototype.isNode||!1},e.isAssignmentNode=function(t){return t&&t.isAssignmentNode&&t.constructor.prototype.isNode||!1},e.isBlockNode=function(t){return t&&t.isBlockNode&&t.constructor.prototype.isNode||!1},e.isConditionalNode=function(t){return t&&t.isConditionalNode&&t.constructor.prototype.isNode||!1},e.isConstantNode=function(t){return t&&t.isConstantNode&&t.constructor.prototype.isNode||!1},e.isFunctionAssignmentNode=function(t){return t&&t.isFunctionAssignmentNode&&t.constructor.prototype.isNode||!1},e.isFunctionNode=function(t){return t&&t.isFunctionNode&&t.constructor.prototype.isNode||!1},e.isIndexNode=function(t){return t&&t.isIndexNode&&t.constructor.prototype.isNode||!1},e.isNode=function(t){return t&&t.isNode&&t.constructor.prototype.isNode||!1},e.isObjectNode=function(t){return t&&t.isObjectNode&&t.constructor.prototype.isNode||!1},e.isOperatorNode=function(t){return t&&t.isOperatorNode&&t.constructor.prototype.isNode||!1},e.isParenthesisNode=function(t){return t&&t.isParenthesisNode&&t.constructor.prototype.isNode||!1},e.isRangeNode=function(t){return t&&t.isRangeNode&&t.constructor.prototype.isNode||!1},e.isSymbolNode=function(t){return t&&t.isSymbolNode&&t.constructor.prototype.isNode||!1},e.isChain=function(t){return t&&t.constructor.prototype.isChain||!1};var i=Va();return i.types=[{name:"number",test:e.isNumber},{name:"Complex",test:e.isComplex},{name:"BigNumber",test:e.isBigNumber},{name:"Fraction",test:e.isFraction},{name:"Unit",test:e.isUnit},{name:"string",test:e.isString},{name:"Array",test:e.isArray},{name:"Matrix",test:e.isMatrix},{name:"DenseMatrix",test:e.isDenseMatrix},{name:"SparseMatrix",test:e.isSparseMatrix},{name:"Range",test:e.isRange},{name:"Index",test:e.isIndex},{name:"boolean",test:e.isBoolean},{name:"ResultSet",test:e.isResultSet},{name:"Help",test:e.isHelp},{name:"function",test:e.isFunction},{name:"Date",test:e.isDate},{name:"RegExp",test:e.isRegExp},{name:"null",test:e.isNull},{name:"undefined",test:e.isUndefined},{name:"OperatorNode",test:e.isOperatorNode},{name:"ConstantNode",test:e.isConstantNode},{name:"SymbolNode",test:e.isSymbolNode},{name:"ParenthesisNode",test:e.isParenthesisNode},{name:"FunctionNode",test:e.isFunctionNode},{name:"FunctionAssignmentNode",test:e.isFunctionAssignmentNode},{name:"ArrayNode",test:e.isArrayNode},{name:"AssignmentNode",test:e.isAssignmentNode},{name:"BlockNode",test:e.isBlockNode},{name:"ConditionalNode",test:e.isConditionalNode},{name:"IndexNode",test:e.isIndexNode},{name:"RangeNode",test:e.isRangeNode},{name:"Node",test:e.isNode},{name:"Object",test:e.isObject}],i.conversions=[{from:"number",to:"BigNumber",convert:function(r){if(sf(r)>15)throw new TypeError("Cannot implicitly convert a number with >15 significant digits to BigNumber (value: "+r+"). Use function bignumber(x) to convert to BigNumber.");return new e.BigNumber(r)}},{from:"number",to:"Complex",convert:function(r){return new e.Complex(r,0)}},{from:"number",to:"string",convert:function(r){return r+""}},{from:"BigNumber",to:"Complex",convert:function(r){return new e.Complex(r.toNumber(),0)}},{from:"Fraction",to:"BigNumber",convert:function(r){throw new TypeError("Cannot implicitly convert a Fraction to BigNumber or vice versa. Use function bignumber(x) to convert to BigNumber or fraction(x) to convert to Fraction.")}},{from:"Fraction",to:"Complex",convert:function(r){return new e.Complex(r.valueOf(),0)}},{from:"number",to:"Fraction",convert:function(r){var o=new e.Fraction(r);if(o.valueOf()!==r)throw new TypeError("Cannot implicitly convert a number to a Fraction when there will be a loss of precision (value: "+r+"). Use function fraction(x) to convert to Fraction.");return new e.Fraction(r)}},{from:"string",to:"number",convert:function(r){var o=Number(r);if(isNaN(o))throw new Error('Cannot convert "'+r+'" to a number');return o}},{from:"string",to:"BigNumber",convert:function(r){try{return new e.BigNumber(r)}catch{throw new Error('Cannot convert "'+r+'" to BigNumber')}}},{from:"string",to:"Fraction",convert:function(r){try{return new e.Fraction(r)}catch{throw new Error('Cannot convert "'+r+'" to Fraction')}}},{from:"string",to:"Complex",convert:function(r){try{return new e.Complex(r)}catch{throw new Error('Cannot convert "'+r+'" to Complex')}}},{from:"boolean",to:"number",convert:function(r){return+r}},{from:"boolean",to:"BigNumber",convert:function(r){return new e.BigNumber(+r)}},{from:"boolean",to:"Fraction",convert:function(r){return new e.Fraction(+r)}},{from:"boolean",to:"string",convert:function(r){return+r}},{from:"Array",to:"Matrix",convert:function(r){return new e.DenseMatrix(r)}},{from:"Matrix",to:"Array",convert:function(r){return r.valueOf()}}],i};var Ga={},ai={exports:{}};function si(){}si.prototype={on:function(n,e,i){var t=this.e||(this.e={});return(t[n]||(t[n]=[])).push({fn:e,ctx:i}),this},once:function(n,e,i){var t=this;function r(){t.off(n,r),e.apply(i,arguments)}return r._=e,this.on(n,r,i)},emit:function(n){var e=[].slice.call(arguments,1),i=((this.e||(this.e={}))[n]||[]).slice(),t=0,r=i.length;for(t;t<r;t++)i[t].fn.apply(i[t].ctx,e);return this},off:function(n,e){var i=this.e||(this.e={}),t=i[n],r=[];if(t&&e)for(var o=0,a=t.length;o<a;o++)t[o].fn!==e&&t[o].fn._!==e&&r.push(t[o]);return r.length?i[n]=r:delete i[n],this}};ai.exports=si;ai.exports.TinyEmitter=si;var ff=ai.exports;Ga.mixin=function(n){var e=new ff;return n.on=e.on.bind(e),n.off=e.off.bind(e),n.once=e.once.bind(e),n.emit=e.emit.bind(e),n};var Vn={};function sn(n,e,i,t){if(!(this instanceof sn))throw new SyntaxError("Constructor must be called with the new operator");this.fn=n,this.count=e,this.min=i,this.max=t,this.message="Wrong number of arguments in function "+n+" ("+e+" provided, "+i+(t!=null?"-"+t:"")+" expected)",this.stack=new Error().stack}sn.prototype=new Error;sn.prototype.constructor=Error;sn.prototype.name="ArgumentsError";sn.prototype.isArgumentsError=!0;var Ha=sn;function kn(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?kn=function(i){return typeof i}:kn=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},kn(n)}var Wi=ot.lazy,Yi=ot.isFactory,cf=ot.traverse,hf=Ha;function df(n,e,i,t,r){function o(h,_){var v=arguments.length;if(v!==1&&v!==2)throw new hf("import",v,1,2);if(_||(_={}),Yi(h))u(h,_);else if(Array.isArray(h))h.forEach(function(N){o(N,_)});else if(kn(h)==="object"){for(var b in h)if(h.hasOwnProperty(b)){var E=h[b];c(E)?a(b,E,_):Yi(h)?u(h,_):o(E,_)}}else if(!_.silent)throw new TypeError("Factory, Object, or Array expected")}function a(h,_,v){if(v.wrap&&typeof _=="function"&&(_=f(_)),p(r[h])&&p(_)){v.override?_=t(h,_.signatures):_=t(r[h],_),r[h]=_,l(h,_),r.emit("import",h,function(){return _});return}if(r[h]===void 0||v.override){r[h]=_,l(h,_),r.emit("import",h,function(){return _});return}if(!v.silent)throw new Error('Cannot import "'+h+'": already exists')}function l(h,_){_&&typeof _.transform=="function"?(r.expression.transform[h]=_.transform,d(h)&&(r.expression.mathWithTransform[h]=_.transform)):(delete r.expression.transform[h],d(h)&&(r.expression.mathWithTransform[h]=_))}function s(h){delete r.expression.transform[h],d(h)?r.expression.mathWithTransform[h]=r[h]:delete r.expression.mathWithTransform[h]}function f(h){var _=function(){for(var b=[],E=0,N=arguments.length;E<N;E++){var T=arguments[E];b[E]=T&&T.valueOf()}return h.apply(r,b)};return h.transform&&(_.transform=h.transform),_}function u(h,_){if(typeof h.name=="string"){var v=h.name,b=v in r.expression.transform,E=h.path?cf(r,h.path):r,N=E.hasOwnProperty(v)?E[v]:void 0,T=function(){var I=i(h);if(I&&typeof I.transform=="function")throw new Error('Transforms cannot be attached to factory functions. Please create a separate function for it with exports.path="expression.transform"');if(p(N)&&p(I))return _.override||(I=t(N,I)),I;if(N===void 0||_.override)return I;if(!_.silent)throw new Error('Cannot import "'+v+'": already exists')};h.lazy!==!1?(Wi(E,v,T),b?s(v):(h.path==="expression.transform"||g(h))&&Wi(r.expression.mathWithTransform,v,T)):(E[v]=T(),b?s(v):(h.path==="expression.transform"||g(h))&&(r.expression.mathWithTransform[v]=T())),r.emit("import",v,T,h.path)}else i(h)}function c(h){return typeof h=="function"||typeof h=="number"||typeof h=="string"||typeof h=="boolean"||h===null||h&&n.isUnit(h)||h&&n.isComplex(h)||h&&n.isBigNumber(h)||h&&n.isFraction(h)||h&&n.isMatrix(h)||h&&Array.isArray(h)}function p(h){return typeof h=="function"&&kn(h.signatures)==="object"}function d(h){return!y.hasOwnProperty(h)}function g(h){return h.path===void 0&&!y.hasOwnProperty(h.name)}var y={expression:!0,type:!0,docs:!0,error:!0,json:!0,chain:!0};return o}Vn.math=!0;Vn.name="import";Vn.factory=df;Vn.lazy=!0;var dr={},It=ot;function pf(n,e,i,t,r){var o=["Matrix","Array"],a=["number","BigNumber","Fraction"];function l(s){if(s){var f=It.map(e,It.clone);Ji(s,"matrix",o),Ji(s,"number",a),It.deepExtend(e,s);var u=It.map(e,It.clone),c=It.map(s,It.clone);return r.emit("config",u,f,c),u}else return It.map(e,It.clone)}return l.MATRIX=o,l.NUMBER=a,l}function mf(n,e){return n.indexOf(e)!==-1}function gf(n,e){return n.map(function(i){return i.toLowerCase()}).indexOf(e.toLowerCase())}function Ji(n,e,i){if(n[e]!==void 0&&!mf(i,n[e])){var t=gf(i,n[e]);t!==-1?(console.warn('Warning: Wrong casing for configuration option "'+e+'", should be "'+i[t]+'" instead of "'+n[e]+'".'),n[e]=i[t]):console.warn('Warning: Unknown value "'+n[e]+'" for configuration option "'+e+'". Available options: '+i.map(JSON.stringify).join(", ")+".")}}dr.name="config";dr.math=!0;dr.factory=pf;var vf=ot.isFactory,yf=Ba,_f=Ga,bf=Vn,wf=dr;Ua.create=function(e){if(typeof Object.create!="function")throw new Error("ES5 not supported by this JavaScript engine. Please load the es5-shim and es5-sham library for compatibility.");var i=[],t=[],r=_f.mixin({});r.type={},r.expression={transform:{},mathWithTransform:{}},r.typed=yf.create(r.type);var o={epsilon:1e-12,matrix:"Matrix",number:"number",precision:64,predictable:!1,randomSeed:null};function a(l){if(!vf(l))throw new Error("Factory object with properties `type`, `name`, and `factory` expected");var s=i.indexOf(l),f;return s===-1?(l.math===!0?f=l.factory(r.type,o,a,r.typed,r):f=l.factory(r.type,o,a,r.typed),i.push(l),t.push(f)):f=t[s],f}return r.import=a(bf),r.config=a(wf),r.expression.mathWithTransform.config=r.config,e&&r.config(e),r};(function(n){n.exports=Ua})(Fa);var Xn={},dn={},Er,Ki;function ln(){return Ki||(Ki=1,Er=function n(e,i,t){return e&&typeof e.map=="function"?e.map(function(r){return n(r,i)}):i(e)}),Er}var pn={},Wn={},Zi;function li(){if(Zi)return Wn;Zi=1;function n(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?n=function(r){return typeof r}:n=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},n(i)}function e(i,t,r,o){var a=o("_typeof",{any:function(s){var f=n(s);return f==="object"?s===null?"null":Array.isArray(s)?"Array":s instanceof Date?"Date":s instanceof RegExp?"RegExp":i.isBigNumber(s)?"BigNumber":i.isComplex(s)?"Complex":i.isFraction(s)?"Fraction":i.isMatrix(s)?"Matrix":i.isUnit(s)?"Unit":i.isIndex(s)?"Index":i.isRange(s)?"Range":i.isResultSet(s)?"ResultSet":i.isNode(s)?s.type:i.isChain(s)?"Chain":i.isHelp(s)?"Help":"Object":f==="function"?"Function":f}});return a.toTex=void 0,a}return Wn.name="typeof",Wn.factory=e,Wn}var Yn={},Qi;function Ef(){if(Qi)return Yn;Qi=1;var n=ln();function e(i,t,r,o){var a=o("number",{"":function(){return 0},number:function(s){return s},string:function(s){if(s==="NaN")return NaN;var f=Number(s);if(isNaN(f))throw new SyntaxError('String "'+s+'" is no valid number');return f},BigNumber:function(s){return s.toNumber()},Fraction:function(s){return s.valueOf()},Unit:function(s){throw new Error("Second argument with valueless unit expected")},null:function(s){return 0},"Unit, string | Unit":function(s,f){return s.toNumber(f)},"Array | Matrix":function(s){return n(s,a)}});return a.toTex={0:"0",1:"\\left(${args[0]}\\right)",2:"\\left(\\left(${args[0]}\\right)${args[1]}\\right)"},a}return Yn.name="number",Yn.factory=e,Yn}var Jn={},$i;function Nf(){if($i)return Jn;$i=1;var n=ln();function e(i,t,r,o){var a=o("bignumber",{"":function(){return new i.BigNumber(0)},number:function(s){return new i.BigNumber(s+"")},string:function(s){return new i.BigNumber(s)},BigNumber:function(s){return s},Fraction:function(s){return new i.BigNumber(s.n).div(s.d).times(s.s)},null:function(s){return new i.BigNumber(0)},"Array | Matrix":function(s){return n(s,a)}});return a.toTex={0:"0",1:"\\left(${args[0]}\\right)"},a}return Jn.name="bignumber",Jn.factory=e,Jn}var Kn={},eo;function Sf(){if(eo)return Kn;eo=1;var n=ln();function e(i,t,r,o){var a=o("fraction",{number:function(s){if(!isFinite(s)||isNaN(s))throw new Error(s+" cannot be represented as a fraction");return new i.Fraction(s)},string:function(s){return new i.Fraction(s)},"number, number":function(s,f){return new i.Fraction(s,f)},null:function(s){return new i.Fraction(0)},BigNumber:function(s){return new i.Fraction(s.toString())},Fraction:function(s){return s},Object:function(s){return new i.Fraction(s)},"Array | Matrix":function(s){return n(s,a)}});return a}return Kn.name="fraction",Kn.factory=e,Kn}var to;function xf(){if(to)return pn;to=1;function n(e,i,t,r){var o=t(li()),a={string:!0,number:!0,BigNumber:!0,Fraction:!0},l={number:t(Ef()),BigNumber:t(Nf()),Fraction:t(Sf())},s=function(u,c){var p=o(u);if(!(p in a))throw new TypeError("Cannot convert "+u+' of type "'+p+'"; valid input types are '+Object.keys(a).join(", "));if(!(c in l))throw new TypeError("Cannot convert "+u+' to type "'+c+'"; valid output types are '+Object.keys(l).join(", "));return c===p?u:l[c](u)};return s.toTex=function(f,u){return f.args[0].toTex()},s}return pn.path="type",pn.name="_numeric",pn.factory=n,pn}var mn={},Ct={},no;function at(){if(no)return Ct;no=1;function n(u){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?n=function(p){return typeof p}:n=function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p},n(u)}var e=ot.hasOwnProperty;function i(u,c){if(l(u)&&r(u,c))return u[c];throw typeof u[c]=="function"&&a(u,c)?new Error('Cannot access method "'+c+'" as a property'):new Error('No access to property "'+c+'"')}function t(u,c,p){if(l(u)&&r(u,c))return u[c]=p,p;throw new Error('No access to property "'+c+'"')}function r(u,c){return!u||n(u)!=="object"?!1:e(s,c)?!0:!(c in Object.prototype||c in Function.prototype)}function o(u,c){if(!a(u,c))throw new Error('No access to method "'+c+'"')}function a(u,c){return!u||typeof u[c]!="function"||e(u,c)&&Object.getPrototypeOf&&c in Object.getPrototypeOf(u)?!1:e(f,c)?!0:!(c in Object.prototype||c in Function.prototype)}function l(u){return n(u)==="object"&&u&&u.constructor===Object}var s={length:!0,name:!0},f={toString:!0,valueOf:!0,toLocaleString:!0};return Ct.getSafeProperty=i,Ct.setSafeProperty=t,Ct.isSafeProperty=r,Ct.validateSafeMethod=o,Ct.isSafeMethod=a,Ct.isPlainObject=l,Ct}var Xt={},Nr,ro;function qa(){return ro||(ro=1,Nr={end:!0}),Nr}var io;function st(){if(io)return Xt;io=1;function n(o){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?n=function(l){return typeof l}:n=function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l},n(o)}var e=qa(),i=ot.deepEqual,t=ot.hasOwnProperty;function r(o,a,l,s,f){function u(){if(!(this instanceof u))throw new SyntaxError("Constructor must be called with the new operator")}u.prototype.eval=function(p){return this.compile().eval(p)},u.prototype.type="Node",u.prototype.isNode=!0,u.prototype.comment="",u.prototype.compile=function(){var p=this._compile(f.expression.mathWithTransform,{}),d={},g=null;return{eval:function(h){var _=h||{};return c(_),p(_,d,g)}}},u.prototype._compile=function(p,d){throw new Error("Method _compile should be implemented by type "+this.type)},u.prototype.forEach=function(p){throw new Error("Cannot run forEach on a Node interface")},u.prototype.map=function(p){throw new Error("Cannot run map on a Node interface")},u.prototype._ifNode=function(p){if(!o.isNode(p))throw new TypeError("Callback function must return a Node");return p},u.prototype.traverse=function(p){p(this,null,null);function d(g,y){g.forEach(function(h,_,v){y(h,_,v),d(h,y)})}d(this,p)},u.prototype.transform=function(p){function d(y,h){return y.map(function(_,v,b){var E=h(_,v,b);return d(E,h)})}var g=p(this,null,null);return d(g,p)},u.prototype.filter=function(p){var d=[];return this.traverse(function(g,y,h){p(g,y,h)&&d.push(g)}),d},u.prototype.find=function(){throw new Error("Function Node.find is deprecated. Use Node.filter instead.")},u.prototype.match=function(){throw new Error("Function Node.match is deprecated. See functions Node.filter, Node.transform, Node.traverse.")},u.prototype.clone=function(){throw new Error("Cannot clone a Node interface")},u.prototype.cloneDeep=function(){return this.map(function(p){return p.cloneDeep()})},u.prototype.equals=function(p){return p?i(this,p):!1},u.prototype.toString=function(p){var d;if(p&&n(p)==="object")switch(n(p.handler)){case"object":case"undefined":break;case"function":d=p.handler(this,p);break;default:throw new TypeError("Object or function expected as callback")}return typeof d<"u"?d:this._toString(p)},u.prototype.toJSON=function(){throw new Error("Cannot serialize object: toJSON not implemented by "+this.type)},u.prototype.toHTML=function(p){var d;if(p&&n(p)==="object")switch(n(p.handler)){case"object":case"undefined":break;case"function":d=p.handler(this,p);break;default:throw new TypeError("Object or function expected as callback")}return typeof d<"u"?d:this.toHTML(p)},u.prototype._toString=function(){throw new Error("_toString not implemented for "+this.type)},u.prototype.toTex=function(p){var d;if(p&&n(p)==="object")switch(n(p.handler)){case"object":case"undefined":break;case"function":d=p.handler(this,p);break;default:throw new TypeError("Object or function expected as callback")}return typeof d<"u"?d:this._toTex(p)},u.prototype._toTex=function(p){throw new Error("_toTex not implemented for "+this.type)},u.prototype.getIdentifier=function(){return this.type},u.prototype.getContent=function(){return this};function c(p){for(var d in p)if(t(p,d)&&d in e)throw new Error('Scope contains an illegal symbol, "'+d+'" is a reserved keyword')}return u}return Xt.name="Node",Xt.path="expression.node",Xt.math=!0,Xt.factory=r,Xt}var Sr={},xr={},Ir,oo;function za(){if(oo)return Ir;oo=1;function n(e,i,t){if(!(this instanceof n))throw new SyntaxError("Constructor must be called with the new operator");this.index=e,arguments.length<3?(this.min=0,this.max=i):(this.min=i,this.max=t),this.min!==void 0&&this.index<this.min?this.message="Index out of range ("+this.index+" < "+this.min+")":this.max!==void 0&&this.index>=this.max?this.message="Index out of range ("+this.index+" > "+(this.max-1)+")":this.message="Index out of range ("+this.index+")",this.stack=new Error().stack}return n.prototype=new RangeError,n.prototype.constructor=RangeError,n.prototype.name="IndexError",n.prototype.isIndexError=!0,Ir=n,Ir}var ao;function Xa(){if(ao)return xr;ao=1;var n=za();return xr.transform=function(e){return e&&e.isIndexError?new n(e.index+1,e.min+1,e.max!==void 0?e.max+1:void 0):e},xr}var Zn={},Qe={},Or={},Tr={},so;function If(){return so||(so=1,function(n){var e=ot;n.format=function(i,t){if(typeof t=="function")return t(i);if(!i.isFinite())return i.isNaN()?"NaN":i.gt(0)?"Infinity":"-Infinity";var r="auto",o;switch(t!==void 0&&(t.notation&&(r=t.notation),typeof t=="number"?o=t:t.precision&&(o=t.precision)),r){case"fixed":return n.toFixed(i,o);case"exponential":return n.toExponential(i,o);case"engineering":return n.toEngineering(i,o);case"auto":if(t&&t.exponential&&(t.exponential.lower!==void 0||t.exponential.upper!==void 0)){var a=e.map(t,function(c){return c});return a.exponential=void 0,t.exponential.lower!==void 0&&(a.lowerExp=Math.round(Math.log(t.exponential.lower)/Math.LN10)),t.exponential.upper!==void 0&&(a.upperExp=Math.round(Math.log(t.exponential.upper)/Math.LN10)),console.warn("Deprecation warning: Formatting options exponential.lower and exponential.upper (minimum and maximum value) are replaced with exponential.lowerExp and exponential.upperExp (minimum and maximum exponent) since version 4.0.0. Replace "+JSON.stringify(t)+" with "+JSON.stringify(a)),n.format(i,a)}var l=t&&t.lowerExp!==void 0?t.lowerExp:-3,s=t&&t.upperExp!==void 0?t.upperExp:5;if(i.isZero())return"0";var f,u=i.e;return u>=l&&u<s?f=i.toSignificantDigits(o).toFixed():f=n.toExponential(i,o),f.replace(/((\.\d*?)(0+))($|e)/,function(){var c=arguments[2],p=arguments[4];return c!=="."?c+p:p});default:throw new Error('Unknown notation "'+r+'". Choose "auto", "exponential", or "fixed".')}},n.toEngineering=function(i,t){var r=i.e,o=r%3===0?r:r<0?r-3-r%3:r-r%3,a=i.mul(Math.pow(10,-o)),l=a.toPrecision(t);return l.indexOf("e")!==-1&&(l=a.toString()),l+"e"+(r>=0?"+":"")+o.toString()},n.toExponential=function(i,t){return t!==void 0?i.toExponential(t-1):i.toExponential()},n.toFixed=function(i,t){return i.toFixed(t)}}(Tr)),Tr}var lo;function wt(){return lo||(lo=1,function(n){function e(l){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?e=function(f){return typeof f}:e=function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},e(l)}var i=jn.format,t=If().format,r=oi;n.isString=function(l){return typeof l=="string"},n.endsWith=function(l,s){var f=l.length-s.length,u=l.length;return l.substring(f,u)===s},n.format=function(l,s){if(typeof l=="number")return i(l,s);if(r(l))return t(l,s);if(a(l))return!s||s.fraction!=="decimal"?l.s*l.n+"/"+l.d:l.toString();if(Array.isArray(l))return o(l,s);if(n.isString(l))return'"'+l+'"';if(typeof l=="function")return l.syntax?String(l.syntax):"function";if(l&&e(l)==="object"){if(typeof l.format=="function")return l.format(s);if(l&&l.toString()!=={}.toString())return l.toString();var f=[];for(var u in l)l.hasOwnProperty(u)&&f.push('"'+u+'": '+n.format(l[u],s));return"{"+f.join(", ")+"}"}return String(l)},n.stringify=function(l){for(var s=String(l),f="",u=0;u<s.length;){var c=s.charAt(u);c==="\\"?(f+=c,u++,c=s.charAt(u),(c===""||'"\\/bfnrtu'.indexOf(c)===-1)&&(f+="\\"),f+=c):c==='"'?f+='\\"':f+=c,u++}return'"'+f+'"'},n.escape=function(l){var s=String(l);return s=s.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),s};function o(l,s){if(Array.isArray(l)){for(var f="[",u=l.length,c=0;c<u;c++)c!==0&&(f+=", "),f+=o(l[c],s);return f+="]",f}else return n.format(l,s)}function a(l){return l&&e(l)==="object"&&typeof l.s=="number"&&typeof l.n=="number"&&typeof l.d=="number"||!1}}(Or)),Or}var Ar,uo;function Wa(){if(uo)return Ar;uo=1;function n(e,i,t){if(!(this instanceof n))throw new SyntaxError("Constructor must be called with the new operator");this.actual=e,this.expected=i,this.relation=t,this.message="Dimension mismatch ("+(Array.isArray(e)?"["+e.join(", ")+"]":e)+" "+(this.relation||"!=")+" "+(Array.isArray(i)?"["+i.join(", ")+"]":i)+")",this.stack=new Error().stack}return n.prototype=new RangeError,n.prototype.constructor=RangeError,n.prototype.name="DimensionError",n.prototype.isDimensionError=!0,Ar=n,Ar}var fo;function Mt(){if(fo)return Qe;fo=1,Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.size=o,Qe.validate=l,Qe.validateIndex=s,Qe.resize=f,Qe.reshape=c,Qe.squeeze=d,Qe.unsqueeze=y,Qe.flatten=_,Qe.map=v,Qe.forEach=b,Qe.filter=E,Qe.filterRegExp=N,Qe.join=T,Qe.identify=R,Qe.generalize=I;var n=r(jn),e=r(wt()),i=r(Wa()),t=r(za());function r(w){return w&&w.__esModule?w:{default:w}}function o(w){for(var S=[];Array.isArray(w);)S.push(w.length),w=w[0];return S}function a(w,S,M){var A,F=w.length;if(F!==S[M])throw new i.default(F,S[M]);if(M<S.length-1){var V=M+1;for(A=0;A<F;A++){var ee=w[A];if(!Array.isArray(ee))throw new i.default(S.length-1,S.length,"<");a(w[A],S,V)}}else for(A=0;A<F;A++)if(Array.isArray(w[A]))throw new i.default(S.length+1,S.length,">")}function l(w,S){var M=S.length===0;if(M){if(Array.isArray(w))throw new i.default(w.length,0)}else a(w,S,0)}function s(w,S){if(!n.default.isNumber(w)||!n.default.isInteger(w))throw new TypeError("Index must be an integer (value: "+w+")");if(w<0||typeof S=="number"&&w>=S)throw new t.default(w,S)}function f(w,S,M){if(!Array.isArray(w)||!Array.isArray(S))throw new TypeError("Array expected");if(S.length===0)throw new Error("Resizing to scalar is not supported");S.forEach(function(F){if(!n.default.isNumber(F)||!n.default.isInteger(F)||F<0)throw new TypeError("Invalid size, must contain positive integers (size: "+e.default.format(S)+")")});var A=M!==void 0?M:0;return u(w,S,0,A),w}function u(w,S,M,A){var F,V,ee=w.length,G=S[M],ae=Math.min(ee,G);if(w.length=G,M<S.length-1){var we=M+1;for(F=0;F<ae;F++)V=w[F],Array.isArray(V)||(V=[V],w[F]=V),u(V,S,we,A);for(F=ae;F<G;F++)V=[],w[F]=V,u(V,S,we,A)}else{for(F=0;F<ae;F++)for(;Array.isArray(w[F]);)w[F]=w[F][0];for(F=ae;F<G;F++)w[F]=A}}function c(w,S){var M=_(w),A;function F(G){return G.reduce(function(ae,we){return ae*we})}if(!Array.isArray(w)||!Array.isArray(S))throw new TypeError("Array expected");if(S.length===0)throw new i.default(0,F(o(w)),"!=");for(var V=1,ee=0;ee<S.length;ee++)V*=S[ee];if(M.length!==V)throw new i.default(F(S),F(o(w)),"!=");try{A=p(M,S)}catch(G){throw G instanceof i.default?new i.default(F(S),F(o(w)),"!="):G}return A}function p(w,S){for(var M=w,A,F=S.length-1;F>0;F--){var V=S[F];A=[];for(var ee=M.length/V,G=0;G<ee;G++)A.push(M.slice(G*V,(G+1)*V));M=A}return M}function d(w,S){for(var M=S||o(w);Array.isArray(w)&&w.length===1;)w=w[0],M.shift();for(var A=M.length;M[A-1]===1;)A--;return A<M.length&&(w=g(w,A,0),M.length=A),w}function g(w,S,M){var A,F;if(M<S){var V=M+1;for(A=0,F=w.length;A<F;A++)w[A]=g(w[A],S,V)}else for(;Array.isArray(w);)w=w[0];return w}function y(w,S,M,A){var F=A||o(w);if(M)for(var V=0;V<M;V++)w=[w],F.unshift(1);for(w=h(w,S,0);F.length<S;)F.push(1);return w}function h(w,S,M){var A,F;if(Array.isArray(w)){var V=M+1;for(A=0,F=w.length;A<F;A++)w[A]=h(w[A],S,V)}else for(var ee=M;ee<S;ee++)w=[w];return w}function _(w){if(!Array.isArray(w))return w;var S=[];return w.forEach(function M(A){Array.isArray(A)?A.forEach(M):S.push(A)}),S}function v(w,S){return Array.prototype.map.call(w,S)}function b(w,S){Array.prototype.forEach.call(w,S)}function E(w,S){if(o(w).length!==1)throw new Error("Only one dimensional matrices supported");return Array.prototype.filter.call(w,S)}function N(w,S){if(o(w).length!==1)throw new Error("Only one dimensional matrices supported");return Array.prototype.filter.call(w,function(M){return S.test(M)})}function T(w,S){return Array.prototype.join.call(w,S)}function R(w){if(!Array.isArray(w))throw new TypeError("Array input expected");if(w.length===0)return w;var S=[],M=0;S[0]={value:w[0],identifier:0};for(var A=1;A<w.length;A++)w[A]===w[A-1]?M++:M=0,S.push({value:w[A],identifier:M});return S}function I(w){if(!Array.isArray(w))throw new TypeError("Array input expected");if(w.length===0)return w;for(var S=[],M=0;M<w.length;M++)S.push(w[M].value);return S}return Qe}var Qn={},co;function Ya(){if(co)return Qn;co=1;function n(e,i,t,r){var o=r("matrix",{"":function(){return a([])},string:function(s){return a([],s)},"string, string":function(s,f){return a([],s,f)},Array:function(s){return a(s)},Matrix:function(s){return a(s,s.storage())},"Array | Matrix, string":a,"Array | Matrix, string, string":a});return o.toTex={0:"\\begin{bmatrix}\\end{bmatrix}",1:"\\left(${args[0]}\\right)",2:"\\left(${args[0]}\\right)"},o;function a(l,s,f){var u=e.Matrix.storage(s||"default");return new u(l,f)}}return Qn.name="matrix",Qn.factory=n,Qn}var ho;function Ja(){if(ho)return Zn;ho=1;var n=ot.clone,e=Mt().validateIndex,i=at().getSafeProperty,t=at().setSafeProperty,r=Wa();function o(s,f,u,c){var p=u(Ya()),d=c("subset",{"Array, Index":function(_,v){var b=p(_),E=b.subset(v);return v.isScalar()?E:E.valueOf()},"Matrix, Index":function(_,v){return _.subset(v)},"Object, Index":a,"string, Index":g,"Array, Index, any":function(_,v,b){return p(n(_)).subset(v,b,void 0).valueOf()},"Array, Index, any, any":function(_,v,b,E){return p(n(_)).subset(v,b,E).valueOf()},"Matrix, Index, any":function(_,v,b){return _.clone().subset(v,b)},"Matrix, Index, any, any":function(_,v,b,E){return _.clone().subset(v,b,E)},"string, Index, string":y,"string, Index, string, string":y,"Object, Index, any":l});return d.toTex=void 0,d;function g(h,_){if(!s.isIndex(_))throw new TypeError("Index expected");if(_.size().length!==1)throw new r(_.size().length,1);var v=h.length;e(_.min()[0],v),e(_.max()[0],v);var b=_.dimension(0),E="";return b.forEach(function(N){E+=h.charAt(N)}),E}function y(h,_,v,b){if(!_||_.isIndex!==!0)throw new TypeError("Index expected");if(_.size().length!==1)throw new r(_.size().length,1);if(b!==void 0){if(typeof b!="string"||b.length!==1)throw new TypeError("Single character expected as defaultValue")}else b=" ";var E=_.dimension(0),N=E.size()[0];if(N!==v.length)throw new r(E.size()[0],v.length);var T=h.length;e(_.min()[0]),e(_.max()[0]);for(var R=[],I=0;I<T;I++)R[I]=h.charAt(I);if(E.forEach(function(M,A){R[M]=v.charAt(A[0])}),R.length>T)for(var w=T-1,S=R.length;w<S;w++)R[w]||(R[w]=b);return R.join("")}}function a(s,f){if(f.size().length!==1)throw new r(f.size(),1);var u=f.dimension(0);if(typeof u!="string")throw new TypeError("String expected as index to retrieve an object property");return i(s,u)}function l(s,f,u){if(f.size().length!==1)throw new r(f.size(),1);var c=f.dimension(0);if(typeof c!="string")throw new TypeError("String expected as index to retrieve an object property");var p=n(s);return t(p,c,u),p}return Zn.name="subset",Zn.factory=o,Zn}var po;function Ka(){if(po)return Sr;po=1;function n(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?n=function(a){return typeof a}:n=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},n(r)}var e=Xa().transform,i=at().getSafeProperty;function t(r,o,a,l){var s=a(Ja());return function(u,c){try{if(Array.isArray(u))return s(u,c);if(u&&typeof u.subset=="function")return u.subset(c);if(typeof u=="string")return s(u,c);if(n(u)==="object"){if(!c.isObjectProperty())throw new TypeError("Cannot apply a numeric index as object property");return i(u,c.getObjectProperty())}else throw new TypeError("Cannot apply index: unsupported type of object")}catch(p){throw e(p)}}}return Sr.factory=t,Sr}var mo;function Of(){if(mo)return mn;mo=1;var n=at().getSafeProperty;function e(i,t,r,o){var a=r(st()),l=r(Ka());function s(u,c){if(!(this instanceof s))throw new SyntaxError("Constructor must be called with the new operator");if(!i.isNode(u))throw new TypeError('Node expected for parameter "object"');if(!i.isIndexNode(c))throw new TypeError('IndexNode expected for parameter "index"');this.object=u||null,this.index=c,Object.defineProperty(this,"name",{get:function(){return this.index?this.index.isObjectProperty()?this.index.getObjectProperty():"":this.object.name||""}.bind(this),set:function(){throw new Error("Cannot assign a new name, name is read-only")}})}s.prototype=new a,s.prototype.type="AccessorNode",s.prototype.isAccessorNode=!0,s.prototype._compile=function(u,c){var p=this.object._compile(u,c),d=this.index._compile(u,c);if(this.index.isObjectProperty()){var g=this.index.getObjectProperty();return function(h,_,v){return n(p(h,_,v),g)}}else return function(h,_,v){var b=p(h,_,v),E=d(h,_,b);return l(b,E)}},s.prototype.forEach=function(u){u(this.object,"object",this),u(this.index,"index",this)},s.prototype.map=function(u){return new s(this._ifNode(u(this.object,"object",this)),this._ifNode(u(this.index,"index",this)))},s.prototype.clone=function(){return new s(this.object,this.index)},s.prototype._toString=function(u){var c=this.object.toString(u);return f(this.object)&&(c="("+c+")"),c+this.index.toString(u)},s.prototype.toHTML=function(u){var c=this.object.toHTML(u);return f(this.object)&&(c='<span class="math-parenthesis math-round-parenthesis">(</span>'+c+'<span class="math-parenthesis math-round-parenthesis">)</span>'),c+this.index.toHTML(u)},s.prototype._toTex=function(u){var c=this.object.toTex(u);return f(this.object)&&(c="\\left(' + object + '\\right)"),c+this.index.toTex(u)},s.prototype.toJSON=function(){return{mathjs:"AccessorNode",object:this.object,index:this.index}},s.fromJSON=function(u){return new s(u.object,u.index)};function f(u){return!(i.isAccessorNode(u)||i.isArrayNode(u)||i.isConstantNode(u)||i.isFunctionNode(u)||i.isObjectNode(u)||i.isParenthesisNode(u)||i.isSymbolNode(u))}return s}return mn.name="AccessorNode",mn.path="expression.node",mn.factory=e,mn}var gn={},go;function Tf(){if(go)return gn;go=1;var n=Mt().map;function e(i,t,r,o){var a=r(st());function l(s){if(!(this instanceof l))throw new SyntaxError("Constructor must be called with the new operator");if(this.items=s||[],!Array.isArray(this.items)||!this.items.every(i.isNode))throw new TypeError("Array containing Nodes expected");var f=function(){throw new Error("Property `ArrayNode.nodes` is deprecated, use `ArrayNode.items` instead")};Object.defineProperty(this,"nodes",{get:f,set:f})}return l.prototype=new a,l.prototype.type="ArrayNode",l.prototype.isArrayNode=!0,l.prototype._compile=function(s,f){var u=n(this.items,function(d){return d._compile(s,f)}),c=s.config().matrix!=="Array";if(c){var p=s.matrix;return function(g,y,h){return p(n(u,function(_){return _(g,y,h)}))}}else return function(g,y,h){return n(u,function(_){return _(g,y,h)})}},l.prototype.forEach=function(s){for(var f=0;f<this.items.length;f++){var u=this.items[f];s(u,"items["+f+"]",this)}},l.prototype.map=function(s){for(var f=[],u=0;u<this.items.length;u++)f[u]=this._ifNode(s(this.items[u],"items["+u+"]",this));return new l(f)},l.prototype.clone=function(){return new l(this.items.slice(0))},l.prototype._toString=function(s){var f=this.items.map(function(u){return u.toString(s)});return"["+f.join(", ")+"]"},l.prototype.toJSON=function(){return{mathjs:"ArrayNode",items:this.items}},l.fromJSON=function(s){return new l(s.items)},l.prototype.toHTML=function(s){var f=this.items.map(function(u){return u.toHTML(s)});return'<span class="math-parenthesis math-square-parenthesis">[</span>'+f.join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-square-parenthesis">]</span>'},l.prototype._toTex=function(s){var f="\\begin{bmatrix}";return this.items.forEach(function(u){u.items?f+=u.items.map(function(c){return c.toTex(s)}).join("&"):f+=u.toTex(s),f+="\\\\"}),f+="\\end{bmatrix}",f},l}return gn.name="ArrayNode",gn.path="expression.node",gn.factory=e,gn}var vn={},Rr={},vo;function Af(){if(vo)return Rr;vo=1;function n(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?n=function(a){return typeof a}:n=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},n(r)}var e=Xa().transform,i=at().setSafeProperty;function t(r,o,a,l){var s=a(Ja()),f=a(Ya());return function(c,p,d){try{if(Array.isArray(c))return f(c).subset(p,d).valueOf();if(c&&typeof c.subset=="function")return c.subset(p,d);if(typeof c=="string")return s(c,p,d);if(n(c)==="object"){if(!p.isObjectProperty())throw TypeError("Cannot apply a numeric index as object property");return i(c,p.getObjectProperty(),d),c}else throw new TypeError("Cannot apply index: unsupported type of object")}catch(g){throw e(g)}}}return Rr.factory=t,Rr}var Wt={},yo;function un(){if(yo)return Wt;yo=1;var n=[{AssignmentNode:{},FunctionAssignmentNode:{}},{ConditionalNode:{latexLeftParens:!1,latexRightParens:!1,latexParens:!1}},{"OperatorNode:or":{associativity:"left",associativeWith:[]}},{"OperatorNode:xor":{associativity:"left",associativeWith:[]}},{"OperatorNode:and":{associativity:"left",associativeWith:[]}},{"OperatorNode:bitOr":{associativity:"left",associativeWith:[]}},{"OperatorNode:bitXor":{associativity:"left",associativeWith:[]}},{"OperatorNode:bitAnd":{associativity:"left",associativeWith:[]}},{"OperatorNode:equal":{associativity:"left",associativeWith:[]},"OperatorNode:unequal":{associativity:"left",associativeWith:[]},"OperatorNode:smaller":{associativity:"left",associativeWith:[]},"OperatorNode:larger":{associativity:"left",associativeWith:[]},"OperatorNode:smallerEq":{associativity:"left",associativeWith:[]},"OperatorNode:largerEq":{associativity:"left",associativeWith:[]},RelationalNode:{associativity:"left",associativeWith:[]}},{"OperatorNode:leftShift":{associativity:"left",associativeWith:[]},"OperatorNode:rightArithShift":{associativity:"left",associativeWith:[]},"OperatorNode:rightLogShift":{associativity:"left",associativeWith:[]}},{"OperatorNode:to":{associativity:"left",associativeWith:[]}},{RangeNode:{}},{"OperatorNode:add":{associativity:"left",associativeWith:["OperatorNode:add","OperatorNode:subtract"]},"OperatorNode:subtract":{associativity:"left",associativeWith:[]}},{"OperatorNode:multiply":{associativity:"left",associativeWith:["OperatorNode:multiply","OperatorNode:divide","Operator:dotMultiply","Operator:dotDivide"]},"OperatorNode:divide":{associativity:"left",associativeWith:[],latexLeftParens:!1,latexRightParens:!1,latexParens:!1},"OperatorNode:dotMultiply":{associativity:"left",associativeWith:["OperatorNode:multiply","OperatorNode:divide","OperatorNode:dotMultiply","OperatorNode:doDivide"]},"OperatorNode:dotDivide":{associativity:"left",associativeWith:[]},"OperatorNode:mod":{associativity:"left",associativeWith:[]}},{"OperatorNode:unaryPlus":{associativity:"right"},"OperatorNode:unaryMinus":{associativity:"right"},"OperatorNode:bitNot":{associativity:"right"},"OperatorNode:not":{associativity:"right"}},{"OperatorNode:pow":{associativity:"right",associativeWith:[],latexRightParens:!1},"OperatorNode:dotPow":{associativity:"right",associativeWith:[]}},{"OperatorNode:factorial":{associativity:"left"}},{"OperatorNode:transpose":{associativity:"left"}}];function e(r,o){var a=r;o!=="keep"&&(a=r.getContent());for(var l=a.getIdentifier(),s=0;s<n.length;s++)if(l in n[s])return s;return null}function i(r,o){var a=r;o!=="keep"&&(a=r.getContent());var l=a.getIdentifier(),s=e(a,o);if(s===null)return null;var f=n[s][l];if(f.hasOwnProperty("associativity")){if(f.associativity==="left")return"left";if(f.associativity==="right")return"right";throw Error("'"+l+"' has the invalid associativity '"+f.associativity+"'.")}return null}function t(r,o,a){var l=a!=="keep"?r.getContent():r,s=a!=="keep"?r.getContent():o,f=l.getIdentifier(),u=s.getIdentifier(),c=e(l,a);if(c===null)return null;var p=n[c][f];if(p.hasOwnProperty("associativeWith")&&p.associativeWith instanceof Array){for(var d=0;d<p.associativeWith.length;d++)if(p.associativeWith[d]===u)return!0;return!1}return null}return Wt.properties=n,Wt.getPrecedence=e,Wt.getAssociativity=i,Wt.isAssociativeWith=t,Wt}var _o;function Rf(){if(_o)return vn;_o=1;var n=at().getSafeProperty,e=at().setSafeProperty;function i(t,r,o,a){var l=o(st()),s=o(Af()),f=o(Ka()),u=un();function c(d,g,y){if(!(this instanceof c))throw new SyntaxError("Constructor must be called with the new operator");if(this.object=d,this.index=y?g:null,this.value=y||g,!t.isSymbolNode(d)&&!t.isAccessorNode(d))throw new TypeError('SymbolNode or AccessorNode expected as "object"');if(t.isSymbolNode(d)&&d.name==="end")throw new Error('Cannot assign to symbol "end"');if(this.index&&!t.isIndexNode(this.index))throw new TypeError('IndexNode expected as "index"');if(!t.isNode(this.value))throw new TypeError('Node expected as "value"');Object.defineProperty(this,"name",{get:function(){return this.index?this.index.isObjectProperty()?this.index.getObjectProperty():"":this.object.name||""}.bind(this),set:function(){throw new Error("Cannot assign a new name, name is read-only")}})}c.prototype=new l,c.prototype.type="AssignmentNode",c.prototype.isAssignmentNode=!0,c.prototype._compile=function(d,g){var y=this.object._compile(d,g),h=this.index?this.index._compile(d,g):null,_=this.value._compile(d,g),v=this.object.name;if(this.index)if(this.index.isObjectProperty()){var b=this.index.getObjectProperty();return function(I,w,S){var M=y(I,w,S),A=_(I,w,S);return e(M,b,A)}}else{if(t.isSymbolNode(this.object))return function(I,w,S){var M=y(I,w,S),A=_(I,w,S),F=h(I,w,M);return e(I,v,s(M,F,A)),A};var E=this.object.object._compile(d,g);if(this.object.index.isObjectProperty()){var N=this.object.index.getObjectProperty();return function(I,w,S){var M=E(I,w,S),A=n(M,N),F=h(I,w,A),V=_(I,w,S);return e(M,N,s(A,F,V)),V}}else{var T=this.object.index._compile(d,g);return function(I,w,S){var M=E(I,w,S),A=T(I,w,M),F=f(M,A),V=h(I,w,F),ee=_(I,w,S);return s(M,A,s(F,V,ee)),ee}}}else{if(!t.isSymbolNode(this.object))throw new TypeError("SymbolNode expected as object");return function(I,w,S){return e(I,v,_(I,w,S))}}},c.prototype.forEach=function(d){d(this.object,"object",this),this.index&&d(this.index,"index",this),d(this.value,"value",this)},c.prototype.map=function(d){var g=this._ifNode(d(this.object,"object",this)),y=this.index?this._ifNode(d(this.index,"index",this)):null,h=this._ifNode(d(this.value,"value",this));return new c(g,y,h)},c.prototype.clone=function(){return new c(this.object,this.index,this.value)};function p(d,g){g||(g="keep");var y=u.getPrecedence(d,g),h=u.getPrecedence(d.value,g);return g==="all"||h!==null&&h<=y}return c.prototype._toString=function(d){var g=this.object.toString(d),y=this.index?this.index.toString(d):"",h=this.value.toString(d);return p(this,d&&d.parenthesis)&&(h="("+h+")"),g+y+" = "+h},c.prototype.toJSON=function(){return{mathjs:"AssignmentNode",object:this.object,index:this.index,value:this.value}},c.fromJSON=function(d){return new c(d.object,d.index,d.value)},c.prototype.toHTML=function(d){var g=this.object.toHTML(d),y=this.index?this.index.toHTML(d):"",h=this.value.toHTML(d);return p(this,d&&d.parenthesis)&&(h='<span class="math-paranthesis math-round-parenthesis">(</span>'+h+'<span class="math-paranthesis math-round-parenthesis">)</span>'),g+y+'<span class="math-operator math-assignment-operator math-variable-assignment-operator math-binary-operator">=</span>'+h},c.prototype._toTex=function(d){var g=this.object.toTex(d),y=this.index?this.index.toTex(d):"",h=this.value.toTex(d);return p(this,d&&d.parenthesis)&&(h="\\left(".concat(h,"\\right)")),g+y+":="+h},c}return vn.name="AssignmentNode",vn.path="expression.node",vn.factory=i,vn}var yn={},_n={},bo;function Mf(){if(bo)return _n;bo=1;function n(e,i,t,r){function o(a){if(!(this instanceof o))throw new SyntaxError("Constructor must be called with the new operator");this.entries=a||[]}return o.prototype.type="ResultSet",o.prototype.isResultSet=!0,o.prototype.valueOf=function(){return this.entries},o.prototype.toString=function(){return"["+this.entries.join(", ")+"]"},o.prototype.toJSON=function(){return{mathjs:"ResultSet",entries:this.entries}},o.fromJSON=function(a){return new o(a.entries)},o}return _n.name="ResultSet",_n.path="type",_n.factory=n,_n}var wo;function Pf(){if(wo)return yn;wo=1;var n=Mt().forEach,e=Mt().map;function i(t,r,o,a){var l=o(st()),s=o(Mf());function f(u){if(!(this instanceof f))throw new SyntaxError("Constructor must be called with the new operator");if(!Array.isArray(u))throw new Error("Array expected");this.blocks=u.map(function(c){var p=c&&c.node,d=c&&c.visible!==void 0?c.visible:!0;if(!t.isNode(p))throw new TypeError('Property "node" must be a Node');if(typeof d!="boolean")throw new TypeError('Property "visible" must be a boolean');return{node:p,visible:d}})}return f.prototype=new l,f.prototype.type="BlockNode",f.prototype.isBlockNode=!0,f.prototype._compile=function(u,c){var p=e(this.blocks,function(d){return{eval:d.node._compile(u,c),visible:d.visible}});return function(g,y,h){var _=[];return n(p,function(b){var E=b.eval(g,y,h);b.visible&&_.push(E)}),new s(_)}},f.prototype.forEach=function(u){for(var c=0;c<this.blocks.length;c++)u(this.blocks[c].node,"blocks["+c+"].node",this)},f.prototype.map=function(u){for(var c=[],p=0;p<this.blocks.length;p++){var d=this.blocks[p],g=this._ifNode(u(d.node,"blocks["+p+"].node",this));c[p]={node:g,visible:d.visible}}return new f(c)},f.prototype.clone=function(){var u=this.blocks.map(function(c){return{node:c.node,visible:c.visible}});return new f(u)},f.prototype._toString=function(u){return this.blocks.map(function(c){return c.node.toString(u)+(c.visible?"":";")}).join(`
`)},f.prototype.toJSON=function(){return{mathjs:"BlockNode",blocks:this.blocks}},f.fromJSON=function(u){return new f(u.blocks)},f.prototype.toHTML=function(u){return this.blocks.map(function(c){return c.node.toHTML(u)+(c.visible?"":'<span class="math-separator">;</span>')}).join('<span class="math-separator"><br /></span>')},f.prototype._toTex=function(u){return this.blocks.map(function(c){return c.node.toTex(u)+(c.visible?"":";")}).join(`\\;\\;
`)},f}return yn.name="BlockNode",yn.path="expression.node",yn.factory=i,yn}var bn={},Eo;function kf(){if(Eo)return bn;Eo=1;var n=un();function e(i,t,r,o){var a=r(st()),l=r(li());function s(u,c,p){if(!(this instanceof s))throw new SyntaxError("Constructor must be called with the new operator");if(!i.isNode(u))throw new TypeError("Parameter condition must be a Node");if(!i.isNode(c))throw new TypeError("Parameter trueExpr must be a Node");if(!i.isNode(p))throw new TypeError("Parameter falseExpr must be a Node");this.condition=u,this.trueExpr=c,this.falseExpr=p}s.prototype=new a,s.prototype.type="ConditionalNode",s.prototype.isConditionalNode=!0,s.prototype._compile=function(u,c){var p=this.condition._compile(u,c),d=this.trueExpr._compile(u,c),g=this.falseExpr._compile(u,c);return function(h,_,v){return f(p(h,_,v))?d(h,_,v):g(h,_,v)}},s.prototype.forEach=function(u){u(this.condition,"condition",this),u(this.trueExpr,"trueExpr",this),u(this.falseExpr,"falseExpr",this)},s.prototype.map=function(u){return new s(this._ifNode(u(this.condition,"condition",this)),this._ifNode(u(this.trueExpr,"trueExpr",this)),this._ifNode(u(this.falseExpr,"falseExpr",this)))},s.prototype.clone=function(){return new s(this.condition,this.trueExpr,this.falseExpr)},s.prototype._toString=function(u){var c=u&&u.parenthesis?u.parenthesis:"keep",p=n.getPrecedence(this,c),d=this.condition.toString(u),g=n.getPrecedence(this.condition,c);(c==="all"||this.condition.type==="OperatorNode"||g!==null&&g<=p)&&(d="("+d+")");var y=this.trueExpr.toString(u),h=n.getPrecedence(this.trueExpr,c);(c==="all"||this.trueExpr.type==="OperatorNode"||h!==null&&h<=p)&&(y="("+y+")");var _=this.falseExpr.toString(u),v=n.getPrecedence(this.falseExpr,c);return(c==="all"||this.falseExpr.type==="OperatorNode"||v!==null&&v<=p)&&(_="("+_+")"),d+" ? "+y+" : "+_},s.prototype.toJSON=function(){return{mathjs:"ConditionalNode",condition:this.condition,trueExpr:this.trueExpr,falseExpr:this.falseExpr}},s.fromJSON=function(u){return new s(u.condition,u.trueExpr,u.falseExpr)},s.prototype.toHTML=function(u){var c=u&&u.parenthesis?u.parenthesis:"keep",p=n.getPrecedence(this,c),d=this.condition.toHTML(u),g=n.getPrecedence(this.condition,c);(c==="all"||this.condition.type==="OperatorNode"||g!==null&&g<=p)&&(d='<span class="math-parenthesis math-round-parenthesis">(</span>'+d+'<span class="math-parenthesis math-round-parenthesis">)</span>');var y=this.trueExpr.toHTML(u),h=n.getPrecedence(this.trueExpr,c);(c==="all"||this.trueExpr.type==="OperatorNode"||h!==null&&h<=p)&&(y='<span class="math-parenthesis math-round-parenthesis">(</span>'+y+'<span class="math-parenthesis math-round-parenthesis">)</span>');var _=this.falseExpr.toHTML(u),v=n.getPrecedence(this.falseExpr,c);return(c==="all"||this.falseExpr.type==="OperatorNode"||v!==null&&v<=p)&&(_='<span class="math-parenthesis math-round-parenthesis">(</span>'+_+'<span class="math-parenthesis math-round-parenthesis">)</span>'),d+'<span class="math-operator math-conditional-operator">?</span>'+y+'<span class="math-operator math-conditional-operator">:</span>'+_},s.prototype._toTex=function(u){return"\\begin{cases} {"+this.trueExpr.toTex(u)+"}, &\\quad{\\text{if }\\;"+this.condition.toTex(u)+"}\\\\{"+this.falseExpr.toTex(u)+"}, &\\quad{\\text{otherwise}}\\end{cases}"};function f(u){if(typeof u=="number"||typeof u=="boolean"||typeof u=="string")return!!u;if(u){if(i.isBigNumber(u))return!u.isZero();if(i.isComplex(u))return!!(u.re||u.im);if(i.isUnit(u))return!!u.value}if(u==null)return!1;throw new TypeError('Unsupported type of condition "'+l(u)+'"')}return s}return bn.name="ConditionalNode",bn.path="expression.node",bn.factory=e,bn}var wn={},Mr={},Pr,No;function Cf(){if(No)return Pr;No=1;var n=Object.assign||function(r){for(var o=1;o<arguments.length;o++){var a=arguments[o];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(r[l]=a[l])}return r},e={"{":"\\{","}":"\\}","\\":"\\textbackslash{}","#":"\\#",$:"\\$","%":"\\%","&":"\\&","^":"\\textasciicircum{}",_:"\\_","~":"\\textasciitilde{}"},i={"\u2013":"\\--","\u2014":"\\---"," ":"~","	":"\\qquad{}","\r\n":"\\newline{}","\n":"\\newline{}"},t=function(o,a){return n({},o,a)};return Pr=function(r){for(var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=o.preserveFormatting,l=a===void 0?!1:a,s=o.escapeMapFn,f=s===void 0?t:s,u=String(r),c="",p=f(n({},e),l?n({},i):{}),d=Object.keys(p),g=function(){var h=!1;d.forEach(function(_,v){h||u.length>=_.length&&u.slice(0,_.length)===_&&(c+=p[d[v]],u=u.slice(_.length,u.length),h=!0)}),h||(c+=u.slice(0,1),u=u.slice(1,u.length))};u;)g();return c},Pr}var So;function fn(){return So||(So=1,function(n){var e=Cf();n.symbols={Alpha:"A",alpha:"\\alpha",Beta:"B",beta:"\\beta",Gamma:"\\Gamma",gamma:"\\gamma",Delta:"\\Delta",delta:"\\delta",Epsilon:"E",epsilon:"\\epsilon",varepsilon:"\\varepsilon",Zeta:"Z",zeta:"\\zeta",Eta:"H",eta:"\\eta",Theta:"\\Theta",theta:"\\theta",vartheta:"\\vartheta",Iota:"I",iota:"\\iota",Kappa:"K",kappa:"\\kappa",varkappa:"\\varkappa",Lambda:"\\Lambda",lambda:"\\lambda",Mu:"M",mu:"\\mu",Nu:"N",nu:"\\nu",Xi:"\\Xi",xi:"\\xi",Omicron:"O",omicron:"o",Pi:"\\Pi",pi:"\\pi",varpi:"\\varpi",Rho:"P",rho:"\\rho",varrho:"\\varrho",Sigma:"\\Sigma",sigma:"\\sigma",varsigma:"\\varsigma",Tau:"T",tau:"\\tau",Upsilon:"\\Upsilon",upsilon:"\\upsilon",Phi:"\\Phi",phi:"\\phi",varphi:"\\varphi",Chi:"X",chi:"\\chi",Psi:"\\Psi",psi:"\\psi",Omega:"\\Omega",omega:"\\omega",true:"\\mathrm{True}",false:"\\mathrm{False}",i:"i",inf:"\\infty",Inf:"\\infty",infinity:"\\infty",Infinity:"\\infty",oo:"\\infty",lim:"\\lim",undefined:"\\mathbf{?}"},n.operators={transpose:"^\\top",ctranspose:"^H",factorial:"!",pow:"^",dotPow:".^\\wedge",unaryPlus:"+",unaryMinus:"-",bitNot:"\\~",not:"\\neg",multiply:"\\cdot",divide:"\\frac",dotMultiply:".\\cdot",dotDivide:".:",mod:"\\mod",add:"+",subtract:"-",to:"\\rightarrow",leftShift:"<<",rightArithShift:">>",rightLogShift:">>>",equal:"=",unequal:"\\neq",smaller:"<",larger:">",smallerEq:"\\leq",largerEq:"\\geq",bitAnd:"\\&",bitXor:"\\underline{|}",bitOr:"|",and:"\\wedge",xor:"\\veebar",or:"\\vee"},n.defaultTemplate="\\mathrm{${name}}\\left(${args}\\right)";var i={deg:"^\\circ"};n.escape=function(t){return e(t,{preserveFormatting:!0})},n.toSymbol=function(t,r){return r=typeof r>"u"?!1:r,r?i.hasOwnProperty(t)?i[t]:"\\mathrm{"+n.escape(t)+"}":n.symbols.hasOwnProperty(t)?n.symbols[t]:n.escape(t)}}(Mr)),Mr}var xo;function Df(){if(xo)return wn;xo=1;var n=wt().format,e=fn().escape;function i(t,r,o,a){var l=o(st()),s=o(li());function f(u){if(!(this instanceof f))throw new SyntaxError("Constructor must be called with the new operator");if(arguments.length===2)throw new SyntaxError("new ConstantNode(valueStr, valueType) is not supported anymore since math v4.0.0. Use new ConstantNode(value) instead, where value is a non-stringified value.");this.value=u}return f.prototype=new l,f.prototype.type="ConstantNode",f.prototype.isConstantNode=!0,f.prototype._compile=function(u,c){var p=this.value;return function(){return p}},f.prototype.forEach=function(u){},f.prototype.map=function(u){return this.clone()},f.prototype.clone=function(){return new f(this.value)},f.prototype._toString=function(u){return n(this.value,u)},f.prototype.toHTML=function(u){var c=this._toString(u);switch(s(this.value)){case"number":case"BigNumber":case"Fraction":return'<span class="math-number">'+c+"</span>";case"string":return'<span class="math-string">'+c+"</span>";case"boolean":return'<span class="math-boolean">'+c+"</span>";case"null":return'<span class="math-null-symbol">'+c+"</span>";case"undefined":return'<span class="math-undefined">'+c+"</span>";default:return'<span class="math-symbol">'+c+"</span>"}},f.prototype.toJSON=function(){return{mathjs:"ConstantNode",value:this.value}},f.fromJSON=function(u){return new f(u.value)},f.prototype._toTex=function(u){var c=this._toString(u);switch(s(this.value)){case"string":return"\\mathtt{"+e(c)+"}";case"number":case"BigNumber":var p=c.toLowerCase().indexOf("e");return p!==-1?c.substring(0,p)+"\\cdot10^{"+c.substring(p+1)+"}":c;case"Fraction":return this.value.toLatex();default:return c}},f}return wn.name="ConstantNode",wn.path="expression.node",wn.factory=i,wn}var En={},Io;function Lf(){if(Io)return En;Io=1;var n=qa(),e=wt().escape,i=Mt().forEach,t=Mt().join,r=fn(),o=un(),a=at().setSafeProperty;function l(s,f,u,c){var p=u(st());function d(y,h,_){if(!(this instanceof d))throw new SyntaxError("Constructor must be called with the new operator");if(typeof y!="string")throw new TypeError('String expected for parameter "name"');if(!Array.isArray(h))throw new TypeError('Array containing strings or objects expected for parameter "params"');if(!s.isNode(_))throw new TypeError('Node expected for parameter "expr"');if(y in n)throw new Error('Illegal function name, "'+y+'" is a reserved keyword');this.name=y,this.params=h.map(function(v){return v&&v.name||v}),this.types=h.map(function(v){return v&&v.type||"any"}),this.expr=_}d.prototype=new p,d.prototype.type="FunctionAssignmentNode",d.prototype.isFunctionAssignmentNode=!0,d.prototype._compile=function(y,h){var _=Object.create(h);i(this.params,function(R){_[R]=!0});var v=this.expr._compile(y,_),b=this.name,E=this.params,N=t(this.types,","),T=b+"("+t(this.params,", ")+")";return function(I,w,S){var M={};M[N]=function(){for(var F=Object.create(w),V=0;V<E.length;V++)F[E[V]]=arguments[V];return v(I,F,S)};var A=c(b,M);return A.syntax=T,a(I,b,A),A}},d.prototype.forEach=function(y){y(this.expr,"expr",this)},d.prototype.map=function(y){var h=this._ifNode(y(this.expr,"expr",this));return new d(this.name,this.params.slice(0),h)},d.prototype.clone=function(){return new d(this.name,this.params.slice(0),this.expr)};function g(y,h){var _=o.getPrecedence(y,h),v=o.getPrecedence(y.expr,h);return h==="all"||v!==null&&v<=_}return d.prototype._toString=function(y){var h=y&&y.parenthesis?y.parenthesis:"keep",_=this.expr.toString(y);return g(this,h)&&(_="("+_+")"),this.name+"("+this.params.join(", ")+") = "+_},d.prototype.toJSON=function(){var y=this.types;return{mathjs:"FunctionAssignmentNode",name:this.name,params:this.params.map(function(h,_){return{name:h,type:y[_]}}),expr:this.expr}},d.fromJSON=function(y){return new d(y.name,y.params,y.expr)},d.prototype.toHTML=function(y){for(var h=y&&y.parenthesis?y.parenthesis:"keep",_=[],v=0;v<this.params.length;v++)_.push('<span class="math-symbol math-parameter">'+e(this.params[v])+"</span>");var b=this.expr.toHTML(y);return g(this,h)&&(b='<span class="math-parenthesis math-round-parenthesis">(</span>'+b+'<span class="math-parenthesis math-round-parenthesis">)</span>'),'<span class="math-function">'+e(this.name)+'</span><span class="math-parenthesis math-round-parenthesis">(</span>'+_.join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-round-parenthesis">)</span><span class="math-operator math-assignment-operator math-variable-assignment-operator math-binary-operator">=</span>'+b},d.prototype._toTex=function(y){var h=y&&y.parenthesis?y.parenthesis:"keep",_=this.expr.toTex(y);return g(this,h)&&(_="\\left(".concat(_,"\\right)")),"\\mathrm{"+this.name+"}\\left("+this.params.map(r.toSymbol).join(",")+"\\right):="+_},d}return En.name="FunctionAssignmentNode",En.path="expression.node",En.factory=l,En}var Nn={},Sn={},Oo;function Ff(){if(Oo)return Sn;Oo=1;var n=jn;function e(i,t,r,o){function a(l,s,f){if(!(this instanceof a))throw new SyntaxError("Constructor must be called with the new operator");var u=l!=null,c=s!=null,p=f!=null;if(u){if(i.isBigNumber(l))l=l.toNumber();else if(typeof l!="number")throw new TypeError("Parameter start must be a number")}if(c){if(i.isBigNumber(s))s=s.toNumber();else if(typeof s!="number")throw new TypeError("Parameter end must be a number")}if(p){if(i.isBigNumber(f))f=f.toNumber();else if(typeof f!="number")throw new TypeError("Parameter step must be a number")}this.start=u?parseFloat(l):0,this.end=c?parseFloat(s):0,this.step=p?parseFloat(f):1}return a.prototype.type="Range",a.prototype.isRange=!0,a.parse=function(l){if(typeof l!="string")return null;var s=l.split(":"),f=s.map(function(c){return parseFloat(c)}),u=f.some(function(c){return isNaN(c)});if(u)return null;switch(f.length){case 2:return new a(f[0],f[1]);case 3:return new a(f[0],f[2],f[1]);default:return null}},a.prototype.clone=function(){return new a(this.start,this.end,this.step)},a.prototype.size=function(){var l=0,s=this.start,f=this.step,u=this.end,c=u-s;return n.sign(f)===n.sign(c)?l=Math.ceil(c/f):c===0&&(l=0),isNaN(l)&&(l=0),[l]},a.prototype.min=function(){var l=this.size()[0];if(l>0)return this.step>0?this.start:this.start+(l-1)*this.step},a.prototype.max=function(){var l=this.size()[0];if(l>0)return this.step>0?this.start+(l-1)*this.step:this.start},a.prototype.forEach=function(l){var s=this.start,f=this.step,u=this.end,c=0;if(f>0)for(;s<u;)l(s,[c],this),s+=f,c++;else if(f<0)for(;s>u;)l(s,[c],this),s+=f,c++},a.prototype.map=function(l){var s=[];return this.forEach(function(f,u,c){s[u[0]]=l(f,u,c)}),s},a.prototype.toArray=function(){var l=[];return this.forEach(function(s,f){l[f[0]]=s}),l},a.prototype.valueOf=function(){return this.toArray()},a.prototype.format=function(l){var s=n.format(this.start,l);return this.step!==1&&(s+=":"+n.format(this.step,l)),s+=":"+n.format(this.end,l),s},a.prototype.toString=function(){return this.format()},a.prototype.toJSON=function(){return{mathjs:"Range",start:this.start,end:this.end,step:this.step}},a.fromJSON=function(l){return new a(l.start,l.end,l.step)},a}return Sn.name="Range",Sn.path="type",Sn.factory=e,Sn}var To;function Uf(){if(To)return Nn;To=1;var n=Mt().map,e=wt().escape;function i(t,r,o,a){var l=o(st()),s=o(Ff()),f=Array.isArray;function u(p,d){if(!(this instanceof u))throw new SyntaxError("Constructor must be called with the new operator");if(this.dimensions=p,this.dotNotation=d||!1,!f(p)||!p.every(t.isNode))throw new TypeError('Array containing Nodes expected for parameter "dimensions"');if(this.dotNotation&&!this.isObjectProperty())throw new Error("dotNotation only applicable for object properties");var g=function(){throw new Error("Property `IndexNode.object` is deprecated, use `IndexNode.fn` instead")};Object.defineProperty(this,"object",{get:g,set:g})}u.prototype=new l,u.prototype.type="IndexNode",u.prototype.isIndexNode=!0,u.prototype._compile=function(p,d){var g=n(this.dimensions,function(y,h){if(t.isRangeNode(y))if(y.needsEnd()){var _=Object.create(d);_.end=!0;var v=y.start._compile(p,_),b=y.end._compile(p,_),E=y.step?y.step._compile(p,_):function(){return 1};return function(A,F,V){var ee=p.size(V).valueOf(),G=Object.create(F);return G.end=ee[h],c(v(A,G,V),b(A,G,V),E(A,G,V))}}else{var N=y.start._compile(p,d),T=y.end._compile(p,d),R=y.step?y.step._compile(p,d):function(){return 1};return function(A,F,V){return c(N(A,F,V),T(A,F,V),R(A,F,V))}}else if(t.isSymbolNode(y)&&y.name==="end"){var I=Object.create(d);I.end=!0;var w=y._compile(p,I);return function(A,F,V){var ee=p.size(V).valueOf(),G=Object.create(F);return G.end=ee[h],w(A,G,V)}}else{var S=y._compile(p,d);return function(A,F,V){return S(A,F,V)}}});return function(h,_,v){var b=n(g,function(E){return E(h,_,v)});return p.index.apply(p,b)}},u.prototype.forEach=function(p){for(var d=0;d<this.dimensions.length;d++)p(this.dimensions[d],"dimensions["+d+"]",this)},u.prototype.map=function(p){for(var d=[],g=0;g<this.dimensions.length;g++)d[g]=this._ifNode(p(this.dimensions[g],"dimensions["+g+"]",this));return new u(d)},u.prototype.clone=function(){return new u(this.dimensions.slice(0))},u.prototype.isObjectProperty=function(){return this.dimensions.length===1&&t.isConstantNode(this.dimensions[0])&&typeof this.dimensions[0].value=="string"},u.prototype.getObjectProperty=function(){return this.isObjectProperty()?this.dimensions[0].value:null},u.prototype._toString=function(p){return this.dotNotation?"."+this.getObjectProperty():"["+this.dimensions.join(", ")+"]"},u.prototype.toJSON=function(){return{mathjs:"IndexNode",dimensions:this.dimensions,dotNotation:this.dotNotation}},u.fromJSON=function(p){return new u(p.dimensions,p.dotNotation)},u.prototype.toHTML=function(p){for(var d=[],g=0;g<this.dimensions.length;g++)d[g]=this.dimensions[g].toHTML();return this.dotNotation?'<span class="math-operator math-accessor-operator">.</span><span class="math-symbol math-property">'+e(this.getObjectProperty())+"</span>":'<span class="math-parenthesis math-square-parenthesis">[</span>'+d.join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-square-parenthesis">]</span>'},u.prototype._toTex=function(p){var d=this.dimensions.map(function(g){return g.toTex(p)});return this.dotNotation?"."+this.getObjectProperty():"_{"+d.join(",")+"}"};function c(p,d,g){return new s(t.isBigNumber(p)?p.toNumber():p,t.isBigNumber(d)?d.toNumber():d,t.isBigNumber(g)?g.toNumber():g)}return u}return Nn.name="IndexNode",Nn.path="expression.node",Nn.factory=i,Nn}var xn={},Ao;function Bf(){if(Ao)return xn;Ao=1;function n(a){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?n=function(s){return typeof s}:n=function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},n(a)}var e=wt().stringify,i=wt().escape,t=at().isSafeProperty,r=ot.hasOwnProperty;function o(a,l,s,f){var u=s(st());function c(p){if(!(this instanceof c))throw new SyntaxError("Constructor must be called with the new operator");if(this.properties=p||{},p&&(n(p)!=="object"||!Object.keys(p).every(function(d){return a.isNode(p[d])})))throw new TypeError("Object containing Nodes expected")}return c.prototype=new u,c.prototype.type="ObjectNode",c.prototype.isObjectNode=!0,c.prototype._compile=function(p,d){var g={};for(var y in this.properties)if(r(this.properties,y)){var h=e(y),_=JSON.parse(h);if(!t(this.properties,_))throw new Error('No access to property "'+_+'"');g[_]=this.properties[y]._compile(p,d)}return function(b,E,N){var T={};for(var R in g)r(g,R)&&(T[R]=g[R](b,E,N));return T}},c.prototype.forEach=function(p){for(var d in this.properties)this.properties.hasOwnProperty(d)&&p(this.properties[d],"properties["+e(d)+"]",this)},c.prototype.map=function(p){var d={};for(var g in this.properties)this.properties.hasOwnProperty(g)&&(d[g]=this._ifNode(p(this.properties[g],"properties["+e(g)+"]",this)));return new c(d)},c.prototype.clone=function(){var p={};for(var d in this.properties)this.properties.hasOwnProperty(d)&&(p[d]=this.properties[d]);return new c(p)},c.prototype._toString=function(p){var d=[];for(var g in this.properties)this.properties.hasOwnProperty(g)&&d.push(e(g)+": "+this.properties[g].toString(p));return"{"+d.join(", ")+"}"},c.prototype.toJSON=function(){return{mathjs:"ObjectNode",properties:this.properties}},c.fromJSON=function(p){return new c(p.properties)},c.prototype.toHTML=function(p){var d=[];for(var g in this.properties)this.properties.hasOwnProperty(g)&&d.push('<span class="math-symbol math-property">'+i(g)+'</span><span class="math-operator math-assignment-operator math-property-assignment-operator math-binary-operator">:</span>'+this.properties[g].toHTML(p));return'<span class="math-parenthesis math-curly-parenthesis">{</span>'+d.join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-curly-parenthesis">}</span>'},c.prototype._toTex=function(p){var d=[];for(var g in this.properties)this.properties.hasOwnProperty(g)&&d.push("\\mathbf{"+g+":} & "+this.properties[g].toTex(p)+"\\\\");return"\\left\\{\\begin{array}{ll}".concat(d.join(`
`),"\\end{array}\\right\\}")},c}return xn.name="ObjectNode",xn.path="expression.node",xn.factory=o,xn}var In={},Ro;function jf(){if(Ro)return In;Ro=1;var n=fn(),e=Mt().map,i=wt().escape,t=at().isSafeMethod,r=at().getSafeProperty,o=un();function a(l,s,f,u){var c=f(st());function p(g,y,h,_){if(!(this instanceof p))throw new SyntaxError("Constructor must be called with the new operator");if(typeof g!="string")throw new TypeError('string expected for parameter "op"');if(typeof y!="string")throw new TypeError('string expected for parameter "fn"');if(!Array.isArray(h)||!h.every(l.isNode))throw new TypeError('Array containing Nodes expected for parameter "args"');this.implicit=_===!0,this.op=g,this.fn=y,this.args=h||[]}p.prototype=new c,p.prototype.type="OperatorNode",p.prototype.isOperatorNode=!0,p.prototype._compile=function(g,y){if(typeof this.fn!="string"||!t(g,this.fn))throw g[this.fn]?new Error('No access to function "'+this.fn+'"'):new Error("Function "+this.fn+' missing in provided namespace "math"');var h=r(g,this.fn),_=e(this.args,function(N){return N._compile(g,y)});if(_.length===1){var v=_[0];return function(T,R,I){return h(v(T,R,I))}}else if(_.length===2){var b=_[0],E=_[1];return function(T,R,I){return h(b(T,R,I),E(T,R,I))}}else return function(T,R,I){return h.apply(null,e(_,function(w){return w(T,R,I)}))}},p.prototype.forEach=function(g){for(var y=0;y<this.args.length;y++)g(this.args[y],"args["+y+"]",this)},p.prototype.map=function(g){for(var y=[],h=0;h<this.args.length;h++)y[h]=this._ifNode(g(this.args[h],"args["+h+"]",this));return new p(this.op,this.fn,y,this.implicit)},p.prototype.clone=function(){return new p(this.op,this.fn,this.args.slice(0),this.implicit)},p.prototype.isUnary=function(){return this.args.length===1},p.prototype.isBinary=function(){return this.args.length===2};function d(g,y,h,_,v){var b=o.getPrecedence(g,y),E=o.getAssociativity(g,y);if(y==="all"||_.length>2&&g.getIdentifier()!=="OperatorNode:add"&&g.getIdentifier()!=="OperatorNode:multiply"){var N=_.map(function(_e){switch(_e.getContent().type){case"ArrayNode":case"ConstantNode":case"SymbolNode":case"ParenthesisNode":return!1;default:return!0}});return N}var T;switch(_.length){case 0:T=[];break;case 1:var R=o.getPrecedence(_[0],y);if(v&&R!==null){var I,w;if(y==="keep"?(I=_[0].getIdentifier(),w=g.getIdentifier()):(I=_[0].getContent().getIdentifier(),w=g.getContent().getIdentifier()),o.properties[b][w].latexLeftParens===!1){T=[!1];break}if(o.properties[R][I].latexParens===!1){T=[!1];break}}if(R===null){T=[!1];break}if(R<=b){T=[!0];break}T=[!1];break;case 2:var S,M=o.getPrecedence(_[0],y),A=o.isAssociativeWith(g,_[0],y);M===null?S=!1:M===b&&E==="right"&&!A||M<b?S=!0:S=!1;var F,V=o.getPrecedence(_[1],y),ee=o.isAssociativeWith(g,_[1],y);if(V===null?F=!1:V===b&&E==="left"&&!ee||V<b?F=!0:F=!1,v){var G,ae,we;y==="keep"?(G=g.getIdentifier(),ae=g.args[0].getIdentifier(),we=g.args[1].getIdentifier()):(G=g.getContent().getIdentifier(),ae=g.args[0].getContent().getIdentifier(),we=g.args[1].getContent().getIdentifier()),M!==null&&(o.properties[b][G].latexLeftParens===!1&&(S=!1),o.properties[M][ae].latexParens===!1&&(S=!1)),V!==null&&(o.properties[b][G].latexRightParens===!1&&(F=!1),o.properties[V][we].latexParens===!1&&(F=!1))}T=[S,F];break;default:(g.getIdentifier()==="OperatorNode:add"||g.getIdentifier()==="OperatorNode:multiply")&&(T=_.map(function(_e){var J=o.getPrecedence(_e,y),Q=o.isAssociativeWith(g,_e,y),Ie=o.getAssociativity(_e,y);return J===null?!1:b===J&&E===Ie&&!Q?!0:J<b}));break}return _.length>=2&&g.getIdentifier()==="OperatorNode:multiply"&&g.implicit&&y==="auto"&&h==="hide"&&(T=_.map(function(_e,J){var Q=_e.getIdentifier()==="ParenthesisNode";return!!(T[J]||Q)})),T}return p.prototype._toString=function(g){var y=g&&g.parenthesis?g.parenthesis:"keep",h=g&&g.implicit?g.implicit:"hide",_=this.args,v=d(this,y,h,_,!1);if(_.length===1){var b=o.getAssociativity(this,y),E=_[0].toString(g);v[0]&&(E="("+E+")");var N=/[a-zA-Z]+/.test(this.op);return b==="right"?this.op+(N?" ":"")+E:b==="left"?E+(N?" ":"")+this.op:E+this.op}else if(_.length===2){var T=_[0].toString(g),R=_[1].toString(g);return v[0]&&(T="("+T+")"),v[1]&&(R="("+R+")"),this.implicit&&this.getIdentifier()==="OperatorNode:multiply"&&h==="hide"?T+" "+R:T+" "+this.op+" "+R}else if(_.length>2&&(this.getIdentifier()==="OperatorNode:add"||this.getIdentifier()==="OperatorNode:multiply")){var I=_.map(function(w,S){return w=w.toString(g),v[S]&&(w="("+w+")"),w});return this.implicit&&this.getIdentifier()==="OperatorNode:multiply"&&h==="hide"?I.join(" "):I.join(" "+this.op+" ")}else return this.fn+"("+this.args.join(", ")+")"},p.prototype.toJSON=function(){return{mathjs:"OperatorNode",op:this.op,fn:this.fn,args:this.args,implicit:this.implicit}},p.fromJSON=function(g){return new p(g.op,g.fn,g.args,g.implicit)},p.prototype.toHTML=function(g){var y=g&&g.parenthesis?g.parenthesis:"keep",h=g&&g.implicit?g.implicit:"hide",_=this.args,v=d(this,y,h,_,!1);if(_.length===1){var b=o.getAssociativity(this,y),E=_[0].toHTML(g);return v[0]&&(E='<span class="math-parenthesis math-round-parenthesis">(</span>'+E+'<span class="math-parenthesis math-round-parenthesis">)</span>'),b==="right"?'<span class="math-operator math-unary-operator math-lefthand-unary-operator">'+i(this.op)+"</span>"+E:E+'<span class="math-operator math-unary-operator math-righthand-unary-operator">'+i(this.op)+"</span>"}else if(_.length===2){var N=_[0].toHTML(g),T=_[1].toHTML(g);return v[0]&&(N='<span class="math-parenthesis math-round-parenthesis">(</span>'+N+'<span class="math-parenthesis math-round-parenthesis">)</span>'),v[1]&&(T='<span class="math-parenthesis math-round-parenthesis">(</span>'+T+'<span class="math-parenthesis math-round-parenthesis">)</span>'),this.implicit&&this.getIdentifier()==="OperatorNode:multiply"&&h==="hide"?N+'<span class="math-operator math-binary-operator math-implicit-binary-operator"></span>'+T:N+'<span class="math-operator math-binary-operator math-explicit-binary-operator">'+i(this.op)+"</span>"+T}else{var R=_.map(function(I,w){return I=I.toHTML(g),v[w]&&(I='<span class="math-parenthesis math-round-parenthesis">(</span>'+I+'<span class="math-parenthesis math-round-parenthesis">)</span>'),I});return _.length>2&&(this.getIdentifier()==="OperatorNode:add"||this.getIdentifier()==="OperatorNode:multiply")?this.implicit&&this.getIdentifier()==="OperatorNode:multiply"&&h==="hide"?R.join('<span class="math-operator math-binary-operator math-implicit-binary-operator"></span>'):R.join('<span class="math-operator math-binary-operator math-explicit-binary-operator">'+i(this.op)+"</span>"):'<span class="math-function">'+i(this.fn)+'</span><span class="math-paranthesis math-round-parenthesis">(</span>'+R.join('<span class="math-separator">,</span>')+'<span class="math-paranthesis math-round-parenthesis">)</span>'}},p.prototype._toTex=function(g){var y=g&&g.parenthesis?g.parenthesis:"keep",h=g&&g.implicit?g.implicit:"hide",_=this.args,v=d(this,y,h,_,!0),b=n.operators[this.fn];if(b=typeof b>"u"?this.op:b,_.length===1){var E=o.getAssociativity(this,y),N=_[0].toTex(g);return v[0]&&(N="\\left(".concat(N,"\\right)")),E==="right"?b+N:N+b}else if(_.length===2){var T=_[0],R=T.toTex(g);v[0]&&(R="\\left(".concat(R,"\\right)"));var I=_[1],w=I.toTex(g);v[1]&&(w="\\left(".concat(w,"\\right)"));var S;switch(y==="keep"?S=T.getIdentifier():S=T.getContent().getIdentifier(),this.getIdentifier()){case"OperatorNode:divide":return b+"{"+R+"}{"+w+"}";case"OperatorNode:pow":switch(R="{"+R+"}",w="{"+w+"}",S){case"ConditionalNode":case"OperatorNode:divide":R="\\left(".concat(R,"\\right)")}break;case"OperatorNode:multiply":if(this.implicit&&h==="hide")return R+"~"+w}return R+b+w}else if(_.length>2&&(this.getIdentifier()==="OperatorNode:add"||this.getIdentifier()==="OperatorNode:multiply")){var M=_.map(function(A,F){return A=A.toTex(g),v[F]&&(A="\\left(".concat(A,"\\right)")),A});return this.getIdentifier()==="OperatorNode:multiply"&&this.implicit?M.join("~"):M.join(b)}else return"\\mathrm{"+this.fn+"}\\left("+_.map(function(A){return A.toTex(g)}).join(",")+"\\right)"},p.prototype.getIdentifier=function(){return this.type+":"+this.fn},p}return In.name="OperatorNode",In.path="expression.node",In.factory=a,In}var On={},Mo;function Vf(){if(Mo)return On;Mo=1;function n(e,i,t,r){var o=t(st());function a(l){if(!(this instanceof a))throw new SyntaxError("Constructor must be called with the new operator");if(!e.isNode(l))throw new TypeError('Node expected for parameter "content"');this.content=l}return a.prototype=new o,a.prototype.type="ParenthesisNode",a.prototype.isParenthesisNode=!0,a.prototype._compile=function(l,s){return this.content._compile(l,s)},a.prototype.getContent=function(){return this.content.getContent()},a.prototype.forEach=function(l){l(this.content,"content",this)},a.prototype.map=function(l){var s=l(this.content,"content",this);return new a(s)},a.prototype.clone=function(){return new a(this.content)},a.prototype._toString=function(l){return!l||l&&!l.parenthesis||l&&l.parenthesis==="keep"?"("+this.content.toString(l)+")":this.content.toString(l)},a.prototype.toJSON=function(){return{mathjs:"ParenthesisNode",content:this.content}},a.fromJSON=function(l){return new a(l.content)},a.prototype.toHTML=function(l){return!l||l&&!l.parenthesis||l&&l.parenthesis==="keep"?'<span class="math-parenthesis math-round-parenthesis">(</span>'+this.content.toHTML(l)+'<span class="math-parenthesis math-round-parenthesis">)</span>':this.content.toHTML(l)},a.prototype._toTex=function(l){return!l||l&&!l.parenthesis||l&&l.parenthesis==="keep"?"\\left(".concat(this.content.toTex(l),"\\right)"):this.content.toTex(l)},a}return On.name="ParenthesisNode",On.path="expression.node",On.factory=n,On}var Yt={},Jt={},Po;function Za(){if(Po)return Jt;Po=1;var n=fn(),e=wt().escape,i=ot.hasOwnProperty,t=at().getSafeProperty;function r(o,a,l,s,f){var u=l(st());function c(g){return o.Unit?o.Unit.isValuelessUnit(g):!1}function p(g){if(!(this instanceof p))throw new SyntaxError("Constructor must be called with the new operator");if(typeof g!="string")throw new TypeError('String expected for parameter "name"');this.name=g}p.prototype=new u,p.prototype.type="SymbolNode",p.prototype.isSymbolNode=!0,p.prototype._compile=function(g,y){var h=this.name;if(i(y,h))return function(v,b,E){return b[h]};if(h in g)return function(v,b,E){return h in v?t(v,h):t(g,h)};var _=c(h);return function(v,b,E){return h in v?t(v,h):_?new o.Unit(null,h):d(h)}},p.prototype.forEach=function(g){},p.prototype.map=function(g){return this.clone()};function d(g){throw new Error("Undefined symbol "+g)}return p.prototype.clone=function(){return new p(this.name)},p.prototype._toString=function(g){return this.name},p.prototype.toHTML=function(g){var y=e(this.name);return y==="true"||y==="false"?'<span class="math-symbol math-boolean">'+y+"</span>":y==="i"?'<span class="math-symbol math-imaginary-symbol">'+y+"</span>":y==="Infinity"?'<span class="math-symbol math-infinity-symbol">'+y+"</span>":y==="NaN"?'<span class="math-symbol math-nan-symbol">'+y+"</span>":y==="null"?'<span class="math-symbol math-null-symbol">'+y+"</span>":y==="undefined"?'<span class="math-symbol math-undefined-symbol">'+y+"</span>":'<span class="math-symbol">'+y+"</span>"},p.prototype.toJSON=function(){return{mathjs:"SymbolNode",name:this.name}},p.fromJSON=function(g){return new p(g.name)},p.prototype._toTex=function(g){var y=!1;typeof f[this.name]>"u"&&c(this.name)&&(y=!0);var h=n.toSymbol(this.name,y);return h[0]==="\\"?h:" "+h},p}return Jt.name="SymbolNode",Jt.path="expression.node",Jt.math=!0,Jt.factory=r,Jt}var ko;function Gf(){if(ko)return Yt;ko=1;function n(f){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?n=function(c){return typeof c}:n=function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},n(f)}function e(){return e=Object.assign||function(f){for(var u=1;u<arguments.length;u++){var c=arguments[u];for(var p in c)Object.prototype.hasOwnProperty.call(c,p)&&(f[p]=c[p])}return f},e.apply(this,arguments)}var i=fn(),t=wt().escape,r=ot.hasOwnProperty,o=Mt().map,a=at().validateSafeMethod,l=at().getSafeProperty;function s(f,u,c,p,d){var g=c(st()),y=c(Za());function h(E,N){if(!(this instanceof h))throw new SyntaxError("Constructor must be called with the new operator");if(typeof E=="string"&&(E=new y(E)),!f.isNode(E))throw new TypeError('Node expected as parameter "fn"');if(!Array.isArray(N)||!N.every(f.isNode))throw new TypeError('Array containing Nodes expected for parameter "args"');this.fn=E,this.args=N||[],Object.defineProperty(this,"name",{get:function(){return this.fn.name||""}.bind(this),set:function(){throw new Error("Cannot assign a new name, name is read-only")}});var T=function(){throw new Error("Property `FunctionNode.object` is deprecated, use `FunctionNode.fn` instead")};Object.defineProperty(this,"object",{get:T,set:T})}h.prototype=new g,h.prototype.type="FunctionNode",h.prototype.isFunctionNode=!0,h.prototype._compile=function(E,N){if(!(this instanceof h))throw new TypeError("No valid FunctionNode");var T=o(this.args,function(_e){return _e._compile(E,N)});if(f.isSymbolNode(this.fn)){var R=this.fn.name,I=R in E?l(E,R):void 0,w=typeof I=="function"&&I.rawArgs===!0;if(w){var S=this.args;return function(J,Q,Ie){return(R in J?l(J,R):I)(S,E,e({},J,Q))}}else if(T.length===1){var M=T[0];return function(J,Q,Ie){return(R in J?l(J,R):I)(M(J,Q,Ie))}}else if(T.length===2){var A=T[0],F=T[1];return function(J,Q,Ie){return(R in J?l(J,R):I)(A(J,Q,Ie),F(J,Q,Ie))}}else return function(J,Q,Ie){return(R in J?l(J,R):I).apply(null,o(T,function(Ee){return Ee(J,Q,Ie)}))}}else if(f.isAccessorNode(this.fn)&&f.isIndexNode(this.fn.index)&&this.fn.index.isObjectProperty()){var V=this.fn.object._compile(E,N),ee=this.fn.index.getObjectProperty(),G=this.args;return function(J,Q,Ie){var Ee=V(J,Q,Ie);a(Ee,ee);var X=Ee[ee]&&Ee[ee].rawArgs;return X?Ee[ee](G,E,e({},J,Q)):Ee[ee].apply(Ee,o(T,function(ve){return ve(J,Q,Ie)}))}}else{var ae=this.fn._compile(E,N),we=this.args;return function(J,Q,Ie){var Ee=ae(J,Q,Ie),X=Ee&&Ee.rawArgs;return X?Ee(we,E,e({},J,Q)):Ee.apply(Ee,o(T,function(ve){return ve(J,Q,Ie)}))}}},h.prototype.forEach=function(E){E(this.fn,"fn",this);for(var N=0;N<this.args.length;N++)E(this.args[N],"args["+N+"]",this)},h.prototype.map=function(E){for(var N=this._ifNode(E(this.fn,"fn",this)),T=[],R=0;R<this.args.length;R++)T[R]=this._ifNode(E(this.args[R],"args["+R+"]",this));return new h(N,T)},h.prototype.clone=function(){return new h(this.fn,this.args.slice(0))};var _=h.prototype.toString;h.prototype.toString=function(E){var N,T=this.fn.toString(E);return E&&n(E.handler)==="object"&&r(E.handler,T)&&(N=E.handler[T](this,E)),typeof N<"u"?N:_.call(this,E)},h.prototype._toString=function(E){var N=this.args.map(function(R){return R.toString(E)}),T=f.isFunctionAssignmentNode(this.fn)?"("+this.fn.toString(E)+")":this.fn.toString(E);return T+"("+N.join(", ")+")"},h.prototype.toJSON=function(){return{mathjs:"FunctionNode",fn:this.fn,args:this.args}},h.fromJSON=function(E){return new h(E.fn,E.args)},h.prototype.toHTML=function(E){var N=this.args.map(function(T){return T.toHTML(E)});return'<span class="math-function">'+t(this.fn)+'</span><span class="math-paranthesis math-round-parenthesis">(</span>'+N.join('<span class="math-separator">,</span>')+'<span class="math-paranthesis math-round-parenthesis">)</span>'};function v(E,N,T){for(var R="",I=new RegExp("\\$(?:\\{([a-z_][a-z_0-9]*)(?:\\[([0-9]+)\\])?\\}|\\$)","ig"),w=0,S;(S=I.exec(E))!==null;)if(R+=E.substring(w,S.index),w=S.index,S[0]==="$$")R+="$",w++;else{w+=S[0].length;var M=N[S[1]];if(!M)throw new ReferenceError("Template: Property "+S[1]+" does not exist.");if(S[2]===void 0)switch(n(M)){case"string":R+=M;break;case"object":if(f.isNode(M))R+=M.toTex(T);else if(Array.isArray(M))R+=M.map(function(A,F){if(f.isNode(A))return A.toTex(T);throw new TypeError("Template: "+S[1]+"["+F+"] is not a Node.")}).join(",");else throw new TypeError("Template: "+S[1]+" has to be a Node, String or array of Nodes");break;default:throw new TypeError("Template: "+S[1]+" has to be a Node, String or array of Nodes")}else if(f.isNode(M[S[2]]&&M[S[2]]))R+=M[S[2]].toTex(T);else throw new TypeError("Template: "+S[1]+"["+S[2]+"] is not a Node.")}return R+=E.slice(w),R}var b=h.prototype.toTex;return h.prototype.toTex=function(E){var N;return E&&n(E.handler)==="object"&&r(E.handler,this.name)&&(N=E.handler[this.name](this,E)),typeof N<"u"?N:b.call(this,E)},h.prototype._toTex=function(E){var N=this.args.map(function(I){return I.toTex(E)}),T;d[this.name]&&(typeof d[this.name].toTex=="function"||n(d[this.name].toTex)==="object"||typeof d[this.name].toTex=="string")&&(T=d[this.name].toTex);var R;switch(n(T)){case"function":R=T(this,E);break;case"string":R=v(T,this,E);break;case"object":switch(n(T[N.length])){case"function":R=T[N.length](this,E);break;case"string":R=v(T[N.length],this,E);break}}return typeof R<"u"?R:v(i.defaultTemplate,this,E)},h.prototype.getIdentifier=function(){return this.type+":"+this.name},h}return Yt.name="FunctionNode",Yt.path="expression.node",Yt.math=!0,Yt.factory=s,Yt}var Tn={},Co;function Hf(){if(Co)return Tn;Co=1;var n=un();function e(i,t,r,o){var a=r(st());function l(f,u,c){if(!(this instanceof l))throw new SyntaxError("Constructor must be called with the new operator");if(!i.isNode(f))throw new TypeError("Node expected");if(!i.isNode(u))throw new TypeError("Node expected");if(c&&!i.isNode(c))throw new TypeError("Node expected");if(arguments.length>3)throw new Error("Too many arguments");this.start=f,this.end=u,this.step=c||null}l.prototype=new a,l.prototype.type="RangeNode",l.prototype.isRangeNode=!0,l.prototype.needsEnd=function(){var f=this.filter(function(u){return i.isSymbolNode(u)&&u.name==="end"});return f.length>0},l.prototype._compile=function(f,u){var c=f.range,p=this.start._compile(f,u),d=this.end._compile(f,u);if(this.step){var g=this.step._compile(f,u);return function(h,_,v){return c(p(h,_,v),d(h,_,v),g(h,_,v))}}else return function(h,_,v){return c(p(h,_,v),d(h,_,v))}},l.prototype.forEach=function(f){f(this.start,"start",this),f(this.end,"end",this),this.step&&f(this.step,"step",this)},l.prototype.map=function(f){return new l(this._ifNode(f(this.start,"start",this)),this._ifNode(f(this.end,"end",this)),this.step&&this._ifNode(f(this.step,"step",this)))},l.prototype.clone=function(){return new l(this.start,this.end,this.step&&this.step)};function s(f,u){var c=n.getPrecedence(f,u),p={},d=n.getPrecedence(f.start,u);if(p.start=d!==null&&d<=c||u==="all",f.step){var g=n.getPrecedence(f.step,u);p.step=g!==null&&g<=c||u==="all"}var y=n.getPrecedence(f.end,u);return p.end=y!==null&&y<=c||u==="all",p}return l.prototype._toString=function(f){var u=f&&f.parenthesis?f.parenthesis:"keep",c=s(this,u),p,d=this.start.toString(f);if(c.start&&(d="("+d+")"),p=d,this.step){var g=this.step.toString(f);c.step&&(g="("+g+")"),p+=":"+g}var y=this.end.toString(f);return c.end&&(y="("+y+")"),p+=":"+y,p},l.prototype.toJSON=function(){return{mathjs:"RangeNode",start:this.start,end:this.end,step:this.step}},l.fromJSON=function(f){return new l(f.start,f.end,f.step)},l.prototype.toHTML=function(f){var u=f&&f.parenthesis?f.parenthesis:"keep",c=s(this,u),p,d=this.start.toHTML(f);if(c.start&&(d='<span class="math-parenthesis math-round-parenthesis">(</span>'+d+'<span class="math-parenthesis math-round-parenthesis">)</span>'),p=d,this.step){var g=this.step.toHTML(f);c.step&&(g='<span class="math-parenthesis math-round-parenthesis">(</span>'+g+'<span class="math-parenthesis math-round-parenthesis">)</span>'),p+='<span class="math-operator math-range-operator">:</span>'+g}var y=this.end.toHTML(f);return c.end&&(y='<span class="math-parenthesis math-round-parenthesis">(</span>'+y+'<span class="math-parenthesis math-round-parenthesis">)</span>'),p+='<span class="math-operator math-range-operator">:</span>'+y,p},l.prototype._toTex=function(f){var u=f&&f.parenthesis?f.parenthesis:"keep",c=s(this,u),p=this.start.toTex(f);if(c.start&&(p="\\left(".concat(p,"\\right)")),this.step){var d=this.step.toTex(f);c.step&&(d="\\left(".concat(d,"\\right)")),p+=":"+d}var g=this.end.toTex(f);return c.end&&(g="\\left(".concat(g,"\\right)")),p+=":"+g,p},l}return Tn.name="RangeNode",Tn.path="expression.node",Tn.factory=e,Tn}var An={},Do;function qf(){if(Do)return An;Do=1;var n=un(),e=fn(),i=wt().escape;function t(r,o,a,l){var s=a(st()),f=at().getSafeProperty;function u(c,p){if(!(this instanceof u))throw new SyntaxError("Constructor must be called with the new operator");if(!Array.isArray(c))throw new TypeError("Parameter conditionals must be an array");if(!Array.isArray(p))throw new TypeError("Parameter params must be an array");if(c.length!==p.length-1)throw new TypeError("Parameter params must contain exactly one more element than parameter conditionals");this.conditionals=c,this.params=p}return u.prototype=new s,u.prototype.type="RelationalNode",u.prototype.isRelationalNode=!0,u.prototype._compile=function(c,p){var d=this,g=this.params.map(function(y){return y._compile(c,p)});return function(h,_,v){for(var b,E=g[0](h,_,v),N=0;N<d.conditionals.length;N++){b=E,E=g[N+1](h,_,v);var T=f(c,d.conditionals[N]);if(!T(b,E))return!1}return!0}},u.prototype.forEach=function(c){var p=this;this.params.forEach(function(d,g){return c(d,"params["+g+"]",p)},this)},u.prototype.map=function(c){var p=this;return new u(this.conditionals.slice(),this.params.map(function(d,g){return p._ifNode(c(d,"params["+g+"]",p))},this))},u.prototype.clone=function(){return new u(this.conditionals,this.params)},u.prototype._toString=function(c){for(var p=c&&c.parenthesis?c.parenthesis:"keep",d=n.getPrecedence(this,p),g=this.params.map(function(v,b){var E=n.getPrecedence(v,p);return p==="all"||E!==null&&E<=d?"("+v.toString(c)+")":v.toString(c)}),y={equal:"==",unequal:"!=",smaller:"<",larger:">",smallerEq:"<=",largerEq:">="},h=g[0],_=0;_<this.conditionals.length;_++)h+=" "+y[this.conditionals[_]]+" "+g[_+1];return h},u.prototype.toJSON=function(){return{mathjs:"RelationalNode",conditionals:this.conditionals,params:this.params}},u.fromJSON=function(c){return new u(c.conditionals,c.params)},u.prototype.toHTML=function(c){for(var p=c&&c.parenthesis?c.parenthesis:"keep",d=n.getPrecedence(this,p),g=this.params.map(function(v,b){var E=n.getPrecedence(v,p);return p==="all"||E!==null&&E<=d?'<span class="math-parenthesis math-round-parenthesis">(</span>'+v.toHTML(c)+'<span class="math-parenthesis math-round-parenthesis">)</span>':v.toHTML(c)}),y={equal:"==",unequal:"!=",smaller:"<",larger:">",smallerEq:"<=",largerEq:">="},h=g[0],_=0;_<this.conditionals.length;_++)h+='<span class="math-operator math-binary-operator math-explicit-binary-operator">'+i(y[this.conditionals[_]])+"</span>"+g[_+1];return h},u.prototype._toTex=function(c){for(var p=c&&c.parenthesis?c.parenthesis:"keep",d=n.getPrecedence(this,p),g=this.params.map(function(_,v){var b=n.getPrecedence(_,p);return p==="all"||b!==null&&b<=d?"\\left("+_.toTex(c)+"\right)":_.toTex(c)}),y=g[0],h=0;h<this.conditionals.length;h++)y+=e.operators[this.conditionals[h]]+g[h+1];return y},u}return An.name="RelationalNode",An.path="expression.node",An.factory=t,An}var Lo;function ui(){if(Lo)return dn;Lo=1;function n(){return n=Object.assign||function(r){for(var o=1;o<arguments.length;o++){var a=arguments[o];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(r[l]=a[l])}return r},n.apply(this,arguments)}var e=Ha,i=ln();function t(r,o,a,l){var s=a(xf()),f=a(Of()),u=a(Tf()),c=a(Rf()),p=a(Pf()),d=a(kf()),g=a(Df()),y=a(Lf()),h=a(Uf()),_=a(Bf()),v=a(jf()),b=a(Vf()),E=a(Gf()),N=a(Hf()),T=a(qf()),R=a(Za());function I(m,x){if(arguments.length!==1&&arguments.length!==2)throw new e("parse",arguments.length,1,2);var U=x&&x.nodes?x.nodes:{};if(typeof m=="string")return X(m,U);if(Array.isArray(m)||m instanceof r.Matrix)return i(m,function(Y){if(typeof Y!="string")throw new TypeError("String expected");return X(Y,U)});throw new TypeError("String or matrix expected")}var w={NULL:0,DELIMITER:1,NUMBER:2,SYMBOL:3,UNKNOWN:4},S={",":!0,"(":!0,")":!0,"[":!0,"]":!0,"{":!0,"}":!0,'"':!0,"'":!0,";":!0,"+":!0,"-":!0,"*":!0,".*":!0,"/":!0,"./":!0,"%":!0,"^":!0,".^":!0,"~":!0,"!":!0,"&":!0,"|":!0,"^|":!0,"=":!0,":":!0,"?":!0,"==":!0,"!=":!0,"<":!0,">":!0,"<=":!0,">=":!0,"<<":!0,">>":!0,">>>":!0},M={mod:!0,to:!0,in:!0,and:!0,xor:!0,or:!0,not:!0},A={true:!0,false:!1,null:null,undefined:void 0},F=["NaN","Infinity"];function V(){return{extraNodes:{},expression:"",comment:"",index:0,token:"",tokenType:w.NULL,nestingLevel:0,conditionalLevel:null}}function ee(m,x){return m.expression.substr(m.index,x)}function G(m){return ee(m,1)}function ae(m){m.index++}function we(m){return m.expression.charAt(m.index-1)}function _e(m){return m.expression.charAt(m.index+1)}function J(m){for(m.tokenType=w.NULL,m.token="",m.comment="";I.isWhitespace(G(m),m.nestingLevel);)ae(m);if(G(m)==="#")for(;G(m)!==`
`&&G(m)!=="";)m.comment+=G(m),ae(m);if(G(m)===""){m.tokenType=w.DELIMITER;return}if(G(m)===`
`&&!m.nestingLevel){m.tokenType=w.DELIMITER,m.token=G(m),ae(m);return}var x=G(m),U=ee(m,2),Y=ee(m,3);if(Y.length===3&&S[Y]){m.tokenType=w.DELIMITER,m.token=Y,ae(m),ae(m),ae(m);return}if(U.length===2&&S[U]){m.tokenType=w.DELIMITER,m.token=U,ae(m),ae(m);return}if(S[x]){m.tokenType=w.DELIMITER,m.token=x,ae(m);return}if(I.isDigitDot(x)){if(m.tokenType=w.NUMBER,G(m)===".")m.token+=G(m),ae(m),I.isDigit(G(m))||(m.tokenType=w.DELIMITER);else{for(;I.isDigit(G(m));)m.token+=G(m),ae(m);I.isDecimalMark(G(m),_e(m))&&(m.token+=G(m),ae(m))}for(;I.isDigit(G(m));)m.token+=G(m),ae(m);if(G(m)==="E"||G(m)==="e"){if(I.isDigit(_e(m))||_e(m)==="-"||_e(m)==="+"){if(m.token+=G(m),ae(m),(G(m)==="+"||G(m)==="-")&&(m.token+=G(m),ae(m)),!I.isDigit(G(m)))throw Ue(m,'Digit expected, got "'+G(m)+'"');for(;I.isDigit(G(m));)m.token+=G(m),ae(m);if(I.isDecimalMark(G(m),_e(m)))throw Ue(m,'Digit expected, got "'+G(m)+'"')}else if(_e(m)===".")throw ae(m),Ue(m,'Digit expected, got "'+G(m)+'"')}return}if(I.isAlpha(G(m),we(m),_e(m))){for(;I.isAlpha(G(m),we(m),_e(m))||I.isDigit(G(m));)m.token+=G(m),ae(m);M.hasOwnProperty(m.token)?m.tokenType=w.DELIMITER:m.tokenType=w.SYMBOL;return}for(m.tokenType=w.UNKNOWN;G(m)!=="";)m.token+=G(m),ae(m);throw Ue(m,'Syntax error in part "'+m.token+'"')}function Q(m){do J(m);while(m.token===`
`)}function Ie(m){m.nestingLevel++}function Ee(m){m.nestingLevel--}I.isAlpha=function(x,U,Y){return I.isValidLatinOrGreek(x)||I.isValidMathSymbol(x,Y)||I.isValidMathSymbol(U,x)},I.isValidLatinOrGreek=function(x){return/^[a-zA-Z_$\u00C0-\u02AF\u0370-\u03FF\u2100-\u214F]$/.test(x)},I.isValidMathSymbol=function(x,U){return/^[\uD835]$/.test(x)&&/^[\uDC00-\uDFFF]$/.test(U)&&/^[^\uDC55\uDC9D\uDCA0\uDCA1\uDCA3\uDCA4\uDCA7\uDCA8\uDCAD\uDCBA\uDCBC\uDCC4\uDD06\uDD0B\uDD0C\uDD15\uDD1D\uDD3A\uDD3F\uDD45\uDD47-\uDD49\uDD51\uDEA6\uDEA7\uDFCC\uDFCD]$/.test(U)},I.isWhitespace=function(x,U){return x===" "||x==="	"||x===`
`&&U>0},I.isDecimalMark=function(x,U){return x==="."&&U!=="/"&&U!=="*"&&U!=="^"},I.isDigitDot=function(x){return x>="0"&&x<="9"||x==="."},I.isDigit=function(x){return x>="0"&&x<="9"};function X(m,x){var U=V();n(U,{expression:m,extraNodes:x}),J(U);var Y=ve(U);if(U.token!=="")throw U.tokenType===w.DELIMITER?qn(U,"Unexpected operator "+U.token):Ue(U,'Unexpected part "'+U.token+'"');return Y}function ve(m){var x,U=[],Y;for(m.token!==""&&m.token!==`
`&&m.token!==";"&&(x=Ae(m),x.comment=m.comment);m.token===`
`||m.token===";";)U.length===0&&x&&(Y=m.token!==";",U.push({node:x,visible:Y})),J(m),m.token!==`
`&&m.token!==";"&&m.token!==""&&(x=Ae(m),x.comment=m.comment,Y=m.token!==";",U.push({node:x,visible:Y}));return U.length>0?new p(U):(x||(x=new g(void 0),x.comment=m.comment),x)}function Ae(m){var x,U,Y,be,Oe=Ke(m);if(m.token==="="){if(r.isSymbolNode(Oe))return x=Oe.name,Q(m),Y=Ae(m),new c(new R(x),Y);if(r.isAccessorNode(Oe))return Q(m),Y=Ae(m),new c(Oe.object,Oe.index,Y);if(r.isFunctionNode(Oe)&&r.isSymbolNode(Oe.fn)&&(be=!0,U=[],x=Oe.name,Oe.args.forEach(function(xt,yr){r.isSymbolNode(xt)?U[yr]=xt.name:be=!1}),be))return Q(m),Y=Ae(m),new y(x,U,Y);throw Ue(m,"Invalid left hand side of assignment operator =")}return Oe}function Ke(m){for(var x=Re(m);m.token==="?";){var U=m.conditionalLevel;m.conditionalLevel=m.nestingLevel,Q(m);var Y=x,be=Ae(m);if(m.token!==":")throw Ue(m,"False part of conditional expression expected");m.conditionalLevel=null,Q(m);var Oe=Ae(m);x=new d(Y,be,Oe),m.conditionalLevel=U}return x}function Re(m){for(var x=Pt(m);m.token==="or";)Q(m),x=new v("or","or",[x,Pt(m)]);return x}function Pt(m){for(var x=dt(m);m.token==="xor";)Q(m),x=new v("xor","xor",[x,dt(m)]);return x}function dt(m){for(var x=Ge(m);m.token==="and";)Q(m),x=new v("and","and",[x,Ge(m)]);return x}function Ge(m){for(var x=j(m);m.token==="|";)Q(m),x=new v("|","bitOr",[x,j(m)]);return x}function j(m){for(var x=K(m);m.token==="^|";)Q(m),x=new v("^|","bitXor",[x,K(m)]);return x}function K(m){for(var x=Z(m);m.token==="&";)Q(m),x=new v("&","bitAnd",[x,Z(m)]);return x}function Z(m){for(var x=[He(m)],U=[],Y={"==":"equal","!=":"unequal","<":"smaller",">":"larger","<=":"smallerEq",">=":"largerEq"};Y.hasOwnProperty(m.token);){var be={name:m.token,fn:Y[m.token]};U.push(be),Q(m),x.push(He(m))}return x.length===1?x[0]:x.length===2?new v(U[0].name,U[0].fn,x):new T(U.map(function(Oe){return Oe.fn}),x)}function He(m){var x,U,Y,be,Oe;for(x=je(m),U={"<<":"leftShift",">>":"rightArithShift",">>>":"rightLogShift"};U.hasOwnProperty(m.token);)Y=m.token,be=U[Y],Q(m),Oe=[x,je(m)],x=new v(Y,be,Oe);return x}function je(m){var x,U,Y,be,Oe;for(x=qe(m),U={to:"to",in:"to"};U.hasOwnProperty(m.token);)Y=m.token,be=U[Y],Q(m),Y==="in"&&m.token===""?x=new v("*","multiply",[x,new R("in")],!0):(Oe=[x,qe(m)],x=new v(Y,be,Oe));return x}function qe(m){var x,U=[];if(m.token===":"?x=new g(1):x=ze(m),m.token===":"&&m.conditionalLevel!==m.nestingLevel){for(U.push(x);m.token===":"&&U.length<3;)Q(m),m.token===")"||m.token==="]"||m.token===","||m.token===""?U.push(new R("end")):U.push(ze(m));U.length===3?x=new N(U[0],U[2],U[1]):x=new N(U[0],U[1])}return x}function ze(m){var x,U,Y,be,Oe;for(x=O(m),U={"+":"add","-":"subtract"};U.hasOwnProperty(m.token);)Y=m.token,be=U[Y],Q(m),Oe=[x,O(m)],x=new v(Y,be,Oe);return x}function O(m){var x,U,Y,be,Oe;for(x=L(m),U=x,Y={"*":"multiply",".*":"dotMultiply","/":"divide","./":"dotDivide","%":"mod",mod:"mod"};Y.hasOwnProperty(m.token);)be=m.token,Oe=Y[be],Q(m),U=L(m),x=new v(be,Oe,[x,U]);return x}function L(m){var x,U;for(x=B(m),U=x;m.tokenType===w.SYMBOL||m.token==="in"&&r.isConstantNode(x)||m.tokenType===w.NUMBER&&!r.isConstantNode(U)&&(!r.isOperatorNode(U)||U.op==="!")||m.token==="(";)U=B(m),x=new v("*","multiply",[x,U],!0);return x}function B(m){for(var x=C(m),U=x,Y=[];m.token==="/"&&r.isConstantNode(U);)if(Y.push(n({},m)),Q(m),m.tokenType===w.NUMBER)if(Y.push(n({},m)),Q(m),m.tokenType===w.SYMBOL||m.token==="(")n(m,Y.pop()),Y.pop(),U=C(m),x=new v("/","divide",[x,U]);else{Y.pop(),n(m,Y.pop());break}else{n(m,Y.pop());break}return x}function C(m){var x,U,Y,be={"-":"unaryMinus","+":"unaryPlus","~":"bitNot",not:"not"};return be.hasOwnProperty(m.token)?(Y=be[m.token],x=m.token,Q(m),U=[C(m)],new v(x,Y,U)):$(m)}function $(m){var x,U,Y,be;return x=ne(m),(m.token==="^"||m.token===".^")&&(U=m.token,Y=U==="^"?"pow":"dotPow",Q(m),be=[x,C(m)],x=new v(U,Y,be)),x}function ne(m){var x,U,Y,be,Oe;for(x=fe(m),U={"!":"factorial","'":"ctranspose"};U.hasOwnProperty(m.token);)Y=m.token,be=U[Y],J(m),Oe=[x],x=new v(Y,be,Oe),x=H(m,x);return x}function fe(m){var x=[];if(m.tokenType===w.SYMBOL&&m.extraNodes.hasOwnProperty(m.token)){var U=m.extraNodes[m.token];if(J(m),m.token==="("){if(x=[],Ie(m),J(m),m.token!==")")for(x.push(Ae(m));m.token===",";)J(m),x.push(Ae(m));if(m.token!==")")throw Ue(m,"Parenthesis ) expected");Ee(m),J(m)}return new U(x)}return se(m)}function se(m){var x,U;return m.tokenType===w.SYMBOL||m.tokenType===w.DELIMITER&&m.token in M?(U=m.token,J(m),A.hasOwnProperty(U)?x=new g(A[U]):F.indexOf(U)!==-1?x=new g(s(U,"number")):x=new R(U),x=H(m,x),x):me(m)}function H(m,x,U){for(var Y;(m.token==="("||m.token==="["||m.token===".")&&(!U||U.indexOf(m.token)!==-1);)if(Y=[],m.token==="(")if(r.isSymbolNode(x)||r.isAccessorNode(x)){if(Ie(m),J(m),m.token!==")")for(Y.push(Ae(m));m.token===",";)J(m),Y.push(Ae(m));if(m.token!==")")throw Ue(m,"Parenthesis ) expected");Ee(m),J(m),x=new E(x,Y)}else return x;else if(m.token==="["){if(Ie(m),J(m),m.token!=="]")for(Y.push(Ae(m));m.token===",";)J(m),Y.push(Ae(m));if(m.token!=="]")throw Ue(m,"Parenthesis ] expected");Ee(m),J(m),x=new f(x,new h(Y))}else{if(J(m),m.tokenType!==w.SYMBOL)throw Ue(m,"Property name expected after dot");Y.push(new g(m.token)),J(m);var be=!0;x=new f(x,new h(Y,be))}return x}function me(m){var x,U;return m.token==='"'?(U=Je(m),x=new g(U),x=H(m,x),x):et(m)}function Je(m){for(var x="";G(m)!==""&&G(m)!=='"';)G(m)==="\\"&&(x+=G(m),ae(m)),x+=G(m),ae(m);if(J(m),m.token!=='"')throw Ue(m,'End of string " expected');return J(m),JSON.parse('"'+x+'"')}function et(m){var x,U;return m.token==="'"?(U=ut(m),x=new g(U),x=H(m,x),x):hn(m)}function ut(m){for(var x="";G(m)!==""&&G(m)!=="'";)G(m)==="\\"&&(x+=G(m),ae(m)),x+=G(m),ae(m);if(J(m),m.token!=="'")throw Ue(m,"End of string ' expected");return J(m),JSON.parse('"'+x+'"')}function hn(m){var x,U,Y,be;if(m.token==="["){if(Ie(m),J(m),m.token!=="]"){var Oe=Gn(m);if(m.token===";"){for(Y=1,U=[Oe];m.token===";";)J(m),U[Y]=Gn(m),Y++;if(m.token!=="]")throw Ue(m,"End of matrix ] expected");Ee(m),J(m),be=U[0].items.length;for(var xt=1;xt<Y;xt++)if(U[xt].items.length!==be)throw qn(m,"Column dimensions mismatch ("+U[xt].items.length+" !== "+be+")");x=new u(U)}else{if(m.token!=="]")throw Ue(m,"End of matrix ] expected");Ee(m),J(m),x=Oe}}else Ee(m),J(m),x=new u([]);return H(m,x)}return pr(m)}function Gn(m){for(var x=[Ae(m)],U=1;m.token===",";)J(m),x[U]=Ae(m),U++;return new u(x)}function pr(m){if(m.token==="{"){Ie(m);var x,U={};do if(J(m),m.token!=="}"){if(m.token==='"')x=Je(m);else if(m.token==="'")x=ut(m);else if(m.tokenType===w.SYMBOL)x=m.token,J(m);else throw Ue(m,"Symbol or string expected as object key");if(m.token!==":")throw Ue(m,"Colon : expected after object key");J(m),U[x]=Ae(m)}while(m.token===",");if(m.token!=="}")throw Ue(m,"Comma , or bracket } expected after object value");Ee(m),J(m);var Y=new _(U);return Y=H(m,Y),Y}return mr(m)}function mr(m){var x;return m.tokenType===w.NUMBER?(x=m.token,J(m),new g(s(x,o.number))):gr(m)}function gr(m){var x;if(m.token==="("){if(Ie(m),J(m),x=Ae(m),m.token!==")")throw Ue(m,"Parenthesis ) expected");return Ee(m),J(m),x=new b(x),x=H(m,x),x}return vr(m)}function vr(m){throw m.token===""?Ue(m,"Unexpected end of expression"):Ue(m,"Value expected")}function Hn(m){return m.index-m.token.length+1}function Ue(m,x){var U=Hn(m),Y=new SyntaxError(x+" (char "+U+")");return Y.char=U,Y}function qn(m,x){var U=Hn(m),Y=new SyntaxError(x+" (char "+U+")");return Y.char=U,Y}return I}return dn.name="parse",dn.path="expression",dn.factory=t,dn}var Fo;function zf(){if(Fo)return Xn;Fo=1;function n(e,i,t,r){var o=t(ui());return r("parse",{"string | Array | Matrix":o,"string | Array | Matrix, Object":o})}return Xn.name="parse",Xn.factory=n,Xn}var $n={},Uo;function Xf(){if(Uo)return $n;Uo=1;var n=ln();function e(i,t,r,o){var a=r(ui());return o("compile",{string:function(s){return a(s).compile()},"Array | Matrix":function(s){return n(s,function(f){return a(f).compile()})}})}return $n.name="compile",$n.factory=e,$n}var er={},Bo;function Wf(){if(Bo)return er;Bo=1;var n=ln();function e(i,t,r,o){var a=r(ui());return o("compile",{string:function(s){var f={};return a(s).compile().eval(f)},"string, Object":function(s,f){return a(s).compile().eval(f)},"Array | Matrix":function(s){var f={};return n(s,function(u){return a(u).compile().eval(f)})},"Array | Matrix, Object":function(s,f){return n(s,function(u){return a(u).compile().eval(f)})}})}return er.name="eval",er.factory=e,er}var tr={},jo;function Yf(){if(jo)return tr;jo=1;var n=wt();function e(i,t,r,o){var a=o("format",{any:n.format,"any, Object | function | number":n.format});return a.toTex=void 0,a}return tr.name="format",tr.factory=e,tr}var Jf=Fa.exports,Ht=Jf.create();Ht.import(zf());Ht.import(Xf());Ht.import(Wf());Ht.import(Yf());Ht.import({add:function(n,e){return n+e},subtract:function(n,e){return n-e},multiply:function(n,e){return n*e},divide:function(n,e){return n/e},mod:function(n,e){return n%e},unaryPlus:function(n){return n},unaryMinus:function(n){return-n},bitOr:function(n,e){return n|e},bitXor:function(n,e){return n^e},bitAnd:function(n,e){return n&e},bitNot:function(n){return~n},leftShift:function(n,e){return n<<e},rightArithShift:function(n,e){return n>>e},rightLogShift:function(n,e){return n>>>e},or:function(n,e){return!!(n||e)},xor:function(n,e){return!!n!=!!e},and:function(n,e){return!!(n&&e)},not:function(n){return!n},equal:function(n,e){return n==e},unequal:function(n,e){return n!=e},smaller:function(n,e){return n<e},larger:function(n,e){return n>e},smallerEq:function(n,e){return n<=e},largerEq:function(n,e){return n>=e},matrix:function(){throw new Error("Matrices not supported")},index:function(){throw new Error("Matrix indexes not supported")},pi:Math.PI,e:Math.E,true:!0,false:!1,null:null});var Qa={};Object.getOwnPropertyNames(Math).forEach(function(n){Object.prototype.hasOwnProperty(n)||(Qa[n]=Math[n])});Ht.import(Qa);var Kf=Ht;const fi=function(e){this.gl=e,this.textureIndex=0};fi.prototype.newTextureIndex=function(){const e=this.textureIndex;return this.textureIndex+=1,e};fi.prototype.reset=function(){this.textureIndex=0};function Ft(n,e,i){console.log("HELLO",n),this.gl=n,console.log("\u{1F6A8} shaders:",this.gl.VERTEX_SHADER),this.vShader=this.createShader(e,this.gl.VERTEX_SHADER),this.fShader=this.createShader(i,this.gl.FRAGMENT_SHADER),this.program=this.createProgram(this.vShader,this.fShader),this.locations={}}Ft.prototype.use=function(){try{this.gl.useProgram(this.program)}catch(e){console.error(e),console.error(this.gl.getError())}};Ft.prototype.getUniformLocation=function(e){return this.gl.getUniformLocation(this.program,e)};Ft.prototype.bindVertices=function(){this.use();const e=this.gl.getAttribLocation(this.program,"isf_position");this.buffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer);const i=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);this.gl.bufferData(this.gl.ARRAY_BUFFER,i,this.gl.STATIC_DRAW),this.gl.enableVertexAttribArray(e),this.gl.vertexAttribPointer(e,2,this.gl.FLOAT,!1,0,0)};Ft.prototype.cleanup=function(){this.gl.deleteShader(this.fShader),this.gl.deleteShader(this.vShader),this.gl.deleteProgram(this.program),this.gl.deleteBuffer(this.buffer)};Ft.prototype.createShader=function(e,i){const t=this.gl.createShader(i);this.gl.shaderSource(t,e),this.gl.compileShader(t);const r=this.gl.getShaderParameter(t,this.gl.COMPILE_STATUS);if(window.shaderSrc=e,console.log("\u{1F6A8} compiled:",r,this.gl.getShaderInfoLog(t)),!r){const o=this.gl.getShaderInfoLog(t),a=e.split(`
`);throw console.log(o),o.split(`
`).forEach(l=>{var c,p,d;l=l.substring(9);const s=parseInt(((c=l.split(":"))==null?void 0:c[0])||0),f=((p=l.split(":"))==null?void 0:p[1])||"N/A";console.error(`${f} ${(d=l.split(":"))==null?void 0:d[2]}`);let u="";for(let g=s-1;g<s+1;g++)u+=`${g}: ${a[g].replaceAll("	","").replaceAll(`
`,"")}
`;console.log(u)}),new Error({message:o,type:"shader"})}return t};Ft.prototype.createProgram=function(e,i){const t=this.gl.createProgram();if(this.gl.attachShader(t,e),this.gl.attachShader(t,i),this.gl.linkProgram(t),!this.gl.getProgramParameter(t,this.gl.LINK_STATUS)){const o=this.gl.getProgramInfoLog(t);throw console.log("Error in program linking",o),new Error({message:o,type:"program"})}return t};function on(n,e){n==null&&(n={}),this.contextState=e,this.float=n.float,this.gl=this.contextState.gl,this.texture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0),this.gl.bindTexture(this.gl.TEXTURE_2D,null)}on.prototype.bind=function(e){e==null&&(e=-1);const i=this.contextState.newTextureIndex();this.gl.activeTexture(this.gl.TEXTURE0+i),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),e!==-1&&this.gl.uniform1i(e,i)};on.prototype.setSize=function(e,i){if(this.width!==e||this.height!==i){this.width=e,this.height=i;const t=this.float?this.gl.FLOAT:this.gl.UNSIGNED_BYTE;this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,e,i,0,this.gl.RGBA,t,null)}};on.prototype.destroy=function(){this.gl.deleteTexture(this.texture)};function cn(n,e){this.contextState=e,this.gl=this.contextState.gl,this.persistent=n.persistent,this.name=n.target,this.textures=[],this.textures.push(new on(n,this.contextState)),this.textures.push(new on(n,this.contextState)),this.flipFlop=!1,this.fbo=this.gl.createFramebuffer(),this.flipFlop=!1}cn.prototype.setSize=function(e,i){if(this.width!==e||this.height!==i){this.width=e,this.height=i;for(let t=0;t<this.textures.length;t++)this.textures[t].setSize(e,i)}};cn.prototype.readTexture=function(){return this.flipFlop?this.textures[1]:this.textures[0]};cn.prototype.writeTexture=function(){return this.flipFlop?this.textures[0]:this.textures[1]};cn.prototype.flip=function(){this.flipFlop=!this.flipFlop};cn.prototype.destroy=function(){for(let e=0;e<this.textures.length;e++)this.textures[e].destroy();this.gl.deleteFramebuffer(this.fbo)};const Zf=function(){var n,e,i={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},t,r=function(d){throw{name:"SyntaxError",message:d,at:n,text:t}},o=function(d){return d&&d!==e&&r("Expected '"+d+"' instead of '"+e+"'"),e=t.charAt(n),n+=1,e},a=function(){var d,g="";for(e==="-"&&(g="-",o("-"));e>="0"&&e<="9";)g+=e,o();if(e===".")for(g+=".";o()&&e>="0"&&e<="9";)g+=e;if(e==="e"||e==="E")for(g+=e,o(),(e==="-"||e==="+")&&(g+=e,o());e>="0"&&e<="9";)g+=e,o();if(d=+g,!isFinite(d))r("Bad number");else return d},l=function(){var d,g,y="",h;if(e==='"')for(;o();){if(e==='"')return o(),y;if(e==="\\")if(o(),e==="u"){for(h=0,g=0;g<4&&(d=parseInt(o(),16),!!isFinite(d));g+=1)h=h*16+d;y+=String.fromCharCode(h)}else if(typeof i[e]=="string")y+=i[e];else break;else y+=e}r("Bad string")},s=function(){for(;e&&e<=" ";)o()},f=function(){switch(e){case"t":return o("t"),o("r"),o("u"),o("e"),!0;case"f":return o("f"),o("a"),o("l"),o("s"),o("e"),!1;case"n":return o("n"),o("u"),o("l"),o("l"),null}r("Unexpected '"+e+"'")},u,c=function(){var d=[];if(e==="["){if(o("["),s(),e==="]")return o("]"),d;for(;e;){if(d.push(u()),s(),e==="]")return o("]"),d;o(","),s()}}r("Bad array")},p=function(){var d,g={};if(e==="{"){if(o("{"),s(),e==="}")return o("}"),g;for(;e;){if(d=l(),s(),o(":"),Object.hasOwnProperty.call(g,d)&&r("Duplicate key '"+d+"'"),g[d]=u(),s(),e==="}")return o("}"),g;o(","),s()}}r("Bad object")};return u=function(){switch(s(),e){case"{":return p();case"[":return c();case'"':return l();case"-":return a();default:return e>="0"&&e<="9"?a():f()}},function(d,g){var y;return t=d,n=0,e=" ",y=u(),s(),e&&r("Syntax error"),typeof g=="function"?function h(_,v){var b,E,N=_[v];if(N&&typeof N=="object")for(b in N)Object.prototype.hasOwnProperty.call(N,b)&&(E=h(N,b),E!==void 0?N[b]=E:delete N[b]);return g.call(_,v,N)}({"":y},""):y}}(),Vo="Something is wrong with your ISF metadata";function Qf(n){const i=/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*+/.exec(n);if(!i)throw new Error("There is no metadata here.");let t=i[0];t=t.substring(1,t.length-1);let r;try{r=Zf(t)}catch(l){const s=l.at,f=l.message||"Invalid JSON";if(s){const u=(t||"").substring(0,s).split(/\r\n|\r|\n/),c=u.length,p=u[c-1].length,d=`${Vo}: ${f}        at line ${c} and position ${p}`,g=new Error(d);throw g.lineNumber=c,g.position=p,g}throw new Error(`${Vo}: ${f}`)}const o=n.indexOf("/*"),a=n.indexOf("*/");return{objectValue:r,stringValue:t,startIndex:o,endIndex:a}}const $f={float:"float",image:"sampler2D",bool:"bool",event:"bool",long:"int",color:"vec4",point2D:"vec2"},We=function(){};We.prototype.parse=function(e,i){try{this.valid=!0,this.rawFragmentShader=e,this.rawVertexShader=i||We.vertexShaderDefault,this.error=null;const t=Qf(this.rawFragmentShader),r=t.objectValue,o=t.stringValue;this.metadata=r,this.credit=r.CREDIT,this.categories=r.CATEGORIES,this.inputs=r.INPUTS,this.imports=r.IMPORTED||{},this.description=r.DESCRIPTION;const a=r.PASSES||[{}];this.passes=this.parsePasses(a);const l=this.rawFragmentShader.indexOf(o)+o.length+2;this.rawFragmentMain=this.rawFragmentShader.substring(l),this.generateShaders(),this.inferFilterType(),this.isfVersion=this.inferISFVersion()}catch(t){this.valid=!1,this.error=t,this.inputs=[],this.categories=[],this.credit="",this.errorLine=t.lineNumber}};We.prototype.parsePasses=function(e){const i=[];for(let t=0;t<e.length;++t){const r=e[t],o={};r.TARGET&&(o.target=r.TARGET),o.persistent=!!r.PERSISTENT,o.width=r.WIDTH||"$WIDTH",o.height=r.HEIGHT||"$HEIGHT",o.float=!!r.FLOAT,i.push(o)}return i};We.prototype.generateShaders=function(){this.uniformDefs="";for(let e=0;e<this.inputs.length;++e)this.addUniform(this.inputs[e]);for(let e=0;e<this.passes.length;++e)this.passes[e].target&&this.addUniform({NAME:this.passes[e].target,TYPE:"image"});for(const e in this.imports)({}).hasOwnProperty.call(this.imports,e)&&this.addUniform({NAME:e,TYPE:"image"});this.fragmentShader=this.buildFragmentShader(),this.vertexShader=this.buildVertexShader()};We.prototype.addUniform=function(e){const i=this.inputToType(e.TYPE);this.addUniformLine(`uniform ${i} ${e.NAME};`),i==="sampler2D"&&this.addUniformLine(this.samplerUniforms(e))};We.prototype.addUniformLine=function(e){this.uniformDefs+=`${e}
`};We.prototype.samplerUniforms=function(e){const i=e.NAME;let t="";return t+=`uniform vec4 _${i}_imgRect;
`,t+=`uniform vec2 _${i}_imgSize;
`,t+=`uniform bool _${i}_flip;
`,t+=`varying vec2 _${i}_normTexCoord;
`,t+=`varying vec2 _${i}_texCoord;
`,t+=`
`,t};We.prototype.buildFragmentShader=function(){const e=this.replaceSpecialFunctions(this.rawFragmentMain);return We.fragmentShaderSkeleton.replace("[[uniforms]]",this.uniformDefs).replace("[[main]]",e)};We.prototype.replaceSpecialFunctions=function(e){let i;return i=/IMG_THIS_PIXEL\((.+?)\)/g,e=e.replace(i,(t,r)=>`texture2D(${r}, isf_FragNormCoord)`),i=/IMG_THIS_NORM_PIXEL\((.+?)\)/g,e=e.replace(i,(t,r)=>`texture2D(${r}, isf_FragNormCoord)`),i=/IMG_PIXEL\((.+?)\)/g,e=e.replace(i,(t,r)=>{const o=r.split(","),a=o[0].trim(),l=o[1].trim();return`texture2D(${a}, (${l}) / RENDERSIZE)`}),i=/IMG_NORM_PIXEL\((.+?)\)/g,e=e.replace(i,(t,r)=>{const o=r.split(","),a=o[0].trim(),l=o[1].trim();return`texture2D(${a}, (${l}))`}),i=/IMG_SIZE\((.+?)\)/g,e=e.replace(i,(t,r)=>`_${r}_imgSize`),e};We.prototype.buildVertexShader=function(){let e=`
`;for(let i=0;i<this.inputs.length;++i){const t=this.inputs[i];t.TYPE==="image"&&(e+=`${this.texCoordFunctions(t)}
`)}return We.vertexShaderSkeleton.replace("[[functions]]",e).replace("[[uniforms]]",this.uniformDefs).replace("[[main]]",this.rawVertexShader)};We.prototype.texCoordFunctions=function(e){const i=e.NAME;return["_[[name]]_texCoord =","    vec2(((isf_fragCoord.x / _[[name]]_imgSize.x * _[[name]]_imgRect.z) + _[[name]]_imgRect.x), ","          (isf_fragCoord.y / _[[name]]_imgSize.y * _[[name]]_imgRect.w) + _[[name]]_imgRect.y);","","_[[name]]_normTexCoord =","  vec2((((isf_FragNormCoord.x * _[[name]]_imgSize.x) / _[[name]]_imgSize.x * _[[name]]_imgRect.z) + _[[name]]_imgRect.x),","          ((isf_FragNormCoord.y * _[[name]]_imgSize.y) / _[[name]]_imgSize.y * _[[name]]_imgRect.w) + _[[name]]_imgRect.y);"].join(`
`).replace(/\[\[name\]\]/g,i)};We.prototype.inferFilterType=function(){function e(r,o){return r.filter(o).length>0}const i=e(this.inputs,r=>r.TYPE==="image"&&r.NAME==="inputImage"),t=e(this.inputs,r=>r.TYPE==="image"&&r.NAME==="startImage")&&e(this.inputs,r=>r.TYPE==="image"&&r.NAME==="endImage")&&e(this.inputs,r=>r.TYPE==="float"&&r.NAME==="progress");i?this.type="filter":t?this.type="transition":this.type="generator"};We.prototype.inferISFVersion=function(){let e=2;return(this.metadata.PERSISTENT_BUFFERS||this.rawFragmentShader.indexOf("vv_FragNormCoord")!==-1||this.rawVertexShader.indexOf("vv_vertShaderInit")!==-1||this.rawVertexShader.indexOf("vv_FragNormCoord")!==-1)&&(e=1),e};We.prototype.inputToType=function(e){const i=$f[e];if(!i)throw new Error(`Unknown input type [${e}]`);return i};We.fragmentShaderSkeleton=`
precision highp float;
precision highp int;

uniform int PASSINDEX;
uniform vec2 RENDERSIZE;
varying vec2 isf_FragNormCoord;
varying vec2 isf_FragCoord;
uniform float TIME;
uniform float TIMEDELTA;
uniform int FRAMEINDEX;
uniform vec4 DATE;

[[uniforms]]

// We don't need 2DRect functions since we control all inputs.  Don't need flip either, but leaving
// for consistency sake.
vec4 VVSAMPLER_2DBYPIXEL(sampler2D sampler, vec4 samplerImgRect, vec2 samplerImgSize, bool samplerFlip, vec2 loc) {
  return (samplerFlip)
    ? texture2D   (sampler,vec2(((loc.x/samplerImgSize.x*samplerImgRect.z)+samplerImgRect.x), (samplerImgRect.w-(loc.y/samplerImgSize.y*samplerImgRect.w)+samplerImgRect.y)))
    : texture2D   (sampler,vec2(((loc.x/samplerImgSize.x*samplerImgRect.z)+samplerImgRect.x), ((loc.y/samplerImgSize.y*samplerImgRect.w)+samplerImgRect.y)));
}
vec4 VVSAMPLER_2DBYNORM(sampler2D sampler, vec4 samplerImgRect, vec2 samplerImgSize, bool samplerFlip, vec2 normLoc)  {
  vec4    returnMe = VVSAMPLER_2DBYPIXEL(   sampler,samplerImgRect,samplerImgSize,samplerFlip,vec2(normLoc.x*samplerImgSize.x, normLoc.y*samplerImgSize.y));
  return returnMe;
}

[[main]]

`;We.vertexShaderDefault=`
void main() {
  isf_vertShaderInit();
}
`;We.vertexShaderSkeleton=`
precision highp float;
precision highp int;
void isf_vertShaderInit();

attribute vec2 isf_position; // -1..1

uniform int     PASSINDEX;
uniform vec2    RENDERSIZE;
varying vec2    isf_FragNormCoord; // 0..1
vec2    isf_fragCoord; // Pixel Space

[[uniforms]]

[[main]]
void isf_vertShaderInit(void)  {
gl_Position = vec4( isf_position, 0.0, 1.0 );
  isf_FragNormCoord = vec2((gl_Position.x+1.0)/2.0, (gl_Position.y+1.0)/2.0);
  isf_fragCoord = floor(isf_FragNormCoord * RENDERSIZE);
  [[functions]]
}
`;function Go(n){const e=n.split(`
`);for(let i=0;i<e.length;i++)if(e[i].indexOf("main()")!==-1)return i;return-1}function ec(n,e,i){const t=Go(e),r=Go(i),a=/ERROR: (\d+):(\d+): (.*)/g.exec(n.message),l=a==null?void 0:a[2];return parseInt(l,10)+r-t}const tc=(n,e)=>null,nc=Kf.eval;function Be(n){this.ctx=n,this.gl=n,this.uniforms=[],this.contextState=new fi(this.ctx),console.log("\u{1F6A8} setting up paint"),this.setupPaintToScreen(),this.startTime=Date.now(),this.lastRenderTime=Date.now(),this.frameIndex=0,this.parser={}}Be.prototype.loadSource=function(e,i){this.parser=new We,this.parser.parse(e,i),this.sourceChanged(this.parser.fragmentShader,this.parser.vertexShader,this.parser)};Be.prototype.sourceChanged=function(e,i,t){if(this.fragmentShader=e,this.vertexShader=i,this.model=t,!this.model.valid){this.valid=!1,this.error=this.model.error,this.errorLine=this.model.errorLine,console.error(this.valid,this.error,this.errorLine);return}try{this.valid=!0,this.error=null,this.errorLine=null,this.setupGL(),this.initUniforms();for(let r=0;r<t.inputs.length;r++){const o=t.inputs[r];o.DEFAULT!==void 0&&this.setValue(o.NAME,o.DEFAULT)}}catch(r){this.valid=!1,this.error=r,this.errorLine=ec(r,this.fragmentShader,this.model.rawFragmentShader)}};Be.prototype.initUniforms=function(){this.uniforms=this.findUniforms(this.fragmentShader);const e=this.model.inputs;for(let i=0;i<e.length;++i){const t=e[i],r=this.uniforms[t.NAME];!r||(r.value=this.model[t.NAME],r.type==="t"&&(r.texture=new on({},this.contextState)))}this.pushTextures()};Be.prototype.setValue=function(e,i){this.program.use();const t=this.uniforms[e];if(!t){console.error(`No uniform named ${e}`);return}t.value=i,t.type==="t"&&(t.textureLoaded=!1),this.pushUniform(t)};Be.prototype.getValue=function(e){return this.uniforms[e]};Be.prototype.setNormalizedValue=function(e,i){const t=this.model.inputs;let r=null;for(let o=0;o<t.length;o++){const a=t[o];if(a.NAME===e){r=a;break}}r&&r.MIN!==void 0&&r.MAX!==void 0&&this.setValue(e,r.MIN+(r.MAX-r.MIN)*i)};Be.prototype.setupPaintToScreen=function(){const{basicVertexShader:e,basicFragmentShader:i}=this;return console.log("\u{1F6A8} new program:",{basicVertexShader:e,basicFragmentShader:i}),this.paintProgram=new Ft(this.ctx,this.basicVertexShader,this.basicFragmentShader),this.paintProgram.bindVertices()};Be.prototype.setupGL=function(){this.cleanup(),this.program=new Ft(this.ctx,this.vertexShader,this.fragmentShader),this.program.bindVertices(),this.generatePersistentBuffers()};Be.prototype.generatePersistentBuffers=function(){this.renderBuffers=[];const e=this.model.passes;for(let i=0;i<e.length;++i){const t=e[i],r=new cn(t,this.contextState);t.buffer=r,this.renderBuffers.push(r)}};Be.prototype.paintToScreen=function(e,i){this.paintProgram.use(),this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,null),this.ctx.viewport(0,0,e.width,e.height);const t=this.paintProgram.getUniformLocation("tex");i.readTexture().bind(t),this.ctx.drawArrays(this.ctx.TRIANGLES,0,6),this.program.use()};Be.prototype.pushTextures=function(){Object.keys(this.uniforms).forEach(e=>{const i=this.uniforms[e];i.type==="t"&&this.pushTexture(i)})};Be.prototype.pushTexture=function(e){if(!e.value||e.value.constructor.name!=="OffscreenCanvas"&&e.value.tagName!=="CANVAS"&&!e.value.complete&&e.value.readyState!==4)return;const i=this.program.getUniformLocation(e.name);if(e.texture.bind(i),this.ctx.texImage2D(this.ctx.TEXTURE_2D,0,this.ctx.RGBA,this.ctx.RGBA,this.ctx.UNSIGNED_BYTE,e.value),!e.textureLoaded){const t=e.value;e.textureLoaded=!0;const r=t.naturalWidth||t.width||t.videoWidth,o=t.naturalHeight||t.height||t.videoHeight;this.setValue(`_${e.name}_imgSize`,[r,o]),this.setValue(`_${e.name}_imgRect`,[0,0,1,1]),this.setValue(`_${e.name}_flip`,!1)}};Be.prototype.pushUniforms=function(){for(const e of this.uniforms)this.pushUniform(e)};Be.prototype.pushUniform=function(e){const i=this.program.getUniformLocation(e.name);if(i!==-1){if(e.type==="t"){this.pushTexture(e);return}const t=e.value;switch(e.type){case"f":this.ctx.uniform1f(i,t);break;case"v2":this.ctx.uniform2f(i,t[0],t[1]);break;case"v3":this.ctx.uniform3f(i,t[0],t[1],t[2]);break;case"v4":this.ctx.uniform4f(i,t[0],t[1],t[2],t[3]);break;case"i":this.ctx.uniform1i(i,t);break;case"color":this.ctx.uniform4f(i,t[0],t[1],t[2],t[3]);break;default:tc(`Unknown type for uniform setting ${e.type}`);break}}};Be.prototype.findUniforms=function(e){const i=e.split(`
`),t={},r=i.length;for(let o=0;o<r;++o){const a=i[o].trim();if(a.indexOf("uniform")===0){const l=a.split(" "),s=l[2].substring(0,l[2].length-1),f=this.typeToUniform(l[1]);f.name=s,t[s]=f}}return t};Be.prototype.typeToUniform=function(e){switch(e){case"float":return{type:"f",value:0};case"vec2":return{type:"v2",value:[0,0]};case"vec3":return{type:"v3",value:[0,0,0]};case"vec4":return{type:"v4",value:[0,0,0,0]};case"bool":return{type:"i",value:0};case"int":return{type:"i",value:0};case"color":return{type:"v4",value:[0,0,0,0]};case"point2D":return{type:"v2",value:[0,0],isPoint:!0};case"sampler2D":return{type:"t",value:{complete:!1,readyState:0},texture:null,textureUnit:null};default:throw new Error(`Unknown uniform type in ISFRenderer.typeToUniform: ${e}`)}};Be.prototype.setDateUniforms=function(){const e=Date.now();this.setValue("TIME",(e-this.startTime)/1e3),this.setValue("TIMEDELTA",(e-this.lastRenderTime)/1e3),this.setValue("FRAMEINDEX",this.frameIndex++);const i=new Date;this.setValue("DATE",[i.getFullYear(),i.getMonth()+1,i.getDate(),i.getHours()*3600+i.getMinutes()*60+i.getSeconds()]),this.lastRenderTime=e};Be.prototype.draw=function(e){this.contextState.reset(),this.program.use(),this.setDateUniforms();const i=this.renderBuffers;for(let o=0;o<i.length;++o){const a=i[o],l=a.readTexture(),s=this.program.getUniformLocation(a.name);l.bind(s),a.name&&(this.setValue(`_${a.name}_imgSize`,[a.width,a.height]),this.setValue(`_${a.name}_imgRect`,[0,0,1,1]),this.setValue(`_${a.name}_flip`,!1))}let t=null;const r=this.model.passes;for(let o=0;o<r.length;++o){const a=r[o];this.setValue("PASSINDEX",o);const l=a.buffer;if(a.target){const s=this.evaluateSize(e,a.width),f=this.evaluateSize(e,a.height);l.setSize(s,f);const u=l.writeTexture();this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,l.fbo),this.ctx.framebufferTexture2D(this.ctx.FRAMEBUFFER,this.ctx.COLOR_ATTACHMENT0,this.ctx.TEXTURE_2D,u.texture,0),this.setValue("RENDERSIZE",[l.width,l.height]),t=l,this.ctx.viewport(0,0,s,f)}else{const s=e.width,f=e.height;this.ctx.bindTexture(this.ctx.TEXTURE_2D,null),this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,null),this.setValue("RENDERSIZE",[s,f]),t=null,this.ctx.viewport(0,0,s,f)}this.ctx.drawArrays(this.ctx.TRIANGLES,0,6),this.ctx.bindTexture(this.ctx.TEXTURE_2D,null),this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,null)}for(let o=0;o<i.length;++o)i[o].flip();t&&this.paintToScreen(e,t)};Be.prototype.evaluateSize=function(e,i){i+="";let t=i.replace("$WIDTH",(e==null?void 0:e.offsetWidth)||(e==null?void 0:e.width)).replace("$HEIGHT",(e==null?void 0:e.offsetHeight)||(e==null?void 0:e.height));for(const r in this.uniforms)if({}.hasOwnProperty.call(this.uniforms,r)){const o=this.uniforms[r];t=t.replace(`$${r}`,o.value)}return nc(t)};Be.prototype.cleanup=function(){if(this.contextState.reset(),this.renderBuffers)for(let e=0;e<this.renderBuffers.length;++e)this.renderBuffers[e].destroy()};Be.prototype.basicVertexShader=`precision mediump float;
precision mediump int;
attribute vec2 isf_position; // -1..1
varying vec2 texCoord;

void main(void) {
  // Since webctx doesn't support ftransform, we do this by hand.
  gl_Position = vec4(isf_position, 0, 1);
  texCoord = isf_position;
}
`;Be.prototype.basicFragmentShader=`precision mediump float;
uniform sampler2D tex;
varying vec2 texCoord;
void main()
{
  gl_FragColor = texture2D(tex, texCoord * 0.5 + 0.5);
  //gl_FragColor = vec4(texCoord.x);
}`;const rc="isf_vertShaderInit();",ft={texcoord:"isf_FragNormCoord",width:"RENDERSIZE.x"},ic=`

varying vec2 VTC_11;
varying vec2 VTC_00;
varying vec2 VTC_02;
varying vec2 VTC_20;
varying vec2 VTC_22;

void main() {
  ${rc}

  VTC_11 = ${ft.texcoord};
  VTC_00 = ${ft.texcoord} + vec2(-${ft.width}, -${ft.width});
  VTC_02 = ${ft.texcoord} + vec2( ${ft.width}, -${ft.width});
  VTC_20 = ${ft.texcoord} + vec2( ${ft.width},  ${ft.width});
  VTC_22 = ${ft.texcoord} + vec2(-${ft.width},  ${ft.width});
}`,oc=window;async function ac(){let n=ye($t),e=ye(Vt);if(n)return n.close(),$t.set(null),yt.set(Tt.COMPILE),null;const i=`toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=no,resizable=yes,width=${e.width},height=${e.height},top=0,left=0`;n=await oc.open("","MXZ",i),n.document.body.style="margin:0;padding:0;background:black;";const t=document.createElement("canvas");return t.id="canvas",t.width=e.width,t.height=e.height,t.style="position:fixed;top:0;left:0;width:100%;height:100%;",n.document.body.appendChild(t),n.document.title="MXZ",$t.set(n),yt.set(Tt.COMPILE),n.addEventListener("beforeunload",r=>{$t.set(null),yt.set(Tt.COMPILE)}),n}var $a={exports:{}};/*! file-extension v4.0.5 | (c) silverwind | BSD license */(function(n,e){(function(i){n.exports=i()})(function(){return function(t,r){if(r||(r={}),!t)return"";var o=(/[^./\\]*$/.exec(t)||[""])[0];return r.preserveCase?o:o.toLowerCase()}})})($a);const sc=$a.exports;function lc(n){const e=sc(n);return["mkv"].includes(e)?"video/x-matroska;codecs=avc1":"video/webm"}function uc(n,e={}){const i=new Date;let t=null;const{filename:r=`Recording ${i.toISOString().slice(0,10)} at ${i.toTimeString().slice(0,8).replace(/:/g,".")}.webm`,frameRate:o=25,download:a=!0,recorderOptions:l={audioBitsPerSecond:128e3,videoBitsPerSecond:25e5}}={...e},s=l.mimeType||lc(r);a&&(t=t||document.createElement("a"),t.download=r);let f=[],u=n.captureStream(o),c=new MediaRecorder(u,{mimeType:s,...l});return c.ondataavailable=p=>{p.data.size&&f.push(p.data)},c.onstop=()=>{if(a&&f.length){const p=new Blob(f,{type:s}),d=URL.createObjectURL(p);t.href=d;const g=new MouseEvent("click");t.dispatchEvent(g),setTimeout(()=>{URL.revokeObjectURL(d)},1)}},{start(p){f=[],c.start(p)},set filename(p){t.download=p},step(){u.getVideoTracks()[0].requestFrame()},stop(){return c.stop(),f},dispose(){c=null,u=null},stream:u,recorder:c}}const{window:fc}=cr;function Ho(n,e,i){const t=n.slice();return t[4]=e[i][0],t[52]=e[i][1],t[53]=e,t[54]=i,t}function qo(n,e,i){const t=n.slice();return t[55]=e[i],t[56]=e,t[57]=i,t}function zo(n,e,i){const t=n.slice();return t[58]=e[i],t[59]=e,t[4]=i,t}function Xo(n){let e,i,t,r,o,a,l,s;function f(d){n[28](d,n[4])}let u={min:-1,max:1,step:.001};n[0][n[4]][0]!==void 0&&(u.value=n[0][n[4]][0]),i=new Ot({props:u}),$e.push(()=>pt(i,"value",f));function c(d){n[29](d,n[4])}let p={min:-1,max:1,step:.001};return n[0][n[4]][1]!==void 0&&(p.value=n[0][n[4]][1]),o=new Ot({props:p}),$e.push(()=>pt(o,"value",c)),{c(){e=q("div"),Ne(i.$$.fragment),r=re(),Ne(o.$$.fragment),l=re(),this.h()},l(d){e=z(d,"DIV",{class:!0});var g=W(e);Te(i.$$.fragment,g),r=ie(g),Te(o.$$.fragment,g),l=ie(g),g.forEach(k),this.h()},h(){D(e,"class","maxw50pc grow")},m(d,g){oe(d,e,g),Se(i,e,null),P(e,r),Se(o,e,null),P(e,l),s=!0},p(d,g){n=d;const y={};!t&&g[0]&1&&(t=!0,y.value=n[0][n[4]][0],vt(()=>t=!1)),i.$set(y);const h={};!a&&g[0]&1&&(a=!0,h.value=n[0][n[4]][1],vt(()=>a=!1)),o.$set(h)},i(d){s||(te(i.$$.fragment,d),te(o.$$.fragment,d),s=!0)},o(d){le(i.$$.fragment,d),le(o.$$.fragment,d),s=!1},d(d){d&&k(e),xe(i),xe(o)}}}function Wo(n){var a,l,s,f;let e,i,t;function r(u){n[30](u,n[4],n[57])}let o={min:(l=(a=n[15])==null?void 0:a[n[4]])==null?void 0:l.min,max:(f=(s=n[15])==null?void 0:s[n[4]])==null?void 0:f.max,step:.001};return n[11][n[4]][n[57]]!==void 0&&(o.value=n[11][n[4]][n[57]]),e=new Ot({props:o}),$e.push(()=>pt(e,"value",r)),{c(){Ne(e.$$.fragment)},l(u){Te(e.$$.fragment,u)},m(u,c){Se(e,u,c),t=!0},p(u,c){var d,g,y,h;n=u;const p={};c[0]&2048&&(p.min=(g=(d=n[15])==null?void 0:d[n[4]])==null?void 0:g.min),c[0]&2048&&(p.max=(h=(y=n[15])==null?void 0:y[n[4]])==null?void 0:h.max),!i&&c[0]&2048&&(i=!0,p.value=n[11][n[4]][n[57]],vt(()=>i=!1)),e.$set(p)},i(u){t||(te(e.$$.fragment,u),t=!0)},o(u){le(e.$$.fragment,u),t=!1},d(u){xe(e,u)}}}function Yo(n){let e,i,t=n[4]+"",r,o,a,l,s=n[52]||[],f=[];for(let c=0;c<s.length;c+=1)f[c]=Wo(qo(n,s,c));const u=c=>le(f[c],1,1,()=>{f[c]=null});return{c(){e=q("div"),i=q("div"),r=de(t),o=re();for(let c=0;c<f.length;c+=1)f[c].c();a=re(),this.h()},l(c){e=z(c,"DIV",{class:!0});var p=W(e);i=z(p,"DIV",{class:!0});var d=W(i);r=pe(d,t),d.forEach(k),o=ie(p);for(let g=0;g<f.length;g+=1)f[g].l(p);a=ie(p),p.forEach(k),this.h()},h(){D(i,"class","mb0-5"),D(e,"class","maxw50pc grow")},m(c,p){oe(c,e,p),P(e,i),P(i,r),P(e,o);for(let d=0;d<f.length;d+=1)f[d].m(e,null);P(e,a),l=!0},p(c,p){if((!l||p[0]&2048)&&t!==(t=c[4]+"")&&Me(r,t),p[0]&34816){s=c[52]||[];let d;for(d=0;d<s.length;d+=1){const g=qo(c,s,d);f[d]?(f[d].p(g,p),te(f[d],1)):(f[d]=Wo(g),f[d].c(),te(f[d],1),f[d].m(e,a))}for(rt(),d=s.length;d<f.length;d+=1)u(d);it()}},i(c){if(!l){for(let p=0;p<s.length;p+=1)te(f[p]);l=!0}},o(c){f=f.filter(Boolean);for(let p=0;p<f.length;p+=1)le(f[p]);l=!1},d(c){c&&k(e),Xe(f,c)}}}function cc(n){let e,i,t,r,o,a,l,s,f,u=n[6]?"\u25CF":"\u25CB",c,p,d,g,y=n[10]?"Recording...":"Record",h,_,v,b=(1e3/n[9]).toFixed(0)+"",E,N,T,R,I,w,S,M,A,F,V,ee,G,ae,we,_e,J,Q,Ie,Ee,X=n[0],ve=[];for(let j=0;j<X.length;j+=1)ve[j]=Xo(zo(n,X,j));const Ae=j=>le(ve[j],1,1,()=>{ve[j]=null});let Ke=Object.entries(n[11]),Re=[];for(let j=0;j<Ke.length;j+=1)Re[j]=Yo(Ho(n,Ke,j));const Pt=j=>le(Re[j],1,1,()=>{Re[j]=null}),dt=n[24].default,Ge=fs(dt,n,n[23],null);return{c(){e=q("div"),i=q("div"),t=q("button"),r=de("Popup"),o=re(),a=q("button"),l=de("Grab"),s=re(),f=q("button"),c=de(u),p=de(" Fullscreen"),d=re(),g=q("button"),h=de(y),_=re(),v=q("span"),E=de(b),N=re(),T=q("div"),R=q("canvas"),S=re(),M=q("canvas"),V=re(),ee=q("div"),G=q("div");for(let j=0;j<ve.length;j+=1)ve[j].c();ae=re(),we=q("div");for(let j=0;j<Re.length;j+=1)Re[j].c();_e=re(),Ge&&Ge.c(),this.h()},l(j){e=z(j,"DIV",{class:!0,style:!0});var K=W(e);i=z(K,"DIV",{style:!0,class:!0});var Z=W(i);t=z(Z,"BUTTON",{});var He=W(t);r=pe(He,"Popup"),He.forEach(k),o=ie(Z),a=z(Z,"BUTTON",{});var je=W(a);l=pe(je,"Grab"),je.forEach(k),s=ie(Z),f=z(Z,"BUTTON",{});var qe=W(f);c=pe(qe,u),p=pe(qe," Fullscreen"),qe.forEach(k),d=ie(Z),g=z(Z,"BUTTON",{});var ze=W(g);h=pe(ze,y),ze.forEach(k),_=ie(Z),v=z(Z,"SPAN",{class:!0});var O=W(v);E=pe(O,b),O.forEach(k),Z.forEach(k),N=ie(K),T=z(K,"DIV",{style:!0,class:!0});var L=W(T);R=z(L,"CANVAS",{class:!0,width:!0,height:!0}),W(R).forEach(k),S=ie(L),M=z(L,"CANVAS",{id:!0,class:!0,style:!0,width:!0,height:!0}),W(M).forEach(k),L.forEach(k),V=ie(K),ee=z(K,"DIV",{class:!0,style:!0});var B=W(ee);G=z(B,"DIV",{class:!0});var C=W(G);for(let ne=0;ne<ve.length;ne+=1)ve[ne].l(C);C.forEach(k),ae=ie(B),we=z(B,"DIV",{class:!0});var $=W(we);for(let ne=0;ne<Re.length;ne+=1)Re[ne].l($);$.forEach(k),B.forEach(k),_e=ie(K),Ge&&Ge.l(K),K.forEach(k),this.h()},h(){Fe(g,"active",n[10]),D(v,"class","fps"),ke(i,"background","var(--blue5-0)"),D(i,"class","actions bb rel z-index99 bt"),D(R,"class","w100pc h100pc"),D(R,"width",I=n[7].width),D(R,"height",w=n[7].height),D(M,"id",n[2]),D(M,"class","w100pc h100pc fill"),ke(M,"transform",n[16](n[11])),D(M,"width",A=n[7].width),D(M,"height",F=n[7].height),ke(T,"top","0px"),ke(T,"left","0px"),ke(T,"background","black"),ke(T,"z-index","999999999"),D(T,"class","rel t0pc l0pc w100pc h100pc overflow-hidden"),Fe(T,"fixed",n[6]),D(G,"class","flex wrap grow w100pc none"),D(we,"class","flex wrap grow w100pc"),D(ee,"class","flex column-stretch-flex-start bg bt p1"),ke(ee,"background","var(--blue5-0)"),ke(ee,"z-index","99999"),D(e,"class",J="renderer bb "+n[3]),ke(e,"height","auto"),ke(e,"min-width",n[1]+"px"),ke(e,"max-width",n[1]+"px")},m(j,K){oe(j,e,K),P(e,i),P(i,t),P(t,r),P(i,o),P(i,a),P(a,l),P(i,s),P(i,f),P(f,c),P(f,p),P(i,d),P(i,g),P(g,h),P(i,_),P(i,v),P(v,E),P(e,N),P(e,T),P(T,R),P(T,S),P(T,M),n[26](M),n[27](T),P(e,V),P(e,ee),P(ee,G);for(let Z=0;Z<ve.length;Z+=1)ve[Z].m(G,null);P(ee,ae),P(ee,we);for(let Z=0;Z<Re.length;Z+=1)Re[Z].m(we,null);P(e,_e),Ge&&Ge.m(e,null),Q=!0,Ie||(Ee=[ce(fc,"resize",n[14]),ce(t,"click",ac),ce(a,"click",n[12]),ce(f,"click",n[25]),ce(g,"click",n[13])],Ie=!0)},p(j,K){if((!Q||K[0]&64)&&u!==(u=j[6]?"\u25CF":"\u25CB")&&Me(c,u),(!Q||K[0]&1024)&&y!==(y=j[10]?"Recording...":"Record")&&Me(h,y),(!Q||K[0]&1024)&&Fe(g,"active",j[10]),(!Q||K[0]&512)&&b!==(b=(1e3/j[9]).toFixed(0)+"")&&Me(E,b),(!Q||K[0]&128&&I!==(I=j[7].width))&&D(R,"width",I),(!Q||K[0]&128&&w!==(w=j[7].height))&&D(R,"height",w),(!Q||K[0]&4)&&D(M,"id",j[2]),(!Q||K[0]&2048)&&ke(M,"transform",j[16](j[11])),(!Q||K[0]&128&&A!==(A=j[7].width))&&D(M,"width",A),(!Q||K[0]&128&&F!==(F=j[7].height))&&D(M,"height",F),(!Q||K[0]&64)&&Fe(T,"fixed",j[6]),K[0]&1){X=j[0];let Z;for(Z=0;Z<X.length;Z+=1){const He=zo(j,X,Z);ve[Z]?(ve[Z].p(He,K),te(ve[Z],1)):(ve[Z]=Xo(He),ve[Z].c(),te(ve[Z],1),ve[Z].m(G,null))}for(rt(),Z=X.length;Z<ve.length;Z+=1)Ae(Z);it()}if(K[0]&34816){Ke=Object.entries(j[11]);let Z;for(Z=0;Z<Ke.length;Z+=1){const He=Ho(j,Ke,Z);Re[Z]?(Re[Z].p(He,K),te(Re[Z],1)):(Re[Z]=Yo(He),Re[Z].c(),te(Re[Z],1),Re[Z].m(we,null))}for(rt(),Z=Ke.length;Z<Re.length;Z+=1)Pt(Z);it()}Ge&&Ge.p&&(!Q||K[0]&8388608)&&cs(Ge,dt,j,j[23],Q?ds(dt,j[23],K,null):hs(j[23]),null),(!Q||K[0]&8&&J!==(J="renderer bb "+j[3]))&&D(e,"class",J),(!Q||K[0]&2)&&ke(e,"min-width",j[1]+"px"),(!Q||K[0]&2)&&ke(e,"max-width",j[1]+"px")},i(j){if(!Q){for(let K=0;K<X.length;K+=1)te(ve[K]);for(let K=0;K<Ke.length;K+=1)te(Re[K]);te(Ge,j),Q=!0}},o(j){ve=ve.filter(Boolean);for(let K=0;K<ve.length;K+=1)le(ve[K]);Re=Re.filter(Boolean);for(let K=0;K<Re.length;K+=1)le(Re[K]);le(Ge,j),Q=!1},d(j){j&&k(e),n[26](null),n[27](null),Xe(ve,j),Xe(Re,j),Ge&&Ge.d(j),Ie=!1,mt(Ee)}}}function hc(n,e,i){let t,r,o,a,l,s;he(n,lr,j=>i(11,t=j)),he(n,Mn,j=>i(6,r=j)),he(n,Vt,j=>i(7,o=j)),he(n,yt,j=>i(41,a=j)),he(n,ue,j=>i(42,l=j)),he(n,$t,j=>i(43,s=j));let{$$slots:f={},$$scope:u}=e,{width:c=320}=e,{preview:p}=e,{key:d}=e,{capture:g=!1}=e,{fullscreen:y=!1}=e,{id:h}=e,{style:_=""}=e,{class:v=""}=e;const b=window;let E,N;const T=(j,K)=>console.log(`[Renderer] ${j}`,K||"");let R;function I(){return s?(R||(R=s.document.getElementById("canvas")),R):E}ps(async j=>{s&&(await s.close(),ge($t,s=null,s))});let w;function S(j){a==Tt.COMPILE&&Br&&(w&&clearTimeout(w),w=setTimeout(K=>{T("\u{1F3DE} recompiling"),b.requestAnimationFrame(async Z=>{const He=I();N||(N=uc(He,{recorderOptions:{audioBitsPerSecond:128e3,videoBitsPerSecond:25e5*10}})),b.RNDRS||(b.RNDRS={});const je=He.getContext("webgl2",{preserveDrawingBuffer:!0});console.log("\u26E9\uFE0F context",je),b.RNDRS[d]=new Be(je),b.ISF=ur(),b.VTX="// hello world?",b.RNDRS[d].loadSource(b.ISF,ic);const qe=document.getElementById("ISF");qe&&(qe.innerText=b.RNDRS[d].parser.fragmentShader),ge(ue,l={...l},l),ge(yt,a=Tt.DONE,a)})},1))}yt.subscribe(S);let M,A=30;const F=j=>{var je;const K=new Date;M||(M=K);const Z=.98,He=K-M;i(9,A=A*Z+He*(1-Z));try{(je=b.RNDRS)!=null&&je[d]&&b.RNDRS[d].draw(I())}catch(qe){throw console.log("\u274C renderer error:",qe.message),qe}M=new Date,requestAnimationFrame(F)};an(async j=>{_e(),F()});function V(){b.requestAnimationFrame(async j=>{const K=document.createElement("a");K.setAttribute("download","_MXZ.png");const Z=(await E.toDataURL("image/png",1)).replace(/^data:image\/png/,"data:application/octet-stream");K.setAttribute("href",Z),K.click()})}window.captureImage=V;let ee=!1;function G(){i(10,ee=!ee),ee?N.start():(N.stop(),N.dispose()),window.recorder=N}let ae,we;function _e(){i(21,ae=b.innerWidth),i(22,we=b.innerHeight)}let{ctrlPoints:J=[[0,0],[0,0],[0,0],[0,0]]}=e;const Q=[[0,0],[0,1],[1,0],[1,1]];let Ie;function Ee(j,K,Z,He){if(!o||!Z)return{from:[],to:[],matrix:[]};const je=[],qe=[];let ze=[],O=[];const L=r?window.innerWidth:Z.offsetWidth,B=r?window.innerHeight:Z.offsetHeight;for(let H=0;H<j.length;H++)O.push([(Q[H][0]+j[H][0])*L,(Q[H][1]+j[H][1])*B]),ze.push([Q[H][0]*L,Q[H][1]*B]);for(let H=0;H<4;H++)je.push([ze[H][0],ze[H][1],1,0,0,0,-ze[H][0]*O[H][0],-ze[H][1]*O[H][0]]),je.push([0,0,0,ze[H][0],ze[H][1],1,-ze[H][0]*O[H][1],-ze[H][1]*O[H][1]]),qe.push(O[H][0]),qe.push(O[H][1]);const C=window.numeric.solve(je,qe),$=[[C[0],C[1],0,C[2]],[C[3],C[4],0,C[5]],[0,0,1,0],[C[6],C[7],0,1]];let ne,fe;fe=[];for(let H=ne=0;ne<4;H=++ne)fe.push(function(){var me,Je;Je=[];for(let et=me=0;me<4;et=++me)Je.push($[et][H].toFixed(20));return Je}());const se=`matrix3d(${fe.join(",")})`;return{from:ze,to:O,matrix:fe,matrix3d:se}}const X={translate:{unit:"%",min:-15,max:15},rotate:{unit:"deg",min:-15,max:15},scale:{unit:" ",min:.5,max:1},skew:{unit:"deg",min:-15,max:15}};function ve(j){let K="";for(const[Z,He]of Object.entries(t)){let je=0;const qe=["X","Y","Z"];K+=`${He.map(ze=>{var L,B;let O=(L=X==null?void 0:X[Z])!=null&&L.unit?qe[je]:"";return je+=1,`${Z}${O}( ${ze||0}${((B=X==null?void 0:X[Z])==null?void 0:B.unit)||""} )`}).join(" ")} `}return K}const Ae=j=>ge(Mn,r=!r,r);function Ke(j){$e[j?"unshift":"push"](()=>{E=j,i(8,E)})}function Re(j){$e[j?"unshift":"push"](()=>{Ie=j,i(5,Ie)})}function Pt(j,K){n.$$.not_equal(J[K][0],j)&&(J[K][0]=j,i(0,J))}function dt(j,K){n.$$.not_equal(J[K][1],j)&&(J[K][1]=j,i(0,J))}function Ge(j,K,Z){n.$$.not_equal(t[K][Z],j)&&(t[K][Z]=j,lr.set(t))}return n.$$set=j=>{"width"in j&&i(1,c=j.width),"preview"in j&&i(17,p=j.preview),"key"in j&&i(4,d=j.key),"capture"in j&&i(18,g=j.capture),"fullscreen"in j&&i(19,y=j.fullscreen),"id"in j&&i(2,h=j.id),"style"in j&&i(20,_=j.style),"class"in j&&i(3,v=j.class),"ctrlPoints"in j&&i(0,J=j.ctrlPoints),"$$scope"in j&&i(23,u=j.$$scope)},n.$$.update=()=>{n.$$.dirty[0]&6291648&&r&&(ae/o.width,we/o.height),n.$$.dirty[0]&225&&Ee(J,o,Ie)},[J,c,h,v,d,Ie,r,o,E,A,ee,t,V,G,_e,X,ve,p,g,y,_,ae,we,u,f,Ae,Ke,Re,Pt,dt,Ge]}class dc extends Ce{constructor(e){super(),De(this,e,hc,cc,Le,{width:1,preview:17,key:4,capture:18,fullscreen:19,id:2,style:20,class:3,ctrlPoints:0},null,[-1,-1])}}const pc=window;function Fn(n){if(!ye(At))return;n=n.detail?n.detail:n;let i=n.composedPath().find(t=>t.getAttribute("data-drag-type"));for(const t of document.querySelectorAll(".draggedover"))t.classList.remove("draggedover");i&&i.classList.add("draggedover"),n.preventDefault()}function Un(n){if(!ye(At))return;n=n.detail?n.detail:n;let i=n.composedPath().find(s=>s.getAttribute("data-drag-type")),t=i.getAttribute("data-drag-type"),r=parseInt(i.getAttribute("data-drag-colIdx")),o=parseInt(i.getAttribute("data-drag-rowIdx"));for(const s of document.querySelectorAll(".draggedover"))s.classList.remove("draggedover");const a=ye(nt),l=typeof(a==null?void 0:a[0])=="string"?a:[];yt.set(Tt.PAUSE),ri(t,o,r,l),At.set(!1),nt.set(null),Qr(),pc.requestAnimationFrame(s=>{yt.set(Tt.COMPILE)})}function mc(n){let e;return{c(){e=de("NO SUCH OPERATOR")},l(i){e=pe(i,"NO SUCH OPERATOR")},m(i,t){oe(i,e,t)},p:Pe,i:Pe,o:Pe,d(i){i&&k(e)}}}function gc(n){let e,i,t;var r=rn[n[0]].COMPONENT;function o(a){return{props:{uuid:a[4],name:a[0],rowIdx:a[1],colIdx:a[2]}}}return r&&(e=new r(o(n))),{c(){e&&Ne(e.$$.fragment),i=Ve()},l(a){e&&Te(e.$$.fragment,a),i=Ve()},m(a,l){e&&Se(e,a,l),oe(a,i,l),t=!0},p(a,l){const s={};if(l&16&&(s.uuid=a[4]),l&1&&(s.name=a[0]),l&2&&(s.rowIdx=a[1]),l&4&&(s.colIdx=a[2]),r!==(r=rn[a[0]].COMPONENT)){if(e){rt();const f=e;le(f.$$.fragment,1,0,()=>{xe(f,1)}),it()}r?(e=new r(o(a)),Ne(e.$$.fragment),te(e.$$.fragment,1),Se(e,i.parentNode,i)):e=null}else r&&e.$set(s)},i(a){t||(e&&te(e.$$.fragment,a),t=!0)},o(a){e&&le(e.$$.fragment,a),t=!1},d(a){a&&k(i),e&&xe(e,a)}}}function vc(n){let e,i,t,r,o,a=Ln(n[1])+"",l,s=n[2]+1+"",f,u,c,p,d,g=(n[4]||"")+"",y,h,_,v,b,E,N,T,R,I;const w=[gc,mc],S=[];function M(A,F){return rn[A[0]]?0:1}return v=M(n),b=S[v]=w[v](n),{c(){e=q("div"),i=q("header"),t=q("div"),r=q("div"),o=q("div"),l=de(a),f=de(s),u=re(),c=de(n[0]),p=re(),d=q("div"),y=de(g),h=re(),_=q("div"),b.c(),this.h()},l(A){e=z(A,"DIV",{"data-drag-type":!0,"data-drag-rowidx":!0,"data-drag-colidx":!0,class:!0});var F=W(e);i=z(F,"HEADER",{draggable:!0,class:!0});var V=W(i);t=z(V,"DIV",{class:!0});var ee=W(t);r=z(ee,"DIV",{class:!0});var G=W(r);o=z(G,"DIV",{class:!0});var ae=W(o);l=pe(ae,a),f=pe(ae,s),u=ie(ae),c=pe(ae,n[0]),ae.forEach(k),p=ie(G),d=z(G,"DIV",{class:!0});var we=W(d);y=pe(we,g),we.forEach(k),G.forEach(k),ee.forEach(k),V.forEach(k),h=ie(F),_=z(F,"DIV",{class:!0});var _e=W(_);b.l(_e),_e.forEach(k),F.forEach(k),this.h()},h(){D(o,"class","bold"),D(d,"class","f0"),D(r,"class","grabbable flex grow row-space-between-center rel p0-5"),D(t,"class","flex row-space-between-center w100pc "),D(i,"draggable",n[6]),D(i,"class","flex column w100pc "),D(_,"class","inner"),D(e,"data-drag-type",lt.MOVE),D(e,"data-drag-rowidx",n[1]),D(e,"data-drag-colidx",E=n[2]-1),D(e,"class",N="op op-"+n[0].toLowerCase()+" global"),Fe(e,"pop",n[5]),Fe(e,"invisible",n[3]&&!n[5])},m(A,F){oe(A,e,F),P(e,i),P(i,t),P(t,r),P(r,o),P(o,l),P(o,f),P(o,u),P(o,c),P(r,p),P(r,d),P(d,y),P(e,h),P(e,_),S[v].m(_,null),T=!0,R||(I=[ce(r,"mousedown",n[12]),ce(i,"dragstart",n[10]),ce(e,"drop",n[13]),ce(e,"dragover",n[14]),ce(e,"dragenter",n[15]),ce(e,"dragleave",n[16]),ce(e,"mouseup",n[9]),ce(e,"mousedown",n[8])],R=!0)},p(A,[F]){(!T||F&2)&&a!==(a=Ln(A[1])+"")&&Me(l,a),(!T||F&4)&&s!==(s=A[2]+1+"")&&Me(f,s),(!T||F&1)&&Me(c,A[0]),(!T||F&16)&&g!==(g=(A[4]||"")+"")&&Me(y,g),(!T||F&64)&&D(i,"draggable",A[6]);let V=v;v=M(A),v===V?S[v].p(A,F):(rt(),le(S[V],1,1,()=>{S[V]=null}),it(),b=S[v],b?b.p(A,F):(b=S[v]=w[v](A),b.c()),te(b,1),b.m(_,null)),(!T||F&2)&&D(e,"data-drag-rowidx",A[1]),(!T||F&4&&E!==(E=A[2]-1))&&D(e,"data-drag-colidx",E),(!T||F&1&&N!==(N="op op-"+A[0].toLowerCase()+" global"))&&D(e,"class",N),(!T||F&33)&&Fe(e,"pop",A[5]),(!T||F&41)&&Fe(e,"invisible",A[3]&&!A[5])},i(A){T||(te(b),T=!0)},o(A){le(b),T=!1},d(A){A&&k(e),S[v].d(),R=!1,mt(I)}}}function yc(n,e,i){let t,r,o,a,l,s;he(n,nt,w=>i(17,r=w)),he(n,Dt,w=>i(18,o=w)),he(n,At,w=>i(6,a=w)),he(n,jt,w=>i(19,l=w)),he(n,ue,w=>i(20,s=w));const f=(w,S)=>console.log(`[Unit] ${w}`,S||"");let{name:u}=e,{rowIdx:c}=e,{colIdx:p}=e,{index:d}=e,{clone:g=!1}=e,{uuid:y}=e;const h=ms();function _(w){if(l&&(l==null?void 0:l.uuid)!=y){const S=parseInt(y.substring(1));f(`\u{1F447} setting OpSelect ${l.uuid} to ${y} ${S}`),ge(ue,s[l.key]=S,s),ge(jt,l=null,l)}}function v(w){ge(At,a=!1,a),r||ge(nt,r=[[-1,-1],[-1,-1]],r);let S=r;if(o[Rs])S[1][0]=c,S[1][1]=p;else try{S[0][0]=S[1][0]=c,S[0][1]=S[1][1]=p}catch{}S=S.sort((M,A)=>M[0]==A[0]?M[1]-A[1]:M[0]-A[0]),console.log(`[Unit] on touchup, setting selected tp ${r}`),ge(nt,r=S,r)}const b=w=>{t||(r||ge(nt,r=[[-1,-1],[-1,-1]],r),console.log(`[Unit] resetting selected ${r} to [${c},${p}]`),ge(nt,r=[[c,p],[c,p]],r));const S=document.getElementById("drag-visualiser");w.dataTransfer.setDragImage(S,80,ni().length*40)},E=w=>ge(At,a=!0,a),N=w=>h(lt.DROP,w),T=w=>h(lt.DRAGOVER,w),R=w=>h(lt.DRAGENTER,w),I=w=>h(lt.DRAGLEAVE,w);return n.$$set=w=>{"name"in w&&i(0,u=w.name),"rowIdx"in w&&i(1,c=w.rowIdx),"colIdx"in w&&i(2,p=w.colIdx),"index"in w&&i(11,d=w.index),"clone"in w&&i(3,g=w.clone),"uuid"in w&&i(4,y=w.uuid)},n.$$.update=()=>{n.$$.dirty&6&&i(5,t=$r([c,p]))},[u,c,p,g,y,t,a,h,_,v,b,d,E,N,T,R,I]}class _c extends Ce{constructor(e){super(),De(this,e,yc,vc,Le,{name:0,rowIdx:1,colIdx:2,index:11,clone:3,uuid:4})}}function Jo(n,e,i){const t=n.slice();return t[9]=e[i],t[11]=i,t}function Ko(n,e,i){const t=n.slice();return t[12]=e[i],t[14]=i,t}function Zo(n){let e,i;return e=new _c({props:{name:n[12].split(":")[0],uuid:n[12].split(":")[1],rowIdx:n[11],colIdx:n[14],type:Us.UNIT,index:Ta(n[11],n[14])}}),e.$on("drop",Un),e.$on("dragover",Fn),{c(){Ne(e.$$.fragment)},l(t){Te(e.$$.fragment,t)},m(t,r){Se(e,t,r),i=!0},p(t,r){const o={};r&2&&(o.name=t[12].split(":")[0]),r&2&&(o.uuid=t[12].split(":")[1]),e.$set(o)},i(t){i||(te(e.$$.fragment,t),i=!0)},o(t){le(e.$$.fragment,t),i=!1},d(t){xe(e,t)}}}function Qo(n){let e,i,t,r,o,a,l,s,f,u,c,p,d=n[9],g=[];for(let h=0;h<d.length;h+=1)g[h]=Zo(Ko(n,d,h));const y=h=>le(g[h],1,1,()=>{g[h]=null});return{c(){e=q("span"),t=re(),r=q("section");for(let h=0;h<g.length;h+=1)g[h].c();o=re(),a=q("div"),l=re(),this.h()},l(h){e=z(h,"SPAN",{id:!0,"data-drag-type":!0,"data-drag-rowidx":!0,"data-drag-colidx":!0,class:!0}),W(e).forEach(k),t=ie(h),r=z(h,"SECTION",{id:!0,"data-drag-type":!0,"data-drag-rowidx":!0,"data-drag-colidx":!0,class:!0});var _=W(r);for(let v=0;v<g.length;v+=1)g[v].l(_);o=ie(_),a=z(_,"DIV",{class:!0}),W(a).forEach(k),l=ie(_),_.forEach(k),this.h()},h(){D(e,"id",i=[n[0],n[11],"gutter"].join("_")),D(e,"data-drag-type",lt.INSERT),D(e,"data-drag-rowidx",n[11]),D(e,"data-drag-colidx",0),D(e,"class","w2em minw2em z-index99 minh100pc h100pc t0 l0"),D(a,"class","minh4em w100pc"),D(r,"id",s=[n[0],n[11]].join("_")),D(r,"data-drag-type",lt.MOVE),D(r,"data-drag-rowidx",n[11]),D(r,"data-drag-colidx",f=n[9].length-1),D(r,"class","channel global")},m(h,_){oe(h,e,_),oe(h,t,_),oe(h,r,_);for(let v=0;v<g.length;v+=1)g[v].m(r,null);P(r,o),P(r,a),P(r,l),u=!0,c||(p=[ce(e,"drop",Un),ce(e,"dragover",Fn),ce(r,"drop",Un),ce(r,"dragover",Fn)],c=!0)},p(h,_){if((!u||_&1&&i!==(i=[h[0],h[11],"gutter"].join("_")))&&D(e,"id",i),_&2){d=h[9];let v;for(v=0;v<d.length;v+=1){const b=Ko(h,d,v);g[v]?(g[v].p(b,_),te(g[v],1)):(g[v]=Zo(b),g[v].c(),te(g[v],1),g[v].m(r,o))}for(rt(),v=d.length;v<g.length;v+=1)y(v);it()}(!u||_&1&&s!==(s=[h[0],h[11]].join("_")))&&D(r,"id",s),(!u||_&2&&f!==(f=h[9].length-1))&&D(r,"data-drag-colidx",f)},i(h){if(!u){for(let _=0;_<d.length;_+=1)te(g[_]);u=!0}},o(h){g=g.filter(Boolean);for(let _=0;_<g.length;_+=1)le(g[_]);u=!1},d(h){h&&k(e),h&&k(t),h&&k(r),Xe(g,h),c=!1,mt(p)}}}function bc(n){let e,i,t,r,o,a,l,s,f,u,c,p,d,g,y=n[1],h=[];for(let v=0;v<y.length;v+=1)h[v]=Qo(Jo(n,y,v));const _=v=>le(h[v],1,1,()=>{h[v]=null});return{c(){e=q("div"),i=q("div");for(let v=0;v<h.length;v+=1)h[v].c();t=re(),r=q("span"),l=re(),s=q("span"),f=de("BIN"),this.h()},l(v){e=z(v,"DIV",{class:!0});var b=W(e);i=z(b,"DIV",{class:!0});var E=W(i);for(let T=0;T<h.length;T+=1)h[T].l(E);t=ie(E),r=z(E,"SPAN",{id:!0,"data-drag-type":!0,"data-drag-rowidx":!0,"data-drag-colidx":!0,style:!0,class:!0}),W(r).forEach(k),E.forEach(k),l=ie(b),s=z(b,"SPAN",{id:!0,"data-drag-type":!0,"data-drag-rowidx":!0,"data-drag-colidx":!0,class:!0});var N=W(s);f=pe(N,"BIN"),N.forEach(k),b.forEach(k),this.h()},h(){var v,b,E,N;D(r,"id",o=[n[0],"tundra"].join("_")),D(r,"data-drag-type",lt.APPEND),D(r,"data-drag-rowidx",a=n[1].length),D(r,"data-drag-colidx",0),ke(r,"padding-right","50vw"),D(r,"class","flex grow h100pc minw16em"),D(i,"class","flex row-flex-start-stretch grow minw100pc"),D(s,"id","bin"),D(s,"data-drag-type",lt.BIN),D(s,"data-drag-rowidx",u=(b=(v=n[2])==null?void 0:v[0])==null?void 0:b[0]),D(s,"data-drag-colidx",c=(N=(E=n[2])==null?void 0:E[0])==null?void 0:N[1]),D(s,"class","flex row-center-center h4em abs t100pc l100pc border w8em fixed bg z-index99"),D(e,"class","flex row-flex-start-stretch pb4 grow rel w100pc")},m(v,b){oe(v,e,b),P(e,i);for(let E=0;E<h.length;E+=1)h[E].m(i,null);P(i,t),P(i,r),P(e,l),P(e,s),P(s,f),p=!0,d||(g=[ce(r,"drop",Un),ce(r,"dragover",Fn),ce(s,"drop",Un),ce(s,"dragover",Fn)],d=!0)},p(v,[b]){var E,N,T,R;if(b&3){y=v[1];let I;for(I=0;I<y.length;I+=1){const w=Jo(v,y,I);h[I]?(h[I].p(w,b),te(h[I],1)):(h[I]=Qo(w),h[I].c(),te(h[I],1),h[I].m(i,t))}for(rt(),I=y.length;I<h.length;I+=1)_(I);it()}(!p||b&1&&o!==(o=[v[0],"tundra"].join("_")))&&D(r,"id",o),(!p||b&2&&a!==(a=v[1].length))&&D(r,"data-drag-rowidx",a),(!p||b&4&&u!==(u=(N=(E=v[2])==null?void 0:E[0])==null?void 0:N[0]))&&D(s,"data-drag-rowidx",u),(!p||b&4&&c!==(c=(R=(T=v[2])==null?void 0:T[0])==null?void 0:R[1]))&&D(s,"data-drag-colidx",c)},i(v){if(!p){for(let b=0;b<y.length;b+=1)te(h[b]);p=!0}},o(v){h=h.filter(Boolean);for(let b=0;b<h.length;b+=1)le(h[b]);p=!1},d(v){v&&k(e),Xe(h,v),d=!1,mt(g)}}}function wc(n,e,i){let t,r;he(n,_t,a=>i(1,t=a)),he(n,jt,a=>i(3,a)),he(n,ue,a=>i(4,a)),he(n,nt,a=>i(2,r=a));let{id:o="editor"}=e;return n.$$set=a=>{"id"in a&&i(0,o=a.id)},n.$$.update=()=>{n.$$.dirty&2&&Ia()},[o,t,r]}class Ec extends Ce{constructor(e){super(),De(this,e,wc,bc,Le,{id:0})}}const{window:Nc}=cr;function $o(n,e,i){const t=n.slice();return t[15]=e[i][0],t[16]=e[i][1],t}function ea(n,e,i){const t=n.slice();return t[19]=e[i],t}function ta(n){let e,i,t=n[19]+"",r,o,a;function l(...f){return n[8](n[19],...f)}function s(...f){return n[9](n[19],...f)}return{c(){e=q("div"),i=q("span"),r=de(t),this.h()},l(f){e=z(f,"DIV",{id:!0,"data-drag-type":!0,"data-drag-unit":!0,draggable:!0,class:!0});var u=W(e);i=z(u,"SPAN",{class:!0});var c=W(i);r=pe(c,t),c.forEach(k),u.forEach(k),this.h()},h(){D(i,"class","f0"),D(e,"id","menu_"+n[19].toLowerCase()),D(e,"data-drag-type",lt.MOVE),D(e,"data-drag-unit",n[19]),D(e,"draggable",!0),D(e,"class","plr0-5 grabbable br bt f3 flex row-center-center pop ptb0-5 grow")},m(f,u){oe(f,e,u),P(e,i),P(i,r),o||(a=[ce(e,"mousedown",l),ce(e,"mouseup",s)],o=!0)},p(f,u){n=f},d(f){f&&k(e),o=!1,mt(a)}}}function na(n){let e,i=Object.keys(n[16]),t=[];for(let r=0;r<i.length;r+=1)t[r]=ta(ea(n,i,r));return{c(){for(let r=0;r<t.length;r+=1)t[r].c();e=Ve()},l(r){for(let o=0;o<t.length;o+=1)t[o].l(r);e=Ve()},m(r,o){for(let a=0;a<t.length;a+=1)t[a].m(r,o);oe(r,e,o)},p(r,o){if(o&14){i=Object.keys(r[16]);let a;for(a=0;a<i.length;a+=1){const l=ea(r,i,a);t[a]?t[a].p(l,o):(t[a]=ta(l),t[a].c(),t[a].m(e.parentNode,e))}for(;a<t.length;a+=1)t[a].d(1);t.length=i.length}},d(r){Xe(t,r),r&&k(e)}}}function Sc(n){let e,i,t,r,o,a,l,s,f,u,c,p,d,g,y,h,_,v,b,E,N,T,R,I,w;e=new la({props:{shortcuts:n[5]}}),o=new of({}),c=new dc({props:{width:n[4],id:"main",key:"main",style:"background: var(--blue5-0)",class:"abs t100pc r0 z-index88",capture:!0}}),g=new Ec({props:{id:"editor"}});let S=Object.entries(n[3]),M=[];for(let A=0;A<S.length;A+=1)M[A]=na($o(n,S,A));return{c(){Ne(e.$$.fragment),i=re(),t=q("div"),r=q("div"),Ne(o.$$.fragment),a=re(),l=q("input"),s=re(),f=q("input"),u=re(),Ne(c.$$.fragment),p=re(),d=q("div"),Ne(g.$$.fragment),y=re(),h=q("div"),_=re(),v=q("div");for(let A=0;A<M.length;A+=1)M[A].c();b=re(),E=q("a"),N=q("img"),this.h()},l(A){Te(e.$$.fragment,A),i=ie(A),t=z(A,"DIV",{class:!0});var F=W(t);r=z(F,"DIV",{style:!0,class:!0});var V=W(r);Te(o.$$.fragment,V),a=ie(V),l=z(V,"INPUT",{type:!0,class:!0}),s=ie(V),f=z(V,"INPUT",{type:!0,class:!0}),u=ie(V),Te(c.$$.fragment,V),V.forEach(k),p=ie(F),d=z(F,"DIV",{class:!0});var ee=W(d);Te(g.$$.fragment,ee),y=ie(ee),h=z(ee,"DIV",{class:!0}),W(h).forEach(k),ee.forEach(k),_=ie(F),v=z(F,"DIV",{style:!0,class:!0});var G=W(v);for(let we=0;we<M.length;we+=1)M[we].l(G);b=ie(G),E=z(G,"A",{href:!0,class:!0,style:!0});var ae=W(E);N=z(ae,"IMG",{style:!0,class:!0,src:!0}),ae.forEach(k),G.forEach(k),F.forEach(k),this.h()},h(){D(l,"type","number"),D(l,"class","br ptb0-5 plr1 minw0px"),D(f,"type","number"),D(f,"class","br ptb0-5 plr1 minw0px"),ke(r,"background","var(--blue5-0)"),D(r,"class","flex row-center-stretch rel t0 l0 w100pc bb z-index99"),D(h,"class","w100pc minh4em"),D(d,"class","grow flex column-stretch-stretch overflow-auto"),ke(N,"background","none"),ke(N,"height","2.4em"),D(N,"class","pt0-4 pb0-3 plr0-5"),Cn(N.src,T="/liberatedinterfaces.png")||D(N,"src",T),D(E,"href","https://liberatedinterfaces.tv"),D(E,"class","bt"),ke(E,"padding","0"),ke(E,"line-height","0em"),ke(v,"background","var(--blue5-0)"),D(v,"class","flex row w100pc z-index98"),D(t,"class","flex column-stretch-stretch grow h100vh")},m(A,F){Se(e,A,F),oe(A,i,F),oe(A,t,F),P(t,r),Se(o,r,null),P(r,a),P(r,l),Lt(l,n[0].width),P(r,s),P(r,f),Lt(f,n[0].height),P(r,u),Se(c,r,null),P(t,p),P(t,d),Se(g,d,null),P(d,y),P(d,h),P(t,_),P(t,v);for(let V=0;V<M.length;V+=1)M[V].m(v,null);P(v,b),P(v,E),P(E,N),R=!0,I||(w=[ce(Nc,"resize",xc),ce(l,"input",n[6]),ce(f,"input",n[7])],I=!0)},p(A,[F]){if(F&1&&nn(l.value)!==A[0].width&&Lt(l,A[0].width),F&1&&nn(f.value)!==A[0].height&&Lt(f,A[0].height),F&14){S=Object.entries(A[3]);let V;for(V=0;V<S.length;V+=1){const ee=$o(A,S,V);M[V]?M[V].p(ee,F):(M[V]=na(ee),M[V].c(),M[V].m(v,b))}for(;V<M.length;V+=1)M[V].d(1);M.length=S.length}},i(A){R||(te(e.$$.fragment,A),te(o.$$.fragment,A),te(c.$$.fragment,A),te(g.$$.fragment,A),R=!0)},o(A){le(e.$$.fragment,A),le(o.$$.fragment,A),le(c.$$.fragment,A),le(g.$$.fragment,A),R=!1},d(A){xe(e,A),A&&k(i),A&&k(t),xe(o),xe(c),xe(g),Xe(M,A),I=!1,mt(w)}}}function xc(){}function Ic(n,e,i){let t,r,o;he(n,At,_=>i(10,t=_)),he(n,nt,_=>i(11,r=_)),he(n,Vt,_=>i(0,o=_));function a(_){ge(nt,r=[Ra(_)],r),ge(At,t=!0,t)}function l(_){ge(nt,r=[-1,-1,-1,-1],r),ge(At,t=!1,t)}const s={ops:rn},f=(_,v)=>console.log(`[MXF] ${_}`,v||"");let u=720/2;an(c);async function c(){f("\u{1F44D} inited")}let p=[];function d(){o.width=nn(this.value),Vt.set(o)}function g(){o.height=nn(this.value),Vt.set(o)}return[o,a,l,s,u,p,d,g,(_,v)=>a(_),(_,v)=>l()]}class Oc extends Ce{constructor(e){super(),De(this,e,Ic,Sc,Le,{})}}function Tc(n){let e,i;return e=new $u({props:{application:Oc}}),{c(){Ne(e.$$.fragment)},l(t){Te(e.$$.fragment,t)},m(t,r){Se(e,t,r),i=!0},p:Pe,i(t){i||(te(e.$$.fragment,t),i=!0)},o(t){le(e.$$.fragment,t),i=!1},d(t){xe(e,t)}}}let Cc=!0;function Ac(n,e,i){return[!1]}class Dc extends Ce{constructor(e){super(),De(this,e,Ac,Tc,Le,{prerender:0})}get prerender(){return this.$$.ctx[0]}}export{Dc as default,Cc as prerender};
