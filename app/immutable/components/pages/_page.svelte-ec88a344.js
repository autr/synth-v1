import{S as Ce,i as Le,s as Fe,e as He,b as ae,R as ye,A as Pe,h as R,V as Et,G as ge,k as V,q as he,a as te,l as G,m as q,r as pe,c as ne,n as P,F as A,u as De,N as Ye,a4 as Ee,p as je,Q as ke,g as st,t as ue,d as lt,f as oe,a5 as _e,a2 as Ir,a3 as _n,_ as ba,O as Je,P as ht,v as Ne,w as Re,x as Se,T as _t,y as xe,X as zt,H as wa,L as Ea,U as Na,Y as Sa,Z as br,o as En,a6 as wr,B as ys,C as _s,D as bs,E as ws,a7 as Es,a1 as Ns}from"../../chunks/index-727a5d9c.js";import{w as ze}from"../../chunks/index-18a24c9d.js";import{_ as Ss}from"../../chunks/preload-helper-a540efd0.js";import{T as xs,e as It}from"../../chunks/Toggle-bda40779.js";let Is=!1;const Qr=!0,Os=!1,Ts=Object.freeze(Object.defineProperty({__proto__:null,browser:Qr,dev:Os,prerendering:Is},Symbol.toStringTag,{value:"Module"}));var As=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Rs={macOS:[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],windows:[/microsoft\s(windows)\s(vista|xp)/i],linux:[/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i,/(cros)\s[\w]+\s([\w\.]+\w)/i,/(sunos)\s?([\w\.]+\d)*/i,/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i,/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i]},xi={name:"Control",abbreviation:"Ctrl",symbol:"^"},Ii={name:"Alt",abbreviation:"Alt",symbol:""},Oi={name:"Windows Key",abbreviation:"Win",symbol:"\u229E"},Ms={macOS:{os:"Mac OS",primaryMeta:!0,meta:{name:"Command",abbreviation:"Cmd",symbol:"\u2318"},ctrl:{name:"Control",abbreviation:"Ctrl",symbol:"\u2303"},alt:{name:"Option (alt)",abbreviation:"Alt",symbol:"\u2325"}},windows:{os:"Windows",primaryMeta:!1,meta:Oi,ctrl:xi,alt:Ii},linux:{os:"Linux",primaryMeta:!1,meta:Oi,ctrl:xi,alt:Ii}};function Ps(n,e){for(var i in e)for(var t=e[i],r=0;r<t.length;r++)if(n.match(t[r]))return i}function ks(n){var e=Ps(n,Rs);if(e)return Ms[e]}var Ds=ks;const Cs=window.navigator,Ls=Ds(Cs.userAgent),Fs="UniversalCommand",Us="Shift",Bs="Escape",Jt=Ls.primaryMeta?"Meta":"Control",Ht=ze({});function Ti(n,e,i){const t=n.slice();return t[9]=e[i],t}function Ai(n){let e,i,t,r=Object.keys(n[2]).join("+")+"",o,a,l,s,f,u,c=n[1],h=[];for(let p=0;p<c.length;p+=1)h[p]=Ri(Ti(n,c,p));return{c(){e=V("div"),i=he("Keys"),t=te(),o=he(r),a=te(),l=V("div"),s=he("Shortcuts"),f=te();for(let p=0;p<h.length;p+=1)h[p].c();u=He(),this.h()},l(p){e=G(p,"DIV",{class:!0});var g=q(e);i=pe(g,"Keys"),g.forEach(R),t=ne(p),o=pe(p,r),a=ne(p),l=G(p,"DIV",{class:!0});var y=q(l);s=pe(y,"Shortcuts"),y.forEach(R),f=ne(p);for(let d=0;d<h.length;d+=1)h[d].l(p);u=He(),this.h()},h(){P(e,"class","italic"),P(l,"class","italic")},m(p,g){ae(p,e,g),A(e,i),ae(p,t,g),ae(p,o,g),ae(p,a,g),ae(p,l,g),A(l,s),ae(p,f,g);for(let y=0;y<h.length;y+=1)h[y].m(p,g);ae(p,u,g)},p(p,g){if(g&4&&r!==(r=Object.keys(p[2]).join("+")+"")&&De(o,r),g&2){c=p[1];let y;for(y=0;y<c.length;y+=1){const d=Ti(p,c,y);h[y]?h[y].p(d,g):(h[y]=Ri(d),h[y].c(),h[y].m(u.parentNode,u))}for(;y<h.length;y+=1)h[y].d(1);h.length=c.length}},d(p){p&&R(e),p&&R(t),p&&R(o),p&&R(a),p&&R(l),p&&R(f),Ye(h,p),p&&R(u)}}}function Ri(n){let e,i=n[9].command.join("+")+"",t;return{c(){e=V("div"),t=he(i)},l(r){e=G(r,"DIV",{});var o=q(e);t=pe(o,i),o.forEach(R)},m(r,o){ae(r,e,o),A(e,t)},p(r,o){o&2&&i!==(i=r[9].command.join("+")+"")&&De(t,i)},d(r){r&&R(e)}}}function js(n){let e,i,t,r=n[0]&&Ai(n);return{c(){r&&r.c(),e=He()},l(o){r&&r.l(o),e=He()},m(o,a){r&&r.m(o,a),ae(o,e,a),i||(t=[ye(window,"keydown",n[3]),ye(window,"keyup",n[4])],i=!0)},p(o,[a]){o[0]?r?r.p(o,a):(r=Ai(o),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null)},i:Pe,o:Pe,d(o){r&&r.d(o),o&&R(e),i=!1,Et(t)}}}function Vs(n,e,i){let t;ge(n,Ht,h=>i(2,t=h));let{debug:r=!1}=e,o,{shortcuts:a=[]}=e,l=[],s={};function f(h){let p=Ee(Ht);Ht.update(y=>(y[h.key]=!0,y)),p[Jt]&&(o={...p});let g=0;for(const y of l||[]){let d=!0;for(let _ of y.command)_==Fs&&(_=Jt),p[_]||(d=!1);d&&(y==null?void 0:y.action)&&(!s[g]&&y.command.find(_=>_==h.key)&&y.action(h),y.command.find(_=>_==Jt)),g+=1}}function u(h){if(Ht.update(p=>(delete p[h.key],p)),h.key==Jt&&o){for(const p of Object.keys(o))Ht.update(g=>(delete g[p],g));s={},o=null}Ht.set({...Ee(Ht)})}function c(h){!Array.isArray(h)&&typeof h=="object"?Object.keys(h).forEach(p=>{l.push({command:p.split("+"),action:h[p]})}):l=[...l,...h],l=l.map(p=>(p.command=p.command.map(g=>g+""),p))}return n.$$set=h=>{"debug"in h&&i(0,r=h.debug),"shortcuts"in h&&i(1,a=h.shortcuts)},[r,a,t,f,u,c]}class xa extends Ce{constructor(e){super(),Le(this,e,Vs,js,Fe,{debug:0,shortcuts:1,addBindings:5})}get addBindings(){return this.$$.ctx[5]}}const Er=n=>{const e=(i,t)=>({prepend:"vec3",type:"function",name:i,body:t,arguments:[{type:"vec3",name:"a"},{type:"vec3",name:"b"}]});return[e("NORM","return b;"),e("ADD","return min(a + b, vec3(1.0));"),e("DARKEN","return COLOR_MAP(DARKEN, a, b);"),e("SCREEN","return COLOR_MAP(SCREEN, a, b);"),e("OVERLAY","return COLOR_MAP(OVERLAY, a, b);"),e("HARD","return OVERLAY(b, a);"),e("SOFT","return COLOR_MAP(SOFT, a, b);"),e("PIN","return COLOR_MAP(PIN, a, b);"),e("DIFFERENCE","return abs(a - b);"),e("REFLECT","return COLOR_MAP(REFLECT, a, b);"),e("LIGHTEN","return COLOR_MAP(LIGHTEN, a, b);"),e("VIVID","return COLOR_MAP(VIVID, a, b);"),e("SUBTRACT","return max(a + b - vec3(1.0), vec3(0.0));"),e("MULTI","return a * b;"),e("AVERAGE","return (a + b) / 2.0;"),e("COLORBURN","return COLOR_MAP(COLORBURN, a, b);"),e("COLORDODGE","return COLOR_MAP(COLORDODGE, a, b);"),e("EXCLUSION","return a + b - 2.0 * a * b;"),e("GLOW","return REFLECT(b, a);"),e("HARD_MIX","return COLOR_MAP(HARD_MIX, a, b);"),e("BURN","return max(a + b - vec3(1.0), vec3(0.0));"),e("DODGE","return min(a + b, vec3(1.0));"),e("LINEAR","return COLOR_MAP(LINEAR, a, b);"),e("NEGATE","return vec3(1.0) - abs(vec3(1.0) - a - b);"),e("PHOENIX","return min(a, b) - max(a, b) + vec3(1.0);")]},Gs=Er().map(n=>n.name),an={APPLICATION:"application",ASSIGNMENTS:"assignments",DEBUG_SHADER:"debug_shader",DEBUG_SYSTEM:"debug_system",MIXER:"mixer"},Hs={float:"float",image:"sampler2D",bool:"bool",event:"bool",long:"int",color:"vec4",point2D:"vec2"},qs={OpSelect:"vec4"},qt={START:`
/*--BEGIN_PROJECT--`,END:`--END_PROJECT--*/
`},pn={BL_MODE:"BlendMode",BL_AMT:"BlendAmt"},vt={DEF:"define",VAR:"variable",FUNC:"function",COMMENT:"comment"},Ct={PAUSE:"pause",COMPILE:"compile",DONE:"done"},yt={IMAGE:"image",VIDEO:"video",CAMERA:"camera",FEEDBACK:"feedback"};let zs=n=>new Promise((e,i)=>{let t=[{type:yt.IMAGE,path:"mxz/testcards/transparent.png"},{type:yt.IMAGE,path:"mxz/testcards/bw.jpg"},{type:yt.IMAGE,path:"mxz/testcards/testcard.png"},{type:yt.IMAGE,path:"mxz/testcards/grid.png"},{type:yt.FEEDBACK}];Ss(()=>Promise.resolve().then(()=>Ts),void 0,import.meta.url).then(r=>{const{browser:o}=r;o?navigator.mediaDevices.enumerateDevices().then(function(a){a.forEach(l=>{l.kind=="videoinput"&&t.push({type:yt.CAMERA,path:l.label})}),e(t)}):e(t)}).catch(r=>{e(t)})});const Ws={SOURCE:"source",UNIT:"unit"},dt={APPEND:"append",INSERT:"insert",MOVE:"move",BIN:"bin"},Yn=ze(null),dn=ze({exp:0,speed:.5,ideal:255/2,luma:0}),Ia=ze({}),Oa=ze([]),Tt=ze([]),ce=ze({}),yn=ze("application"),Zt=ze({width:720,height:576}),At=ze({}),Ta={rotate:[0,0,0],skew:[0,0],scale:[1,1],translate:[0,0]},Nr=ze(Ta),Qt=ze({}),Wr=ze({}),Ot=ze("compile"),at=ze(null),Lt=ze(!1),Kt=ze(null),hn=ze(!1),mn=ze(!1),gn=ze(null),zn=ze(!1),Rr=(n,e)=>console.log(`[Store] ${n}`,e||"");function Mi(n){try{const e=JSON.parse(n);Rr("\u{1F4BE} loading stores from text",e==null?void 0:e._UNIFORMS),Yn.set((e==null?void 0:e._PREVIEW)||null),Ia.set((e==null?void 0:e._TITLES)||{}),Nr.set((e==null?void 0:e._PROJECTION)||Ta),Oa.set((e==null?void 0:e._SOURCES)||[]),Tt.set((e==null?void 0:e._SEQUENCE)||[]),ce.set((e==null?void 0:e._UNIFORMS)||{}),yn.set((e==null?void 0:e._CURRENT_VIEW)||"application"),Zt.set((e==null?void 0:e._DIMENSIONS)||{width:720,height:576}),At.set((e==null?void 0:e._ASSIGNMENTS)||{}),Qt.set((e==null?void 0:e._HIDDEN)||{}),Qr&&window.requestAnimationFrame(i=>{Rr("\u{1F3A8} setting uniforms and recompiling",(e==null?void 0:e._UNIFORMS)||"\u274C NO UNIFORMS"),ce.set((e==null?void 0:e._UNIFORMS)||{}),Ot.set("compile")})}catch(e){Rr("\u274C could not load stores",e.message)}}function $r(n){return JSON.stringify({_PREVIEW:Ee(Yn),_PROJECTION:Ee(Nr),_TITLES:Ee(Ia),_SOURCES:Ee(Oa),_SEQUENCE:Ee(Tt),_UNIFORMS:Ee(ce),_CURRENT_VIEW:Ee(yn),_DIMENSIONS:Ee(Zt),_ASSIGNMENTS:Ee(At),_HIDDEN:Ee(Qt)},null,n)}var Aa=`const int hardMax = 99999;
float cap = 0.;
float battery = 0.;
bool discharging = false;
vec3 outpix = vec3(0.);
vec2 pos = gl_FragCoord.xy;

float xx = direction == 1 ? pos.x :  center.x * RENDERSIZE.x;
float yy = direction == 0 ? pos.y :  center.y * RENDERSIZE.y;

vec2 centerPix = vec2(xx,yy);
int dist = int( distance(centerPix, pos) );
float angle = ANGLE(centerPix, pos) + 180.;
float res = resistance;
if (type ==0) res *= 2.;

for (int i = 0; i < hardMax; i++) {

	
	

	vec2 lookup = vec2(xx,yy);
	vec3 rgb = IMG_PIXEL( TEXTURE, lookup ).rgb;
	float pix = length(rgb)/3.;
	pix = (rgb.r + rgb.g + rgb.b)/3.;
	pix = pow(pix, power);
	
	if (type == 0) { 
	
		cap += pix;
		if (cap > res) cap -= res;

		
	} else if (type == 1) { 
	
		if (battery < res && !discharging) battery += pix;
		if (battery > res) discharging = true;
		if (battery < 0.) discharging = false;
		
		if (discharging) {
			cap = battery;
			battery -= ((discharge.x * 20.)+0.05) + (discharge.y / 5.);
		} else {
			cap = 0.;
		}
	} else if (type == 2) { 
		cap += pix;
		cap -= discharge.x;
	}
	
	/* LOOP */
	
	int idx = direction == 3 ? dist - i : i;
	vec2 outward = VEC2_FROM_ANGLE(centerPix, angle, float(idx));
	
	xx = direction == 1 ? gl_FragCoord.x : outward.x;
	yy = direction == 0 ? gl_FragCoord.y : outward.y;
	
	if (i >= dist) break;
	
}

cap /= res;

return vec4( HSL_TO_RGB(vec3(hue,saturation,cap*lightness)), INPUT.a);`,Ra="return INPUT;",Ma=`vec2 pos = POS_NORM;
float amt = Amt * 0.5;
float Amount = Amt * 0.5;

if (TYPE == 0) { 

	/*
		LumaSharpen 1.4.1

		original hlsl by Christian Cann Schuldt Jensen ~ CeeJay.dk
		port to glsl by Anon

		It blurs the original pixel with the surrounding pixels and then subtracts this blur to sharpen the image.
		It does this in luma to avoid color artifacts and allows limiting the maximum sharpning to avoid or lessen halo artifacts.

		This is similar to using Unsharp Mask in Photoshop.
	*/

	float sharp_strength = Amount;
	float sharp_clamp = sharp_strength;
	float offset_bias = Radius;
	
	#define COEFLUMA vec3(0.299, 0.587, 0.114)       
	

	vec4 colorInput = IMG_NORM_PIXEL(TEXTURE, POS_NORM);
	
	vec3 ori = colorInput.rgb;
	vec3 sharp_strength_luma = (COEFLUMA * sharp_strength);
	
	
	

	float px = 1.0/RENDERSIZE.x;
	float py = 1.0/RENDERSIZE.y;
	vec2 xy = gl_FragCoord.xy;

	

	vec3 blur_ori = IMG_NORM_PIXEL(TEXTURE, POS_NORM.xy + vec2(px,-py) * 0.5 * offset_bias).rgb; 
	blur_ori += IMG_NORM_PIXEL(TEXTURE, POS_NORM.xy + vec2(-px,-py) * 0.5 * offset_bias).rgb;  
	blur_ori += IMG_NORM_PIXEL(TEXTURE, POS_NORM.xy + vec2(px,py) * 0.5 * offset_bias).rgb; 
	blur_ori += IMG_NORM_PIXEL(TEXTURE, POS_NORM.xy + vec2(-px,py) * 0.5 * offset_bias).rgb; 
	blur_ori *= 0.25;
	vec3 sharp = ori - blur_ori;
	vec4 sharp_strength_luma_clamp = vec4(sharp_strength_luma * (0.5 / sharp_clamp),0.5);
	float sharp_luma = clamp((dot(vec4(sharp,1.0), sharp_strength_luma_clamp)), 0.0,1.0 );
	sharp_luma = (sharp_clamp * 2.0) * sharp_luma - sharp_clamp;
	colorInput.rgb = colorInput.rgb + sharp_luma;

	return clamp(colorInput, 0.0,1.0);

	

	for (int i = 0; i < 4; i++) {

		float blur_ori = IMG_NORM_PIXEL(TEXTURE, POS_NORM.xy + vec2(px,-py) * 0.5 * offset_bias)[i]; 
		blur_ori += IMG_NORM_PIXEL(TEXTURE, POS_NORM.xy + vec2(-px,-py) * 0.5 * offset_bias)[i];  
		blur_ori += IMG_NORM_PIXEL(TEXTURE, POS_NORM.xy + vec2(px,py) * 0.5 * offset_bias)[i]; 
		blur_ori += IMG_NORM_PIXEL(TEXTURE, POS_NORM.xy + vec2(-px,py) * 0.5 * offset_bias)[i]; 

		blur_ori *= 0.25;  

		
		float sharp = ori[i] - blur_ori;  

		
		float sharp_strength_luma_clamp = sharp_strength_luma[i] * (0.5 / sharp_clamp); 

		float sharp_luma = clamp((sharp + sharp_strength_luma_clamp), 0.0,1.0 ); 
		sharp_luma = (sharp_clamp * 2.0) * sharp_luma - sharp_clamp; 

		

		colorInput[i] = colorInput[i] + sharp_luma;    
	}

	return clamp(colorInput, 0.0,1.0);
	
} else if (TYPE == 1) {

	

	vec3 res = vec3(RENDERSIZE, 1.);
	float time = TIME;

	const vec2 blurdir = vec2( 1.0, 0.0 );

	float blurdist_px = float(RENDERSIZE.x*Radius);
	vec2 POS = POS_FRAG;
	vec2 suv = POS / res.xy; 
	vec2 uv = POS / res.xy;

	float blur = 10. * amt * blurdist_px;
	blur *= .1; 

	float da = 6.283;
	float a = 1.0;

    if (Jitter) { 
    	a = da * HASH12N(uv+(time)); 
	} else { 
		a = da * HASH12N(uv); 
	}

	vec3 sumcol = vec3(0.0);

	for (int i=0;i<10;++i) {
		vec2 ofs = vec2( cos(a), sin(a) ) / res.xy * blur*float(i+1)*.31;
		vec2 p = uv+(ofs/10.);
		vec3 pix = IMG_NORM_PIXEL(TEXTURE, p).rgb;
		sumcol = sumcol+SRGB2LIN(pix);
		a += da;
	}

	sumcol = sumcol / 10.;
	sumcol = max( sumcol, 0.0 );

	return vec4( LIN2SRGB( sumcol ), INPUT.a);
} else {

	
	return IMG_NORM_PIXEL(TEXTURE, pos );

}`,Pa=`vec2 pos = POS_NORM;
vec2 center = vec2( 0.5, 0.5 );
float off = Offset;
float all = mix(SUM_RGBA(Src)/3.0,1.0,1.0-SrcAmount);
if (Invert) all = 1.0 - all;
float bb = (all*2.0)-1.0;
bb += off;

float mini = Mini ? 0.1 : 1.;

vec2 xy = XY * vec2(mini,mini);
vec2 zoom = Zoom * vec2(mini,mini);

float angle = ANGLE(center, pos);

pos.x += xy.x * bb;
pos.y += xy.y * bb;
pos.x += (((pos.x * 2.0) - 1.0) * zoom.x) * bb;
pos.y += ((pos.y * 2.0) - 1.0) * (zoom.y * bb);
if (Rotate) pos = ROTATE_VEC2(Origin, pos, 	Degree * bb * 180. * mini);

return IMG_NORM_PIXEL(TEXTURE,pos);`,ka=`float MINI = Mini ? 0.2 : 1.; 

vec3 hsl = RGB_TO_HSL( INPUT.rgb );

if (ColorMode == 3) {

	

	float maxDelta = sqrt(hsl.y) - hsl.y;
	hsl.y += (maxDelta * Vibrance);

} else if (ColorMode == 1) {

	

	vec3 tint = vec3(TintHue / 360.0,1.0,0.5);
	hsl = RGB_TO_HSL(mix(HSL_TO_RGB(hsl),HSL_TO_RGB(tint),TintAmount * hsl.z * MINI));

} else if (ColorMode == 2) {

	

	
	
	
	
	
	

	
	

	
	
	

	float space = 1./Levels;
	float snapped = hsl.z - FMOD(hsl.z,space); 
	float blend = FMOD(hsl.z,space)*Levels; 
	if (blend > 0.5) blend -= blend - 0.5;
	blend *= 2.;

	float h1 = snapped * Spacing;
	float h2 = (snapped + space) * Spacing;
	vec3 rgb1 = HSL_TO_RGB(vec3(h1, 1.0, 0.5));
	vec3 rgb2 = HSL_TO_RGB(vec3(h2, 1.0, 0.5));

	hsl = RGB_TO_HSL(mix(rgb1,rgb2,blend*Smooth));

}

/*------------ SATURATION ------------*/

hsl.y += Saturation * MINI;
hsl.y = clamp( hsl.y, 0.0, 1.0 );
hsl.x = FMOD( hsl.x + (Shift * MINI), 1.0);

/*------------ LIGHT / RGB ------------*/

vec3 rgb = HSL_TO_RGB(hsl);
vec3 final;

if (LightMode == 0) {

	

	vec3 hsl = RGB_TO_HSL(rgb);
	hsl.z += Light * MINI;
	final = HSL_TO_RGB(hsl);

} else if (LightMode == 1) {

	

	final = rgb * pow(2.0, Light * MINI);

} else if (LightMode == 2) {

	

	vec3 hsv = RGB_TO_HSV(rgb);
	hsv.z += Light * MINI;
	final = HSV_TO_RGB(hsv);

}

/*------------ INVERT ------------*/

if (Invert) final = RGB_SHIFT( vec3(1.0,1.0,1.0) - final, 0.5);

/*------------ LOW / HIGH ------------*/

float low = Low * (MINI/2.);
float high = 1.0 - (High * (MINI/2.));

/*------------ NOISE ------------*/

return vec4( LEVELS(final.rgb, Low, 1.0, High).rgb, INPUT.a );`,Da=`vec3 mask = INPUT.rgb;
vec3 foreground = INPUT.rgb;

if (Mode == 1) {
	mask = Mask.rgb;
	foreground = Foreground.rgb;
}

float amt;
float sat = RGB_TO_HSL(mask).y;

if (LightMode == 0) {
	
	amt = RGB_TO_HSL(mask).z;
} else if (LightMode == 1) {
	
	amt = RGB_TO_HSV(mask).z;
} else {
	
	amt = mask.r + mask.g + mask.b;
}

if (Invert) amt = 1.0 - amt;

float ll = MAP(Threshold.x,0.0,1.0,-0.1,1.1);
float hh = MAP(Threshold.y,0.0,1.0,-0.1,1.1);

float low = MAP(amt,ll, ll+Smooth.x,1.0,0.0, true);
float high = MAP(amt,hh-Smooth.y,hh,0.0,1.0, false);
float blend = CLAMP(max(low,high),-1.0,1.0);
blend = MAP(blend,0.0,1.0,-1.0,1.0);

blend *= 1.0 + (sat * SatInfluence * 1.);
blend = (blend+1.0)/2.0;

return vec4( mix(foreground,Background.rgb,blend), 1.0);`,Ca=`if (Mode == 0) {
	return INPUT;
} else if (Mode == 1) {
	return IMG_NORM_PIXEL( u999, POS_NORM ).rgb;
} else if (Mode == 2) {
	return Src;
}`,La=`bool SnapShape = true; 
float Skew = 0.5; 

vec2 pos = POS_FRAG;
float ratio = RENDERSIZE.y / RENDERSIZE.x;

vec2 center = Center * RENDERSIZE;
vec2 trueCenter = vec2( 0.5, 0.5 ) * RENDERSIZE;

vec3 rgb = INPUT.rgb;
bool inv = false;

pos = ROTATE_VEC2( center, pos, Rotate * 360.0 );

if (Fit) pos.x = (pos.x * ratio) + (( RENDERSIZE.x - RENDERSIZE.y) / 2.0);

float shape = float(Shape);
float pointsTotal = shape + 1.0;
float segmentAng = 360.0 / pointsTotal;
float miniAngle = segmentAng * mod( pointsTotal, 1. );

float flip = 90.;
int p = int( floor( pointsTotal ) );
if (p == 2) {
    flip +=  miniAngle / 2. ;
    flip += 180.;
} else if (p == 3) {
    flip +=  miniAngle / 2. ;
} else if (p == 4) {
    flip -= (segmentAng / 2.0);
    flip - (miniAngle / 2.);
    inv = !inv;
} else if (p == 5) {
    flip += 180.;
    flip +=  miniAngle / 2. ;
    inv = !inv;
} else if (p == 6) {
    flip -= (segmentAng / 2.0);
    flip +=  miniAngle / 2. ;
    inv = !inv;
} else if (p == 7) {
    flip +=  miniAngle / 2. ;
    inv = !inv;
} else if (p == 8) {
    flip -= (segmentAng / 2.0);
    flip +=  miniAngle / 2. ;
} else if (p == 9) {
    flip +=  miniAngle / 2. ;
} else if (p == 10) {
    flip -= (segmentAng / 2.0);
    flip +=  miniAngle / 2. ;
    inv = !inv;
} else if (p == 11) {
    inv = !inv;
}

pos = ROTATE_VEC2( center, pos, flip );

float posAngle = ANGLE( center, pos );
float centerDist = distance(center, pos);
bool isMini = posAngle > 360.0 - miniAngle && posAngle < 360.;

float prevAngle = posAngle -mod( posAngle, segmentAng );
float midpointAngle;

if (!isMini) {

    

    midpointAngle = prevAngle + (segmentAng / 2.0);

} else {

    midpointAngle = -( (miniAngle) / 2.0 );

}

vec2 rotatedLoc = ROTATE_VEC2( center, pos, midpointAngle );
vec2 rotatePrev = ROTATE_VEC2( center, pos, midpointAngle);

float ogDist2Center = distance( rotatedLoc.x, center.x );
float dist2Center = ogDist2Center;
float DIST = RENDERSIZE.x * Size;
float HDIST = DIST / 2.0;

    

float alter = (ShapeMode == 1) ? Alternate : 0.0;
bool ODD = mod( posAngle, segmentAng * (1.0 + alter) ) > segmentAng;
if (ODD) dist2Center += DIST / 2.0;

dist2Center -= TIME * Scroll * DIST;
centerDist -= TIME * Scroll * DIST;

float skew = MAP( Skew, 0.0, 1.0, -1.0, 1.0);
float pointy = abs( center.y - rotatePrev.y  ) * skew * 10.;

float idxDist = mix( dist2Center, centerDist, Circular) + pointy;
float idxMod = mod( idxDist, DIST );
int idx = int( (idxDist - idxMod) / DIST );

vec3 red = vec3(0.0);

float wipe = Recursion * DIST;
float smo = (DIST * Smooth);
bool isRecur = ShapeMode == 1;
if (!isRecur) idxMod = idxDist;
red.r = MAP(idxMod, wipe, wipe + smo, 1.0, 0.0);
red.r = clamp(red.r, 0.0, 1.0);

if (Invert) red.r = 1.0 - red.r;

vec3 black = vec3(0.0,0.0,0.0);
vec3 white = vec3(1.0,1.0,1.0);

if ( Mode == 0 ) {

    return vec4( HSL_TO_RGB( Color[0], Color[1], Color[2] * red.r ), 1.0);

} else if (Mode == 1) {
    vec3 invt = RGB_SHIFT(vec3(1.0,1.0,1.0)-rgb,0.5);
    vec3 mixed = (invt * red.r) + (rgb * (1.0-red.r));
    return vec4( mixed, 1.0);
} else if (Mode == 2) {
    return vec4( mix(Mask.rgb,rgb,red.r), 1.0);
} else {
    return vec4( mix(Mask.rgb,rgb,red.r), 1.0);
}`,Fa="return INPUT;",Ua=`vec3 src = INPUT.rgb;
vec2 frag = POS_FRAG;
vec2 norm = POS_NORM;
vec2 center = CENTER();
float ratio = RENDERSIZE.y / RENDERSIZE.x;

float mask = SUM_RGB( Mode != 1 ? vec3(.5) : Src.rgb ) / 3.0;
mask = pow(mask, SmoothExp);
if (Invert) mask = 1.0 - mask;

float width = RENDERSIZE.x;
float height = RENDERSIZE.y;
float total = width*height;

/* define sizes */

float pixel = (frag.y * RENDERSIZE.x) + frag.x;
float scanline = MAP(pixel,0.,total, 0.,1.);

/* set frequencies */

float count = 30.; 
float freq = float(int((Freq * count) + 1.));

/* SYNC */

freq += Sync * 0.1;
freq += mask * ExtSync * 0.1;

/* MISC */

float space = Lock == 0 ? width/freq : total/freq;

/* do scrolls here */

frag.y -= RENDERSIZE.y / 2.0;

/* OFFSET */

pixel += Offset * TIME * ( Lock == 0 ? width : width * height );
pixel += mask * ExtOffset * ( Lock == 0 ? width : width * height );

float wave = clamp( MAP( FMOD(pixel,space),0.0, space * Ramp, 0.0, PI), 0.0, PI);
float r = WAVE( wave, 1., Amp, Exp );
if (Mask) r *= mask;

return vec4( HSL_TO_RGB( Color[0], Color[1], Color[2] * r ), 1.0);`,Ba=`vec2 pos = POS_NORM;
vec2 xy = POS_FRAG;
float idx = ( xy.y * RENDERSIZE.x ) + ( xy.x );

if (Mode == 1) {
	idx = distance(pos,Origin) * (RENDERSIZE.x * RENDERSIZE.y);
}

float freq = (Frequency.x * 0.01) + (Frequency.y * 0.0001);
float wobble = sin((TIME * Speed) + (idx * freq));

pos = VEC2_FROM_ANGLE( pos, Angle, wobble * Amount * 0.5 );

pos.x = FMOD(pos.x, 1.);
pos.y = FMOD(pos.y, 1.);

return IMG_NORM_PIXEL(TEXTURE,pos);`,ja=`vec3 hsl = RGB_TO_HSL( INPUT.rgb );

hsl.z += Exp * Amp * 0.001;
return vec4( HSL_TO_RGB(hsl).rgb, INPUT.a );`;const Xs=!0,Ys={type:{type:"long",default:2,values:[0,1,2],labels:["DIGITAL","ANALOG","ADDITIVE"]},direction:{type:"long",default:0,values:[0,1,2,3],labels:["X","Y","XY","XYREV"]},resistance:{type:"float",default:10,min:1,max:100},power:{type:"float",default:1,min:1,max:4},discharge:{type:"point2D",default:[.2,0],min:[0,-1],max:[1,1]},center:{type:"point2D",default:[0,0],min:[0,0],max:[1,1]},blend:{type:"float",default:.2,min:0,max:1},hue:{type:"float",default:0,min:0,max:1},saturation:{type:"float",default:0,min:0,max:1},lightness:{type:"float",default:1,min:0,max:2}},ei={PASS:Xs,INPUTS:Ys},Js=!0,Ks={},ti={CHANNEL:Js,INPUTS:Ks},Zs=!0,Qs={TYPE:{type:"long",default:0,gui:"MultiClick",labels:["SHARPEN","DITHER"]},Amt:{type:"float",min:0,max:1,default:0},Threshold:{type:"float",min:0,max:1,default:.2},Radius:{type:"float",min:0,max:1,default:.2},Jitter:{type:"bool",default:!1}},ni={PASS:Zs,INPUTS:Qs},$s=!0,el={Mini:{type:"bool",default:!0},Src:{type:"long",min:-1,default:-1,gui:"OpSelect"},SrcAmount:{type:"float",min:0,max:1,default:0},Invert:{type:"bool",default:!1},Offset:{type:"float",default:0,min:-1,max:1},XY:{type:"point2D",default:[0,0],min:[-1,-1],max:[1,1]},Zoom:{type:"point2D",default:[0,0],min:[-1,-1],max:[1,1]},Rotate:{type:"bool",default:!1},Degree:{type:"float",default:0,min:-1,max:1},Origin:{type:"point2D",default:[.5,.5],min:[0,0],max:[1,1]}},ri={PASS:$s,INPUTS:el},tl={Mini:{type:"bool",default:!1},Invert:{type:"bool",default:!1},LightMode:{type:"long",default:0,labels:["Lightness","Exposure","Brightness"],gui:"MultiClick"},Low:{type:"float",default:0,min:0,max:1},Light:{type:"float",default:0,min:-1,max:1},High:{type:"float",default:1,min:0,max:1},Saturation:{type:"float",default:0,min:-1,max:1},Shift:{type:"float",default:0,min:-.5,max:.5,position:-1,smooth:0,degrees:359},ColorMode:{type:"long",default:0,labels:["Basic","Tint","Colorise","Tweak"],gui:"MultiClick"},TintAmount:{type:"float",default:0,min:0,max:1,link:"ColorMode:1"},TintHue:{type:"float",default:0,min:-180,max:180,degrees:359,link:"ColorMode:1"},Levels:{type:"float",default:0,min:0,max:10,link:"ColorMode:2"},Spacing:{type:"float",default:.5,min:0,max:1,link:"ColorMode:2"},Smooth:{type:"float",default:0,min:0,max:1,link:"ColorMode:2"},Flip:{type:"bool",default:!1},Vibrance:{type:"float",default:0,min:0,max:1,link:"ColorMode:3"}},ii={INPUTS:tl},nl={Mode:{type:"long",default:0,labels:["Basic","Advanced"],gui:"MultiClick"},Background:{type:"long",min:-1,default:-1,gui:"OpSelect"},Foreground:{type:"long",min:-1,default:-1,gui:"OpSelect",link:"Mode:1"},Mask:{type:"long",min:-1,default:-1,gui:"OpSelect",link:"Mode:1"},LightMode:{type:"long",default:0,labels:["Lightness","Brightness","RGB"],gui:"MultiClick",link:"Mode:1"},Invert:{type:"bool",default:!1},Threshold:{type:"point2D",default:[0,1],min:[0,0],max:[1,1]},Smooth:{type:"point2D",default:[0,0],min:[0,0],max:[1,1]},SatInfluence:{type:"float",default:0,min:-1,max:1}},oi={INPUTS:nl},rl={Mode:{type:"long",default:0,labels:["Anchor","Output","Teleport"],gui:"MultiClick"},Src:{gui:"OpSelect",link:"Mode:2"}},ai={INPUTS:rl},il={Mode:{type:"long",default:0,labels:["MATTE","INVERT","MASK","ALPHA"],gui:"MultiClick"},ShapeMode:{type:"long",default:0,labels:["SHAPE","RECURSIVE"],gui:"MultiClick"},Mask:{type:"long",default:-1,gui:"OpSelect",link:"Mode:2"},Shape:{type:"long",default:3,labels:["Horizontal","Vertical","Triangle","Square","Pentagon","Hexagon","Heptagon","Octagon"]},Circular:{type:"float",default:0,min:0,max:1},Smooth:{type:"float",default:0,min:0,max:1},Size:{type:"float",default:.5,min:0,max:1.5},Center:{type:"point2D",default:[.5,.5],min:[0,0],max:[1,1]},Rotate:{type:"float",default:.5,min:0,max:1},Invert:{type:"bool",default:!1},Fit:{type:"bool",default:!1},Recursion:{type:"float",default:.5,min:0,max:1,link:"ShapeMode:1"},Scroll:{type:"float",default:0,min:-1,max:1,link:"ShapeMode:1"},Alternate:{type:"float",default:0,min:0,max:1,link:"ShapeMode:1"},Color:{type:"color",min:[0,0,0],max:[1,1,1],default:[1,1,1]},Alpha:{type:"bool",default:!1}},si={INPUTS:il},ol={Src:{type:"image",gui:"ExtSource",default:{type:"image",path:"mxz/testcards/transparent.png"}},Rows:{type:"long",default:1},Columns:{type:"long",default:1},Index:{type:"long",default:0}},li={INPUTS:ol},al={Mode:{type:"long",min:0,default:0,gui:"MultiClick",labels:["BASIC","DEFORM"]},Lock:{type:"long",default:0,labels:["Horizontal","Vertical"],gui:"MultiClick"},Ramp:{type:"float",default:1,min:0,max:2},Amp:{type:"float",default:0,min:0,max:2},Exp:{type:"float",default:1,min:1,max:8},Freq:{type:"float",min:0,max:1,default:.45},Sync:{type:"float",min:-1,max:1,default:0},Offset:{type:"float",min:-1,max:1,default:0},Src:{type:"long",min:-1,default:-1,gui:"OpSelect",link:"Mode:1"},SmoothExp:{type:"float",min:0,max:2,default:1,link:"Mode:1"},Mask:{type:"bool",default:!1,link:"Mode:1"},Invert:{type:"bool",default:!1,link:"Mode:1"},ExtSync:{type:"float",min:-1,max:1,default:0,link:"Mode:1"},ExtOffset:{type:"float",min:-1,max:1,default:0,link:"Mode:1"},Color:{type:"color",min:[0,0,0],max:[1,1,1],default:[1,1,1]}},ui={INPUTS:al},sl=!0,ll={Frequency:{type:"point2D",default:[0,0],min:[-1,-1],max:[1,1]},Speed:{type:"float",default:0,min:-10,max:10},Angle:{type:"float",default:0,min:0,max:360},Amount:{type:"float",default:.5,min:0,max:1},Mode:{type:"long",default:0,labels:["Scanline","Origin"],gui:"MultiClick"},Origin:{type:"point2D",default:[0,0],min:[0,0],max:[1,1],link:"Mode:1"}},fi={PASS:sl,INPUTS:ll},ul=!0,fl={Exp:{type:"float",default:0,min:-100,max:100},Luma:{type:"float",default:0,min:0,max:255},Amp:{type:"float",default:.1,min:0,max:1},Low:{type:"float",default:0,min:0,max:1},High:{type:"float",default:1,min:0,max:1}},ci={PASS:ul,INPUTS:fl},{window:cl}=Ir;function Pi(n,e,i){const t=n.slice();return t[37]=e[i],t[39]=i,t}function dl(n){let e;return{c(){e=he("NONE")},l(i){e=pe(i,"NONE")},m(i,t){ae(i,e,t)},p:Pe,i:Pe,o:Pe,d(i){i&&R(e)}}}function hl(n){let e,i,t;function r(a){n[32](a)}let o={};return n[4][n[1]]!==void 0&&(o.value=n[4][n[1]]),e=new xs({props:o}),Je.push(()=>ht(e,"value",r)),e.$on("contextmenu",n[8]),{c(){Ne(e.$$.fragment)},l(a){Re(e.$$.fragment,a)},m(a,l){Se(e,a,l),t=!0},p(a,l){const s={};!i&&l[0]&18&&(i=!0,s.value=a[4][a[1]],_t(()=>i=!1)),e.$set(s)},i(a){t||(oe(e.$$.fragment,a),t=!0)},o(a){ue(e.$$.fragment,a),t=!1},d(a){xe(e,a)}}}function pl(n){let e,i,t=n[4][n[1]]&&ki(n);return{c(){t&&t.c(),e=He()},l(r){t&&t.l(r),e=He()},m(r,o){t&&t.m(r,o),ae(r,e,o),i=!0},p(r,o){r[4][r[1]]?t?(t.p(r,o),o[0]&18&&oe(t,1)):(t=ki(r),t.c(),oe(t,1),t.m(e.parentNode,e)):t&&(st(),ue(t,1,1,()=>{t=null}),lt())},i(r){i||(oe(t),i=!0)},o(r){ue(t),i=!1},d(r){t&&t.d(r),r&&R(e)}}}function ml(n){let e,i,t=n[4][n[1]]&&Di(n);return{c(){t&&t.c(),e=He()},l(r){t&&t.l(r),e=He()},m(r,o){t&&t.m(r,o),ae(r,e,o),i=!0},p(r,o){r[4][r[1]]?t?(t.p(r,o),o[0]&18&&oe(t,1)):(t=Di(r),t.c(),oe(t,1),t.m(e.parentNode,e)):t&&(st(),ue(t,1,1,()=>{t=null}),lt())},i(r){i||(oe(t),i=!0)},o(r){ue(t),i=!1},d(r){t&&t.d(r),r&&R(e)}}}function gl(n){let e,i,t;return{c(){e=V("input"),this.h()},l(r){e=G(r,"INPUT",{id:!0,class:!0,type:!0,name:!0}),this.h()},h(){P(e,"id",n[1]),P(e,"class","w100pc radius100pc"),P(e,"type","text"),P(e,"name",n[2])},m(r,o){ae(r,e,o),zt(e,n[4][n[1]]),i||(t=[ye(e,"contextmenu",n[8]),ye(e,"input",n[21])],i=!0)},p(r,o){o[0]&2&&P(e,"id",r[1]),o[0]&4&&P(e,"name",r[2]),o[0]&18&&e.value!==r[4][r[1]]&&zt(e,r[4][r[1]])},i:Pe,o:Pe,d(r){r&&R(e),i=!1,Et(t)}}}function vl(n){let e;function i(o,a){return!o[0].max&&!o[0].labels?wl:bl}let t=i(n),r=t(n);return{c(){r.c(),e=He()},l(o){r.l(o),e=He()},m(o,a){r.m(o,a),ae(o,e,a)},p(o,a){t===(t=i(o))&&r?r.p(o,a):(r.d(1),r=t(o),r&&(r.c(),r.m(e.parentNode,e)))},i:Pe,o:Pe,d(o){r.d(o),o&&R(e)}}}function yl(n){let e,i,t;const r=[{name:n[2]},{id:n[1]},n[0],{step:n[0].type=="float"?0:1},{class:"mb0"}];function o(l){n[18](l)}let a={};for(let l=0;l<r.length;l+=1)a=wa(a,r[l]);return n[4][n[1]]!==void 0&&(a.value=n[4][n[1]]),e=new It({props:a}),Je.push(()=>ht(e,"value",o)),e.$on("contextmenu",n[8]),{c(){Ne(e.$$.fragment)},l(l){Re(e.$$.fragment,l)},m(l,s){Se(e,l,s),t=!0},p(l,s){const f=s[0]&7?Ea(r,[s[0]&4&&{name:l[2]},s[0]&2&&{id:l[1]},s[0]&1&&Na(l[0]),s[0]&1&&{step:l[0].type=="float"?0:1},r[4]]):{};!i&&s[0]&18&&(i=!0,f.value=l[4][l[1]],_t(()=>i=!1)),e.$set(f)},i(l){t||(oe(e.$$.fragment,l),t=!0)},o(l){ue(e.$$.fragment,l),t=!1},d(l){xe(e,l)}}}function _l(n){let e,i,t,r;const o=[{name:n[2]},{id:n[1]},n[0]];function a(f){n[17](f)}var l=n[3];function s(f){let u={};for(let c=0;c<o.length;c+=1)u=wa(u,o[c]);return f[4][f[1]]!==void 0&&(u.value=f[4][f[1]]),{props:u}}return l&&(e=new l(s(n)),Je.push(()=>ht(e,"value",a)),e.$on("contextmenu",n[8])),{c(){e&&Ne(e.$$.fragment),t=He()},l(f){e&&Re(e.$$.fragment,f),t=He()},m(f,u){e&&Se(e,f,u),ae(f,t,u),r=!0},p(f,u){const c=u[0]&7?Ea(o,[u[0]&4&&{name:f[2]},u[0]&2&&{id:f[1]},u[0]&1&&Na(f[0])]):{};if(!i&&u[0]&18&&(i=!0,c.value=f[4][f[1]],_t(()=>i=!1)),l!==(l=f[3])){if(e){st();const h=e;ue(h.$$.fragment,1,0,()=>{xe(h,1)}),lt()}l?(e=new l(s(f)),Je.push(()=>ht(e,"value",a)),e.$on("contextmenu",f[8]),Ne(e.$$.fragment),oe(e.$$.fragment,1),Se(e,t.parentNode,t)):e=null}else l&&e.$set(c)},i(f){r||(e&&oe(e.$$.fragment,f),r=!0)},o(f){e&&ue(e.$$.fragment,f),r=!1},d(f){f&&R(t),e&&xe(e,f)}}}function ki(n){let e,i,t,r,o,a,l,s,f;function u(d){n[26](d)}let c={class:"mb0-5 ",min:n[0].min[0],max:n[0].max[0]};n[4][n[1]][0]!==void 0&&(c.value=n[4][n[1]][0]),e=new It({props:c}),Je.push(()=>ht(e,"value",u)),e.$on("contextmenu",n[27]);function h(d){n[28](d)}let p={class:"mb0-5 ",min:n[0].min[1],max:n[0].max[1]};n[4][n[1]][1]!==void 0&&(p.value=n[4][n[1]][1]),r=new It({props:p}),Je.push(()=>ht(r,"value",h)),r.$on("contextmenu",n[29]);function g(d){n[30](d)}let y={class:"mb0 ",min:n[0].min[2],max:n[0].max[2]};return n[4][n[1]][2]!==void 0&&(y.value=n[4][n[1]][2]),l=new It({props:y}),Je.push(()=>ht(l,"value",g)),l.$on("contextmenu",n[31]),{c(){Ne(e.$$.fragment),t=te(),Ne(r.$$.fragment),a=te(),Ne(l.$$.fragment)},l(d){Re(e.$$.fragment,d),t=ne(d),Re(r.$$.fragment,d),a=ne(d),Re(l.$$.fragment,d)},m(d,_){Se(e,d,_),ae(d,t,_),Se(r,d,_),ae(d,a,_),Se(l,d,_),f=!0},p(d,_){const v={};_[0]&1&&(v.min=d[0].min[0]),_[0]&1&&(v.max=d[0].max[0]),!i&&_[0]&18&&(i=!0,v.value=d[4][d[1]][0],_t(()=>i=!1)),e.$set(v);const E={};_[0]&1&&(E.min=d[0].min[1]),_[0]&1&&(E.max=d[0].max[1]),!o&&_[0]&18&&(o=!0,E.value=d[4][d[1]][1],_t(()=>o=!1)),r.$set(E);const b={};_[0]&1&&(b.min=d[0].min[2]),_[0]&1&&(b.max=d[0].max[2]),!s&&_[0]&18&&(s=!0,b.value=d[4][d[1]][2],_t(()=>s=!1)),l.$set(b)},i(d){f||(oe(e.$$.fragment,d),oe(r.$$.fragment,d),oe(l.$$.fragment,d),f=!0)},o(d){ue(e.$$.fragment,d),ue(r.$$.fragment,d),ue(l.$$.fragment,d),f=!1},d(d){xe(e,d),d&&R(t),xe(r,d),d&&R(a),xe(l,d)}}}function Di(n){let e,i,t,r,o,a;function l(c){n[22](c)}let s={class:"mb0-5 ",min:n[0].min[0],max:n[0].max[0]};n[4][n[1]][0]!==void 0&&(s.value=n[4][n[1]][0]),e=new It({props:s}),Je.push(()=>ht(e,"value",l)),e.$on("contextmenu",n[23]);function f(c){n[24](c)}let u={class:"mb0 ",min:n[0].min[1],max:n[0].max[1]};return n[4][n[1]][1]!==void 0&&(u.value=n[4][n[1]][1]),r=new It({props:u}),Je.push(()=>ht(r,"value",f)),r.$on("contextmenu",n[25]),{c(){Ne(e.$$.fragment),t=te(),Ne(r.$$.fragment)},l(c){Re(e.$$.fragment,c),t=ne(c),Re(r.$$.fragment,c)},m(c,h){Se(e,c,h),ae(c,t,h),Se(r,c,h),a=!0},p(c,h){const p={};h[0]&1&&(p.min=c[0].min[0]),h[0]&1&&(p.max=c[0].max[0]),!i&&h[0]&18&&(i=!0,p.value=c[4][c[1]][0],_t(()=>i=!1)),e.$set(p);const g={};h[0]&1&&(g.min=c[0].min[1]),h[0]&1&&(g.max=c[0].max[1]),!o&&h[0]&18&&(o=!0,g.value=c[4][c[1]][1],_t(()=>o=!1)),r.$set(g)},i(c){a||(oe(e.$$.fragment,c),oe(r.$$.fragment,c),a=!0)},o(c){ue(e.$$.fragment,c),ue(r.$$.fragment,c),a=!1},d(c){xe(e,c),c&&R(t),xe(r,c)}}}function bl(n){let e,i,t,r=n[0].labels||[],o=[];for(let a=0;a<r.length;a+=1)o[a]=Ci(Pi(n,r,a));return{c(){e=V("select");for(let a=0;a<o.length;a+=1)o[a].c();this.h()},l(a){e=G(a,"SELECT",{id:!0,class:!0,type:!0});var l=q(e);for(let s=0;s<o.length;s+=1)o[s].l(l);l.forEach(R),this.h()},h(){P(e,"id",n[1]),P(e,"class","w100pc text-center italic maxw1000pc overflow-hidden"),P(e,"type","text"),n[4][n[1]]===void 0&&Sa(()=>n[20].call(e))},m(a,l){ae(a,e,l);for(let s=0;s<o.length;s+=1)o[s].m(e,null);br(e,n[4][n[1]]),i||(t=[ye(e,"contextmenu",n[8]),ye(e,"change",n[20])],i=!0)},p(a,l){if(l[0]&1){r=a[0].labels||[];let s;for(s=0;s<r.length;s+=1){const f=Pi(a,r,s);o[s]?o[s].p(f,l):(o[s]=Ci(f),o[s].c(),o[s].m(e,null))}for(;s<o.length;s+=1)o[s].d(1);o.length=r.length}l[0]&2&&P(e,"id",a[1]),l[0]&18&&br(e,a[4][a[1]])},d(a){a&&R(e),Ye(o,a),i=!1,Et(t)}}}function wl(n){let e,i,t;return{c(){e=V("input"),this.h()},l(r){e=G(r,"INPUT",{class:!0,type:!0}),this.h()},h(){P(e,"class","input button"),P(e,"type","number")},m(r,o){ae(r,e,o),zt(e,n[4][n[1]]),i||(t=ye(e,"input",n[19]),i=!0)},p(r,o){o[0]&18&&_n(e.value)!==r[4][r[1]]&&zt(e,r[4][r[1]])},d(r){r&&R(e),i=!1,t()}}}function Ci(n){let e,i=n[37]+"",t,r;return{c(){e=V("option"),t=he(i),this.h()},l(o){e=G(o,"OPTION",{name:!0});var a=q(e);t=pe(a,i),a.forEach(R),this.h()},h(){P(e,"name",r=n[37]),e.__value=n[39],e.value=e.__value},m(o,a){ae(o,e,a),A(e,t)},p(o,a){a[0]&1&&i!==(i=o[37]+"")&&De(t,i),a[0]&1&&r!==(r=o[37])&&P(e,"name",r)},d(o){o&&R(e)}}}function El(n){let e,i,t,r=n[6]?"Learning...":"MIDI Learn",o,a,l,s,f,u,c,h,p,g;const y=[_l,yl,vl,gl,ml,pl,hl,dl],d=[];function _(v,E){return v[3]?0:v[0].type=="float"||v[0].type=="int"?1:v[0].type=="long"?2:v[0].type=="string"?3:v[0].type=="point2D"?4:v[0].type=="color"?5:v[0].type=="bool"?6:7}return u=_(n),c=d[u]=y[u](n),{c(){e=V("div"),i=V("div"),t=V("div"),o=he(r),a=te(),l=V("div"),s=he("Remove Assignments"),f=te(),c.c(),this.h()},l(v){e=G(v,"DIV",{class:!0});var E=q(e);i=G(E,"DIV",{style:!0,class:!0});var b=q(i);t=G(b,"DIV",{class:!0});var N=q(t);o=pe(N,r),N.forEach(R),a=ne(b),l=G(b,"DIV",{class:!0});var T=q(l);s=pe(T,"Remove Assignments"),T.forEach(R),b.forEach(R),f=ne(E),c.l(E),E.forEach(R),this.h()},h(){P(t,"class","bb clickable"),P(l,"class","bb clickable"),je(i,"transform","translate("+n[5].offsetX+"px, "+n[5].offsetY+"px)"),P(i,"class","z-index2 bg abs t0 l0 border bt bl br cplr1 cptb0-5"),ke(i,"none",(n[7]||"").indexOf(n[1])==-1),P(e,"class","auto-element rel")},m(v,E){ae(v,e,E),A(e,i),A(i,t),A(t,o),A(i,a),A(i,l),A(l,s),A(e,f),d[u].m(e,null),h=!0,p||(g=[ye(cl,"click",n[9]),ye(t,"click",n[10]),ye(l,"click",n[11]),ye(e,"click",Nl)],p=!0)},p(v,E){(!h||E[0]&64)&&r!==(r=v[6]?"Learning...":"MIDI Learn")&&De(o,r),(!h||E[0]&32)&&je(i,"transform","translate("+v[5].offsetX+"px, "+v[5].offsetY+"px)"),(!h||E[0]&130)&&ke(i,"none",(v[7]||"").indexOf(v[1])==-1);let b=u;u=_(v),u===b?d[u].p(v,E):(st(),ue(d[b],1,1,()=>{d[b]=null}),lt(),c=d[u],c?c.p(v,E):(c=d[u]=y[u](v),c.c()),oe(c,1),c.m(e,null))},i(v){h||(oe(c),h=!0)},o(v){ue(c),h=!1},d(v){v&&R(e),d[u].d(),p=!1,Et(g)}}}function Nl(n){n.stopPropagation()}function Sl(n,e,i){let t,r,o,a,l;ge(n,Wr,Y=>i(33,t=Y)),ge(n,mn,Y=>i(6,r=Y)),ge(n,hn,Y=>i(7,o=Y)),ge(n,At,Y=>i(34,a=Y)),ge(n,ce,Y=>i(4,l=Y));let{def:s}=e,{key:f}=e,{parentName:u}=e,{name:c}=e,{uuid:h}=e,{rowIdx:p}=e,{colIdx:g}=e;const y=window,d=(Y,Ue)=>console.log(`[Auto] ${Y}`,Ue||"");let{component:_=null}=e,v={offsetX:0,offsetY:0};function E(Y,Ue){_e(hn,o=f,o),Ue!=null&&_e(hn,o+=":"+Ue,o),d(`opening context menu with ${o}`);const{offsetX:Oe,offsetY:We}=Y;i(5,v={offsetX:Oe,offsetY:We}),Y.preventDefault()}function b(Y){_e(hn,o=null,o),_e(mn,r=null,r)}function N(Y){_e(mn,r=r?null:o,r)}function T(Y){delete a[o],At.set(a),_e(hn,o=null,o),_e(mn,r=null,r)}let k;function I(Y){n.$$.not_equal(l[f],Y)&&(l[f]=Y,ce.set(l))}function w(Y){n.$$.not_equal(l[f],Y)&&(l[f]=Y,ce.set(l))}function x(){l[f]=_n(this.value),ce.set(l)}function B(){l[f]=ba(this),ce.set(l)}function F(){l[f]=this.value,ce.set(l)}function j(Y){n.$$.not_equal(l[f][0],Y)&&(l[f][0]=Y,ce.set(l))}const H=Y=>E(Y,0);function K(Y){n.$$.not_equal(l[f][1],Y)&&(l[f][1]=Y,ce.set(l))}const U=Y=>E(Y,1);function ee(Y){n.$$.not_equal(l[f][0],Y)&&(l[f][0]=Y,ce.set(l))}const fe=Y=>E(Y,0);function ve(Y){n.$$.not_equal(l[f][1],Y)&&(l[f][1]=Y,ce.set(l))}const Q=Y=>E(Y,1);function se(Y){n.$$.not_equal(l[f][2],Y)&&(l[f][2]=Y,ce.set(l))}const be=Y=>E(Y,2);function de(Y){n.$$.not_equal(l[f],Y)&&(l[f]=Y,ce.set(l))}return n.$$set=Y=>{"def"in Y&&i(0,s=Y.def),"key"in Y&&i(1,f=Y.key),"parentName"in Y&&i(12,u=Y.parentName),"name"in Y&&i(2,c=Y.name),"uuid"in Y&&i(13,h=Y.uuid),"rowIdx"in Y&&i(14,p=Y.rowIdx),"colIdx"in Y&&i(15,g=Y.colIdx),"component"in Y&&i(3,_=Y.component)},n.$$.update=()=>{n.$$.dirty[0]&19&&(Y=>{if(l[f]==null&&s.default!=null&&_e(ce,l[f]=JSON.parse(JSON.stringify(s.default)),l),!!y.RNDRS){for(const[Ue,Oe]of Object.entries(y.RNDRS))if(Oe.getValue()!=l[f]&&!s.ignore)try{Oe.uniforms[f]&&Oe.setValue(f,l[f])}catch(We){console.log("\u274C error setting value in Auto",We)}}})(),n.$$.dirty[0]&65539&&(Y=>{k!=f&&(_e(Wr,t[f]=s,t),i(16,k=f))})()},[s,f,c,_,l,v,r,o,E,b,N,T,u,h,p,g,k,I,w,x,B,F,j,H,K,U,ee,fe,ve,Q,se,be,de]}class Xr extends Ce{constructor(e){super(),Le(this,e,Sl,El,Fe,{def:0,key:1,parentName:12,name:2,uuid:13,rowIdx:14,colIdx:15,component:3},null,[-1,-1])}}function Li(n,e,i){const t=n.slice();return t[2]=e[i],t}function Fi(n){let e,i=n[2].type+"",t,r,o=(n[2].path||"")+"",a,l,s;return{c(){e=V("option"),t=he(i),r=te(),a=he(o),l=te(),this.h()},l(f){e=G(f,"OPTION",{});var u=q(e);t=pe(u,i),r=ne(u),a=pe(u,o),l=ne(u),u.forEach(R),this.h()},h(){e.__value=s=n[2],e.value=e.__value},m(f,u){ae(f,e,u),A(e,t),A(e,r),A(e,a),A(e,l)},p(f,u){u&32&&i!==(i=f[2].type+"")&&De(t,i),u&32&&o!==(o=(f[2].path||"")+"")&&De(a,o),u&32&&s!==(s=f[2])&&(e.__value=s,e.value=e.__value)},d(f){f&&R(e)}}}function xl(n){let e;return{c(){e=V("video"),this.h()},l(i){e=G(i,"VIDEO",{}),q(e).forEach(R),this.h()},h(){e.autoplay=!0,e.loop=!0,e.controls=!0},m(i,t){ae(i,e,t),n[17](e)},p:Pe,d(i){i&&R(e),n[17](null)}}}function Il(n){let e,i;return{c(){e=V("video"),this.h()},l(t){e=G(t,"VIDEO",{volume:!0,src:!0}),q(e).forEach(R),this.h()},h(){var t;e.autoplay=!0,P(e,"volume","0"),e.muted=!0,e.loop=!0,e.controls=!0,wr(e.src,i=(t=n[4][n[1]])==null?void 0:t.path)||P(e,"src",i)},m(t,r){ae(t,e,r),n[16](e)},p(t,r){var o;r&18&&!wr(e.src,i=(o=t[4][t[1]])==null?void 0:o.path)&&P(e,"src",i)},d(t){t&&R(e),n[16](null)}}}function Ol(n){let e,i;return{c(){e=V("img"),this.h()},l(t){e=G(t,"IMG",{src:!0}),this.h()},h(){var t;wr(e.src,i=(t=n[4][n[1]])==null?void 0:t.path)||P(e,"src",i)},m(t,r){ae(t,e,r),n[15](e)},p(t,r){var o;r&18&&!wr(e.src,i=(o=t[4][t[1]])==null?void 0:o.path)&&P(e,"src",i)},d(t){t&&R(e),n[15](null)}}}function Tl(n){let e,i,t,r,o,a,l,s,f,u,c=n[5],h=[];for(let d=0;d<c.length;d+=1)h[d]=Fi(Li(n,c,d));function p(d,_){var v,E,b;if(((v=d[4][d[1]])==null?void 0:v.type)==yt.IMAGE)return Ol;if(((E=d[4][d[1]])==null?void 0:E.type)==yt.VIDEO)return Il;if(((b=d[4][d[1]])==null?void 0:b.type)==yt.CAMERA)return xl}let g=p(n),y=g&&g(n);return{c(){e=V("div"),i=V("div"),t=V("div"),r=he(n[0]),o=te(),a=V("select");for(let d=0;d<h.length;d+=1)h[d].c();l=te(),s=V("div"),y&&y.c(),this.h()},l(d){e=G(d,"DIV",{class:!0});var _=q(e);i=G(_,"DIV",{class:!0});var v=q(i);t=G(v,"DIV",{class:!0});var E=q(t);r=pe(E,n[0]),E.forEach(R),o=ne(v),a=G(v,"SELECT",{class:!0});var b=q(a);for(let T=0;T<h.length;T+=1)h[T].l(b);b.forEach(R),v.forEach(R),l=ne(_),s=G(_,"DIV",{class:!0});var N=q(s);y&&y.l(N),N.forEach(R),_.forEach(R),this.h()},h(){P(t,"class","plr0-5 flex row-flex-start-center"),P(a,"class","invisible abs l0 t0"),n[6]===void 0&&Sa(()=>n[14].call(a)),P(i,"class","select bl bt br bb rel maxw100pc overflow-hidden 100pc"),P(s,"class","w100pc filled minh2em sticky t0 l0"),P(e,"class","flex column sticky t0 l0")},m(d,_){ae(d,e,_),A(e,i),A(i,t),A(t,r),A(i,o),A(i,a);for(let v=0;v<h.length;v+=1)h[v].m(a,null);br(a,n[6]),A(e,l),A(e,s),y&&y.m(s,null),f||(u=[ye(a,"change",n[7]),ye(a,"change",n[14]),ye(e,"dragover",Al),ye(e,"drop",n[8])],f=!0)},p(d,[_]){if(_&1&&De(r,d[0]),_&32){c=d[5];let v;for(v=0;v<c.length;v+=1){const E=Li(d,c,v);h[v]?h[v].p(E,_):(h[v]=Fi(E),h[v].c(),h[v].m(a,null))}for(;v<h.length;v+=1)h[v].d(1);h.length=c.length}_&96&&br(a,d[6]),g===(g=p(d))&&y?y.p(d,_):(y&&y.d(1),y=g&&g(d),y&&(y.c(),y.m(s,null)))},i:Pe,o:Pe,d(d){d&&R(e),Ye(h,d),y&&y.d(),f=!1,Et(u)}}}function Al(n){n.preventDefault()}function Rl(n,e,i){let t;ge(n,ce,I=>i(4,t=I));let{def:r}=e,{key:o}=e,{parentName:a}=e,{name:l}=e,{uuid:s}=e,{rowIdx:f}=e,{colIdx:u}=e;const c=window;let h=[];function p(){var I;if(c.RNDRS){for(const[w,x]of Object.entries(c.RNDRS))if(x&&d)x.setValue(o,d);else if(((I=t[o])==null?void 0:I.type)==yt.FEEDBACK){const B=document.getElementById("main");x.setValue(o,B)}}c.requestAnimationFrame(p)}En(async I=>{i(5,h=await zs()),p()});let g=!1;function y(I){i(13,g=!0),navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then((w,x)=>{console.log("\u2705 ------------ camera opened",w),i(3,d.srcObject=w,d)})}let d,_;function v(I){window.requestAnimationFrame(w=>{_&&_e(ce,t[o]=_,t)})}async function E(I){var j,H;I.preventDefault();const w=(H=(j=I==null?void 0:I.dataTransfer)==null?void 0:j.items)==null?void 0:H[0];if(!w)return;const x=await w.getAsFileSystemHandle(),B=x.name.split(".").pop().toLowerCase(),{name:F}=x;if(x.kind=="file"){const K=URL.createObjectURL(await x.getFile()),U=["mp4","mov","avi","mkv"],ee=["jpg","png","gif","jpeg"];U.indexOf(B)!=-1?_e(ce,t[o]={type:yt.VIDEO,path:K,name:F},t):ee.indexOf(B)!=-1&&_e(ce,t[o]={type:yt.IMAGE,path:K,name:F},t)}}function b(){_=ba(this),i(6,_),i(5,h)}function N(I){Je[I?"unshift":"push"](()=>{d=I,i(3,d)})}function T(I){Je[I?"unshift":"push"](()=>{d=I,i(3,d)})}function k(I){Je[I?"unshift":"push"](()=>{d=I,i(3,d)})}return n.$$set=I=>{"def"in I&&i(2,r=I.def),"key"in I&&i(1,o=I.key),"parentName"in I&&i(9,a=I.parentName),"name"in I&&i(0,l=I.name),"uuid"in I&&i(10,s=I.uuid),"rowIdx"in I&&i(11,f=I.rowIdx),"colIdx"in I&&i(12,u=I.colIdx)},n.$$.update=()=>{var I,w;n.$$.dirty&22&&(x=>{if(t[o]==null&&r.default!=null&&_e(ce,t[o]=JSON.parse(JSON.stringify(r.default)),t),!!c.RNDRS)for(const[B,F]of Object.entries(c.RNDRS));})(),n.$$.dirty&8218&&(x=>{var B;((B=t[o])==null?void 0:B.type)==yt.CAMERA?g||y():i(13,g=!1)})(),n.$$.dirty&18&&i(0,l=(I=t==null?void 0:t[o])!=null&&I.name?t[o].name:(w=t==null?void 0:t[o])!=null&&w.path?t[o].path.split("/").pop():"N/A")},[l,o,r,d,t,h,_,v,E,a,s,f,u,g,b,N,T,k]}class Ml extends Ce{constructor(e){super(),Le(this,e,Rl,Tl,Fe,{def:2,key:1,parentName:9,name:0,uuid:10,rowIdx:11,colIdx:12})}}function Pl(n){let e,i=n[0].labels[n[2][n[1]]]+"",t,r,o;return{c(){e=V("button"),t=he(i),this.h()},l(a){e=G(a,"BUTTON",{class:!0});var l=q(e);t=pe(l,i),l.forEach(R),this.h()},h(){P(e,"class","italic")},m(a,l){ae(a,e,l),A(e,t),r||(o=ye(e,"mousedown",n[3]),r=!0)},p(a,[l]){l&7&&i!==(i=a[0].labels[a[2][a[1]]]+"")&&De(t,i)},i:Pe,o:Pe,d(a){a&&R(e),r=!1,o()}}}function kl(n,e,i){let t;ge(n,ce,p=>i(2,t=p));let{def:r}=e,{key:o}=e,{parentName:a}=e,{name:l}=e,{uuid:s}=e,{rowIdx:f}=e,{colIdx:u}=e;const c=window;function h(p){_e(ce,t[o]+=1,t),t[o]>=r.labels.length&&_e(ce,t[o]=0,t)}return n.$$set=p=>{"def"in p&&i(0,r=p.def),"key"in p&&i(1,o=p.key),"parentName"in p&&i(4,a=p.parentName),"name"in p&&i(5,l=p.name),"uuid"in p&&i(6,s=p.uuid),"rowIdx"in p&&i(7,f=p.rowIdx),"colIdx"in p&&i(8,u=p.colIdx)},n.$$.update=()=>{n.$$.dirty&7&&(p=>{if(t[o]==null&&r.default!=null&&_e(ce,t[o]=JSON.parse(JSON.stringify(r.default)),t),!!c.RNDRS){for(const[g,y]of Object.entries(c.RNDRS))if(y.getValue()!=t[o]&&!r.ignore)try{y.uniforms[o]&&y.setValue(o,t[o])}catch(d){console.log("\u274C error setting value in MultiClick",d)}}})()},[r,o,t,h,a,l,s,f,u]}class Dl extends Ce{constructor(e){super(),Le(this,e,kl,Pl,Fe,{def:0,key:1,parentName:4,name:5,uuid:6,rowIdx:7,colIdx:8})}}const{window:Cl}=Ir;function Ll(n){let e,i,t=(n[3]?"Selecting...":n[2])+"",r,o,a,l,s;return{c(){e=V("div"),i=V("button"),r=he(t),o=te(),a=V("button"),this.h()},l(f){e=G(f,"DIV",{class:!0});var u=q(e);i=G(u,"BUTTON",{class:!0});var c=q(i);r=pe(c,t),c.forEach(R),o=ne(u),a=G(u,"BUTTON",{class:!0}),q(a).forEach(R),u.forEach(R),this.h()},h(){P(i,"class","italic selector svelte-1t6rmfu"),ke(i,"fade",n[1][n[0]]==-1),ke(i,"error",n[1][n[0]]!=-1),ke(i,"alert",n[4]),ke(i,"selecting",n[3]),P(a,"class","italic"),P(e,"class","flex")},m(f,u){ae(f,e,u),A(e,i),A(i,r),A(e,o),A(e,a),l||(s=[ye(Cl,"mousedown",n[7]),ye(i,"mousedown",n[5]),ye(a,"click",n[6])],l=!0)},p(f,[u]){u&12&&t!==(t=(f[3]?"Selecting...":f[2])+"")&&De(r,t),u&3&&ke(i,"fade",f[1][f[0]]==-1),u&3&&ke(i,"error",f[1][f[0]]!=-1),u&16&&ke(i,"alert",f[4]),u&8&&ke(i,"selecting",f[3])},i:Pe,o:Pe,d(f){f&&R(e),l=!1,Et(s)}}}function Fl(n,e,i){let t,r;ge(n,Kt,b=>i(4,t=b)),ge(n,ce,b=>i(1,r=b));let{def:o}=e,{key:a}=e,{parentName:l}=e,{name:s}=e,{uuid:f}=e,{rowIdx:u}=e,{colIdx:c}=e;const h=window,p=(b,N)=>console.log(`[OpSelect] ${b}`,N||"");let g=null,y,d=!1;function _(b){if((t==null?void 0:t.key)==a){p("INITI"),_e(Kt,t=null,t);return}p(`initiating selection for ${a}`),_e(Kt,t={key:a,uuid:f},t),i(3,d=!0),b.stopPropagation()}function v(){_e(ce,r[a]=-1,r)}function E(b){h.requestAnimationFrame(N=>{t&&(p("no source was selected"),_e(Kt,t=null,t)),i(3,d=!1)})}return n.$$set=b=>{"def"in b&&i(8,o=b.def),"key"in b&&i(0,a=b.key),"parentName"in b&&i(9,l=b.parentName),"name"in b&&i(10,s=b.name),"uuid"in b&&i(11,f=b.uuid),"rowIdx"in b&&i(12,u=b.rowIdx),"colIdx"in b&&i(13,c=b.colIdx)},n.$$.update=()=>{n.$$.dirty&259&&(b=>{if(r[a]==null&&o.default!=null&&_e(ce,r[a]=JSON.parse(JSON.stringify(o.default)),r),!!h.RNDRS){for(const[N,T]of Object.entries(h.RNDRS))if(T.getValue()!=r[a]&&!o.ignore)try{T.uniforms[a]&&T.setValue(a,r[a])}catch(k){console.log("\u274C error setting value in OpSelect",k)}}})(),n.$$.dirty&16387&&(b=>{if(y!=r[a]){if(i(14,y=r[a]),r[a]>=0&&r[a]<99)i(2,g=`${Jn(r[a])} (${r[a]})`);else{const N=pi(r[a]),T=Ft().find(k=>k.uuid==N);i(2,g=`${(T==null?void 0:T.name)||"None"} ${(T==null?void 0:T.uuid)||""}`)}Ot.set(Ct.COMPILE)}})(r[a])},[a,r,g,d,t,_,v,E,o,l,s,f,u,c,y]}class Ul extends Ce{constructor(e){super(),Le(this,e,Fl,Ll,Fe,{def:8,key:0,parentName:9,name:10,uuid:11,rowIdx:12,colIdx:13})}}const Bl=Xr,jl=Ml,Vl=Dl,Gl=Ul,Ui=Object.freeze(Object.defineProperty({__proto__:null,Auto:Bl,ExtSource:jl,MultiClick:Vl,OpSelect:Gl},Symbol.toStringTag,{value:"Module"}));function Bi(n,e,i){const t=n.slice();return t[7]=e[i][0],t[8]=e[i][1],t[10]=i,t}function ji(n){let e,i,t=(n[8].label||n[7])+"",r,o,a,l,s;var f=Ui[n[8].gui]||Xr;function u(c){return{props:{def:c[8],uuid:c[1],rowIdx:c[3],colIdx:c[4],parentName:c[2],name:c[7],key:c[1]+c[7]}}}return f&&(a=new f(u(n))),{c(){e=V("div"),i=V("div"),r=he(t),o=te(),a&&Ne(a.$$.fragment),l=te(),this.h()},l(c){e=G(c,"DIV",{class:!0});var h=q(e);i=G(h,"DIV",{class:!0});var p=q(i);r=pe(p,t),p.forEach(R),o=ne(h),a&&Re(a.$$.fragment,h),l=ne(h),h.forEach(R),this.h()},h(){P(i,"class","grow monospace f1 italic mb0-4"),P(e,"class","flex row-stretch-center wrap bt"),ke(e,"none",n[5][n[1]+n[7]])},m(c,h){ae(c,e,h),A(e,i),A(i,r),A(e,o),a&&Se(a,e,null),A(e,l),s=!0},p(c,h){(!s||h&1)&&t!==(t=(c[8].label||c[7])+"")&&De(r,t);const p={};if(h&1&&(p.def=c[8]),h&2&&(p.uuid=c[1]),h&8&&(p.rowIdx=c[3]),h&16&&(p.colIdx=c[4]),h&4&&(p.parentName=c[2]),h&1&&(p.name=c[7]),h&3&&(p.key=c[1]+c[7]),f!==(f=Ui[c[8].gui]||Xr)){if(a){st();const g=a;ue(g.$$.fragment,1,0,()=>{xe(g,1)}),lt()}f?(a=new f(u(c)),Ne(a.$$.fragment),oe(a.$$.fragment,1),Se(a,e,l)):a=null}else f&&a.$set(p);(!s||h&35)&&ke(e,"none",c[5][c[1]+c[7]])},i(c){s||(a&&oe(a.$$.fragment,c),s=!0)},o(c){a&&ue(a.$$.fragment,c),s=!1},d(c){c&&R(e),a&&xe(a)}}}function Hl(n){let e,i,t=Object.entries(n[0].INPUTS),r=[];for(let a=0;a<t.length;a+=1)r[a]=ji(Bi(n,t,a));const o=a=>ue(r[a],1,1,()=>{r[a]=null});return{c(){for(let a=0;a<r.length;a+=1)r[a].c();e=He()},l(a){for(let l=0;l<r.length;l+=1)r[l].l(a);e=He()},m(a,l){for(let s=0;s<r.length;s+=1)r[s].m(a,l);ae(a,e,l),i=!0},p(a,[l]){if(l&63){t=Object.entries(a[0].INPUTS);let s;for(s=0;s<t.length;s+=1){const f=Bi(a,t,s);r[s]?(r[s].p(f,l),oe(r[s],1)):(r[s]=ji(f),r[s].c(),oe(r[s],1),r[s].m(e.parentNode,e))}for(st(),s=t.length;s<r.length;s+=1)o(s);lt()}},i(a){if(!i){for(let l=0;l<t.length;l+=1)oe(r[l]);i=!0}},o(a){r=r.filter(Boolean);for(let l=0;l<r.length;l+=1)ue(r[l]);i=!1},d(a){Ye(r,a),a&&R(e)}}}function ql(n,e,i){let t;ge(n,Qt,u=>i(5,t=u));let{schema:r}=e,{uuid:o}=e,{name:a}=e,{shader:l}=e,{rowIdx:s}=e,{colIdx:f}=e;return n.$$set=u=>{"schema"in u&&i(0,r=u.schema),"uuid"in u&&i(1,o=u.uuid),"name"in u&&i(2,a=u.name),"shader"in u&&i(6,l=u.shader),"rowIdx"in u&&i(3,s=u.rowIdx),"colIdx"in u&&i(4,f=u.colIdx)},[r,o,a,s,f,t,l]}class Nt extends Ce{constructor(e){super(),Le(this,e,ql,Hl,Fe,{schema:0,uuid:1,name:2,shader:6,rowIdx:3,colIdx:4})}}function zl(n){let e,i;return e=new Nt({props:{name:n[0],uuid:n[1],schema:ei,shader:Aa,colIdx:n[2],rowIdx:n[3]}}),{c(){Ne(e.$$.fragment)},l(t){Re(e.$$.fragment,t)},m(t,r){Se(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(oe(e.$$.fragment,t),i=!0)},o(t){ue(e.$$.fragment,t),i=!1},d(t){xe(e,t)}}}function Wl(n,e,i){let t;ge(n,ce,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>bt({name:r,uuid:o,schema:ei}))()},[r,o,a,l,t]}class Xl extends Ce{constructor(e){super(),Le(this,e,Wl,zl,Fe,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function Yl(n){let e,i;return e=new Nt({props:{name:n[0],uuid:n[1],schema:ti,shader:Ra,colIdx:n[2],rowIdx:n[3]}}),{c(){Ne(e.$$.fragment)},l(t){Re(e.$$.fragment,t)},m(t,r){Se(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(oe(e.$$.fragment,t),i=!0)},o(t){ue(e.$$.fragment,t),i=!1},d(t){xe(e,t)}}}function Jl(n,e,i){let t;ge(n,ce,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>bt({name:r,uuid:o,schema:ti}))()},[r,o,a,l,t]}class Kl extends Ce{constructor(e){super(),Le(this,e,Jl,Yl,Fe,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function Zl(n){let e,i;return e=new Nt({props:{name:n[0],uuid:n[1],schema:ni,shader:Ma,colIdx:n[2],rowIdx:n[3]}}),{c(){Ne(e.$$.fragment)},l(t){Re(e.$$.fragment,t)},m(t,r){Se(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(oe(e.$$.fragment,t),i=!0)},o(t){ue(e.$$.fragment,t),i=!1},d(t){xe(e,t)}}}function Ql(n,e,i){let t;ge(n,ce,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>bt({name:r,uuid:o,schema:ni}))()},[r,o,a,l,t]}class $l extends Ce{constructor(e){super(),Le(this,e,Ql,Zl,Fe,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function eu(n){let e,i;return e=new Nt({props:{name:n[0],uuid:n[1],schema:ri,shader:Pa,colIdx:n[2],rowIdx:n[3]}}),{c(){Ne(e.$$.fragment)},l(t){Re(e.$$.fragment,t)},m(t,r){Se(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(oe(e.$$.fragment,t),i=!0)},o(t){ue(e.$$.fragment,t),i=!1},d(t){xe(e,t)}}}function tu(n,e,i){let t;ge(n,ce,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>bt({name:r,uuid:o,schema:ri}))()},[r,o,a,l,t]}class nu extends Ce{constructor(e){super(),Le(this,e,tu,eu,Fe,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function ru(n){let e,i;return e=new Nt({props:{name:n[0],uuid:n[1],schema:ii,shader:ka,colIdx:n[2],rowIdx:n[3]}}),{c(){Ne(e.$$.fragment)},l(t){Re(e.$$.fragment,t)},m(t,r){Se(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(oe(e.$$.fragment,t),i=!0)},o(t){ue(e.$$.fragment,t),i=!1},d(t){xe(e,t)}}}function iu(n,e,i){let t;ge(n,ce,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>bt({name:r,uuid:o,schema:ii}))()},[r,o,a,l,t]}class ou extends Ce{constructor(e){super(),Le(this,e,iu,ru,Fe,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function au(n){let e,i;return e=new Nt({props:{name:n[0],uuid:n[1],schema:oi,shader:Da,colIdx:n[2],rowIdx:n[3]}}),{c(){Ne(e.$$.fragment)},l(t){Re(e.$$.fragment,t)},m(t,r){Se(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(oe(e.$$.fragment,t),i=!0)},o(t){ue(e.$$.fragment,t),i=!1},d(t){xe(e,t)}}}function su(n,e,i){let t;ge(n,ce,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>bt({name:r,uuid:o,schema:oi}))()},[r,o,a,l,t]}class lu extends Ce{constructor(e){super(),Le(this,e,su,au,Fe,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function uu(n){let e,i;return e=new Nt({props:{name:n[0],uuid:n[1],schema:ai,shader:Ca,colIdx:n[2],rowIdx:n[3]}}),{c(){Ne(e.$$.fragment)},l(t){Re(e.$$.fragment,t)},m(t,r){Se(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(oe(e.$$.fragment,t),i=!0)},o(t){ue(e.$$.fragment,t),i=!1},d(t){xe(e,t)}}}function fu(n,e,i){let t;ge(n,ce,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>bt({name:r,uuid:o,schema:ai}))()},[r,o,a,l,t]}class cu extends Ce{constructor(e){super(),Le(this,e,fu,uu,Fe,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function du(n){let e,i;return e=new Nt({props:{name:n[0],uuid:n[1],schema:si,shader:La,colIdx:n[2],rowIdx:n[3]}}),{c(){Ne(e.$$.fragment)},l(t){Re(e.$$.fragment,t)},m(t,r){Se(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(oe(e.$$.fragment,t),i=!0)},o(t){ue(e.$$.fragment,t),i=!1},d(t){xe(e,t)}}}function hu(n,e,i){let t;ge(n,ce,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>bt({name:r,uuid:o,schema:si}))()},[r,o,a,l,t]}class pu extends Ce{constructor(e){super(),Le(this,e,hu,du,Fe,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function mu(n){let e,i;return e=new Nt({props:{name:n[0],uuid:n[1],schema:li,shader:Fa,colIdx:n[2],rowIdx:n[3]}}),{c(){Ne(e.$$.fragment)},l(t){Re(e.$$.fragment,t)},m(t,r){Se(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(oe(e.$$.fragment,t),i=!0)},o(t){ue(e.$$.fragment,t),i=!1},d(t){xe(e,t)}}}function gu(n,e,i){let t;ge(n,ce,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>bt({name:r,uuid:o,schema:li}))()},[r,o,a,l,t]}class vu extends Ce{constructor(e){super(),Le(this,e,gu,mu,Fe,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function yu(n){let e,i;return e=new Nt({props:{name:n[0],uuid:n[1],schema:ui,shader:Ua,colIdx:n[2],rowIdx:n[3]}}),{c(){Ne(e.$$.fragment)},l(t){Re(e.$$.fragment,t)},m(t,r){Se(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(oe(e.$$.fragment,t),i=!0)},o(t){ue(e.$$.fragment,t),i=!1},d(t){xe(e,t)}}}function _u(n,e,i){let t;ge(n,ce,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>bt({name:r,uuid:o,schema:ui}))()},[r,o,a,l,t]}class bu extends Ce{constructor(e){super(),Le(this,e,_u,yu,Fe,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function wu(n){let e,i;return e=new Nt({props:{name:n[0],uuid:n[1],schema:fi,shader:Ba,colIdx:n[2],rowIdx:n[3]}}),{c(){Ne(e.$$.fragment)},l(t){Re(e.$$.fragment,t)},m(t,r){Se(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(oe(e.$$.fragment,t),i=!0)},o(t){ue(e.$$.fragment,t),i=!1},d(t){xe(e,t)}}}function Eu(n,e,i){let t;ge(n,ce,s=>i(4,t=s));let{name:r}=e,{uuid:o}=e,{colIdx:a}=e,{rowIdx:l}=e;return n.$$set=s=>{"name"in s&&i(0,r=s.name),"uuid"in s&&i(1,o=s.uuid),"colIdx"in s&&i(2,a=s.colIdx),"rowIdx"in s&&i(3,l=s.rowIdx)},n.$$.update=()=>{n.$$.dirty&19&&(s=>bt({name:r,uuid:o,schema:fi}))()},[r,o,a,l,t]}class Nu extends Ce{constructor(e){super(),Le(this,e,Eu,wu,Fe,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function Su(n){let e,i;return e=new Nt({props:{name:n[0],uuid:n[1],schema:ci,shader:ja,colIdx:n[2],rowIdx:n[3]}}),{c(){Ne(e.$$.fragment)},l(t){Re(e.$$.fragment,t)},m(t,r){Se(e,t,r),i=!0},p(t,[r]){const o={};r&1&&(o.name=t[0]),r&2&&(o.uuid=t[1]),r&4&&(o.colIdx=t[2]),r&8&&(o.rowIdx=t[3]),e.$set(o)},i(t){i||(oe(e.$$.fragment,t),i=!0)},o(t){ue(e.$$.fragment,t),i=!1},d(t){xe(e,t)}}}function xu(n,e,i){let t,r;ge(n,dn,f=>i(4,t=f)),ge(n,ce,f=>i(5,r=f));let{name:o}=e,{uuid:a}=e,{colIdx:l}=e,{rowIdx:s}=e;return n.$$set=f=>{"name"in f&&i(0,o=f.name),"uuid"in f&&i(1,a=f.uuid),"colIdx"in f&&i(2,l=f.colIdx),"rowIdx"in f&&i(3,s=f.rowIdx)},n.$$.update=()=>{n.$$.dirty&18&&((f,u)=>{_e(ce,r[a+"Exp"]=f,r),_e(ce,r[a+"Luma"]=u,r)})(t.exp,t.luma),n.$$.dirty&35&&(f=>bt({name:o,uuid:a,schema:ci}))()},[o,a,l,s,t,r]}class Iu extends Ce{constructor(e){super(),Le(this,e,xu,Su,Fe,{name:0,uuid:1,colIdx:2,rowIdx:3})}}function St(n,e){e.INPUTS={BlendMode:{type:"long",label:"Blend Mode",min:0,max:Er().length,default:0,labels:Er().map(i=>i.name)},BlendAmt:{type:"float",label:"Blend Amount",min:0,max:1,default:1},...e.INPUTS};for(let[i,t]of Object.entries(e.INPUTS))t.gui=="OpSelect"&&(e.INPUTS[i]={...t,gui:"OpSelect",type:"float",min:-1,max:999});return e}const Ou={COMPONENT:Xl,GLSL:Aa,SCHEMA:St("Capacitor",ei)},Tu={COMPONENT:Kl,GLSL:Ra,SCHEMA:St("Channel",ti)},Au={COMPONENT:$l,GLSL:Ma,SCHEMA:St("Convolution",ni)},Ru={COMPONENT:nu,GLSL:Pa,SCHEMA:St("Deform",ri)},Mu={COMPONENT:ou,GLSL:ka,SCHEMA:St("Light",ii)},Pu={COMPONENT:lu,GLSL:Da,SCHEMA:St("Mask",oi)},ku={COMPONENT:cu,GLSL:Ca,SCHEMA:St("Mix",ai)},Du={COMPONENT:pu,GLSL:La,SCHEMA:St("Shape",si)},Cu={COMPONENT:vu,GLSL:Fa,SCHEMA:St("Source",li)},Lu={COMPONENT:bu,GLSL:Ua,SCHEMA:St("Synth",ui)},Fu={COMPONENT:Nu,GLSL:Ba,SCHEMA:St("Wobbulate",fi)},Uu={COMPONENT:Iu,GLSL:ja,SCHEMA:St("AutoWB",ci)},bn=Object.freeze(Object.defineProperty({__proto__:null,Capacitor:Ou,Channel:Tu,Convolution:Au,Deform:Ru,Light:Mu,Mask:Pu,Mix:ku,Shape:Du,Source:Cu,Synth:Lu,Wobbulate:Fu,AutoWB:Uu},Symbol.toStringTag,{value:"Module"})),Va=(n,e)=>console.log(`[API] ${n}`,e||""),Ga=n=>{let e=[{type:"vec4",name:"INPUT"},{type:"int",name:"IN_PASS"},{type:"vec2",name:"POS_NORM"},{type:"vec2",name:"POS_FRAG"}];for(const[i,t]of Object.entries(n)){let{ignore:r,type:o}=t;const a=i==pn.BL_AMT||i==pn.BL_MODE;!r&&!a&&(o=qs[t.gui]||Hs[t.type]||o,e.push({type:o,name:i}))}return e};function gr(n,e,i,t,r){const o=r-t,a=i-e;return(n-e)*o/a+t}const Ha="Channel";function qa(){Va("\u{1F39E} sequence changed");let n=!1;console.log("skipping channel adjustments (TODO)");const e=Ee(Tt);let i=[];for(const t of e)t.length==1&&t[0].indexOf(Ha)!=-1?(console.log("EMPTY CHANNEL"),n=!0):t.length==0?n=!0:i.push(t);return n&&Tt.set(i),n}function di(){Va("\u{1F5D1} clearing up uniforms");const n=Ee(ce);let e={};for(const i of Ft())for(const[t,r]of Object.entries(i.schema.INPUTS)){const o=i.uuid+t;e[o]=n[o]}ce.set(e)}function za(n,e){try{if(e=="float")return n.toFixed(3);if(e=="int"||e=="long")return parseInt(n)+"";if(e=="vec2"||e=="vec3"||e=="vec4")return`${e}(${n.map(i=>i.toFixed(3)).join(",")})`}catch{}return n+""}function Wa(n,e){let i=0;for(const t of Ee(Tt).slice(0,n))i+=t.length;return i+e}function hi(n){const e=n,i=Ee(at);if(!!i)return(e[0]==i[0][0]?e[1]>=i[0][1]:e[0]>i[0][0])&&(e[0]==i[1][0]?e[1]<=i[1][1]:e[0]<=i[0][0])}function Yr(n,e){return e||(e=-1),n?parseInt(n.substring(1)):e}function pi(n,e){return"u"+(n+"").padStart(3,"0")}function bt(n){const{name:e,uuid:i,schema:t}=n;let r=Ee(ce);for(const[o,a]of Object.entries(t.INPUTS)){const l=i+o;if(a.link!=null){const s=a.link.split(":")[0],f=parseInt(a.link.split(":")[1]);Qt.update(u=>(u[l]=r[i+s]!=f,u))}}}const vr=n=>`${Math.floor(Math.random()*9)+1}`[0];function Xa(){const n=Ft().map(e=>e.uuid);for(let e=0;e<1e3;e++){const i=`u${vr()}${vr()}${vr()}`;if(n.indexOf(i)==-1)return i}alert("error generating uuid")}function Ya(n){return n+":"+Xa()}function mi(n,e){return`${Jn(n.x)}${n.y+1} ${n.name} ${e}`}function Jr(n){const e=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg,i=/([^\s,]+)/g;let t=n.toString().replace(e,""),r=t.slice(t.indexOf("(")+1,t.indexOf(")")).match(i);return r===null&&(r=[]),r}function Ja(n){let e,i=Object.keys(n),t=i.length,r={};for(;t--;)e=i[t],r[e.toUpperCase()]=n[e];for(const[o,a]of Object.entries(r))a.constructor;return r}function Jn(n){return String.fromCharCode(97+n).toUpperCase()}function gi(){var t;const n=Ee(at),e=Ee(Tt);if(!n)return[];if(n.length!=2)return[];let i=[];for(let r=n[0][0];r<=n[1][0];r++)for(let o=n[0][1];o<=n[1][1];o++){const a=(t=e==null?void 0:e[r])==null?void 0:t[o];a&&i.push(a)}return i}function vi(n,e,i,t){console.log(`[API] \u{1F4A7} ${n} with [${e},${i}]`);let r=[],o=[];t&&(o=t);let a=0;for(const l of Ee(Tt)){let s=0;r.push([]);for(const f of l){let u=hi([a,s]);u&&o.push(f),u||r[a].push(f),s+=1}a+=1}return n==dt.MOVE&&(r[e]=[...r[e].slice(0,i+1),...o,...r[e].slice(i+1)]),n==dt.INSERT&&(r=[...r.slice(0,e),o,...r.slice(e)]),n==dt.APPEND&&(r=[...r,o]),Tt.set(r),r}function Ka(n){return["Image","Video","Source","Media","Camera"].indexOf(n)!=-1}function Za(){return Ee(Tt).map(n=>n.length).reduce((n,e)=>n+e,0)}function Qn(n){const e=Ee(Tt);let i=0;for(const t of e){let r=0;for(const o of t){const a=o.split(":")[0],l=o.split(":")[1],s=bn[a].SCHEMA,f=Ka(a);n({name:a,schema:s,x:i,y:r,source:f,uuid:l}),r+=1}i+=1}}function Ft(){let n=[];return Qn(e=>n.push(e)),n}function Or(){var i;let n,e=[];for(const t of Ft()){const r=((i=t==null?void 0:t.schema)==null?void 0:i.PASS)&&n,o=(n==null?void 0:n.name)==Ha;(r||o)&&e.indexOf(n.uuid)==-1&&e.push(n.uuid),n=t}return e}function yr(n){return n=n.substring(0,4),Ft().find(e=>e.uuid==n)}function yi(n){let e=Ee(Qt);if(!n)return e;for(const i of Ft())for(const[t,r]of Object.entries(i.schema.INPUTS))r.gui=="OpSelect"&&(e[i.uuid+r.name]=!0);return e}const Vi=Object.freeze(Object.defineProperty({__proto__:null,GetISFFunctionArgsFromSchema:Ga,ScaleValue:gr,SequenceUpdatedCallback:qa,ClearUpUniforms:di,ConvertVariableToString:za,IndexFromRowAndCol:Wa,IsRowColSelected:hi,UuidToInt:Yr,IntToUuid:pi,SetOpCallback:bt,R:vr,GenerateUuid:Xa,GenerateUuidWithName:Ya,GetLabelFromOp:mi,GetFunctionArgumentNames:Jr,MakeJsonKeysUppercase:Ja,GetLetterFromIdx:Jn,GetSelectedSequenceList:gi,MakeSequenceAdjustment:vi,IsSource:Ka,TotalSequenceLength:Za,LoopThroughSequence:Qn,GetSequenceAsList:Ft,GetUuidsForPasses:Or,GetOpByUuid:yr,GetExpandedHiddenUniforms:yi},Symbol.toStringTag,{value:"Module"}));function Gi(n,e,i){const t=n.slice();return t[7]=e[i][0],t[8]=e[i][1],t[9]=e,t[10]=i,t}function Hi(n,e,i){const t=n.slice();return t[11]=e[i],t[13]=i,t}function Bu(n){let e=n[8]+"",i;return{c(){i=he(e)},l(t){i=pe(t,e)},m(t,r){ae(t,i,r)},p(t,r){r&8&&e!==(e=t[8]+"")&&De(i,e)},d(t){t&&R(i)}}}function ju(n){let e=n[8].toFixed(2)+"",i;return{c(){i=he(e)},l(t){i=pe(t,e)},m(t,r){ae(t,i,r)},p(t,r){r&8&&e!==(e=t[8].toFixed(2)+"")&&De(i,e)},d(t){t&&R(i)}}}function Vu(n){let e,i=n[8],t=[];for(let r=0;r<i.length;r+=1)t[r]=qi(Hi(n,i,r));return{c(){for(let r=0;r<t.length;r+=1)t[r].c();e=He()},l(r){for(let o=0;o<t.length;o+=1)t[o].l(r);e=He()},m(r,o){for(let a=0;a<t.length;a+=1)t[a].m(r,o);ae(r,e,o)},p(r,o){if(o&8){i=r[8];let a;for(a=0;a<i.length;a+=1){const l=Hi(r,i,a);t[a]?t[a].p(l,o):(t[a]=qi(l),t[a].c(),t[a].m(e.parentNode,e))}for(;a<t.length;a+=1)t[a].d(1);t.length=i.length}},d(r){Ye(t,r),r&&R(e)}}}function qi(n){let e=(n[11]?n[11].toFixed(2):"null")+"",i;return{c(){i=he(e)},l(t){i=pe(t,e)},m(t,r){ae(t,i,r)},p(t,r){r&8&&e!==(e=(t[11]?t[11].toFixed(2):"null")+"")&&De(i,e)},d(t){t&&R(i)}}}function zi(n){let e,i,t,r,o,a,l=n[7]+"",s,f,u,c,h,p,g;function y(){n[6].call(t,n[7])}function d(E,b){return b&8&&(c=null),c==null&&(c=!!Array.isArray(E[8])),c?Vu:typeof E[8]=="number"?ju:Bu}let _=d(n,-1),v=_(n);return{c(){e=V("div"),i=V("label"),t=V("input"),r=te(),o=V("span"),a=te(),s=he(l),f=te(),u=V("span"),v.c(),h=te(),this.h()},l(E){e=G(E,"DIV",{class:!0});var b=q(e);i=G(b,"LABEL",{class:!0});var N=q(i);t=G(N,"INPUT",{type:!0}),r=ne(N),o=G(N,"SPAN",{}),q(o).forEach(R),a=ne(N),s=pe(N,l),N.forEach(R),f=ne(b),u=G(b,"SPAN",{});var T=q(u);v.l(T),T.forEach(R),h=ne(b),b.forEach(R),this.h()},h(){P(t,"type","checkbox"),P(i,"class","checkbox"),P(e,"class","flex row-space-between-flex-start minw16em")},m(E,b){ae(E,e,b),A(e,i),A(i,t),t.checked=n[4][n[7]],A(i,r),A(i,o),A(i,a),A(i,s),A(e,f),A(e,u),v.m(u,null),A(e,h),p||(g=ye(t,"change",y),p=!0)},p(E,b){n=E,b&24&&(t.checked=n[4][n[7]]),b&8&&l!==(l=n[7]+"")&&De(s,l),_===(_=d(n,b))&&v?v.p(n,b):(v.d(1),v=_(n),v&&(v.c(),v.m(u,null)))},d(E){E&&R(e),v.d(),p=!1,g()}}}function Gu(n){let e,i,t,r,o,a,l,s,f,u,c,h,p,g,y,d,_,v,E,b=n[0].trim()+"",N,T=Object.entries(n[3]),k=[];for(let I=0;I<T.length;I+=1)k[I]=zi(Gi(n,T,I));return{c(){e=V("div"),i=V("div"),t=V("div"),r=he("PREVIEW"),o=te(),a=V("div"),l=he(n[1]),s=te(),f=V("div"),u=he("selected"),c=te(),h=V("div"),p=he(n[2]),g=te(),y=V("div"),d=he("uniforms"),_=te();for(let I=0;I<k.length;I+=1)k[I].c();v=te(),E=V("pre"),N=he(b),this.h()},l(I){e=G(I,"DIV",{class:!0});var w=q(e);i=G(w,"DIV",{class:!0});var x=q(i);t=G(x,"DIV",{class:!0});var B=q(t);r=pe(B,"PREVIEW"),B.forEach(R),o=ne(x),a=G(x,"DIV",{class:!0});var F=q(a);l=pe(F,n[1]),F.forEach(R),s=ne(x),f=G(x,"DIV",{class:!0});var j=q(f);u=pe(j,"selected"),j.forEach(R),c=ne(x),h=G(x,"DIV",{class:!0});var H=q(h);p=pe(H,n[2]),H.forEach(R),g=ne(x),y=G(x,"DIV",{class:!0});var K=q(y);d=pe(K,"uniforms"),K.forEach(R),_=ne(x);for(let ee=0;ee<k.length;ee+=1)k[ee].l(x);x.forEach(R),v=ne(w),E=G(w,"PRE",{class:!0});var U=q(E);N=pe(U,b),U.forEach(R),w.forEach(R),this.h()},h(){P(t,"class","bold"),P(a,"class",""),P(f,"class","bold"),P(h,"class",""),P(y,"class","bold"),P(i,"class","flex column p1"),P(E,"class","monospace p1 pl3 grow filled overflow-auto f2 rel"),P(e,"class","flex row")},m(I,w){ae(I,e,w),A(e,i),A(i,t),A(t,r),A(i,o),A(i,a),A(a,l),A(i,s),A(i,f),A(f,u),A(i,c),A(i,h),A(h,p),A(i,g),A(i,y),A(y,d),A(i,_);for(let x=0;x<k.length;x+=1)k[x].m(i,null);A(e,v),A(e,E),A(E,N)},p(I,[w]){if(w&2&&De(l,I[1]),w&4&&De(p,I[2]),w&24){T=Object.entries(I[3]);let x;for(x=0;x<T.length;x+=1){const B=Gi(I,T,x);k[x]?k[x].p(B,w):(k[x]=zi(B),k[x].c(),k[x].m(i,null))}for(;x<k.length;x+=1)k[x].d(1);k.length=T.length}w&1&&b!==(b=I[0].trim()+"")&&De(N,b)},i:Pe,o:Pe,d(I){I&&R(e),Ye(k,I)}}}function Hu(n,e,i){let t,r,o,a,l;ge(n,yn,u=>i(5,t=u)),ge(n,Yn,u=>i(1,r=u)),ge(n,at,u=>i(2,o=u)),ge(n,ce,u=>i(3,a=u)),ge(n,Qt,u=>i(4,l=u));let s="";function f(u){l[u]=this.checked,Qt.set(l)}return n.$$.update=()=>{n.$$.dirty&32&&(u=>{i(0,s=$r("	"))})()},[s,r,o,a,l,t,f]}class qu extends Ce{constructor(e){super(),Le(this,e,Hu,Gu,Fe,{})}}const zu=n=>{const e=Ee(ce),i=Or();let t=[];return Qn(r=>{var o,a,l,s;if(((a=(o=r.schema)==null?void 0:o.PASSES)==null?void 0:a.length)>0)for(let f=0;f<((s=(l=r.schema)==null?void 0:l.PASSES)==null?void 0:s.length);f++)t.push({...r,uuid:r.uuid,pass:f});t.push(r)}),[{type:vt.FUNC,name:"main",prepend:"void",body:(r=>{let o="";o+=`vec2 POS_NORM = POSITION_NORM();
`,o+=`vec2 POS_FRAG = POSITION_FRAG();
`,o+=`vec4 BG = vec4(0.0); // GRID(0.02, POS_FRAG);
`,o+=`vec4 temp = BG;
`;let a=0,l,s;return t.forEach((f,u)=>{var E,b;const c=u==t.length-1,h=i.indexOf(f.uuid)!=-1||c,p=f.name=="Channel",g=Yr((E=t[s])==null?void 0:E.uuid),y=Yr((b=t[l])==null?void 0:b.uuid),d=p?g:y,_=N=>{if(N<0||N==null)return"BG";const T=pi(N);return i.indexOf(T)!=-1?`IMG_NORM_PIXEL(${T}, POS_NORM)`:T},v=N=>{let T="";if(f.source){const k=f.uuid+"Index",I=f.uuid+"Rows";f.uuid+"";const w=`(1. / float(${I} ))`,x=`(${w} * float(${k}) )`;T+="texture2D(",T+=f.uuid+"Src",T+=`, (POS_NORM * vec2( ${w}, 1.0) + vec2(${x},0.0) ))`}else{let k=[_(y),a,"POS_NORM","POS_FRAG"];for(const[I,w]of Object.entries(f.schema.INPUTS)){const x=I==pn.BL_AMT||I==pn.BL_MODE;if(!w.ignore&&!x)if(w.gui=="OpSelect"){const B=e[f.uuid+I],F=_(B);k.push(F)}else k.push(f.uuid+I)}T+=f.name,f.schema.PASS&&(T+=f.uuid),T+="(",T+=k.join(","),T+=")"}return T};o+=`
/* ${h?"PASS":""} ${p?"CHANNEL	":""} ${f.name} ${f.uuid}  */
`,o+=`temp = ${v()};
`,o+=h?"gl_FragColor = ":f.uuid+" = ",o+="MAKE_PASS( ",o+=`${f.uuid}${pn.BL_MODE}`,o+=`, ${d?_(d):BG}`,o+=", temp",o+=`, ${f.uuid}${pn.BL_AMT})`,o+=`;
`,h&&(o+=`if ( PASSINDEX == ${a} ) { return; }
`,a+=1),l=u,p&&(s=u)}),o})()}]},Wu=n=>`



float CLAMP( float v, float min, float max ) {

    if (v > max) v = max;
    if (v < min) v = min;
    return v;
}


// wenn yu perfekt lieber Gott boese (Nam june Paik 1963)

#define COLOR_MAP(f, a, b) vec3(f(a.r, b.r), f(a.g, b.g), f(a.b, b.b))
#define PI 3.14159265358979323846264338327
#define HPI 1.5707963267948966

/*  EXPERIMENTAL CONVOLUTION

varying vec2 VTC_11;
varying vec2 VTC_00;
varying vec2 VTC_02;
varying vec2 VTC_20;
varying vec2 VTC_22;
*/


vec3 SRGB2LIN(vec3 c) { return c*c; }
vec3 LIN2SRGB(vec3 c) { return sqrt(c); }

//note: uniform pdf rand [0;1]

float HASH12N(vec2 p)
{
    p  = fract(p * vec2(5.3987, 5.4421));
    p += dot(p.yx, p.xy + vec2(21.5351, 14.3137));
    return fract(p.x * p.y * 95.4307);
}

vec2 PIXELATE( vec2 coord, vec2 size ) {
    return floor( coord / size ) * size;
}

float ADD(float a, float b) { return min(a + b, 1.0); }
float COLORBURN(float a, float b) { return (b == 0.0) ? b : max((1.0 - ((1.0 - a) / b)), 0.0); }
float DARKEN(float a, float b) { return min(b, a); }
float LIGHTEN(float a, float b) { return max(b, a); }
float PIN(float a, float b) { return (b < 0.5) ? DARKEN(a, (2.0 * b)) : LIGHTEN(a , (2.0 * (b - 0.5))); }
float COLORDODGE(float a, float b) { return (b == 1.0) ? b : min(a / (1.0 - b), 1.0); }
float REFLECT(float a, float b) { return (b == 1.0) ? b : min(a * a / (1.0 - b), 1.0); }
float VIVID(float a, float b) { return (b < 0.5) ? COLORBURN(a, (2.0 * b)) : COLORDODGE(a, (2.0 * (b - 0.5))); }
float HARD_MIX(float a, float b) { return (VIVID(a, b) < 0.5) ? 0.0 : 1.0; }
float OVERLAY(float a, float b) { return a < 0.5 ? (2.0 * a * b) : (1.0 - 2.0 * (1.0 - a) * (1.0 - b)); }
float DODGE(float a, float b) { return min(a + b, 1.0); }
float SCREEN(float a, float b) { return 1.0 - ((1.0 - a) * (1.0 - b)); }
float SOFT(float a, float b) { return (b < 0.5) ? (2.0 * a * b + a * a * (1.0 - 2.0 * b)) : (sqrt(a) * (2.0 * b - 1.0) + 2.0 * a * (1.0 - b)); }
float SUBTRACT(float a, float b) { return max(a + b - 1.0, 0.0); }
float LINEAR(float a, float b) { return b < 0.5 ? SUBTRACT(a, (2.0 * b)) : DODGE(a, (2.0 * (b - 0.5))); }

float SUM_RGBA( vec4 v ) {
    return v.r + v.g + v.b;
}

float SUM_RGB( vec3 v ) {
    return v.r + v.g + v.b;
}

float PHI = 1.61803398874989484820459;  // \u03A6 = Golden Ratio  


float HASH(float n) { return fract(sin(n) * 1e4); }
float HASH(vec2 p) { return fract(1e4 * sin(17.0 * p.x + p.y * 0.1) * (0.1 + abs(sin(p.y * 13.0 + p.x)))); }


vec3 GAMMA_CORRECT(vec3 color, float gamma){
    return pow(color, vec3(1.0/gamma));
}

vec3 LEVEL_RANGE(vec3 color, float minInput, float maxInput){
    return min(max(color - vec3(minInput), vec3(0.0)) / (vec3(maxInput) - vec3(minInput)), vec3(1.0));
}

vec3 LEVELS(vec3 color, float minInput, float gamma, float maxInput){
    return GAMMA_CORRECT(LEVEL_RANGE(color, minInput, maxInput), gamma);
}

float RANDOM(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

vec2 NORM_TO_VEC2( vec2 xy ) {

    xy.x = ( ( xy.x * 2.0 ) - 1.0 );
    xy.y = ( ( xy.y * 2.0 ) - 1.0 );
    return xy;
}
vec2 NORM_TO_VEC2( float x, float y ) {


    x = ( ( x * 2.0 ) - 1.0 );
    y = ( ( y * 2.0 ) - 1.0 );
    return vec2(x,y);
}

float BRIGHT( vec4 xyz ) {

    return (xyz.r + xyz.g + xyz.b)/3.0;
}

float MAP(float oldValue, float oldMin, float oldMax, float newMin, float newMax) {
    float oldRange = oldMax - oldMin;
    float newRange = newMax - newMin;

    float newVal = ((oldValue - oldMin) * newRange / oldRange) + newMin;
    return newVal;
}

float MAP(float oldValue, float oldMin, float oldMax, float newMin, float newMax, bool clamp) {
    float oldRange = oldMax - oldMin;
    float newRange = newMax - newMin;

    float newVal = ((oldValue - oldMin) * newRange / oldRange) + newMin;
    if (clamp) return CLAMP(newVal, min(newMin,newMax), max(newMin,newMax));
    return newVal;
}


float FMOD( float a, float b ) {
    return a - b * floor(a/b);
}


int WITHIN(float value, float low, float high) {
  bool a = value > low && value < high;
  bool b = value + 1.0 > low && value + 1.0 < high;
  bool c = value - 1.0 > low && value - 1.0 < high;
  if (a) return 1;
  if (b) return 2;
  if (c) return 3;
  return 0;
}


vec2 INTERSECTION(vec2 a,vec2 b,vec2 c,vec2 d) {
    float ua, ub, denom = (d.y - c.y)*(b.x - a.x) - (d.x - c.x)*(b.y - a.y);
    if (denom == 0.0) return vec2(-1.0,-1.0);
    ua = ((d.x - c.x)*(a.y - c.y) - (d.y - c.y)*(a.x - c.x))/denom;
    ub = ((b.x - a.x)*(a.y - c.y) - (b.y - a.y)*(a.x - c.x))/denom;
    return vec2(
        a.x + ua * (b.x - a.x),
        a.y + ua * (b.y - a.y)
    );
}
vec2 INTERLACE_VEC2(vec2 pointA, vec2 pointB, vec2 pointC, vec2 pointD) {

  float z1 = (pointA.x - pointB.x);
  float z2 = (pointC.x - pointD.x);
  float z3 = (pointA.y - pointB.y);
  float z4 = (pointC.y - pointD.y);
  float dist = z1 * z4 - z3 * z2;
  vec2 blank = vec2(-1.0,-1.0);
  if (dist == 0.0) {
    return blank;
  }
  float tempA = (pointA.x * pointB.y - pointA.y * pointB.x);
  float tempB = (pointC.x * pointD.y - pointC.y * pointD.x);
  float xCoor = (tempA * z2 - z1 * tempB) / dist;
  float yCoor = (tempA * z4 - z3 * tempB) / dist;

  return vec2(xCoor, yCoor);
}

vec2 ROTATE_VEC2(vec2 origin, vec2 point, float angle) {
  float rad = (PI / 180.0) * angle;
  float _cos = cos(rad);
  float _sin = sin(rad);
  float run = point.x - origin.x;
  float rise = point.y - origin.y;
  float cx = (_cos * run) + (_sin * rise) + origin.x;
  float cy = (_cos * rise) - (_sin * run) + origin.y;
  return vec2(
    cx,
    cy
  );
}


float ANGLE( vec2 a, vec2 b ) {
    return ((atan(b.y - a.y, b.x - a.x)  * 360.0 / PI) + 360.0) / 2.0;
}

vec2 VEC2_FROM_ANGLE(vec2 xy, float angle, float dist) {
    float x = cos(angle * PI / 180.0) * dist + xy.x;
    float y = sin(angle * PI / 180.0) * dist + xy.y;
    return vec2(x,y);
}


vec2 VEC2_POLAR( vec2 a, vec2 b, vec2 c) {

    float slope = (a.y - b.y) / (a.x - b.x);
    float m = -1.0 / slope;
    float x = (m * c.x - c.y - slope * a.x + a.y) / (m - slope);
    float y = m * x - m * c.x + c.y;
    return vec2(x,y);
}

float VEC2_POLAR_DIST(vec2 a, vec2 b, vec2 c) {

    return ((c.x - a.x)*(b.x - a.x) + (c.y - a.y)*(b.y - a.y)) /
    (pow(b.x - a.x, 2.0) + pow(b.y - a.y, 2.0));
}



vec3 CMYK_TO_RGB (vec4 cmyk) {
    float c = cmyk.x;
    float m = cmyk.y;
    float y = cmyk.z;
    float k = cmyk.w;

    float invK = 1.0 - k;
    float r = 1.0 - min(1.0, c * invK + k);
    float g = 1.0 - min(1.0, m * invK + k);
    float b = 1.0 - min(1.0, y * invK + k);
    return clamp(vec3(r, g, b), 0.0, 1.0);
}

vec4 RGB_TO_CMYK (vec3 rgb) {
    float r = rgb.r;
    float g = rgb.g;
    float b = rgb.b;
    float k = min(1.0 - r, min(1.0 - g, 1.0 - b));
    vec3 cmy = vec3(0.0);
    float invK = 1.0 - k;
    if (invK != 0.0) {
        cmy.x = (1.0 - r - k) / invK;
        cmy.y = (1.0 - g - k) / invK;
        cmy.z = (1.0 - b - k) / invK;
    }
    return clamp(vec4(cmy, k), 0.0, 1.0);
}

vec3 RGB_TO_HSL(vec3 color) {
    vec3 hsl; // init to 0 to avoid warnings ? (and reverse if + remove first part)

    float fmin = min(min(color.r, color.g), color.b); //Min. value of RGB
    float fmax = max(max(color.r, color.g), color.b); //Max. value of RGB
    float delta = fmax - fmin; //Delta RGB value

    hsl.z = (fmax + fmin) / 2.0; // Luminance

    if (delta == 0.0) //This is a gray, no chroma...
    {
        hsl.x = 0.0; // Hue
        hsl.y = 0.0; // Saturation
    } else //Chromatic data...
    {
        if (hsl.z < 0.5)
            hsl.y = delta / (fmax + fmin); // Saturation
        else
            hsl.y = delta / (2.0 - fmax - fmin); // Saturation

        float deltaR = (((fmax - color.r) / 6.0) + (delta / 2.0)) / delta;
        float deltaG = (((fmax - color.g) / 6.0) + (delta / 2.0)) / delta;
        float deltaB = (((fmax - color.b) / 6.0) + (delta / 2.0)) / delta;

        if (color.r == fmax)
            hsl.x = deltaB - deltaG; // Hue
        else if (color.g == fmax)
            hsl.x = (1.0 / 3.0) + deltaR - deltaB; // Hue
        else if (color.b == fmax)
            hsl.x = (2.0 / 3.0) + deltaG - deltaR; // Hue

        if (hsl.x < 0.0)
            hsl.x += 1.0; // Hue
        else if (hsl.x > 1.0)
            hsl.x -= 1.0; // Hue
    }

    return hsl;
}

float HUE_TO_RGB(float f1, float f2, float hue) {
    if (hue < 0.0)
        hue += 1.0;
    else if (hue > 1.0)
        hue -= 1.0;
    float res;
    if ((6.0 * hue) < 1.0)
        res = f1 + (f2 - f1) * 6.0 * hue;
    else if ((2.0 * hue) < 1.0)
        res = f2;
    else if ((3.0 * hue) < 2.0)
        res = f1 + (f2 - f1) * ((2.0 / 3.0) - hue) * 6.0;
    else
        res = f1;
    return res;
}

vec3 HSL_TO_RGB(vec3 hsl) {
    vec3 rgb;
    
    if (hsl.y == 0.0) {
        rgb = vec3(hsl.z); // Luminance
    } else {
        float f2;
        
        if (hsl.z < 0.5)
            f2 = hsl.z * (1.0 + hsl.y);
        else
            f2 = hsl.z + hsl.y - hsl.y * hsl.z;
            
        float f1 = 2.0 * hsl.z - f2;
        
        rgb.r = HUE_TO_RGB(f1, f2, hsl.x + (1.0/3.0));
        rgb.g = HUE_TO_RGB(f1, f2, hsl.x);
        rgb.b = HUE_TO_RGB(f1, f2, hsl.x - (1.0/3.0));
    }   
    return rgb;
}

vec3 HSL_TO_RGB(float h, float s, float l) {
    return HSL_TO_RGB(vec3(h, s, l));
}


vec3 RGB_SHIFT(vec3 color, float hue) {
    hue *= 6.28318530718;
    const vec3 k = vec3(0.57735, 0.57735, 0.57735);
    float cosAngle = cos(hue);
    return vec3(color * cosAngle + cross(k, color) * sin(hue) + k * dot(k, color) * (1.0 - cosAngle));
}

vec3 HSV_TO_RGB(vec3 c)
{
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}

vec3 RGB_TO_HSV(vec3 rgb) {
    float Cmax = max(rgb.r, max(rgb.g, rgb.b));
    float Cmin = min(rgb.r, min(rgb.g, rgb.b));
    float delta = Cmax - Cmin;

    vec3 hsv = vec3(0., 0., Cmax);

    if (Cmax > Cmin) {
        hsv.y = delta / Cmax;

        if (rgb.r == Cmax)
            hsv.x = (rgb.g - rgb.b) / delta;
        else {
            if (rgb.g == Cmax)
                hsv.x = 2. + (rgb.b - rgb.r) / delta;
            else
                hsv.x = 4. + (rgb.r - rgb.g) / delta;
        }
        hsv.x = fract(hsv.x / 6.);
    }
    return hsv;
}


vec3 GRID( float width, vec2 coord ) {
    float size = width * RENDERSIZE.x;
    vec3 a = HSL_TO_RGB( vec3(0.0,0.0,0.9) );
    vec3 b = HSL_TO_RGB( vec3(0.0,0.0,0.7) );

    if (size == 0.0)    {
        return a;
    } else if ((mod((coord.x / size),2.0) < 1.0)&&(mod((coord.y / size),2.0) > 1.0))  {
        return a;
    } else if ((mod((coord.x / size),2.0) > 1.0)&&(mod((coord.y / size),2.0) < 1.0))  {
        return a;
    }
    
    return b;

}

float SAW( float t ) {
    return 1.0-abs(2.*fract(t/PI)-1.);
}

float WAVE( float t, float shape, float amp, float exp ) {

    float sine = sin(t);
    float saw = SAW(t);
    return pow((mix(sine,saw,shape)*(1.+amp))-(amp/2.),exp);
}



`,Xu=n=>{const e=Ee(ce),i=yi(n.hide),t=[...Or().map(s=>({TARGET:s,WIDTH:"$WIDTH",HEIGHT:"$HEIGHT",PERSISTENT:!0})),{TARGET:"u999",WIDTH:"$WIDTH",HEIGHT:"$HEIGHT",PERSISTENT:!0}];let r=[],o=[{NAME:"inputImage",TYPE:"image"},{NAME:"Preview",TYPE:"bool",default:!1},{NAME:"PreviewSrc",TYPE:"long",default:-1}];Qn(s=>{let{x:f,y:u,name:c,uuid:h,schema:p,source:g}=s;for(const[y,d]of Object.entries(p.INPUTS)){const _=n.hide?i[h+y]:!1;if(!d.ignore&&!_){let v={...Ja(d),NAME:h+y,LABEL:mi(s,y),DEFAULT:e[h+y]||d.default};d.labels&&(v.VALUES=d.labels.map((E,b)=>b)),o.push(v)}}for(let y of o)y.GUI=="Teleport"&&(y.LABELS=[...t.map(d=>d.TARGET)],y.MAX=t.length);r.indexOf(c)==-1&&r.push(c),u+=1});const a=t.map(s=>s.TARGET);return{DESCRIPTION:"COMPILED: "+new Date().toLocaleString().toUpperCase().replaceAll(/[&\/\\#,+()$~%.'":*?<>{}]/g,"_"),CREDIT:"MX",PERSISTENT_BUFFERS:a,CATEGORIES:r,INPUTS:o,PASSES:t}},Yu=n=>{Ee(ce);let e={},i;return Qn(t=>{let{x:r,y:o,name:a,schema:l,source:s,uuid:f}=t,u=a;if(l.PASS&&(a+=f),!e[a]){let c=bn[u].GLSL.split(`
`).map(p=>"	"+p).join(`
`);const h=i?i==null?void 0:i.uuid:"inputImage";c=c.replaceAll("TEXTURE",h),e[a]={type:vt.FUNC,name:a,prepend:"vec4",arguments:Ga(l.INPUTS),body:c}}i=t}),Object.values(e)},Vt=(n,e)=>({name:e,type:n}),Ju=n=>{const e=Ee(ce),i=yi(n.hide),t={float:"float",image:"sampler2D",bool:"bool",event:"bool",long:"int",color:"vec4",point2D:"vec2"};let r=[];if(n.hide)for(const l of Ft()){const{schema:s,uuid:f}=l;for(const[u,c]of Object.entries(s.INPUTS))if(i[f+u]){const h=t[c.type],p=za(e[f+u]||c.default,h);r.push({type:vt.VAR,name:f+u,prepend:"const "+h,body:p})}}const o=Or();return[...Ft().filter(l=>o.indexOf(l.uuid)==-1).map(l=>({type:vt.VAR,name:l.uuid,prepend:"vec4"})),...r,{type:vt.VAR,name:"TOTAL_PASSES",prepend:"int",body:`${Za()}`},{type:vt.FUNC,name:"POSITION_FRAG",prepend:"vec2",body:"return gl_FragCoord.xy;"},{type:vt.FUNC,name:"POSITION_NORM",prepend:"vec2",body:`
				vec2 p = isf_FragNormCoord;
				// p *= 2.;
				// if (p.y < 0.5) p.y = p.y * 1.5;
				return p;`},{type:vt.FUNC,name:"CENTER",arguments:[],prepend:"vec2",body:"return vec2( 0.5, 0.5 ) * RENDERSIZE;"},{type:vt.FUNC,name:"BLEND",arguments:[Vt("int","mode"),Vt("vec3","a"),Vt("vec3","b"),Vt("float","amount")],prepend:"vec3",body:`vec3 color;
`+Gs.map((l,s)=>`${s==0?"if":"else if"} (mode == ${s}) { color = ${l}(a, b); }`).join(`
`)+`
return mix(a, color, amount);`},{type:vt.FUNC,name:"MAKE_PASS",arguments:[Vt("int","blendMode"),Vt("vec4","srcA"),Vt("vec4","srcB"),Vt("float","slider")],prepend:"vec4",body:`
			float amt = slider * srcB.a;
			float first = clamp( amt * 2.0, 0.0, 1.0);
			float second = clamp( (amt - 0.5) * 2.0, 0.0, 1.0);

			vec3 blend = BLEND( blendMode, srcA.rgb, srcB.rgb, first);
			// 0.5 - 1.0 = 0.0 - 1.0
			return vec4( mix( blend, srcB.rgb, second), 1.0);
			`}]},Ku=(n,e)=>console.log(`[Compiler] ${n}`,e||""),Kr={JSON_CONFIG:Xu,HELPERS:Wu,BLEND_MODES:Er,UTILS:Ju,OPS:Yu,BODY:zu},Zu=n=>"	"+n.trim().split(`
`).map(e=>e.trim()).join(`
	`),Sr=n=>{n||(n={}),n.keys||(n.keys=Object.keys(Kr)),Ku(`\u{1F4DA} parsing ${n.keys.join(" ")}`);const e=Ee(ce);let i="";for(const t of n.keys){const r=Kr[t](n);r||SAT(`\u274C no such section called ${t}`),Array.isArray(r)?i+=r.map(o=>{let a="";return a+=`
${o.prepend} ${o.name}`,o.type==vt.VAR&&o.body&&(a+=" = "),o.type==vt.FUNC?(a+="( ",a+=(o.arguments||[]).map(l=>`${l.type} ${l.name}`).join(", "),a+=`) {
`,a+=`${Zu(o.body||"")}`):a+=`${o.body||""};`,o.type==vt.FUNC&&(a+=`
}`),a}).join(`
`):typeof r=="string"?i+=r:i+=`/*
${JSON.stringify(r,null,2)}
*/`}return i+=qt.START,i+=$r(),i+=qt.END,console.log({OUT:i,UNIFORMS:e},"SHADER"),window.HELLO={OUT:i,UNIFORMS:e},i};function Wi(n,e,i){const t=n.slice();return t[6]=e[i],t[8]=i,t}function Xi(n,e,i){const t=n.slice();return t[9]=e[i],t}function Yi(n){let e,i=n[9]+"",t,r,o,a;function l(...s){return n[3](n[9],...s)}return{c(){e=V("button"),t=he(i),r=te(),this.h()},l(s){e=G(s,"BUTTON",{});var f=q(e);t=pe(f,i),r=ne(f),f.forEach(R),this.h()},h(){ke(e,"filled",n[0]==n[9])},m(s,f){ae(s,e,f),A(e,t),A(e,r),o||(a=ye(e,"mousedown",l),o=!0)},p(s,f){n=s,f&5&&ke(e,"filled",n[0]==n[9])},d(s){s&&R(e),o=!1,a()}}}function Ji(n){let e,i;return{c(){e=he(n[8]),i=V("br")},l(t){e=pe(t,n[8]),i=G(t,"BR",{})},m(t,r){ae(t,e,r),ae(t,i,r)},p:Pe,d(t){t&&R(e),t&&R(i)}}}function Qu(n){let e,i,t,r,o,a=n[1].trim()+"",l,s,f,u,c,h=["VERTEX","FRAGMENT","ISF",...n[2],"API"],p=[];for(let d=0;d<h.length;d+=1)p[d]=Yi(Xi(n,h,d));let g=new Array(n[1].split(`
`).length),y=[];for(let d=0;d<g.length;d+=1)y[d]=Ji(Wi(n,g,d));return{c(){e=V("div"),i=V("nav");for(let d=0;d<p.length;d+=1)p[d].c();t=te(),r=V("div"),o=V("pre"),l=he(a),s=he(`
			`),f=V("pre");for(let d=0;d<y.length;d+=1)y[d].c();u=he(`
			`),c=he(`
		`),this.h()},l(d){e=G(d,"DIV",{class:!0});var _=q(e);i=G(_,"NAV",{class:!0});var v=q(i);for(let T=0;T<p.length;T+=1)p[T].l(v);v.forEach(R),t=ne(_),r=G(_,"DIV",{class:!0});var E=q(r);o=G(E,"PRE",{class:!0});var b=q(o);l=pe(b,a),s=pe(b,`
			`),f=G(b,"PRE",{class:!0,style:!0});var N=q(f);for(let T=0;T<y.length;T+=1)y[T].l(N);u=pe(N,`
			`),N.forEach(R),c=pe(b,`
		`),b.forEach(R),E.forEach(R),_.forEach(R),this.h()},h(){P(i,"class","flex column br"),P(f,"class","abs l0 t0 mt1 plr0-5 fade"),je(f,"user-select","none",1),P(o,"class","monospace whitespace-prewrap p1 pl3 grow filled overflow-auto f2 rel"),P(r,"class","overflow-auto h100pc"),P(e,"class","row flex")},m(d,_){ae(d,e,_),A(e,i);for(let v=0;v<p.length;v+=1)p[v].m(i,null);A(e,t),A(e,r),A(r,o),A(o,l),A(o,s),A(o,f);for(let v=0;v<y.length;v+=1)y[v].m(f,null);A(f,u),A(o,c)},p(d,[_]){if(_&5){h=["VERTEX","FRAGMENT","ISF",...d[2],"API"];let v;for(v=0;v<h.length;v+=1){const E=Xi(d,h,v);p[v]?p[v].p(E,_):(p[v]=Yi(E),p[v].c(),p[v].m(i,null))}for(;v<p.length;v+=1)p[v].d(1);p.length=h.length}if(_&2&&a!==(a=d[1].trim()+"")&&De(l,a),_&2){g=new Array(d[1].split(`
`).length);let v;for(v=0;v<g.length;v+=1){const E=Wi(d,g,v);y[v]?y[v].p(E,_):(y[v]=Ji(E),y[v].c(),y[v].m(f,u))}for(;v<y.length;v+=1)y[v].d(1);y.length=g.length}},i:Pe,o:Pe,d(d){d&&R(e),Ye(p,d),Ye(y,d)}}}function $u(n,e,i){const t=window;let r="JSON_CONFIG",o="";const a=Object.keys(Kr),l=(s,f)=>i(0,r=s);return n.$$.update=()=>{n.$$.dirty&1&&(s=>{var f,u,c,h;s=="API"?i(1,o=Object.keys(Vi).map(p=>{const g=Vi[p];return console.log(Jr(g)),`${p}( ${Jr(g).join(", ")} )`}).join(`
`)):s=="FRAGMENT"?i(1,o=((u=(f=t==null?void 0:t.renderer)==null?void 0:f.parser)==null?void 0:u.fragmentShader)||(window==null?void 0:window.shaderSrc)||"// None"):s=="VERTEX"?i(1,o=((h=(c=t==null?void 0:t.renderer)==null?void 0:c.parser)==null?void 0:h.vertexShader)||"// None"):s=="ISF"?i(1,o=Sr({hide:!0})):a.indexOf(s)!=-1&&i(1,o=Sr({keys:[s],hide:!0}))})(r)},[r,o,a,l]}class ef extends Ce{constructor(e){super(),Le(this,e,$u,Qu,Fe,{})}}var sn=function(n,e,i){return n<64?e:i},Yt=function(n,e,i){return n===0?e:n===127?i:null},tf=function(n,e){switch(n){case 0:return"bankselect";case 1:return"modulation";case 2:return"breathcontroller";case 4:return"footcontroller";case 5:return"portamentotime";case 6:return"dataentry";case 7:return"volume";case 8:return"balance";case 10:return"pan";case 11:return"expressioncontroller";case 12:return"effect1";case 13:return"effect2";case 16:return"generalpurposecontroller1";case 17:return"generalpurposecontroller2";case 18:return"generalpurposecontroller3";case 19:return"generalpurposecontroller4";case 32:return"bankselectfine";case 33:return"modulationfine";case 34:return"breathcontrollerfine";case 36:return"footcontrollerfine";case 37:return"portamentotimefine";case 38:return"dataentryfine";case 39:return"volumefine";case 40:return"balancefine";case 42:return"panfine";case 43:return"expressioncontrollerfine";case 44:return"effect1fine";case 45:return"effect2fine";case 48:return"generalpurposecontroller1fine";case 49:return"generalpurposecontroller2fine";case 50:return"generalpurposecontroller3fine";case 51:return"generalpurposecontroller4fine";case 64:return sn(e,"sustainoff","sustainon");case 65:return sn(e,"portamentooff","portamentoon");case 66:return sn(e,"sostenutooff","sostenutoon");case 67:return sn(e,"softoff","softon");case 68:return sn(e,"legatooff","legatoon");case 69:return sn(e,"hold2off","hold2on");case 70:return"soundcontroller1";case 71:return"soundcontroller2";case 72:return"soundcontroller3";case 73:return"soundcontroller4";case 74:return"soundcontroller5";case 75:return"soundcontroller6";case 76:return"soundcontroller7";case 77:return"soundcontroller8";case 78:return"soundcontroller9";case 79:return"soundcontroller10";case 80:return"generalpurposecontroller5";case 81:return"generalpurposecontroller6";case 82:return"generalpurposecontroller7";case 83:return"generalpurposecontroller8";case 84:return"portamentocontrol";case 91:return"effectdepth1";case 92:return"effectdepth2";case 93:return"effectdepth3";case 94:return"effectdepth4";case 95:return"effectdepth5";case 96:return"dataincrement";case 97:return"datadecrement";case 98:return"nonregisteredparameternumberfine";case 99:return"nonregisteredparameternumber";case 100:return"registeredparameternumberfine";case 101:return"registeredparameternumber"}return null},nf=function(n,e){switch(n){case 120:return Yt(e,"allsoundoff",null);case 121:return Yt(e,"resetallcontrollers",null);case 122:return Yt(e,"localcontroloff","localcontrolon");case 123:return Yt(e,"allnotesoff",null);case 124:return Yt(e,"omnimodeoff",null);case 125:return Yt(e,"omnimodeon",null);case 126:return"monomodeon";case 127:return Yt(e,"polymodeon",null)}return null},rf=Math.pow(2,7),or=Math.pow(rf,2)/2;function Qa(n){var e=n[0],i=n[1],t=n[2],r={messageCode:240&e,channel:1+(15&e)};switch(r.messageCode){case 128:return Object.assign({},r,{messageType:"noteoff",key:i,velocity:t});case 144:return Object.assign({},r,{messageType:t===0?"noteoff":"noteon",key:i,velocity:t});case 160:return Object.assign({},r,{messageType:"keypressure",key:i,pressure:t});case 176:return i<120?Object.assign({},r,{messageType:"controlchange",controlNumber:i,controlFunction:tf(i,t),controlValue:t}):Object.assign({},r,{messageType:"channelmodechange",controlNumber:i,channelModeMessage:nf(i,t),controlValue:t});case 192:return Object.assign({},r,{messageType:"programchange",program:i});case 208:return Object.assign({},r,{messageType:"channelpressure",pressure:i});case 224:var o=(t<<7)+i;return Object.assign({},r,{messageType:"pitchbendchange",pitchBend:o,pitchBendMultiplier:(o-or)/(o<=or?or:or-1)});default:return Object.assign({},r,{messageType:"unknown",data1:i,data2:t})}}const xr=(n,e)=>console.log(`[MIDI] \u{1F39B} ${n}`,e||""),vn={CC:"controlchange",NOTE:"note",NOTEON:"noteon",NOTEOFF:"noteoff"};let Wn={},Zr={};const of=.75;function $a(){const n=Ee(At);for(const[e,i]of Object.entries(n))for(const t of i)if(Zr[t]!=null){let r=of;Wn[t]=Wn[t]*r+Zr[t]*(1-r),es(e,Wn[t])}window.requestAnimationFrame($a)}function af(n){const{manufacturer:e,name:i}=n.target,t=Qa(n.data),{messageCode:r,controlFunction:o,messageType:a,controlNumber:l,controlValue:s,channel:f,key:u,velocity:c}=t;return vn.CC==a?[e,i,f,a,l].join(":"):vn.NOTEON==a||vn.NOTEOFF==a?[e,i,f,vn.NOTE,u].join(":"):null}function sf(n){let e=n.split(":");return e[2]=parseInt(e[2]),e[4]=parseInt(e[4]),e}function es(n,e){const i=n.split(":"),t=i[0],r=parseInt(i[1]),o=Ee(Wr),a=o==null?void 0:o[t];if(!a)return xr(`\u274C no lookup for ${t}`);const{min:l,max:s,type:f}=a;let u=Ee(ce);a.type=="float"?u[t]=gr(e,0,127,l,s):a.type=="point2D"||a.type=="color"?(u[t],u[t][r]=gr(e,0,127,l[r],s[r])):a.type=="long"?u[t]=gr(e,0,127,0,a.labels.length):a.type=="bool"&&(u[t]=!u[t]),ce.set(u)}function lf(n){const e=Ee(mn);let i=Ee(At);const t=af(n);e&&(i[e]||(i[e]=[]),i[e].indexOf(t)!=-1?alert("this assignment already exists."):(xr(`adding assignment ${t} to ${e}`),i[e]=[...i[e],t]),At.set(i),mn.set(!1),hn.set(!1));for(const[r,o]of Object.entries(i))if(o.indexOf(t)!=-1){const a=Qa(n.data),{messageCode:l,controlFunction:s,messageType:f,controlNumber:u,controlValue:c,channel:h,key:p,velocity:g}=a;vn.CC==f?(Wn[t]||(Wn[t]=c),Zr[t]=c):vn.NOTEON==f&&es(r,g)}}async function uf(){const n=await navigator.requestMIDIAccess();xr("requesting MIDI devices");for(const[e,i]of n.inputs)i.onmidimessage=lf,xr(`\u2705 attached ${i.manufacturer} ${i.name}`);window.requestAnimationFrame($a)}async function ff(){const n={echNm2:"Launch Control XL-Launch Control XL",echo:!0,src:"/MIDI/ch. 9/note [41]",tog:!0,wantsEnbl:!0},e={echNm2:"Launch Control XL-Launch Control XL",endM:5,echo:!0,src:"/MIDI/ch. 9/ctrl [77]",tog:!0,wantsEnbl:!0};let t={...{VVGridSize:"{-1, -1}",classArray:[],keyArray:[],uiBuilder:{}}};const r=Ee(At);let o=Object.keys(r);o=o.sort((l,s)=>(l=yr(l),s=yr(s),l.x-s.x||l.y-s.y)),console.log("HEY!");for(const l of o){const s=r[l];for(const f of s){const u=sf(f),c=`${u[1]-u[1]}`,h=yr(l),p=mi(h,l.substring(4));u[3]=="note"?(t.classArray.push("Button"),t.keyArray.push(p),t.uiBuilder[p]={...n,rcvrs:[{...n}]},t.uiBuilder[p].rcvrs[0].echNm2=c,t.uiBuilder[p].rcvrs[0].src=`/MIDI/ch. ${u[2]}/note [${u[4]}]`):u[3]=="controlchange"&&(t.classArray.push("Slider"),t.keyArray.push(p),t.uiBuilder[p]={...e,rcvrs:[{...e}]},t.uiBuilder[p].rcvrs[0].echNm2=c,t.uiBuilder[p].rcvrs[0].src=`/MIDI/ch. ${u[2]}/ctrl [${u[4]}]`)}}return JSON.stringify(t,null,"	")}function Ki(n,e,i){const t=n.slice();return t[3]=e[i][0],t[4]=e[i][1],t}function Zi(n){let e,i,t=n[3]+"",r,o,a,l=n[4]+"",s,f,u,c,h,p;function g(...y){return n[2](n[3],...y)}return{c(){e=V("div"),i=V("div"),r=he(t),o=te(),a=V("div"),s=he(l),f=te(),u=V("button"),c=te(),this.h()},l(y){e=G(y,"DIV",{class:!0});var d=q(e);i=G(d,"DIV",{class:!0});var _=q(i);r=pe(_,t),_.forEach(R),o=ne(d),a=G(d,"DIV",{class:!0});var v=q(a);s=pe(v,l),v.forEach(R),f=ne(d),u=G(d,"BUTTON",{class:!0});var E=q(u);E.forEach(R),c=ne(d),d.forEach(R),this.h()},h(){P(i,"class","bold"),P(a,"class",""),P(u,"class","cross h2em"),P(e,"class","flex row-space-between-center")},m(y,d){ae(y,e,d),A(e,i),A(i,r),A(e,o),A(e,a),A(a,s),A(e,f),A(e,u),A(e,c),h||(p=ye(u,"click",g),h=!0)},p(y,d){n=y,d&1&&t!==(t=n[3]+"")&&De(r,t),d&1&&l!==(l=n[4]+"")&&De(s,l)},d(y){y&&R(e),h=!1,p()}}}function cf(n){let e,i=Object.entries(n[0]),t=[];for(let r=0;r<i.length;r+=1)t[r]=Zi(Ki(n,i,r));return{c(){e=V("div");for(let r=0;r<t.length;r+=1)t[r].c();this.h()},l(r){e=G(r,"DIV",{id:!0,class:!0});var o=q(e);for(let a=0;a<t.length;a+=1)t[a].l(o);o.forEach(R),this.h()},h(){P(e,"id","assignments"),P(e,"class","flex column-stretch-flex-start p1")},m(r,o){ae(r,e,o);for(let a=0;a<t.length;a+=1)t[a].m(e,null)},p(r,[o]){if(o&3){i=Object.entries(r[0]);let a;for(a=0;a<i.length;a+=1){const l=Ki(r,i,a);t[a]?t[a].p(l,o):(t[a]=Zi(l),t[a].c(),t[a].m(e,null))}for(;a<t.length;a+=1)t[a].d(1);t.length=i.length}},i:Pe,o:Pe,d(r){r&&R(e),Ye(t,r)}}}function df(n,e,i){let t;ge(n,At,a=>i(0,t=a)),En(async a=>{await uf()});function r(a){delete t[a],At.set(t)}return[t,r,(a,l)=>r(a)]}class hf extends Ce{constructor(e){super(),Le(this,e,df,cf,Fe,{})}}function Qi(n,e,i){const t=n.slice();return t[12]=e[i][0],t[13]=e[i][1],t}function $i(n,e,i){const t=n.slice();return t[12]=e[i][0],t[13]=e[i][1],t}function eo(n,e,i){const t=n.slice();return t[12]=e[i],t}function to(n){let e,i=n[12].split(":")[0]+"",t,r;return{c(){e=V("div"),t=he(i),r=te(),this.h()},l(o){e=G(o,"DIV",{style:!0,class:!0});var a=q(e);t=pe(a,i),r=ne(a),a.forEach(R),this.h()},h(){je(e,"background","var(--blue5-0)"),P(e,"class","bt p0-5 bold grow w100pc h40px flex row-flex-start-center")},m(o,a){ae(o,e,a),A(e,t),A(e,r)},p(o,a){a&1&&i!==(i=o[12].split(":")[0]+"")&&De(t,i)},d(o){o&&R(e)}}}function no(n){let e,i=n[13].name+"",t,r,o,a;function l(...s){return n[8](n[12],...s)}return{c(){e=V("button"),t=he(i),r=te(),this.h()},l(s){e=G(s,"BUTTON",{class:!0});var f=q(e);t=pe(f,i),r=ne(f),f.forEach(R),this.h()},h(){P(e,"class","grow"),ke(e,"filled",n[1]==n[12])},m(s,f){ae(s,e,f),A(e,t),A(e,r),o||(a=ye(e,"click",l),o=!0)},p(s,f){n=s,f&10&&ke(e,"filled",n[1]==n[12])},d(s){s&&R(e),o=!1,a()}}}function ro(n){let e,i,t,r;var o=n[13].view;function a(l){return{}}return o&&(i=new o(a())),{c(){e=V("section"),i&&Ne(i.$$.fragment),t=te(),this.h()},l(l){e=G(l,"SECTION",{id:!0,class:!0});var s=q(e);i&&Re(i.$$.fragment,s),t=ne(s),s.forEach(R),this.h()},h(){P(e,"id",n[12]),P(e,"class","flex column grow"),ke(e,"none",n[12]!=n[1])},m(l,s){ae(l,e,s),i&&Se(i,e,null),A(e,t),r=!0},p(l,s){if(o!==(o=l[13].view)){if(i){st();const f=i;ue(f.$$.fragment,1,0,()=>{xe(f,1)}),lt()}o?(i=new o(a()),Ne(i.$$.fragment),oe(i.$$.fragment,1),Se(i,e,t)):i=null}(!r||s&10)&&ke(e,"none",l[12]!=l[1])},i(l){r||(i&&oe(i.$$.fragment,l),r=!0)},o(l){i&&ue(i.$$.fragment,l),r=!1},d(l){l&&R(e),i&&xe(i)}}}function pf(n){let e,i,t,r,o,a,l,s,f,u=n[0],c=[];for(let v=0;v<u.length;v+=1)c[v]=to(eo(n,u,v));let h={};t=new xa({props:h}),n[7](t);let p=Object.entries(n[3]),g=[];for(let v=0;v<p.length;v+=1)g[v]=no($i(n,p,v));let y=Object.entries(n[3]),d=[];for(let v=0;v<y.length;v+=1)d[v]=ro(Qi(n,y,v));const _=v=>ue(d[v],1,1,()=>{d[v]=null});return{c(){e=V("div");for(let v=0;v<c.length;v+=1)c[v].c();i=te(),Ne(t.$$.fragment),r=te(),o=V("div"),a=V("nav");for(let v=0;v<g.length;v+=1)g[v].c();l=te(),s=V("article");for(let v=0;v<d.length;v+=1)d[v].c();this.h()},l(v){e=G(v,"DIV",{id:!0,style:!0,class:!0});var E=q(e);for(let k=0;k<c.length;k+=1)c[k].l(E);E.forEach(R),i=ne(v),Re(t.$$.fragment,v),r=ne(v),o=G(v,"DIV",{id:!0,class:!0});var b=q(o);a=G(b,"NAV",{style:!0,class:!0});var N=q(a);for(let k=0;k<g.length;k+=1)g[k].l(N);N.forEach(R),l=ne(b),s=G(b,"ARTICLE",{class:!0});var T=q(s);for(let k=0;k<d.length;k+=1)d[k].l(T);T.forEach(R),b.forEach(R),this.h()},h(){P(e,"id","drag-visualiser"),je(e,"bottom","-100%"),P(e,"class","pop w80px fixed b0 l0 bl bb br flex column-center-center z-index66"),ke(e,"none",!n[0]),je(a,"background","var(--blue5-0)"),P(a,"class","flex bb fixed t0 l0 w100pc z-index44 none"),P(s,"class","flex column grow overflow-hidden h100vh w100vw"),P(o,"id","app"),P(o,"class","app mxz dark flex row-stretch-stretch")},m(v,E){ae(v,e,E);for(let b=0;b<c.length;b+=1)c[b].m(e,null);ae(v,i,E),Se(t,v,E),ae(v,r,E),ae(v,o,E),A(o,a);for(let b=0;b<g.length;b+=1)g[b].m(a,null);A(o,l),A(o,s);for(let b=0;b<d.length;b+=1)d[b].m(s,null);f=!0},p(v,[E]){if(E&1){u=v[0];let N;for(N=0;N<u.length;N+=1){const T=eo(v,u,N);c[N]?c[N].p(T,E):(c[N]=to(T),c[N].c(),c[N].m(e,null))}for(;N<c.length;N+=1)c[N].d(1);c.length=u.length}(!f||E&1)&&ke(e,"none",!v[0]);const b={};if(t.$set(b),E&10){p=Object.entries(v[3]);let N;for(N=0;N<p.length;N+=1){const T=$i(v,p,N);g[N]?g[N].p(T,E):(g[N]=no(T),g[N].c(),g[N].m(a,null))}for(;N<g.length;N+=1)g[N].d(1);g.length=p.length}if(E&10){y=Object.entries(v[3]);let N;for(N=0;N<y.length;N+=1){const T=Qi(v,y,N);d[N]?(d[N].p(T,E),oe(d[N],1)):(d[N]=ro(T),d[N].c(),oe(d[N],1),d[N].m(s,null))}for(st(),N=y.length;N<d.length;N+=1)_(N);lt()}},i(v){if(!f){oe(t.$$.fragment,v);for(let E=0;E<y.length;E+=1)oe(d[E]);f=!0}},o(v){ue(t.$$.fragment,v),d=d.filter(Boolean);for(let E=0;E<d.length;E+=1)ue(d[E]);f=!1},d(v){v&&R(e),Ye(c,v),v&&R(i),n[7](null),xe(t,v),v&&R(r),v&&R(o),Ye(g,v),Ye(d,v)}}}function mf(n,e,i){let t,r,o,a;ge(n,yn,y=>i(1,t=y)),ge(n,at,y=>i(6,r=y)),ge(n,zn,y=>i(9,o=y)),ge(n,Yn,y=>i(10,a=y));const l=(y,d)=>console.log(`[App] ${y}`,d||"");let{application:s}=e,f=[],u=!1,c;En(async y=>{l(`getting current view ${t}`),i(5,u=!0),c.addBindings([{command:["Tab"],action:d=>{}},{command:[Jt,"f"],action:d=>{_e(zn,o=!o,o),d.preventDefault()}},{command:[Jt,"s"],action:d=>{console.log("CAPTURING IMAGE"),window.captureImage(),d.preventDefault(),d.stopPropagation()}},{command:[Bs],action:d=>{o&&_e(zn,o=!1,o),d.preventDefault()}},...Object.values(an).map((d,_)=>({command:[Jt,_+1+""],action:v=>{_e(yn,t=Object.values(an)[_],t),v.preventDefault()}})),{command:["Backspace"],action:d=>{var _,v,E,b;r&&(l("\u{1F6A9} deleting",r),((_=r==null?void 0:r[0])==null?void 0:_[0])!=null&&((v=r==null?void 0:r[0])==null?void 0:v[1])!=null&&(vi(dt.BIN,(E=r==null?void 0:r[0])==null?void 0:E[0],(b=r==null?void 0:r[0])==null?void 0:b[1]),di(),window.requestAnimationFrame(N=>{Ot.set(Ct.COMPILE)})))}}])});const h={[an.APPLICATION]:{name:"Application",view:s},[an.ASSIGNMENTS]:{name:"Assignments",view:hf},[an.DEBUG_SHADER]:{name:"Shader (Debug)",view:ef},[an.DEBUG_SYSTEM]:{name:"System (Debug)",view:qu}};function p(y){Je[y?"unshift":"push"](()=>{c=y,i(2,c)})}const g=(y,d)=>yn.set(y);return n.$$set=y=>{"application"in y&&i(4,s=y.application)},n.$$.update=()=>{n.$$.dirty&65&&(y=>{i(0,f=gi()),_e(Yn,a=f==null?void 0:f[f.length-1],a)})(),n.$$.dirty&34&&(y=>{u&&(l(`setting view to ${t}`),window.localStorage.setItem("__CURRENT_VIEW",t))})()},[f,t,c,h,s,u,r,p,g]}class gf extends Ce{constructor(e){super(),Le(this,e,mf,pf,Fe,{application:4})}}function io(n,e,i){const t=n.slice();return t[12]=e[i][0],t[13]=e[i][1],t}function oo(n){let e,i=n[12]+"",t,r,o,a;return{c(){e=V("button"),t=he(i),r=te(),this.h()},l(l){e=G(l,"BUTTON",{class:!0});var s=q(e);t=pe(s,i),r=ne(s),s.forEach(R),this.h()},h(){P(e,"class","br plr1 grow ptb0-5 pop pointer")},m(l,s){ae(l,e,s),A(e,t),A(e,r),o||(a=ye(e,"mousedown",n[13]),o=!0)},p(l,s){n=l},d(l){l&&R(e),o=!1,a()}}}function vf(n){let e,i=Object.entries(n[0]),t=[];for(let r=0;r<i.length;r+=1)t[r]=oo(io(n,i,r));return{c(){for(let r=0;r<t.length;r+=1)t[r].c();e=He()},l(r){for(let o=0;o<t.length;o+=1)t[o].l(r);e=He()},m(r,o){for(let a=0;a<t.length;a+=1)t[a].m(r,o);ae(r,e,o)},p(r,[o]){if(o&1){i=Object.entries(r[0]);let a;for(a=0;a<i.length;a+=1){const l=io(r,i,a);t[a]?t[a].p(l,o):(t[a]=oo(l),t[a].c(),t[a].m(e.parentNode,e))}for(;a<t.length;a+=1)t[a].d(1);t.length=i.length}},i:Pe,o:Pe,d(r){Ye(t,r),r&&R(e)}}}const Mr="MXZ";function yf(n,e,i){const t=window,r=(y,d)=>console.log(`[FileSave] ${y}`,d||"");function o(){const y=$r();t.localStorage.setItem(Mr,y),r("\u{1F4BE} saved",JSON.parse(y))}function a(){t.confirm("Clear?")&&t.localStorage.removeItem(Mr)}async function l(){let y=await(await fetch("/default.fs")).text();const d=y.indexOf(qt.START),_=y.indexOf(qt.END),v=y.substring(d+qt.START.length,_);await s(v)}async function s(y){r("loading from local storage"),y=y||t.localStorage.getItem(Mr),Mi(y)}const f=()=>new Date().toISOString();function u(){const y=document.createElement("a");y.setAttribute("href",`data:application/plain;charset=utf-8,${encodeURIComponent(Sr({hide:!0,isf:!0}))}`),y.setAttribute("download",`synth.v1.${f()}.fs`),y.click()}async function c(){const y={types:[{description:"Shaders",accept:{"text/*":[".fs",".glsl"]}}],excludeAcceptAllOption:!0,multiple:!1},[d]=await window.showOpenFilePicker(y);try{const _=await(await d.getFile()).text(),v=_.indexOf(qt.START),E=_.indexOf(qt.END),b=_.substring(v+qt.START.length,E);Mi(b)}catch(_){alert(`Could not open project: ${_.message}`)}}async function h(){t.confirm("Clear?")&&At.set({})}async function p(){console.log("save assignments");const y=document.createElement("a"),d=await ff();y.setAttribute("href",`data:application/plain;charset=utf-8,${encodeURIComponent(d)}`),y.setAttribute("download",`synth.v1.${f()}.VDMX.fs`),y.click()}return En(s),[{"L: Load":s,"D: Default":l,"L: Save":o,"L: Clear":a,"P: Open":c,"P: Save":u,"M: Clear":h,"M: Save":p},o,a,l,s,u,c,h,p]}class _f extends Ce{constructor(e){super(),Le(this,e,yf,vf,Fe,{saveLocally:1,clearLocally:2,loadDefaultProject:3,loadLocally:4,saveProject:5,openProject:6,clearAssignments:7,saveAssignments:8})}get saveLocally(){return this.$$.ctx[1]}get clearLocally(){return this.$$.ctx[2]}get loadDefaultProject(){return this.$$.ctx[3]}get loadLocally(){return this.$$.ctx[4]}get saveProject(){return this.$$.ctx[5]}get openProject(){return this.$$.ctx[6]}get clearAssignments(){return this.$$.ctx[7]}get saveAssignments(){return this.$$.ctx[8]}}var ts={exports:{}},ns={};Number.isFinite=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)};Number.isNaN=Number.isNaN||function(n){return n!==n};var ut={},Pr,ao;function _i(){return ao||(ao=1,Pr=function(e){return e&&e.constructor.prototype.isBigNumber||!1}),Pr}(function(n){function e(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?e=function(o){return typeof o}:e=function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},e(t)}var i=_i();n.clone=function t(r){var o=e(r);if(o==="number"||o==="string"||o==="boolean"||r===null||r===void 0)return r;if(typeof r.clone=="function")return r.clone();if(Array.isArray(r))return r.map(function(a){return t(a)});if(r instanceof Date)return new Date(r.valueOf());if(i(r))return r;if(r instanceof RegExp)throw new TypeError("Cannot clone "+r);return n.map(r,t)},n.map=function(t,r){var o={};for(var a in t)n.hasOwnProperty(t,a)&&(o[a]=r(t[a]));return o},n.extend=function(t,r){for(var o in r)n.hasOwnProperty(r,o)&&(t[o]=r[o]);return t},n.deepExtend=function t(r,o){if(Array.isArray(o))throw new TypeError("Arrays are not supported by deepExtend");for(var a in o)if(n.hasOwnProperty(o,a))if(o[a]&&o[a].constructor===Object)r[a]===void 0&&(r[a]={}),r[a].constructor===Object?t(r[a],o[a]):r[a]=o[a];else{if(Array.isArray(o[a]))throw new TypeError("Arrays are not supported by deepExtend");r[a]=o[a]}return r},n.deepEqual=function(r,o){var a,l,s;if(Array.isArray(r)){if(!Array.isArray(o)||r.length!==o.length)return!1;for(l=0,s=r.length;l<s;l++)if(!n.deepEqual(r[l],o[l]))return!1;return!0}else if(r instanceof Object){if(Array.isArray(o)||!(o instanceof Object))return!1;for(a in r)if(!n.deepEqual(r[a],o[a]))return!1;for(a in o)if(!n.deepEqual(r[a],o[a]))return!1;return!0}else return r===o},n.canDefineProperty=function(){try{if(Object.defineProperty)return Object.defineProperty({},"x",{get:function(){}}),!0}catch{}return!1},n.lazy=function(t,r,o){if(n.canDefineProperty()){var a=!0,l;Object.defineProperty(t,r,{get:function(){return a&&(l=o(),a=!1),l},set:function(f){l=f,a=!1},configurable:!0,enumerable:!0})}else t[r]=o()},n.traverse=function(t,r){var o=t;if(r)for(var a=r.split("."),l=0;l<a.length;l++){var s=a[l];s in o||(o[s]={}),o=o[s]}return o},n.hasOwnProperty=function(t,r){return t&&Object.hasOwnProperty.call(t,r)},n.isFactory=function(t){return t&&typeof t.factory=="function"}})(ut);var rs={},is={exports:{}};(function(n,e){(function(i,t){n.exports=t()})(As,function(){function i(){return!0}function t(){return!1}function r(){}function o(){var a=[{name:"number",test:function(O){return typeof O=="number"}},{name:"string",test:function(O){return typeof O=="string"}},{name:"boolean",test:function(O){return typeof O=="boolean"}},{name:"Function",test:function(O){return typeof O=="function"}},{name:"Array",test:Array.isArray},{name:"Date",test:function(O){return O instanceof Date}},{name:"RegExp",test:function(O){return O instanceof RegExp}},{name:"Object",test:function(O){return typeof O=="object"&&O.constructor===Object}},{name:"null",test:function(O){return O===null}},{name:"undefined",test:function(O){return O===void 0}}],l={name:"any",test:i},s=[],f=[],u={types:a,conversions:f,ignore:s};function c(O){var C=pt(u.types,function(D){return D.name===O});if(C)return C;if(O==="any")return l;var L=pt(u.types,function(D){return D.name.toLowerCase()===O.toLowerCase()});throw new TypeError('Unknown type "'+O+'"'+(L?'. Did you mean "'+L.name+'"?':""))}function h(O){return O===l?999:u.types.indexOf(O)}function p(O){var C=pt(u.types,function(L){return L.test(O)});if(C)return C.name;throw new TypeError("Value has unknown type. Value: "+O)}function g(O,C){if(!O.signatures)throw new TypeError("Function is no typed-function");var L;if(typeof C=="string"){L=C.split(",");for(var D=0;D<L.length;D++)L[D]=L[D].trim()}else if(Array.isArray(C))L=C;else throw new TypeError("String array or a comma separated string expected");var J=L.join(","),Z=O.signatures[J];if(Z)return Z;throw new TypeError("Signature not found (signature: "+(O.name||"unnamed")+"("+L.join(", ")+"))")}function y(O,C){var L=p(O);if(C===L)return O;for(var D=0;D<u.conversions.length;D++){var J=u.conversions[D];if(J.from===L&&J.to===C)return J.convert(O)}throw new Error("Cannot convert from "+L+" to "+C)}function d(O){return O.map(function(C){var L=C.types.map(w);return(C.restParam?"...":"")+L.join("|")}).join(",")}function _(O,C){var L=O.indexOf("...")===0,D=L?O.length>3?O.slice(3):"any":O,J=D.split("|").map(Ue).filter(Oe).filter(Y),Z=ee(C,J),le=J.map(function(X){var ie=c(X);return{name:X,typeIndex:h(ie),test:ie.test,conversion:null,conversionIndex:-1}}),re=Z.map(function(X){var ie=c(X.from);return{name:X.from,typeIndex:h(ie),test:ie.test,conversion:X,conversionIndex:C.indexOf(X)}});return{types:le.concat(re),restParam:L}}function v(O,C,L){var D=[];return O.trim()!==""&&(D=O.split(",").map(Ue).map(function(J,Z,le){var re=_(J,L);if(re.restParam&&Z!==le.length-1)throw new SyntaxError('Unexpected rest parameter "'+J+'": only allowed for the last parameter');return re})),D.some(kt)?null:{params:D,fn:C}}function E(O){var C=ot(O);return C?C.restParam:!1}function b(O){return O.types.some(function(C){return C.conversion!=null})}function N(O){if(!O||O.types.length===0)return i;if(O.types.length===1)return c(O.types[0].name).test;if(O.types.length===2){var C=c(O.types[0].name).test,L=c(O.types[1].name).test;return function(Z){return C(Z)||L(Z)}}else{var D=O.types.map(function(J){return c(J.name).test});return function(Z){for(var le=0;le<D.length;le++)if(D[le](Z))return!0;return!1}}}function T(O){var C,L,D;if(E(O)){C=it(O).map(N);var J=C.length,Z=N(ot(O)),le=function(re){for(var X=J;X<re.length;X++)if(!Z(re[X]))return!1;return!0};return function(X){for(var ie=0;ie<C.length;ie++)if(!C[ie](X[ie]))return!1;return le(X)&&X.length>=J+1}}else return O.length===0?function(X){return X.length===0}:O.length===1?(L=N(O[0]),function(X){return L(X[0])&&X.length===1}):O.length===2?(L=N(O[0]),D=N(O[1]),function(X){return L(X[0])&&D(X[1])&&X.length===2}):(C=O.map(N),function(X){for(var ie=0;ie<C.length;ie++)if(!C[ie](X[ie]))return!1;return X.length===C.length})}function k(O,C){return C<O.params.length?O.params[C]:E(O.params)?ot(O.params):null}function I(O,C,L){var D=k(O,C),J=D?L?D.types.filter(x):D.types:[];return J.map(w)}function w(O){return O.name}function x(O){return O.conversion===null||O.conversion===void 0}function B(O,C){var L=Pt(tt(O,function(D){return I(D,C,!1)}));return L.indexOf("any")!==-1?["any"]:L}function F(O,C,L){var D,J,Z=O||"unnamed",le=L,re;for(re=0;re<C.length;re++){var X=le.filter(function(Xe){var Ie=N(k(Xe,re));return(re<Xe.params.length||E(Xe.params))&&Ie(C[re])});if(X.length===0){if(J=B(le,re),J.length>0){var ie=p(C[re]);return D=new TypeError("Unexpected type of argument in function "+Z+" (expected: "+J.join(" or ")+", actual: "+ie+", index: "+re+")"),D.data={category:"wrongType",fn:Z,index:re,actual:ie,expected:J},D}}else le=X}var Ve=le.map(function(Xe){return E(Xe.params)?1/0:Xe.params.length});if(C.length<Math.min.apply(null,Ve))return J=B(le,re),D=new TypeError("Too few arguments in function "+Z+" (expected: "+J.join(" or ")+", index: "+C.length+")"),D.data={category:"tooFewArgs",fn:Z,index:C.length,expected:J},D;var Be=Math.max.apply(null,Ve);return C.length>Be?(D=new TypeError("Too many arguments in function "+Z+" (expected: "+Be+", actual: "+C.length+")"),D.data={category:"tooManyArgs",fn:Z,index:C.length,expectedLength:Be},D):(D=new TypeError('Arguments of type "'+C.join(", ")+'" do not match any of the defined signatures of function '+Z+"."),D.data={category:"mismatch",actual:C.map(p)},D)}function j(O){for(var C=999,L=0;L<O.types.length;L++)x(O.types[L])&&(C=Math.min(C,O.types[L].typeIndex));return C}function H(O){for(var C=999,L=0;L<O.types.length;L++)x(O.types[L])||(C=Math.min(C,O.types[L].conversionIndex));return C}function K(O,C){var L;return L=O.restParam-C.restParam,L!==0||(L=b(O)-b(C),L!==0)||(L=j(O)-j(C),L!==0)?L:H(O)-H(C)}function U(O,C){var L=Math.min(O.params.length,C.params.length),D,J;if(J=O.params.some(b)-C.params.some(b),J!==0)return J;for(D=0;D<L;D++)if(J=b(O.params[D])-b(C.params[D]),J!==0)return J;for(D=0;D<L;D++)if(J=K(O.params[D],C.params[D]),J!==0)return J;return O.params.length-C.params.length}function ee(O,C){var L={};return O.forEach(function(D){C.indexOf(D.from)===-1&&C.indexOf(D.to)!==-1&&!L[D.from]&&(L[D.from]=D)}),Object.keys(L).map(function(D){return L[D]})}function fe(O,C){var L=C;if(O.some(b)){var D=E(O),J=O.map(ve);L=function(){for(var X=[],ie=D?arguments.length-1:arguments.length,Ve=0;Ve<ie;Ve++)X[Ve]=J[Ve](arguments[Ve]);return D&&(X[ie]=arguments[ie].map(J[ie])),C.apply(null,X)}}var Z=L;if(E(O)){var le=O.length-1;Z=function(){return L.apply(null,xt(arguments,0,le).concat([xt(arguments,le)]))}}return Z}function ve(O){var C,L,D,J,Z=[],le=[];switch(O.types.forEach(function(re){re.conversion&&(Z.push(c(re.conversion.from).test),le.push(re.conversion.convert))}),le.length){case 0:return function(X){return X};case 1:return C=Z[0],D=le[0],function(X){return C(X)?D(X):X};case 2:return C=Z[0],L=Z[1],D=le[0],J=le[1],function(X){return C(X)?D(X):L(X)?J(X):X};default:return function(X){for(var ie=0;ie<le.length;ie++)if(Z[ie](X))return le[ie](X);return X}}}function Q(O){var C={};return O.forEach(function(L){L.params.some(b)||se(L.params,!0).forEach(function(D){C[d(D)]=L.fn})}),C}function se(O,C){function L(D,J,Z){if(J<D.length){var le=D[J],re=C?le.types.filter(x):le.types,X;if(le.restParam){var ie=re.filter(x);X=ie.length<re.length?[ie,re]:[re]}else X=re.map(function(Be){return[Be]});return tt(X,function(Be){return L(D,J+1,Z.concat([Be]))})}else{var Ve=Z.map(function(Be,Xe){return{types:Be,restParam:Xe===D.length-1&&E(D)}});return[Ve]}}return L(O,0,[])}function be(O,C){for(var L=Math.max(O.params.length,C.params.length),D=0;D<L;D++){var J=I(O,D,!0),Z=I(C,D,!0);if(!rt(J,Z))return!1}var le=O.params.length,re=C.params.length,X=E(O.params),ie=E(C.params);return X?ie?le===re:re>=le:ie?le>=re:le===re}function de(O,C){if(Object.keys(C).length===0)throw new SyntaxError("No signatures provided");var L=[];Object.keys(C).map(function(qe){return v(qe,C[qe],u.conversions)}).filter(We).forEach(function(qe){var Ze=pt(L,function($e){return be($e,qe)});if(Ze)throw new TypeError('Conflicting signatures "'+d(Ze.params)+'" and "'+d(qe.params)+'".');L.push(qe)});var D=tt(L,function(qe){var Ze=qe?se(qe.params,!1):[];return Ze.map(function($e){return{params:$e,fn:qe.fn}})}).filter(We);D.sort(U);var J=D[0]&&D[0].params.length<=2&&!E(D[0].params),Z=D[1]&&D[1].params.length<=2&&!E(D[1].params),le=D[2]&&D[2].params.length<=2&&!E(D[2].params),re=D[3]&&D[3].params.length<=2&&!E(D[3].params),X=D[4]&&D[4].params.length<=2&&!E(D[4].params),ie=D[5]&&D[5].params.length<=2&&!E(D[5].params),Ve=J&&Z&&le&&re&&X&&ie,Be=D.map(function(qe){return T(qe.params)}),Xe=J?N(D[0].params[0]):t,Ie=Z?N(D[1].params[0]):t,mt=le?N(D[2].params[0]):t,nt=re?N(D[3].params[0]):t,Me=X?N(D[4].params[0]):t,On=ie?N(D[5].params[0]):t,Xt=J?N(D[0].params[1]):t,Qe=Z?N(D[1].params[1]):t,W=le?N(D[2].params[1]):t,me=re?N(D[3].params[1]):t,m=X?N(D[4].params[1]):t,S=ie?N(D[5].params[1]):t,M=D.map(function(qe){return fe(qe.params,qe.fn)}),z=J?M[0]:r,we=Z?M[1]:r,Te=le?M[2]:r,wt=re?M[3]:r,Bt=X?M[4]:r,en=ie?M[5]:r,er=J?D[0].params.length:-1,jt=Z?D[1].params.length:-1,tr=le?D[2].params.length:-1,nr=re?D[3].params.length:-1,tn=X?D[4].params.length:-1,rr=ie?D[5].params.length:-1,nn=Ve?6:0,ir=D.length,rn=function(){for(var Ze=nn;Ze<ir;Ze++)if(Be[Ze](arguments))return M[Ze].apply(null,arguments);throw F(O,arguments,D)},on=function(Ze,$e){return arguments.length===er&&Xe(Ze)&&Xt($e)?z.apply(null,arguments):arguments.length===jt&&Ie(Ze)&&Qe($e)?we.apply(null,arguments):arguments.length===tr&&mt(Ze)&&W($e)?Te.apply(null,arguments):arguments.length===nr&&nt(Ze)&&me($e)?wt.apply(null,arguments):arguments.length===tn&&Me(Ze)&&m($e)?Bt.apply(null,arguments):arguments.length===rr&&On(Ze)&&S($e)?en.apply(null,arguments):rn.apply(null,arguments)};try{Object.defineProperty(on,"name",{value:O})}catch{}return on.signatures=Q(D),on}function Y(O){return u.ignore.indexOf(O)===-1}function Ue(O){return O.trim()}function Oe(O){return!!O}function We(O){return O!==null}function kt(O){return O.types.length===0}function it(O){return O.slice(0,O.length-1)}function ot(O){return O[O.length-1]}function xt(O,C,L){return Array.prototype.slice.call(O,C,L)}function Mt(O,C){return O.indexOf(C)!==-1}function rt(O,C){for(var L=0;L<O.length;L++)if(Mt(C,O[L]))return!0;return!1}function pt(O,C){for(var L=0;L<O.length;L++)if(C(O[L]))return O[L]}function Pt(O){for(var C={},L=0;L<O.length;L++)C[O[L]]=!0;return Object.keys(C)}function tt(O,C){return Array.prototype.concat.apply([],O.map(C))}function $(O){for(var C="",L=0;L<O.length;L++){var D=O[L];if((typeof D.signatures=="object"||typeof D.signature=="string")&&D.name!==""){if(C==="")C=D.name;else if(C!==D.name){var J=new Error("Function names do not match (expected: "+C+", actual: "+D.name+")");throw J.data={actual:D.name,expected:C},J}}}return C}function Ae(O){var C,L={};function D(re,X){if(L.hasOwnProperty(re)&&X!==L[re])throw C=new Error('Signature "'+re+'" is defined twice'),C.data={signature:re},C}for(var J=0;J<O.length;J++){var Z=O[J];if(typeof Z.signatures=="object")for(var le in Z.signatures)Z.signatures.hasOwnProperty(le)&&(D(le,Z.signatures[le]),L[le]=Z.signatures[le]);else if(typeof Z.signature=="string")D(Z.signature,Z),L[Z.signature]=Z;else throw C=new TypeError("Function is no typed-function (index: "+J+")"),C.data={index:J},C}return L}return u=de("typed",{"string, Object":de,Object:function(O){var C=[];for(var L in O)O.hasOwnProperty(L)&&C.push(O[L]);var D=$(C);return de(D,O)},"...Function":function(O){return de($(O),Ae(O))},"string, ...Function":function(O,C){return de(O,Ae(C))}}),u.create=o,u.types=a,u.conversions=f,u.ignore=s,u.convert=y,u.find=g,u.addType=function(O,C){if(!O||typeof O.name!="string"||typeof O.test!="function")throw new TypeError("Object with properties {name: string, test: function} expected");if(C!==!1){for(var L=0;L<u.types.length;L++)if(u.types[L].name==="Object"){u.types.splice(L,0,O);return}}u.types.push(O)},u.addConversion=function(O){if(!O||typeof O.from!="string"||typeof O.to!="string"||typeof O.convert!="function")throw new TypeError("Object with properties {from: string, to: string, convert: function} expected");u.conversions.push(O)},u}return o()})})(is);var kr={},so;function Tr(){return so||(so=1,function(n){var e=ut;n.isNumber=function(t){return typeof t=="number"},n.isInteger=function(t){return typeof t=="boolean"?!0:isFinite(t)?t===Math.round(t):!1},n.sign=Math.sign||function(t){return t>0?1:t<0?-1:0},n.format=function(t,r){if(typeof r=="function")return r(t);if(t===1/0)return"Infinity";if(t===-1/0)return"-Infinity";if(isNaN(t))return"NaN";var o="auto",a;switch(r&&(r.notation&&(o=r.notation),n.isNumber(r)?a=r:n.isNumber(r.precision)&&(a=r.precision)),o){case"fixed":return n.toFixed(t,a);case"exponential":return n.toExponential(t,a);case"engineering":return n.toEngineering(t,a);case"auto":if(r&&r.exponential&&(r.exponential.lower!==void 0||r.exponential.upper!==void 0)){var l=e.map(r,function(s){return s});return l.exponential=void 0,r.exponential.lower!==void 0&&(l.lowerExp=Math.round(Math.log(r.exponential.lower)/Math.LN10)),r.exponential.upper!==void 0&&(l.upperExp=Math.round(Math.log(r.exponential.upper)/Math.LN10)),console.warn("Deprecation warning: Formatting options exponential.lower and exponential.upper (minimum and maximum value) are replaced with exponential.lowerExp and exponential.upperExp (minimum and maximum exponent) since version 4.0.0. Replace "+JSON.stringify(r)+" with "+JSON.stringify(l)),n.toPrecision(t,a,l)}return n.toPrecision(t,a,r&&r).replace(/((\.\d*?)(0+))($|e)/,function(){var s=arguments[2],f=arguments[4];return s!=="."?s+f:f});default:throw new Error('Unknown notation "'+o+'". Choose "auto", "exponential", or "fixed".')}},n.splitNumber=function(t){var r=String(t).toLowerCase().match(/^0*?(-?)(\d+\.?\d*)(e([+-]?\d+))?$/);if(!r)throw new SyntaxError("Invalid number "+t);var o=r[1],a=r[2],l=parseFloat(r[4]||"0"),s=a.indexOf(".");l+=s!==-1?s-1:a.length-1;var f=a.replace(".","").replace(/^0*/,function(u){return l-=u.length,""}).replace(/0*$/,"").split("").map(function(u){return parseInt(u)});return f.length===0&&(f.push(0),l++),{sign:o,coefficients:f,exponent:l}},n.toEngineering=function(t,r){if(isNaN(t)||!isFinite(t))return String(t);var o=n.roundDigits(n.splitNumber(t),r),a=o.exponent,l=o.coefficients,s=a%3===0?a:a<0?a-3-a%3:a-a%3;if(n.isNumber(r))for(;r>l.length||a-s+1>l.length;)l.push(0);else for(var f=a>=0?a:Math.abs(s);l.length-1<f;)l.push(0);for(var u=Math.abs(a-s),c=1;u>0;)c++,u--;var h=l.slice(c).join(""),p=n.isNumber(r)&&h.length||h.match(/[1-9]/)?"."+h:"",g=l.slice(0,c).join("")+p+"e"+(a>=0?"+":"")+s.toString();return o.sign+g},n.toFixed=function(t,r){if(isNaN(t)||!isFinite(t))return String(t);var o=n.splitNumber(t),a=typeof r=="number"?n.roundDigits(o,o.exponent+1+r):o,l=a.coefficients,s=a.exponent+1,f=s+(r||0);return l.length<f&&(l=l.concat(i(f-l.length))),s<0&&(l=i(-s+1).concat(l),s=1),s<l.length&&l.splice(s,0,s===0?"0.":"."),a.sign+l.join("")},n.toExponential=function(t,r){if(isNaN(t)||!isFinite(t))return String(t);var o=n.splitNumber(t),a=r?n.roundDigits(o,r):o,l=a.coefficients,s=a.exponent;l.length<r&&(l=l.concat(i(r-l.length)));var f=l.shift();return a.sign+f+(l.length>0?"."+l.join(""):"")+"e"+(s>=0?"+":"")+s},n.toPrecision=function(t,r,o){if(isNaN(t)||!isFinite(t))return String(t);var a=o&&o.lowerExp!==void 0?o.lowerExp:-3,l=o&&o.upperExp!==void 0?o.upperExp:5,s=n.splitNumber(t);if(s.exponent<a||s.exponent>=l)return n.toExponential(t,r);var f=r?n.roundDigits(s,r):s,u=f.coefficients,c=f.exponent;u.length<r&&(u=u.concat(i(r-u.length))),u=u.concat(i(c-u.length+1+(u.length<r?r-u.length:0))),u=i(-c).concat(u);var h=c>0?c:0;return h<u.length-1&&u.splice(h+1,0,"."),f.sign+u.join("")},n.roundDigits=function(t,r){for(var o={sign:t.sign,coefficients:t.coefficients,exponent:t.exponent},a=o.coefficients;r<=0;)a.unshift(0),o.exponent++,r++;if(a.length>r){var l=a.splice(r,a.length-r);if(l[0]>=5){var s=r-1;for(a[s]++;a[s]===10;)a.pop(),s===0&&(a.unshift(0),o.exponent++,s++),s--,a[s]++}}return o};function i(t){for(var r=[],o=0;o<t;o++)r.push(0);return r}n.digits=function(t){return t.toExponential().replace(/e.*$/,"").replace(/^0\.?0*|\./,"").length},n.DBL_EPSILON=Number.EPSILON||2220446049250313e-31,n.nearlyEqual=function(t,r,o){if(o==null)return t===r;if(t===r)return!0;if(isNaN(t)||isNaN(r))return!1;if(isFinite(t)&&isFinite(r)){var a=Math.abs(t-r);return a<n.DBL_EPSILON?!0:a<=Math.max(Math.abs(t),Math.abs(r))*o}return!1}}(kr)),kr}var bf=function(e){return e&&e.constructor.prototype.isMatrix||!1};function _r(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_r=function(i){return typeof i}:_r=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_r(n)}var lo=is.exports,wf=Tr().digits,Ef=_i(),Nf=bf,os=function(){return os=lo.create,lo};rs.create=function(e){e.isNumber=function(t){return typeof t=="number"},e.isComplex=function(t){return e.Complex&&t instanceof e.Complex||!1},e.isBigNumber=Ef,e.isFraction=function(t){return e.Fraction&&t instanceof e.Fraction||!1},e.isUnit=function(t){return t&&t.constructor.prototype.isUnit||!1},e.isString=function(t){return typeof t=="string"},e.isArray=Array.isArray,e.isMatrix=Nf,e.isDenseMatrix=function(t){return t&&t.isDenseMatrix&&t.constructor.prototype.isMatrix||!1},e.isSparseMatrix=function(t){return t&&t.isSparseMatrix&&t.constructor.prototype.isMatrix||!1},e.isRange=function(t){return t&&t.constructor.prototype.isRange||!1},e.isIndex=function(t){return t&&t.constructor.prototype.isIndex||!1},e.isBoolean=function(t){return typeof t=="boolean"},e.isResultSet=function(t){return t&&t.constructor.prototype.isResultSet||!1},e.isHelp=function(t){return t&&t.constructor.prototype.isHelp||!1},e.isFunction=function(t){return typeof t=="function"},e.isDate=function(t){return t instanceof Date},e.isRegExp=function(t){return t instanceof RegExp},e.isObject=function(t){return _r(t)==="object"&&t.constructor===Object&&!e.isComplex(t)&&!e.isFraction(t)},e.isNull=function(t){return t===null},e.isUndefined=function(t){return t===void 0},e.isAccessorNode=function(t){return t&&t.isAccessorNode&&t.constructor.prototype.isNode||!1},e.isArrayNode=function(t){return t&&t.isArrayNode&&t.constructor.prototype.isNode||!1},e.isAssignmentNode=function(t){return t&&t.isAssignmentNode&&t.constructor.prototype.isNode||!1},e.isBlockNode=function(t){return t&&t.isBlockNode&&t.constructor.prototype.isNode||!1},e.isConditionalNode=function(t){return t&&t.isConditionalNode&&t.constructor.prototype.isNode||!1},e.isConstantNode=function(t){return t&&t.isConstantNode&&t.constructor.prototype.isNode||!1},e.isFunctionAssignmentNode=function(t){return t&&t.isFunctionAssignmentNode&&t.constructor.prototype.isNode||!1},e.isFunctionNode=function(t){return t&&t.isFunctionNode&&t.constructor.prototype.isNode||!1},e.isIndexNode=function(t){return t&&t.isIndexNode&&t.constructor.prototype.isNode||!1},e.isNode=function(t){return t&&t.isNode&&t.constructor.prototype.isNode||!1},e.isObjectNode=function(t){return t&&t.isObjectNode&&t.constructor.prototype.isNode||!1},e.isOperatorNode=function(t){return t&&t.isOperatorNode&&t.constructor.prototype.isNode||!1},e.isParenthesisNode=function(t){return t&&t.isParenthesisNode&&t.constructor.prototype.isNode||!1},e.isRangeNode=function(t){return t&&t.isRangeNode&&t.constructor.prototype.isNode||!1},e.isSymbolNode=function(t){return t&&t.isSymbolNode&&t.constructor.prototype.isNode||!1},e.isChain=function(t){return t&&t.constructor.prototype.isChain||!1};var i=os();return i.types=[{name:"number",test:e.isNumber},{name:"Complex",test:e.isComplex},{name:"BigNumber",test:e.isBigNumber},{name:"Fraction",test:e.isFraction},{name:"Unit",test:e.isUnit},{name:"string",test:e.isString},{name:"Array",test:e.isArray},{name:"Matrix",test:e.isMatrix},{name:"DenseMatrix",test:e.isDenseMatrix},{name:"SparseMatrix",test:e.isSparseMatrix},{name:"Range",test:e.isRange},{name:"Index",test:e.isIndex},{name:"boolean",test:e.isBoolean},{name:"ResultSet",test:e.isResultSet},{name:"Help",test:e.isHelp},{name:"function",test:e.isFunction},{name:"Date",test:e.isDate},{name:"RegExp",test:e.isRegExp},{name:"null",test:e.isNull},{name:"undefined",test:e.isUndefined},{name:"OperatorNode",test:e.isOperatorNode},{name:"ConstantNode",test:e.isConstantNode},{name:"SymbolNode",test:e.isSymbolNode},{name:"ParenthesisNode",test:e.isParenthesisNode},{name:"FunctionNode",test:e.isFunctionNode},{name:"FunctionAssignmentNode",test:e.isFunctionAssignmentNode},{name:"ArrayNode",test:e.isArrayNode},{name:"AssignmentNode",test:e.isAssignmentNode},{name:"BlockNode",test:e.isBlockNode},{name:"ConditionalNode",test:e.isConditionalNode},{name:"IndexNode",test:e.isIndexNode},{name:"RangeNode",test:e.isRangeNode},{name:"Node",test:e.isNode},{name:"Object",test:e.isObject}],i.conversions=[{from:"number",to:"BigNumber",convert:function(r){if(wf(r)>15)throw new TypeError("Cannot implicitly convert a number with >15 significant digits to BigNumber (value: "+r+"). Use function bignumber(x) to convert to BigNumber.");return new e.BigNumber(r)}},{from:"number",to:"Complex",convert:function(r){return new e.Complex(r,0)}},{from:"number",to:"string",convert:function(r){return r+""}},{from:"BigNumber",to:"Complex",convert:function(r){return new e.Complex(r.toNumber(),0)}},{from:"Fraction",to:"BigNumber",convert:function(r){throw new TypeError("Cannot implicitly convert a Fraction to BigNumber or vice versa. Use function bignumber(x) to convert to BigNumber or fraction(x) to convert to Fraction.")}},{from:"Fraction",to:"Complex",convert:function(r){return new e.Complex(r.valueOf(),0)}},{from:"number",to:"Fraction",convert:function(r){var o=new e.Fraction(r);if(o.valueOf()!==r)throw new TypeError("Cannot implicitly convert a number to a Fraction when there will be a loss of precision (value: "+r+"). Use function fraction(x) to convert to Fraction.");return new e.Fraction(r)}},{from:"string",to:"number",convert:function(r){var o=Number(r);if(isNaN(o))throw new Error('Cannot convert "'+r+'" to a number');return o}},{from:"string",to:"BigNumber",convert:function(r){try{return new e.BigNumber(r)}catch{throw new Error('Cannot convert "'+r+'" to BigNumber')}}},{from:"string",to:"Fraction",convert:function(r){try{return new e.Fraction(r)}catch{throw new Error('Cannot convert "'+r+'" to Fraction')}}},{from:"string",to:"Complex",convert:function(r){try{return new e.Complex(r)}catch{throw new Error('Cannot convert "'+r+'" to Complex')}}},{from:"boolean",to:"number",convert:function(r){return+r}},{from:"boolean",to:"BigNumber",convert:function(r){return new e.BigNumber(+r)}},{from:"boolean",to:"Fraction",convert:function(r){return new e.Fraction(+r)}},{from:"boolean",to:"string",convert:function(r){return+r}},{from:"Array",to:"Matrix",convert:function(r){return new e.DenseMatrix(r)}},{from:"Matrix",to:"Array",convert:function(r){return r.valueOf()}}],i};var as={},bi={exports:{}};function wi(){}wi.prototype={on:function(n,e,i){var t=this.e||(this.e={});return(t[n]||(t[n]=[])).push({fn:e,ctx:i}),this},once:function(n,e,i){var t=this;function r(){t.off(n,r),e.apply(i,arguments)}return r._=e,this.on(n,r,i)},emit:function(n){var e=[].slice.call(arguments,1),i=((this.e||(this.e={}))[n]||[]).slice(),t=0,r=i.length;for(t;t<r;t++)i[t].fn.apply(i[t].ctx,e);return this},off:function(n,e){var i=this.e||(this.e={}),t=i[n],r=[];if(t&&e)for(var o=0,a=t.length;o<a;o++)t[o].fn!==e&&t[o].fn._!==e&&r.push(t[o]);return r.length?i[n]=r:delete i[n],this}};bi.exports=wi;bi.exports.TinyEmitter=wi;var Sf=bi.exports;as.mixin=function(n){var e=new Sf;return n.on=e.on.bind(e),n.off=e.off.bind(e),n.once=e.once.bind(e),n.emit=e.emit.bind(e),n};var $n={},Dr,uo;function ss(){if(uo)return Dr;uo=1;function n(e,i,t,r){if(!(this instanceof n))throw new SyntaxError("Constructor must be called with the new operator");this.fn=e,this.count=i,this.min=t,this.max=r,this.message="Wrong number of arguments in function "+e+" ("+i+" provided, "+t+(r!=null?"-"+r:"")+" expected)",this.stack=new Error().stack}return n.prototype=new Error,n.prototype.constructor=Error,n.prototype.name="ArgumentsError",n.prototype.isArgumentsError=!0,Dr=n,Dr}function Xn(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Xn=function(i){return typeof i}:Xn=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Xn(n)}var fo=ut.lazy,co=ut.isFactory,xf=ut.traverse,If=ss();function Of(n,e,i,t,r){function o(d,_){var v=arguments.length;if(v!==1&&v!==2)throw new If("import",v,1,2);if(_||(_={}),co(d))u(d,_);else if(Array.isArray(d))d.forEach(function(N){o(N,_)});else if(Xn(d)==="object"){for(var E in d)if(d.hasOwnProperty(E)){var b=d[E];c(b)?a(E,b,_):co(d)?u(d,_):o(b,_)}}else if(!_.silent)throw new TypeError("Factory, Object, or Array expected")}function a(d,_,v){if(v.wrap&&typeof _=="function"&&(_=f(_)),h(r[d])&&h(_)){v.override?_=t(d,_.signatures):_=t(r[d],_),r[d]=_,l(d,_),r.emit("import",d,function(){return _});return}if(r[d]===void 0||v.override){r[d]=_,l(d,_),r.emit("import",d,function(){return _});return}if(!v.silent)throw new Error('Cannot import "'+d+'": already exists')}function l(d,_){_&&typeof _.transform=="function"?(r.expression.transform[d]=_.transform,p(d)&&(r.expression.mathWithTransform[d]=_.transform)):(delete r.expression.transform[d],p(d)&&(r.expression.mathWithTransform[d]=_))}function s(d){delete r.expression.transform[d],p(d)?r.expression.mathWithTransform[d]=r[d]:delete r.expression.mathWithTransform[d]}function f(d){var _=function(){for(var E=[],b=0,N=arguments.length;b<N;b++){var T=arguments[b];E[b]=T&&T.valueOf()}return d.apply(r,E)};return d.transform&&(_.transform=d.transform),_}function u(d,_){if(typeof d.name=="string"){var v=d.name,E=v in r.expression.transform,b=d.path?xf(r,d.path):r,N=b.hasOwnProperty(v)?b[v]:void 0,T=function(){var I=i(d);if(I&&typeof I.transform=="function")throw new Error('Transforms cannot be attached to factory functions. Please create a separate function for it with exports.path="expression.transform"');if(h(N)&&h(I))return _.override||(I=t(N,I)),I;if(N===void 0||_.override)return I;if(!_.silent)throw new Error('Cannot import "'+v+'": already exists')};d.lazy!==!1?(fo(b,v,T),E?s(v):(d.path==="expression.transform"||g(d))&&fo(r.expression.mathWithTransform,v,T)):(b[v]=T(),E?s(v):(d.path==="expression.transform"||g(d))&&(r.expression.mathWithTransform[v]=T())),r.emit("import",v,T,d.path)}else i(d)}function c(d){return typeof d=="function"||typeof d=="number"||typeof d=="string"||typeof d=="boolean"||d===null||d&&n.isUnit(d)||d&&n.isComplex(d)||d&&n.isBigNumber(d)||d&&n.isFraction(d)||d&&n.isMatrix(d)||d&&Array.isArray(d)}function h(d){return typeof d=="function"&&Xn(d.signatures)==="object"}function p(d){return!y.hasOwnProperty(d)}function g(d){return d.path===void 0&&!y.hasOwnProperty(d.name)}var y={expression:!0,type:!0,docs:!0,error:!0,json:!0,chain:!0};return o}$n.math=!0;$n.name="import";$n.factory=Of;$n.lazy=!0;var Ar={},Dt=ut;function Tf(n,e,i,t,r){var o=["Matrix","Array"],a=["number","BigNumber","Fraction"];function l(s){if(s){var f=Dt.map(e,Dt.clone);ho(s,"matrix",o),ho(s,"number",a),Dt.deepExtend(e,s);var u=Dt.map(e,Dt.clone),c=Dt.map(s,Dt.clone);return r.emit("config",u,f,c),u}else return Dt.map(e,Dt.clone)}return l.MATRIX=o,l.NUMBER=a,l}function Af(n,e){return n.indexOf(e)!==-1}function Rf(n,e){return n.map(function(i){return i.toLowerCase()}).indexOf(e.toLowerCase())}function ho(n,e,i){if(n[e]!==void 0&&!Af(i,n[e])){var t=Rf(i,n[e]);t!==-1?(console.warn('Warning: Wrong casing for configuration option "'+e+'", should be "'+i[t]+'" instead of "'+n[e]+'".'),n[e]=i[t]):console.warn('Warning: Unknown value "'+n[e]+'" for configuration option "'+e+'". Available options: '+i.map(JSON.stringify).join(", ")+".")}}Ar.name="config";Ar.math=!0;Ar.factory=Tf;var Mf=ut.isFactory,Pf=rs,kf=as,Df=$n,Cf=Ar;ns.create=function(e){if(typeof Object.create!="function")throw new Error("ES5 not supported by this JavaScript engine. Please load the es5-shim and es5-sham library for compatibility.");var i=[],t=[],r=kf.mixin({});r.type={},r.expression={transform:{},mathWithTransform:{}},r.typed=Pf.create(r.type);var o={epsilon:1e-12,matrix:"Matrix",number:"number",precision:64,predictable:!1,randomSeed:null};function a(l){if(!Mf(l))throw new Error("Factory object with properties `type`, `name`, and `factory` expected");var s=i.indexOf(l),f;return s===-1?(l.math===!0?f=l.factory(r.type,o,a,r.typed,r):f=l.factory(r.type,o,a,r.typed),i.push(l),t.push(f)):f=t[s],f}return r.import=a(Df),r.config=a(Cf),r.expression.mathWithTransform.config=r.config,e&&r.config(e),r};(function(n){n.exports=ns})(ts);var ar={},Tn={},Cr,po;function Nn(){return po||(po=1,Cr=function n(e,i,t){return e&&typeof e.map=="function"?e.map(function(r){return n(r,i)}):i(e)}),Cr}var An={},sr={},mo;function Ei(){if(mo)return sr;mo=1;function n(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?n=function(r){return typeof r}:n=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},n(i)}function e(i,t,r,o){var a=o("_typeof",{any:function(s){var f=n(s);return f==="object"?s===null?"null":Array.isArray(s)?"Array":s instanceof Date?"Date":s instanceof RegExp?"RegExp":i.isBigNumber(s)?"BigNumber":i.isComplex(s)?"Complex":i.isFraction(s)?"Fraction":i.isMatrix(s)?"Matrix":i.isUnit(s)?"Unit":i.isIndex(s)?"Index":i.isRange(s)?"Range":i.isResultSet(s)?"ResultSet":i.isNode(s)?s.type:i.isChain(s)?"Chain":i.isHelp(s)?"Help":"Object":f==="function"?"Function":f}});return a.toTex=void 0,a}return sr.name="typeof",sr.factory=e,sr}var lr={},go;function Lf(){if(go)return lr;go=1;var n=Nn();function e(i,t,r,o){var a=o("number",{"":function(){return 0},number:function(s){return s},string:function(s){if(s==="NaN")return NaN;var f=Number(s);if(isNaN(f))throw new SyntaxError('String "'+s+'" is no valid number');return f},BigNumber:function(s){return s.toNumber()},Fraction:function(s){return s.valueOf()},Unit:function(s){throw new Error("Second argument with valueless unit expected")},null:function(s){return 0},"Unit, string | Unit":function(s,f){return s.toNumber(f)},"Array | Matrix":function(s){return n(s,a)}});return a.toTex={0:"0",1:"\\left(${args[0]}\\right)",2:"\\left(\\left(${args[0]}\\right)${args[1]}\\right)"},a}return lr.name="number",lr.factory=e,lr}var ur={},vo;function Ff(){if(vo)return ur;vo=1;var n=Nn();function e(i,t,r,o){var a=o("bignumber",{"":function(){return new i.BigNumber(0)},number:function(s){return new i.BigNumber(s+"")},string:function(s){return new i.BigNumber(s)},BigNumber:function(s){return s},Fraction:function(s){return new i.BigNumber(s.n).div(s.d).times(s.s)},null:function(s){return new i.BigNumber(0)},"Array | Matrix":function(s){return n(s,a)}});return a.toTex={0:"0",1:"\\left(${args[0]}\\right)"},a}return ur.name="bignumber",ur.factory=e,ur}var fr={},yo;function Uf(){if(yo)return fr;yo=1;var n=Nn();function e(i,t,r,o){var a=o("fraction",{number:function(s){if(!isFinite(s)||isNaN(s))throw new Error(s+" cannot be represented as a fraction");return new i.Fraction(s)},string:function(s){return new i.Fraction(s)},"number, number":function(s,f){return new i.Fraction(s,f)},null:function(s){return new i.Fraction(0)},BigNumber:function(s){return new i.Fraction(s.toString())},Fraction:function(s){return s},Object:function(s){return new i.Fraction(s)},"Array | Matrix":function(s){return n(s,a)}});return a}return fr.name="fraction",fr.factory=e,fr}var _o;function Bf(){if(_o)return An;_o=1;function n(e,i,t,r){var o=t(Ei()),a={string:!0,number:!0,BigNumber:!0,Fraction:!0},l={number:t(Lf()),BigNumber:t(Ff()),Fraction:t(Uf())},s=function(u,c){var h=o(u);if(!(h in a))throw new TypeError("Cannot convert "+u+' of type "'+h+'"; valid input types are '+Object.keys(a).join(", "));if(!(c in l))throw new TypeError("Cannot convert "+u+' to type "'+c+'"; valid output types are '+Object.keys(l).join(", "));return c===h?u:l[c](u)};return s.toTex=function(f,u){return f.args[0].toTex()},s}return An.path="type",An.name="_numeric",An.factory=n,An}var Rn={},Gt={},bo;function ft(){if(bo)return Gt;bo=1;function n(u){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?n=function(h){return typeof h}:n=function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},n(u)}var e=ut.hasOwnProperty;function i(u,c){if(l(u)&&r(u,c))return u[c];throw typeof u[c]=="function"&&a(u,c)?new Error('Cannot access method "'+c+'" as a property'):new Error('No access to property "'+c+'"')}function t(u,c,h){if(l(u)&&r(u,c))return u[c]=h,h;throw new Error('No access to property "'+c+'"')}function r(u,c){return!u||n(u)!=="object"?!1:e(s,c)?!0:!(c in Object.prototype||c in Function.prototype)}function o(u,c){if(!a(u,c))throw new Error('No access to method "'+c+'"')}function a(u,c){return!u||typeof u[c]!="function"||e(u,c)&&Object.getPrototypeOf&&c in Object.getPrototypeOf(u)?!1:e(f,c)?!0:!(c in Object.prototype||c in Function.prototype)}function l(u){return n(u)==="object"&&u&&u.constructor===Object}var s={length:!0,name:!0},f={toString:!0,valueOf:!0,toLocaleString:!0};return Gt.getSafeProperty=i,Gt.setSafeProperty=t,Gt.isSafeProperty=r,Gt.validateSafeMethod=o,Gt.isSafeMethod=a,Gt.isPlainObject=l,Gt}var ln={},Lr,wo;function ls(){return wo||(wo=1,Lr={end:!0}),Lr}var Eo;function ct(){if(Eo)return ln;Eo=1;function n(o){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?n=function(l){return typeof l}:n=function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l},n(o)}var e=ls(),i=ut.deepEqual,t=ut.hasOwnProperty;function r(o,a,l,s,f){function u(){if(!(this instanceof u))throw new SyntaxError("Constructor must be called with the new operator")}u.prototype.eval=function(h){return this.compile().eval(h)},u.prototype.type="Node",u.prototype.isNode=!0,u.prototype.comment="",u.prototype.compile=function(){var h=this._compile(f.expression.mathWithTransform,{}),p={},g=null;return{eval:function(d){var _=d||{};return c(_),h(_,p,g)}}},u.prototype._compile=function(h,p){throw new Error("Method _compile should be implemented by type "+this.type)},u.prototype.forEach=function(h){throw new Error("Cannot run forEach on a Node interface")},u.prototype.map=function(h){throw new Error("Cannot run map on a Node interface")},u.prototype._ifNode=function(h){if(!o.isNode(h))throw new TypeError("Callback function must return a Node");return h},u.prototype.traverse=function(h){h(this,null,null);function p(g,y){g.forEach(function(d,_,v){y(d,_,v),p(d,y)})}p(this,h)},u.prototype.transform=function(h){function p(y,d){return y.map(function(_,v,E){var b=d(_,v,E);return p(b,d)})}var g=h(this,null,null);return p(g,h)},u.prototype.filter=function(h){var p=[];return this.traverse(function(g,y,d){h(g,y,d)&&p.push(g)}),p},u.prototype.find=function(){throw new Error("Function Node.find is deprecated. Use Node.filter instead.")},u.prototype.match=function(){throw new Error("Function Node.match is deprecated. See functions Node.filter, Node.transform, Node.traverse.")},u.prototype.clone=function(){throw new Error("Cannot clone a Node interface")},u.prototype.cloneDeep=function(){return this.map(function(h){return h.cloneDeep()})},u.prototype.equals=function(h){return h?i(this,h):!1},u.prototype.toString=function(h){var p;if(h&&n(h)==="object")switch(n(h.handler)){case"object":case"undefined":break;case"function":p=h.handler(this,h);break;default:throw new TypeError("Object or function expected as callback")}return typeof p<"u"?p:this._toString(h)},u.prototype.toJSON=function(){throw new Error("Cannot serialize object: toJSON not implemented by "+this.type)},u.prototype.toHTML=function(h){var p;if(h&&n(h)==="object")switch(n(h.handler)){case"object":case"undefined":break;case"function":p=h.handler(this,h);break;default:throw new TypeError("Object or function expected as callback")}return typeof p<"u"?p:this.toHTML(h)},u.prototype._toString=function(){throw new Error("_toString not implemented for "+this.type)},u.prototype.toTex=function(h){var p;if(h&&n(h)==="object")switch(n(h.handler)){case"object":case"undefined":break;case"function":p=h.handler(this,h);break;default:throw new TypeError("Object or function expected as callback")}return typeof p<"u"?p:this._toTex(h)},u.prototype._toTex=function(h){throw new Error("_toTex not implemented for "+this.type)},u.prototype.getIdentifier=function(){return this.type},u.prototype.getContent=function(){return this};function c(h){for(var p in h)if(t(h,p)&&p in e)throw new Error('Scope contains an illegal symbol, "'+p+'" is a reserved keyword')}return u}return ln.name="Node",ln.path="expression.node",ln.math=!0,ln.factory=r,ln}var Fr={},Ur={},Br,No;function us(){if(No)return Br;No=1;function n(e,i,t){if(!(this instanceof n))throw new SyntaxError("Constructor must be called with the new operator");this.index=e,arguments.length<3?(this.min=0,this.max=i):(this.min=i,this.max=t),this.min!==void 0&&this.index<this.min?this.message="Index out of range ("+this.index+" < "+this.min+")":this.max!==void 0&&this.index>=this.max?this.message="Index out of range ("+this.index+" > "+(this.max-1)+")":this.message="Index out of range ("+this.index+")",this.stack=new Error().stack}return n.prototype=new RangeError,n.prototype.constructor=RangeError,n.prototype.name="IndexError",n.prototype.isIndexError=!0,Br=n,Br}var So;function fs(){if(So)return Ur;So=1;var n=us();return Ur.transform=function(e){return e&&e.isIndexError?new n(e.index+1,e.min+1,e.max!==void 0?e.max+1:void 0):e},Ur}var cr={},et={},jr={},Vr={},xo;function jf(){return xo||(xo=1,function(n){var e=ut;n.format=function(i,t){if(typeof t=="function")return t(i);if(!i.isFinite())return i.isNaN()?"NaN":i.gt(0)?"Infinity":"-Infinity";var r="auto",o;switch(t!==void 0&&(t.notation&&(r=t.notation),typeof t=="number"?o=t:t.precision&&(o=t.precision)),r){case"fixed":return n.toFixed(i,o);case"exponential":return n.toExponential(i,o);case"engineering":return n.toEngineering(i,o);case"auto":if(t&&t.exponential&&(t.exponential.lower!==void 0||t.exponential.upper!==void 0)){var a=e.map(t,function(c){return c});return a.exponential=void 0,t.exponential.lower!==void 0&&(a.lowerExp=Math.round(Math.log(t.exponential.lower)/Math.LN10)),t.exponential.upper!==void 0&&(a.upperExp=Math.round(Math.log(t.exponential.upper)/Math.LN10)),console.warn("Deprecation warning: Formatting options exponential.lower and exponential.upper (minimum and maximum value) are replaced with exponential.lowerExp and exponential.upperExp (minimum and maximum exponent) since version 4.0.0. Replace "+JSON.stringify(t)+" with "+JSON.stringify(a)),n.format(i,a)}var l=t&&t.lowerExp!==void 0?t.lowerExp:-3,s=t&&t.upperExp!==void 0?t.upperExp:5;if(i.isZero())return"0";var f,u=i.e;return u>=l&&u<s?f=i.toSignificantDigits(o).toFixed():f=n.toExponential(i,o),f.replace(/((\.\d*?)(0+))($|e)/,function(){var c=arguments[2],h=arguments[4];return c!=="."?c+h:h});default:throw new Error('Unknown notation "'+r+'". Choose "auto", "exponential", or "fixed".')}},n.toEngineering=function(i,t){var r=i.e,o=r%3===0?r:r<0?r-3-r%3:r-r%3,a=i.mul(Math.pow(10,-o)),l=a.toPrecision(t);return l.indexOf("e")!==-1&&(l=a.toString()),l+"e"+(r>=0?"+":"")+o.toString()},n.toExponential=function(i,t){return t!==void 0?i.toExponential(t-1):i.toExponential()},n.toFixed=function(i,t){return i.toFixed(t)}}(Vr)),Vr}var Io;function Rt(){return Io||(Io=1,function(n){function e(l){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?e=function(f){return typeof f}:e=function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},e(l)}var i=Tr().format,t=jf().format,r=_i();n.isString=function(l){return typeof l=="string"},n.endsWith=function(l,s){var f=l.length-s.length,u=l.length;return l.substring(f,u)===s},n.format=function(l,s){if(typeof l=="number")return i(l,s);if(r(l))return t(l,s);if(a(l))return!s||s.fraction!=="decimal"?l.s*l.n+"/"+l.d:l.toString();if(Array.isArray(l))return o(l,s);if(n.isString(l))return'"'+l+'"';if(typeof l=="function")return l.syntax?String(l.syntax):"function";if(l&&e(l)==="object"){if(typeof l.format=="function")return l.format(s);if(l&&l.toString()!=={}.toString())return l.toString();var f=[];for(var u in l)l.hasOwnProperty(u)&&f.push('"'+u+'": '+n.format(l[u],s));return"{"+f.join(", ")+"}"}return String(l)},n.stringify=function(l){for(var s=String(l),f="",u=0;u<s.length;){var c=s.charAt(u);c==="\\"?(f+=c,u++,c=s.charAt(u),(c===""||'"\\/bfnrtu'.indexOf(c)===-1)&&(f+="\\"),f+=c):c==='"'?f+='\\"':f+=c,u++}return'"'+f+'"'},n.escape=function(l){var s=String(l);return s=s.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),s};function o(l,s){if(Array.isArray(l)){for(var f="[",u=l.length,c=0;c<u;c++)c!==0&&(f+=", "),f+=o(l[c],s);return f+="]",f}else return n.format(l,s)}function a(l){return l&&e(l)==="object"&&typeof l.s=="number"&&typeof l.n=="number"&&typeof l.d=="number"||!1}}(jr)),jr}var Gr,Oo;function cs(){if(Oo)return Gr;Oo=1;function n(e,i,t){if(!(this instanceof n))throw new SyntaxError("Constructor must be called with the new operator");this.actual=e,this.expected=i,this.relation=t,this.message="Dimension mismatch ("+(Array.isArray(e)?"["+e.join(", ")+"]":e)+" "+(this.relation||"!=")+" "+(Array.isArray(i)?"["+i.join(", ")+"]":i)+")",this.stack=new Error().stack}return n.prototype=new RangeError,n.prototype.constructor=RangeError,n.prototype.name="DimensionError",n.prototype.isDimensionError=!0,Gr=n,Gr}var To;function Ut(){if(To)return et;To=1,Object.defineProperty(et,"__esModule",{value:!0}),et.size=o,et.validate=l,et.validateIndex=s,et.resize=f,et.reshape=c,et.squeeze=p,et.unsqueeze=y,et.flatten=_,et.map=v,et.forEach=E,et.filter=b,et.filterRegExp=N,et.join=T,et.identify=k,et.generalize=I;var n=r(Tr()),e=r(Rt()),i=r(cs()),t=r(us());function r(w){return w&&w.__esModule?w:{default:w}}function o(w){for(var x=[];Array.isArray(w);)x.push(w.length),w=w[0];return x}function a(w,x,B){var F,j=w.length;if(j!==x[B])throw new i.default(j,x[B]);if(B<x.length-1){var H=B+1;for(F=0;F<j;F++){var K=w[F];if(!Array.isArray(K))throw new i.default(x.length-1,x.length,"<");a(w[F],x,H)}}else for(F=0;F<j;F++)if(Array.isArray(w[F]))throw new i.default(x.length+1,x.length,">")}function l(w,x){var B=x.length===0;if(B){if(Array.isArray(w))throw new i.default(w.length,0)}else a(w,x,0)}function s(w,x){if(!n.default.isNumber(w)||!n.default.isInteger(w))throw new TypeError("Index must be an integer (value: "+w+")");if(w<0||typeof x=="number"&&w>=x)throw new t.default(w,x)}function f(w,x,B){if(!Array.isArray(w)||!Array.isArray(x))throw new TypeError("Array expected");if(x.length===0)throw new Error("Resizing to scalar is not supported");x.forEach(function(j){if(!n.default.isNumber(j)||!n.default.isInteger(j)||j<0)throw new TypeError("Invalid size, must contain positive integers (size: "+e.default.format(x)+")")});var F=B!==void 0?B:0;return u(w,x,0,F),w}function u(w,x,B,F){var j,H,K=w.length,U=x[B],ee=Math.min(K,U);if(w.length=U,B<x.length-1){var fe=B+1;for(j=0;j<ee;j++)H=w[j],Array.isArray(H)||(H=[H],w[j]=H),u(H,x,fe,F);for(j=ee;j<U;j++)H=[],w[j]=H,u(H,x,fe,F)}else{for(j=0;j<ee;j++)for(;Array.isArray(w[j]);)w[j]=w[j][0];for(j=ee;j<U;j++)w[j]=F}}function c(w,x){var B=_(w),F;function j(U){return U.reduce(function(ee,fe){return ee*fe})}if(!Array.isArray(w)||!Array.isArray(x))throw new TypeError("Array expected");if(x.length===0)throw new i.default(0,j(o(w)),"!=");for(var H=1,K=0;K<x.length;K++)H*=x[K];if(B.length!==H)throw new i.default(j(x),j(o(w)),"!=");try{F=h(B,x)}catch(U){throw U instanceof i.default?new i.default(j(x),j(o(w)),"!="):U}return F}function h(w,x){for(var B=w,F,j=x.length-1;j>0;j--){var H=x[j];F=[];for(var K=B.length/H,U=0;U<K;U++)F.push(B.slice(U*H,(U+1)*H));B=F}return B}function p(w,x){for(var B=x||o(w);Array.isArray(w)&&w.length===1;)w=w[0],B.shift();for(var F=B.length;B[F-1]===1;)F--;return F<B.length&&(w=g(w,F,0),B.length=F),w}function g(w,x,B){var F,j;if(B<x){var H=B+1;for(F=0,j=w.length;F<j;F++)w[F]=g(w[F],x,H)}else for(;Array.isArray(w);)w=w[0];return w}function y(w,x,B,F){var j=F||o(w);if(B)for(var H=0;H<B;H++)w=[w],j.unshift(1);for(w=d(w,x,0);j.length<x;)j.push(1);return w}function d(w,x,B){var F,j;if(Array.isArray(w)){var H=B+1;for(F=0,j=w.length;F<j;F++)w[F]=d(w[F],x,H)}else for(var K=B;K<x;K++)w=[w];return w}function _(w){if(!Array.isArray(w))return w;var x=[];return w.forEach(function B(F){Array.isArray(F)?F.forEach(B):x.push(F)}),x}function v(w,x){return Array.prototype.map.call(w,x)}function E(w,x){Array.prototype.forEach.call(w,x)}function b(w,x){if(o(w).length!==1)throw new Error("Only one dimensional matrices supported");return Array.prototype.filter.call(w,x)}function N(w,x){if(o(w).length!==1)throw new Error("Only one dimensional matrices supported");return Array.prototype.filter.call(w,function(B){return x.test(B)})}function T(w,x){return Array.prototype.join.call(w,x)}function k(w){if(!Array.isArray(w))throw new TypeError("Array input expected");if(w.length===0)return w;var x=[],B=0;x[0]={value:w[0],identifier:0};for(var F=1;F<w.length;F++)w[F]===w[F-1]?B++:B=0,x.push({value:w[F],identifier:B});return x}function I(w){if(!Array.isArray(w))throw new TypeError("Array input expected");if(w.length===0)return w;for(var x=[],B=0;B<w.length;B++)x.push(w[B].value);return x}return et}var dr={},Ao;function ds(){if(Ao)return dr;Ao=1;function n(e,i,t,r){var o=r("matrix",{"":function(){return a([])},string:function(s){return a([],s)},"string, string":function(s,f){return a([],s,f)},Array:function(s){return a(s)},Matrix:function(s){return a(s,s.storage())},"Array | Matrix, string":a,"Array | Matrix, string, string":a});return o.toTex={0:"\\begin{bmatrix}\\end{bmatrix}",1:"\\left(${args[0]}\\right)",2:"\\left(${args[0]}\\right)"},o;function a(l,s,f){var u=e.Matrix.storage(s||"default");return new u(l,f)}}return dr.name="matrix",dr.factory=n,dr}var Ro;function hs(){if(Ro)return cr;Ro=1;var n=ut.clone,e=Ut().validateIndex,i=ft().getSafeProperty,t=ft().setSafeProperty,r=cs();function o(s,f,u,c){var h=u(ds()),p=c("subset",{"Array, Index":function(_,v){var E=h(_),b=E.subset(v);return v.isScalar()?b:b.valueOf()},"Matrix, Index":function(_,v){return _.subset(v)},"Object, Index":a,"string, Index":g,"Array, Index, any":function(_,v,E){return h(n(_)).subset(v,E,void 0).valueOf()},"Array, Index, any, any":function(_,v,E,b){return h(n(_)).subset(v,E,b).valueOf()},"Matrix, Index, any":function(_,v,E){return _.clone().subset(v,E)},"Matrix, Index, any, any":function(_,v,E,b){return _.clone().subset(v,E,b)},"string, Index, string":y,"string, Index, string, string":y,"Object, Index, any":l});return p.toTex=void 0,p;function g(d,_){if(!s.isIndex(_))throw new TypeError("Index expected");if(_.size().length!==1)throw new r(_.size().length,1);var v=d.length;e(_.min()[0],v),e(_.max()[0],v);var E=_.dimension(0),b="";return E.forEach(function(N){b+=d.charAt(N)}),b}function y(d,_,v,E){if(!_||_.isIndex!==!0)throw new TypeError("Index expected");if(_.size().length!==1)throw new r(_.size().length,1);if(E!==void 0){if(typeof E!="string"||E.length!==1)throw new TypeError("Single character expected as defaultValue")}else E=" ";var b=_.dimension(0),N=b.size()[0];if(N!==v.length)throw new r(b.size()[0],v.length);var T=d.length;e(_.min()[0]),e(_.max()[0]);for(var k=[],I=0;I<T;I++)k[I]=d.charAt(I);if(b.forEach(function(B,F){k[B]=v.charAt(F[0])}),k.length>T)for(var w=T-1,x=k.length;w<x;w++)k[w]||(k[w]=E);return k.join("")}}function a(s,f){if(f.size().length!==1)throw new r(f.size(),1);var u=f.dimension(0);if(typeof u!="string")throw new TypeError("String expected as index to retrieve an object property");return i(s,u)}function l(s,f,u){if(f.size().length!==1)throw new r(f.size(),1);var c=f.dimension(0);if(typeof c!="string")throw new TypeError("String expected as index to retrieve an object property");var h=n(s);return t(h,c,u),h}return cr.name="subset",cr.factory=o,cr}var Mo;function ps(){if(Mo)return Fr;Mo=1;function n(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?n=function(a){return typeof a}:n=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},n(r)}var e=fs().transform,i=ft().getSafeProperty;function t(r,o,a,l){var s=a(hs());return function(u,c){try{if(Array.isArray(u))return s(u,c);if(u&&typeof u.subset=="function")return u.subset(c);if(typeof u=="string")return s(u,c);if(n(u)==="object"){if(!c.isObjectProperty())throw new TypeError("Cannot apply a numeric index as object property");return i(u,c.getObjectProperty())}else throw new TypeError("Cannot apply index: unsupported type of object")}catch(h){throw e(h)}}}return Fr.factory=t,Fr}var Po;function Vf(){if(Po)return Rn;Po=1;var n=ft().getSafeProperty;function e(i,t,r,o){var a=r(ct()),l=r(ps());function s(u,c){if(!(this instanceof s))throw new SyntaxError("Constructor must be called with the new operator");if(!i.isNode(u))throw new TypeError('Node expected for parameter "object"');if(!i.isIndexNode(c))throw new TypeError('IndexNode expected for parameter "index"');this.object=u||null,this.index=c,Object.defineProperty(this,"name",{get:function(){return this.index?this.index.isObjectProperty()?this.index.getObjectProperty():"":this.object.name||""}.bind(this),set:function(){throw new Error("Cannot assign a new name, name is read-only")}})}s.prototype=new a,s.prototype.type="AccessorNode",s.prototype.isAccessorNode=!0,s.prototype._compile=function(u,c){var h=this.object._compile(u,c),p=this.index._compile(u,c);if(this.index.isObjectProperty()){var g=this.index.getObjectProperty();return function(d,_,v){return n(h(d,_,v),g)}}else return function(d,_,v){var E=h(d,_,v),b=p(d,_,E);return l(E,b)}},s.prototype.forEach=function(u){u(this.object,"object",this),u(this.index,"index",this)},s.prototype.map=function(u){return new s(this._ifNode(u(this.object,"object",this)),this._ifNode(u(this.index,"index",this)))},s.prototype.clone=function(){return new s(this.object,this.index)},s.prototype._toString=function(u){var c=this.object.toString(u);return f(this.object)&&(c="("+c+")"),c+this.index.toString(u)},s.prototype.toHTML=function(u){var c=this.object.toHTML(u);return f(this.object)&&(c='<span class="math-parenthesis math-round-parenthesis">(</span>'+c+'<span class="math-parenthesis math-round-parenthesis">)</span>'),c+this.index.toHTML(u)},s.prototype._toTex=function(u){var c=this.object.toTex(u);return f(this.object)&&(c="\\left(' + object + '\\right)"),c+this.index.toTex(u)},s.prototype.toJSON=function(){return{mathjs:"AccessorNode",object:this.object,index:this.index}},s.fromJSON=function(u){return new s(u.object,u.index)};function f(u){return!(i.isAccessorNode(u)||i.isArrayNode(u)||i.isConstantNode(u)||i.isFunctionNode(u)||i.isObjectNode(u)||i.isParenthesisNode(u)||i.isSymbolNode(u))}return s}return Rn.name="AccessorNode",Rn.path="expression.node",Rn.factory=e,Rn}var Mn={},ko;function Gf(){if(ko)return Mn;ko=1;var n=Ut().map;function e(i,t,r,o){var a=r(ct());function l(s){if(!(this instanceof l))throw new SyntaxError("Constructor must be called with the new operator");if(this.items=s||[],!Array.isArray(this.items)||!this.items.every(i.isNode))throw new TypeError("Array containing Nodes expected");var f=function(){throw new Error("Property `ArrayNode.nodes` is deprecated, use `ArrayNode.items` instead")};Object.defineProperty(this,"nodes",{get:f,set:f})}return l.prototype=new a,l.prototype.type="ArrayNode",l.prototype.isArrayNode=!0,l.prototype._compile=function(s,f){var u=n(this.items,function(p){return p._compile(s,f)}),c=s.config().matrix!=="Array";if(c){var h=s.matrix;return function(g,y,d){return h(n(u,function(_){return _(g,y,d)}))}}else return function(g,y,d){return n(u,function(_){return _(g,y,d)})}},l.prototype.forEach=function(s){for(var f=0;f<this.items.length;f++){var u=this.items[f];s(u,"items["+f+"]",this)}},l.prototype.map=function(s){for(var f=[],u=0;u<this.items.length;u++)f[u]=this._ifNode(s(this.items[u],"items["+u+"]",this));return new l(f)},l.prototype.clone=function(){return new l(this.items.slice(0))},l.prototype._toString=function(s){var f=this.items.map(function(u){return u.toString(s)});return"["+f.join(", ")+"]"},l.prototype.toJSON=function(){return{mathjs:"ArrayNode",items:this.items}},l.fromJSON=function(s){return new l(s.items)},l.prototype.toHTML=function(s){var f=this.items.map(function(u){return u.toHTML(s)});return'<span class="math-parenthesis math-square-parenthesis">[</span>'+f.join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-square-parenthesis">]</span>'},l.prototype._toTex=function(s){var f="\\begin{bmatrix}";return this.items.forEach(function(u){u.items?f+=u.items.map(function(c){return c.toTex(s)}).join("&"):f+=u.toTex(s),f+="\\\\"}),f+="\\end{bmatrix}",f},l}return Mn.name="ArrayNode",Mn.path="expression.node",Mn.factory=e,Mn}var Pn={},Hr={},Do;function Hf(){if(Do)return Hr;Do=1;function n(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?n=function(a){return typeof a}:n=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},n(r)}var e=fs().transform,i=ft().setSafeProperty;function t(r,o,a,l){var s=a(hs()),f=a(ds());return function(c,h,p){try{if(Array.isArray(c))return f(c).subset(h,p).valueOf();if(c&&typeof c.subset=="function")return c.subset(h,p);if(typeof c=="string")return s(c,h,p);if(n(c)==="object"){if(!h.isObjectProperty())throw TypeError("Cannot apply a numeric index as object property");return i(c,h.getObjectProperty(),p),c}else throw new TypeError("Cannot apply index: unsupported type of object")}catch(g){throw e(g)}}}return Hr.factory=t,Hr}var un={},Co;function Sn(){if(Co)return un;Co=1;var n=[{AssignmentNode:{},FunctionAssignmentNode:{}},{ConditionalNode:{latexLeftParens:!1,latexRightParens:!1,latexParens:!1}},{"OperatorNode:or":{associativity:"left",associativeWith:[]}},{"OperatorNode:xor":{associativity:"left",associativeWith:[]}},{"OperatorNode:and":{associativity:"left",associativeWith:[]}},{"OperatorNode:bitOr":{associativity:"left",associativeWith:[]}},{"OperatorNode:bitXor":{associativity:"left",associativeWith:[]}},{"OperatorNode:bitAnd":{associativity:"left",associativeWith:[]}},{"OperatorNode:equal":{associativity:"left",associativeWith:[]},"OperatorNode:unequal":{associativity:"left",associativeWith:[]},"OperatorNode:smaller":{associativity:"left",associativeWith:[]},"OperatorNode:larger":{associativity:"left",associativeWith:[]},"OperatorNode:smallerEq":{associativity:"left",associativeWith:[]},"OperatorNode:largerEq":{associativity:"left",associativeWith:[]},RelationalNode:{associativity:"left",associativeWith:[]}},{"OperatorNode:leftShift":{associativity:"left",associativeWith:[]},"OperatorNode:rightArithShift":{associativity:"left",associativeWith:[]},"OperatorNode:rightLogShift":{associativity:"left",associativeWith:[]}},{"OperatorNode:to":{associativity:"left",associativeWith:[]}},{RangeNode:{}},{"OperatorNode:add":{associativity:"left",associativeWith:["OperatorNode:add","OperatorNode:subtract"]},"OperatorNode:subtract":{associativity:"left",associativeWith:[]}},{"OperatorNode:multiply":{associativity:"left",associativeWith:["OperatorNode:multiply","OperatorNode:divide","Operator:dotMultiply","Operator:dotDivide"]},"OperatorNode:divide":{associativity:"left",associativeWith:[],latexLeftParens:!1,latexRightParens:!1,latexParens:!1},"OperatorNode:dotMultiply":{associativity:"left",associativeWith:["OperatorNode:multiply","OperatorNode:divide","OperatorNode:dotMultiply","OperatorNode:doDivide"]},"OperatorNode:dotDivide":{associativity:"left",associativeWith:[]},"OperatorNode:mod":{associativity:"left",associativeWith:[]}},{"OperatorNode:unaryPlus":{associativity:"right"},"OperatorNode:unaryMinus":{associativity:"right"},"OperatorNode:bitNot":{associativity:"right"},"OperatorNode:not":{associativity:"right"}},{"OperatorNode:pow":{associativity:"right",associativeWith:[],latexRightParens:!1},"OperatorNode:dotPow":{associativity:"right",associativeWith:[]}},{"OperatorNode:factorial":{associativity:"left"}},{"OperatorNode:transpose":{associativity:"left"}}];function e(r,o){var a=r;o!=="keep"&&(a=r.getContent());for(var l=a.getIdentifier(),s=0;s<n.length;s++)if(l in n[s])return s;return null}function i(r,o){var a=r;o!=="keep"&&(a=r.getContent());var l=a.getIdentifier(),s=e(a,o);if(s===null)return null;var f=n[s][l];if(f.hasOwnProperty("associativity")){if(f.associativity==="left")return"left";if(f.associativity==="right")return"right";throw Error("'"+l+"' has the invalid associativity '"+f.associativity+"'.")}return null}function t(r,o,a){var l=a!=="keep"?r.getContent():r,s=a!=="keep"?r.getContent():o,f=l.getIdentifier(),u=s.getIdentifier(),c=e(l,a);if(c===null)return null;var h=n[c][f];if(h.hasOwnProperty("associativeWith")&&h.associativeWith instanceof Array){for(var p=0;p<h.associativeWith.length;p++)if(h.associativeWith[p]===u)return!0;return!1}return null}return un.properties=n,un.getPrecedence=e,un.getAssociativity=i,un.isAssociativeWith=t,un}var Lo;function qf(){if(Lo)return Pn;Lo=1;var n=ft().getSafeProperty,e=ft().setSafeProperty;function i(t,r,o,a){var l=o(ct()),s=o(Hf()),f=o(ps()),u=Sn();function c(p,g,y){if(!(this instanceof c))throw new SyntaxError("Constructor must be called with the new operator");if(this.object=p,this.index=y?g:null,this.value=y||g,!t.isSymbolNode(p)&&!t.isAccessorNode(p))throw new TypeError('SymbolNode or AccessorNode expected as "object"');if(t.isSymbolNode(p)&&p.name==="end")throw new Error('Cannot assign to symbol "end"');if(this.index&&!t.isIndexNode(this.index))throw new TypeError('IndexNode expected as "index"');if(!t.isNode(this.value))throw new TypeError('Node expected as "value"');Object.defineProperty(this,"name",{get:function(){return this.index?this.index.isObjectProperty()?this.index.getObjectProperty():"":this.object.name||""}.bind(this),set:function(){throw new Error("Cannot assign a new name, name is read-only")}})}c.prototype=new l,c.prototype.type="AssignmentNode",c.prototype.isAssignmentNode=!0,c.prototype._compile=function(p,g){var y=this.object._compile(p,g),d=this.index?this.index._compile(p,g):null,_=this.value._compile(p,g),v=this.object.name;if(this.index)if(this.index.isObjectProperty()){var E=this.index.getObjectProperty();return function(I,w,x){var B=y(I,w,x),F=_(I,w,x);return e(B,E,F)}}else{if(t.isSymbolNode(this.object))return function(I,w,x){var B=y(I,w,x),F=_(I,w,x),j=d(I,w,B);return e(I,v,s(B,j,F)),F};var b=this.object.object._compile(p,g);if(this.object.index.isObjectProperty()){var N=this.object.index.getObjectProperty();return function(I,w,x){var B=b(I,w,x),F=n(B,N),j=d(I,w,F),H=_(I,w,x);return e(B,N,s(F,j,H)),H}}else{var T=this.object.index._compile(p,g);return function(I,w,x){var B=b(I,w,x),F=T(I,w,B),j=f(B,F),H=d(I,w,j),K=_(I,w,x);return s(B,F,s(j,H,K)),K}}}else{if(!t.isSymbolNode(this.object))throw new TypeError("SymbolNode expected as object");return function(I,w,x){return e(I,v,_(I,w,x))}}},c.prototype.forEach=function(p){p(this.object,"object",this),this.index&&p(this.index,"index",this),p(this.value,"value",this)},c.prototype.map=function(p){var g=this._ifNode(p(this.object,"object",this)),y=this.index?this._ifNode(p(this.index,"index",this)):null,d=this._ifNode(p(this.value,"value",this));return new c(g,y,d)},c.prototype.clone=function(){return new c(this.object,this.index,this.value)};function h(p,g){g||(g="keep");var y=u.getPrecedence(p,g),d=u.getPrecedence(p.value,g);return g==="all"||d!==null&&d<=y}return c.prototype._toString=function(p){var g=this.object.toString(p),y=this.index?this.index.toString(p):"",d=this.value.toString(p);return h(this,p&&p.parenthesis)&&(d="("+d+")"),g+y+" = "+d},c.prototype.toJSON=function(){return{mathjs:"AssignmentNode",object:this.object,index:this.index,value:this.value}},c.fromJSON=function(p){return new c(p.object,p.index,p.value)},c.prototype.toHTML=function(p){var g=this.object.toHTML(p),y=this.index?this.index.toHTML(p):"",d=this.value.toHTML(p);return h(this,p&&p.parenthesis)&&(d='<span class="math-paranthesis math-round-parenthesis">(</span>'+d+'<span class="math-paranthesis math-round-parenthesis">)</span>'),g+y+'<span class="math-operator math-assignment-operator math-variable-assignment-operator math-binary-operator">=</span>'+d},c.prototype._toTex=function(p){var g=this.object.toTex(p),y=this.index?this.index.toTex(p):"",d=this.value.toTex(p);return h(this,p&&p.parenthesis)&&(d="\\left(".concat(d,"\\right)")),g+y+":="+d},c}return Pn.name="AssignmentNode",Pn.path="expression.node",Pn.factory=i,Pn}var kn={},Dn={},Fo;function zf(){if(Fo)return Dn;Fo=1;function n(e,i,t,r){function o(a){if(!(this instanceof o))throw new SyntaxError("Constructor must be called with the new operator");this.entries=a||[]}return o.prototype.type="ResultSet",o.prototype.isResultSet=!0,o.prototype.valueOf=function(){return this.entries},o.prototype.toString=function(){return"["+this.entries.join(", ")+"]"},o.prototype.toJSON=function(){return{mathjs:"ResultSet",entries:this.entries}},o.fromJSON=function(a){return new o(a.entries)},o}return Dn.name="ResultSet",Dn.path="type",Dn.factory=n,Dn}var Uo;function Wf(){if(Uo)return kn;Uo=1;var n=Ut().forEach,e=Ut().map;function i(t,r,o,a){var l=o(ct()),s=o(zf());function f(u){if(!(this instanceof f))throw new SyntaxError("Constructor must be called with the new operator");if(!Array.isArray(u))throw new Error("Array expected");this.blocks=u.map(function(c){var h=c&&c.node,p=c&&c.visible!==void 0?c.visible:!0;if(!t.isNode(h))throw new TypeError('Property "node" must be a Node');if(typeof p!="boolean")throw new TypeError('Property "visible" must be a boolean');return{node:h,visible:p}})}return f.prototype=new l,f.prototype.type="BlockNode",f.prototype.isBlockNode=!0,f.prototype._compile=function(u,c){var h=e(this.blocks,function(p){return{eval:p.node._compile(u,c),visible:p.visible}});return function(g,y,d){var _=[];return n(h,function(E){var b=E.eval(g,y,d);E.visible&&_.push(b)}),new s(_)}},f.prototype.forEach=function(u){for(var c=0;c<this.blocks.length;c++)u(this.blocks[c].node,"blocks["+c+"].node",this)},f.prototype.map=function(u){for(var c=[],h=0;h<this.blocks.length;h++){var p=this.blocks[h],g=this._ifNode(u(p.node,"blocks["+h+"].node",this));c[h]={node:g,visible:p.visible}}return new f(c)},f.prototype.clone=function(){var u=this.blocks.map(function(c){return{node:c.node,visible:c.visible}});return new f(u)},f.prototype._toString=function(u){return this.blocks.map(function(c){return c.node.toString(u)+(c.visible?"":";")}).join(`
`)},f.prototype.toJSON=function(){return{mathjs:"BlockNode",blocks:this.blocks}},f.fromJSON=function(u){return new f(u.blocks)},f.prototype.toHTML=function(u){return this.blocks.map(function(c){return c.node.toHTML(u)+(c.visible?"":'<span class="math-separator">;</span>')}).join('<span class="math-separator"><br /></span>')},f.prototype._toTex=function(u){return this.blocks.map(function(c){return c.node.toTex(u)+(c.visible?"":";")}).join(`\\;\\;
`)},f}return kn.name="BlockNode",kn.path="expression.node",kn.factory=i,kn}var Cn={},Bo;function Xf(){if(Bo)return Cn;Bo=1;var n=Sn();function e(i,t,r,o){var a=r(ct()),l=r(Ei());function s(u,c,h){if(!(this instanceof s))throw new SyntaxError("Constructor must be called with the new operator");if(!i.isNode(u))throw new TypeError("Parameter condition must be a Node");if(!i.isNode(c))throw new TypeError("Parameter trueExpr must be a Node");if(!i.isNode(h))throw new TypeError("Parameter falseExpr must be a Node");this.condition=u,this.trueExpr=c,this.falseExpr=h}s.prototype=new a,s.prototype.type="ConditionalNode",s.prototype.isConditionalNode=!0,s.prototype._compile=function(u,c){var h=this.condition._compile(u,c),p=this.trueExpr._compile(u,c),g=this.falseExpr._compile(u,c);return function(d,_,v){return f(h(d,_,v))?p(d,_,v):g(d,_,v)}},s.prototype.forEach=function(u){u(this.condition,"condition",this),u(this.trueExpr,"trueExpr",this),u(this.falseExpr,"falseExpr",this)},s.prototype.map=function(u){return new s(this._ifNode(u(this.condition,"condition",this)),this._ifNode(u(this.trueExpr,"trueExpr",this)),this._ifNode(u(this.falseExpr,"falseExpr",this)))},s.prototype.clone=function(){return new s(this.condition,this.trueExpr,this.falseExpr)},s.prototype._toString=function(u){var c=u&&u.parenthesis?u.parenthesis:"keep",h=n.getPrecedence(this,c),p=this.condition.toString(u),g=n.getPrecedence(this.condition,c);(c==="all"||this.condition.type==="OperatorNode"||g!==null&&g<=h)&&(p="("+p+")");var y=this.trueExpr.toString(u),d=n.getPrecedence(this.trueExpr,c);(c==="all"||this.trueExpr.type==="OperatorNode"||d!==null&&d<=h)&&(y="("+y+")");var _=this.falseExpr.toString(u),v=n.getPrecedence(this.falseExpr,c);return(c==="all"||this.falseExpr.type==="OperatorNode"||v!==null&&v<=h)&&(_="("+_+")"),p+" ? "+y+" : "+_},s.prototype.toJSON=function(){return{mathjs:"ConditionalNode",condition:this.condition,trueExpr:this.trueExpr,falseExpr:this.falseExpr}},s.fromJSON=function(u){return new s(u.condition,u.trueExpr,u.falseExpr)},s.prototype.toHTML=function(u){var c=u&&u.parenthesis?u.parenthesis:"keep",h=n.getPrecedence(this,c),p=this.condition.toHTML(u),g=n.getPrecedence(this.condition,c);(c==="all"||this.condition.type==="OperatorNode"||g!==null&&g<=h)&&(p='<span class="math-parenthesis math-round-parenthesis">(</span>'+p+'<span class="math-parenthesis math-round-parenthesis">)</span>');var y=this.trueExpr.toHTML(u),d=n.getPrecedence(this.trueExpr,c);(c==="all"||this.trueExpr.type==="OperatorNode"||d!==null&&d<=h)&&(y='<span class="math-parenthesis math-round-parenthesis">(</span>'+y+'<span class="math-parenthesis math-round-parenthesis">)</span>');var _=this.falseExpr.toHTML(u),v=n.getPrecedence(this.falseExpr,c);return(c==="all"||this.falseExpr.type==="OperatorNode"||v!==null&&v<=h)&&(_='<span class="math-parenthesis math-round-parenthesis">(</span>'+_+'<span class="math-parenthesis math-round-parenthesis">)</span>'),p+'<span class="math-operator math-conditional-operator">?</span>'+y+'<span class="math-operator math-conditional-operator">:</span>'+_},s.prototype._toTex=function(u){return"\\begin{cases} {"+this.trueExpr.toTex(u)+"}, &\\quad{\\text{if }\\;"+this.condition.toTex(u)+"}\\\\{"+this.falseExpr.toTex(u)+"}, &\\quad{\\text{otherwise}}\\end{cases}"};function f(u){if(typeof u=="number"||typeof u=="boolean"||typeof u=="string")return!!u;if(u){if(i.isBigNumber(u))return!u.isZero();if(i.isComplex(u))return!!(u.re||u.im);if(i.isUnit(u))return!!u.value}if(u==null)return!1;throw new TypeError('Unsupported type of condition "'+l(u)+'"')}return s}return Cn.name="ConditionalNode",Cn.path="expression.node",Cn.factory=e,Cn}var Ln={},qr={},zr,jo;function Yf(){if(jo)return zr;jo=1;var n=Object.assign||function(r){for(var o=1;o<arguments.length;o++){var a=arguments[o];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(r[l]=a[l])}return r},e={"{":"\\{","}":"\\}","\\":"\\textbackslash{}","#":"\\#",$:"\\$","%":"\\%","&":"\\&","^":"\\textasciicircum{}",_:"\\_","~":"\\textasciitilde{}"},i={"\u2013":"\\--","\u2014":"\\---"," ":"~","	":"\\qquad{}","\r\n":"\\newline{}","\n":"\\newline{}"},t=function(o,a){return n({},o,a)};return zr=function(r){for(var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=o.preserveFormatting,l=a===void 0?!1:a,s=o.escapeMapFn,f=s===void 0?t:s,u=String(r),c="",h=f(n({},e),l?n({},i):{}),p=Object.keys(h),g=function(){var d=!1;p.forEach(function(_,v){d||u.length>=_.length&&u.slice(0,_.length)===_&&(c+=h[p[v]],u=u.slice(_.length,u.length),d=!0)}),d||(c+=u.slice(0,1),u=u.slice(1,u.length))};u;)g();return c},zr}var Vo;function xn(){return Vo||(Vo=1,function(n){var e=Yf();n.symbols={Alpha:"A",alpha:"\\alpha",Beta:"B",beta:"\\beta",Gamma:"\\Gamma",gamma:"\\gamma",Delta:"\\Delta",delta:"\\delta",Epsilon:"E",epsilon:"\\epsilon",varepsilon:"\\varepsilon",Zeta:"Z",zeta:"\\zeta",Eta:"H",eta:"\\eta",Theta:"\\Theta",theta:"\\theta",vartheta:"\\vartheta",Iota:"I",iota:"\\iota",Kappa:"K",kappa:"\\kappa",varkappa:"\\varkappa",Lambda:"\\Lambda",lambda:"\\lambda",Mu:"M",mu:"\\mu",Nu:"N",nu:"\\nu",Xi:"\\Xi",xi:"\\xi",Omicron:"O",omicron:"o",Pi:"\\Pi",pi:"\\pi",varpi:"\\varpi",Rho:"P",rho:"\\rho",varrho:"\\varrho",Sigma:"\\Sigma",sigma:"\\sigma",varsigma:"\\varsigma",Tau:"T",tau:"\\tau",Upsilon:"\\Upsilon",upsilon:"\\upsilon",Phi:"\\Phi",phi:"\\phi",varphi:"\\varphi",Chi:"X",chi:"\\chi",Psi:"\\Psi",psi:"\\psi",Omega:"\\Omega",omega:"\\omega",true:"\\mathrm{True}",false:"\\mathrm{False}",i:"i",inf:"\\infty",Inf:"\\infty",infinity:"\\infty",Infinity:"\\infty",oo:"\\infty",lim:"\\lim",undefined:"\\mathbf{?}"},n.operators={transpose:"^\\top",ctranspose:"^H",factorial:"!",pow:"^",dotPow:".^\\wedge",unaryPlus:"+",unaryMinus:"-",bitNot:"\\~",not:"\\neg",multiply:"\\cdot",divide:"\\frac",dotMultiply:".\\cdot",dotDivide:".:",mod:"\\mod",add:"+",subtract:"-",to:"\\rightarrow",leftShift:"<<",rightArithShift:">>",rightLogShift:">>>",equal:"=",unequal:"\\neq",smaller:"<",larger:">",smallerEq:"\\leq",largerEq:"\\geq",bitAnd:"\\&",bitXor:"\\underline{|}",bitOr:"|",and:"\\wedge",xor:"\\veebar",or:"\\vee"},n.defaultTemplate="\\mathrm{${name}}\\left(${args}\\right)";var i={deg:"^\\circ"};n.escape=function(t){return e(t,{preserveFormatting:!0})},n.toSymbol=function(t,r){return r=typeof r>"u"?!1:r,r?i.hasOwnProperty(t)?i[t]:"\\mathrm{"+n.escape(t)+"}":n.symbols.hasOwnProperty(t)?n.symbols[t]:n.escape(t)}}(qr)),qr}var Go;function Jf(){if(Go)return Ln;Go=1;var n=Rt().format,e=xn().escape;function i(t,r,o,a){var l=o(ct()),s=o(Ei());function f(u){if(!(this instanceof f))throw new SyntaxError("Constructor must be called with the new operator");if(arguments.length===2)throw new SyntaxError("new ConstantNode(valueStr, valueType) is not supported anymore since math v4.0.0. Use new ConstantNode(value) instead, where value is a non-stringified value.");this.value=u}return f.prototype=new l,f.prototype.type="ConstantNode",f.prototype.isConstantNode=!0,f.prototype._compile=function(u,c){var h=this.value;return function(){return h}},f.prototype.forEach=function(u){},f.prototype.map=function(u){return this.clone()},f.prototype.clone=function(){return new f(this.value)},f.prototype._toString=function(u){return n(this.value,u)},f.prototype.toHTML=function(u){var c=this._toString(u);switch(s(this.value)){case"number":case"BigNumber":case"Fraction":return'<span class="math-number">'+c+"</span>";case"string":return'<span class="math-string">'+c+"</span>";case"boolean":return'<span class="math-boolean">'+c+"</span>";case"null":return'<span class="math-null-symbol">'+c+"</span>";case"undefined":return'<span class="math-undefined">'+c+"</span>";default:return'<span class="math-symbol">'+c+"</span>"}},f.prototype.toJSON=function(){return{mathjs:"ConstantNode",value:this.value}},f.fromJSON=function(u){return new f(u.value)},f.prototype._toTex=function(u){var c=this._toString(u);switch(s(this.value)){case"string":return"\\mathtt{"+e(c)+"}";case"number":case"BigNumber":var h=c.toLowerCase().indexOf("e");return h!==-1?c.substring(0,h)+"\\cdot10^{"+c.substring(h+1)+"}":c;case"Fraction":return this.value.toLatex();default:return c}},f}return Ln.name="ConstantNode",Ln.path="expression.node",Ln.factory=i,Ln}var Fn={},Ho;function Kf(){if(Ho)return Fn;Ho=1;var n=ls(),e=Rt().escape,i=Ut().forEach,t=Ut().join,r=xn(),o=Sn(),a=ft().setSafeProperty;function l(s,f,u,c){var h=u(ct());function p(y,d,_){if(!(this instanceof p))throw new SyntaxError("Constructor must be called with the new operator");if(typeof y!="string")throw new TypeError('String expected for parameter "name"');if(!Array.isArray(d))throw new TypeError('Array containing strings or objects expected for parameter "params"');if(!s.isNode(_))throw new TypeError('Node expected for parameter "expr"');if(y in n)throw new Error('Illegal function name, "'+y+'" is a reserved keyword');this.name=y,this.params=d.map(function(v){return v&&v.name||v}),this.types=d.map(function(v){return v&&v.type||"any"}),this.expr=_}p.prototype=new h,p.prototype.type="FunctionAssignmentNode",p.prototype.isFunctionAssignmentNode=!0,p.prototype._compile=function(y,d){var _=Object.create(d);i(this.params,function(k){_[k]=!0});var v=this.expr._compile(y,_),E=this.name,b=this.params,N=t(this.types,","),T=E+"("+t(this.params,", ")+")";return function(I,w,x){var B={};B[N]=function(){for(var j=Object.create(w),H=0;H<b.length;H++)j[b[H]]=arguments[H];return v(I,j,x)};var F=c(E,B);return F.syntax=T,a(I,E,F),F}},p.prototype.forEach=function(y){y(this.expr,"expr",this)},p.prototype.map=function(y){var d=this._ifNode(y(this.expr,"expr",this));return new p(this.name,this.params.slice(0),d)},p.prototype.clone=function(){return new p(this.name,this.params.slice(0),this.expr)};function g(y,d){var _=o.getPrecedence(y,d),v=o.getPrecedence(y.expr,d);return d==="all"||v!==null&&v<=_}return p.prototype._toString=function(y){var d=y&&y.parenthesis?y.parenthesis:"keep",_=this.expr.toString(y);return g(this,d)&&(_="("+_+")"),this.name+"("+this.params.join(", ")+") = "+_},p.prototype.toJSON=function(){var y=this.types;return{mathjs:"FunctionAssignmentNode",name:this.name,params:this.params.map(function(d,_){return{name:d,type:y[_]}}),expr:this.expr}},p.fromJSON=function(y){return new p(y.name,y.params,y.expr)},p.prototype.toHTML=function(y){for(var d=y&&y.parenthesis?y.parenthesis:"keep",_=[],v=0;v<this.params.length;v++)_.push('<span class="math-symbol math-parameter">'+e(this.params[v])+"</span>");var E=this.expr.toHTML(y);return g(this,d)&&(E='<span class="math-parenthesis math-round-parenthesis">(</span>'+E+'<span class="math-parenthesis math-round-parenthesis">)</span>'),'<span class="math-function">'+e(this.name)+'</span><span class="math-parenthesis math-round-parenthesis">(</span>'+_.join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-round-parenthesis">)</span><span class="math-operator math-assignment-operator math-variable-assignment-operator math-binary-operator">=</span>'+E},p.prototype._toTex=function(y){var d=y&&y.parenthesis?y.parenthesis:"keep",_=this.expr.toTex(y);return g(this,d)&&(_="\\left(".concat(_,"\\right)")),"\\mathrm{"+this.name+"}\\left("+this.params.map(r.toSymbol).join(",")+"\\right):="+_},p}return Fn.name="FunctionAssignmentNode",Fn.path="expression.node",Fn.factory=l,Fn}var Un={},Bn={},qo;function Zf(){if(qo)return Bn;qo=1;var n=Tr();function e(i,t,r,o){function a(l,s,f){if(!(this instanceof a))throw new SyntaxError("Constructor must be called with the new operator");var u=l!=null,c=s!=null,h=f!=null;if(u){if(i.isBigNumber(l))l=l.toNumber();else if(typeof l!="number")throw new TypeError("Parameter start must be a number")}if(c){if(i.isBigNumber(s))s=s.toNumber();else if(typeof s!="number")throw new TypeError("Parameter end must be a number")}if(h){if(i.isBigNumber(f))f=f.toNumber();else if(typeof f!="number")throw new TypeError("Parameter step must be a number")}this.start=u?parseFloat(l):0,this.end=c?parseFloat(s):0,this.step=h?parseFloat(f):1}return a.prototype.type="Range",a.prototype.isRange=!0,a.parse=function(l){if(typeof l!="string")return null;var s=l.split(":"),f=s.map(function(c){return parseFloat(c)}),u=f.some(function(c){return isNaN(c)});if(u)return null;switch(f.length){case 2:return new a(f[0],f[1]);case 3:return new a(f[0],f[2],f[1]);default:return null}},a.prototype.clone=function(){return new a(this.start,this.end,this.step)},a.prototype.size=function(){var l=0,s=this.start,f=this.step,u=this.end,c=u-s;return n.sign(f)===n.sign(c)?l=Math.ceil(c/f):c===0&&(l=0),isNaN(l)&&(l=0),[l]},a.prototype.min=function(){var l=this.size()[0];if(l>0)return this.step>0?this.start:this.start+(l-1)*this.step},a.prototype.max=function(){var l=this.size()[0];if(l>0)return this.step>0?this.start+(l-1)*this.step:this.start},a.prototype.forEach=function(l){var s=this.start,f=this.step,u=this.end,c=0;if(f>0)for(;s<u;)l(s,[c],this),s+=f,c++;else if(f<0)for(;s>u;)l(s,[c],this),s+=f,c++},a.prototype.map=function(l){var s=[];return this.forEach(function(f,u,c){s[u[0]]=l(f,u,c)}),s},a.prototype.toArray=function(){var l=[];return this.forEach(function(s,f){l[f[0]]=s}),l},a.prototype.valueOf=function(){return this.toArray()},a.prototype.format=function(l){var s=n.format(this.start,l);return this.step!==1&&(s+=":"+n.format(this.step,l)),s+=":"+n.format(this.end,l),s},a.prototype.toString=function(){return this.format()},a.prototype.toJSON=function(){return{mathjs:"Range",start:this.start,end:this.end,step:this.step}},a.fromJSON=function(l){return new a(l.start,l.end,l.step)},a}return Bn.name="Range",Bn.path="type",Bn.factory=e,Bn}var zo;function Qf(){if(zo)return Un;zo=1;var n=Ut().map,e=Rt().escape;function i(t,r,o,a){var l=o(ct()),s=o(Zf()),f=Array.isArray;function u(h,p){if(!(this instanceof u))throw new SyntaxError("Constructor must be called with the new operator");if(this.dimensions=h,this.dotNotation=p||!1,!f(h)||!h.every(t.isNode))throw new TypeError('Array containing Nodes expected for parameter "dimensions"');if(this.dotNotation&&!this.isObjectProperty())throw new Error("dotNotation only applicable for object properties");var g=function(){throw new Error("Property `IndexNode.object` is deprecated, use `IndexNode.fn` instead")};Object.defineProperty(this,"object",{get:g,set:g})}u.prototype=new l,u.prototype.type="IndexNode",u.prototype.isIndexNode=!0,u.prototype._compile=function(h,p){var g=n(this.dimensions,function(y,d){if(t.isRangeNode(y))if(y.needsEnd()){var _=Object.create(p);_.end=!0;var v=y.start._compile(h,_),E=y.end._compile(h,_),b=y.step?y.step._compile(h,_):function(){return 1};return function(F,j,H){var K=h.size(H).valueOf(),U=Object.create(j);return U.end=K[d],c(v(F,U,H),E(F,U,H),b(F,U,H))}}else{var N=y.start._compile(h,p),T=y.end._compile(h,p),k=y.step?y.step._compile(h,p):function(){return 1};return function(F,j,H){return c(N(F,j,H),T(F,j,H),k(F,j,H))}}else if(t.isSymbolNode(y)&&y.name==="end"){var I=Object.create(p);I.end=!0;var w=y._compile(h,I);return function(F,j,H){var K=h.size(H).valueOf(),U=Object.create(j);return U.end=K[d],w(F,U,H)}}else{var x=y._compile(h,p);return function(F,j,H){return x(F,j,H)}}});return function(d,_,v){var E=n(g,function(b){return b(d,_,v)});return h.index.apply(h,E)}},u.prototype.forEach=function(h){for(var p=0;p<this.dimensions.length;p++)h(this.dimensions[p],"dimensions["+p+"]",this)},u.prototype.map=function(h){for(var p=[],g=0;g<this.dimensions.length;g++)p[g]=this._ifNode(h(this.dimensions[g],"dimensions["+g+"]",this));return new u(p)},u.prototype.clone=function(){return new u(this.dimensions.slice(0))},u.prototype.isObjectProperty=function(){return this.dimensions.length===1&&t.isConstantNode(this.dimensions[0])&&typeof this.dimensions[0].value=="string"},u.prototype.getObjectProperty=function(){return this.isObjectProperty()?this.dimensions[0].value:null},u.prototype._toString=function(h){return this.dotNotation?"."+this.getObjectProperty():"["+this.dimensions.join(", ")+"]"},u.prototype.toJSON=function(){return{mathjs:"IndexNode",dimensions:this.dimensions,dotNotation:this.dotNotation}},u.fromJSON=function(h){return new u(h.dimensions,h.dotNotation)},u.prototype.toHTML=function(h){for(var p=[],g=0;g<this.dimensions.length;g++)p[g]=this.dimensions[g].toHTML();return this.dotNotation?'<span class="math-operator math-accessor-operator">.</span><span class="math-symbol math-property">'+e(this.getObjectProperty())+"</span>":'<span class="math-parenthesis math-square-parenthesis">[</span>'+p.join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-square-parenthesis">]</span>'},u.prototype._toTex=function(h){var p=this.dimensions.map(function(g){return g.toTex(h)});return this.dotNotation?"."+this.getObjectProperty():"_{"+p.join(",")+"}"};function c(h,p,g){return new s(t.isBigNumber(h)?h.toNumber():h,t.isBigNumber(p)?p.toNumber():p,t.isBigNumber(g)?g.toNumber():g)}return u}return Un.name="IndexNode",Un.path="expression.node",Un.factory=i,Un}var jn={},Wo;function $f(){if(Wo)return jn;Wo=1;function n(a){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?n=function(s){return typeof s}:n=function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},n(a)}var e=Rt().stringify,i=Rt().escape,t=ft().isSafeProperty,r=ut.hasOwnProperty;function o(a,l,s,f){var u=s(ct());function c(h){if(!(this instanceof c))throw new SyntaxError("Constructor must be called with the new operator");if(this.properties=h||{},h&&(n(h)!=="object"||!Object.keys(h).every(function(p){return a.isNode(h[p])})))throw new TypeError("Object containing Nodes expected")}return c.prototype=new u,c.prototype.type="ObjectNode",c.prototype.isObjectNode=!0,c.prototype._compile=function(h,p){var g={};for(var y in this.properties)if(r(this.properties,y)){var d=e(y),_=JSON.parse(d);if(!t(this.properties,_))throw new Error('No access to property "'+_+'"');g[_]=this.properties[y]._compile(h,p)}return function(E,b,N){var T={};for(var k in g)r(g,k)&&(T[k]=g[k](E,b,N));return T}},c.prototype.forEach=function(h){for(var p in this.properties)this.properties.hasOwnProperty(p)&&h(this.properties[p],"properties["+e(p)+"]",this)},c.prototype.map=function(h){var p={};for(var g in this.properties)this.properties.hasOwnProperty(g)&&(p[g]=this._ifNode(h(this.properties[g],"properties["+e(g)+"]",this)));return new c(p)},c.prototype.clone=function(){var h={};for(var p in this.properties)this.properties.hasOwnProperty(p)&&(h[p]=this.properties[p]);return new c(h)},c.prototype._toString=function(h){var p=[];for(var g in this.properties)this.properties.hasOwnProperty(g)&&p.push(e(g)+": "+this.properties[g].toString(h));return"{"+p.join(", ")+"}"},c.prototype.toJSON=function(){return{mathjs:"ObjectNode",properties:this.properties}},c.fromJSON=function(h){return new c(h.properties)},c.prototype.toHTML=function(h){var p=[];for(var g in this.properties)this.properties.hasOwnProperty(g)&&p.push('<span class="math-symbol math-property">'+i(g)+'</span><span class="math-operator math-assignment-operator math-property-assignment-operator math-binary-operator">:</span>'+this.properties[g].toHTML(h));return'<span class="math-parenthesis math-curly-parenthesis">{</span>'+p.join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-curly-parenthesis">}</span>'},c.prototype._toTex=function(h){var p=[];for(var g in this.properties)this.properties.hasOwnProperty(g)&&p.push("\\mathbf{"+g+":} & "+this.properties[g].toTex(h)+"\\\\");return"\\left\\{\\begin{array}{ll}".concat(p.join(`
`),"\\end{array}\\right\\}")},c}return jn.name="ObjectNode",jn.path="expression.node",jn.factory=o,jn}var Vn={},Xo;function ec(){if(Xo)return Vn;Xo=1;var n=xn(),e=Ut().map,i=Rt().escape,t=ft().isSafeMethod,r=ft().getSafeProperty,o=Sn();function a(l,s,f,u){var c=f(ct());function h(g,y,d,_){if(!(this instanceof h))throw new SyntaxError("Constructor must be called with the new operator");if(typeof g!="string")throw new TypeError('string expected for parameter "op"');if(typeof y!="string")throw new TypeError('string expected for parameter "fn"');if(!Array.isArray(d)||!d.every(l.isNode))throw new TypeError('Array containing Nodes expected for parameter "args"');this.implicit=_===!0,this.op=g,this.fn=y,this.args=d||[]}h.prototype=new c,h.prototype.type="OperatorNode",h.prototype.isOperatorNode=!0,h.prototype._compile=function(g,y){if(typeof this.fn!="string"||!t(g,this.fn))throw g[this.fn]?new Error('No access to function "'+this.fn+'"'):new Error("Function "+this.fn+' missing in provided namespace "math"');var d=r(g,this.fn),_=e(this.args,function(N){return N._compile(g,y)});if(_.length===1){var v=_[0];return function(T,k,I){return d(v(T,k,I))}}else if(_.length===2){var E=_[0],b=_[1];return function(T,k,I){return d(E(T,k,I),b(T,k,I))}}else return function(T,k,I){return d.apply(null,e(_,function(w){return w(T,k,I)}))}},h.prototype.forEach=function(g){for(var y=0;y<this.args.length;y++)g(this.args[y],"args["+y+"]",this)},h.prototype.map=function(g){for(var y=[],d=0;d<this.args.length;d++)y[d]=this._ifNode(g(this.args[d],"args["+d+"]",this));return new h(this.op,this.fn,y,this.implicit)},h.prototype.clone=function(){return new h(this.op,this.fn,this.args.slice(0),this.implicit)},h.prototype.isUnary=function(){return this.args.length===1},h.prototype.isBinary=function(){return this.args.length===2};function p(g,y,d,_,v){var E=o.getPrecedence(g,y),b=o.getAssociativity(g,y);if(y==="all"||_.length>2&&g.getIdentifier()!=="OperatorNode:add"&&g.getIdentifier()!=="OperatorNode:multiply"){var N=_.map(function(ve){switch(ve.getContent().type){case"ArrayNode":case"ConstantNode":case"SymbolNode":case"ParenthesisNode":return!1;default:return!0}});return N}var T;switch(_.length){case 0:T=[];break;case 1:var k=o.getPrecedence(_[0],y);if(v&&k!==null){var I,w;if(y==="keep"?(I=_[0].getIdentifier(),w=g.getIdentifier()):(I=_[0].getContent().getIdentifier(),w=g.getContent().getIdentifier()),o.properties[E][w].latexLeftParens===!1){T=[!1];break}if(o.properties[k][I].latexParens===!1){T=[!1];break}}if(k===null){T=[!1];break}if(k<=E){T=[!0];break}T=[!1];break;case 2:var x,B=o.getPrecedence(_[0],y),F=o.isAssociativeWith(g,_[0],y);B===null?x=!1:B===E&&b==="right"&&!F||B<E?x=!0:x=!1;var j,H=o.getPrecedence(_[1],y),K=o.isAssociativeWith(g,_[1],y);if(H===null?j=!1:H===E&&b==="left"&&!K||H<E?j=!0:j=!1,v){var U,ee,fe;y==="keep"?(U=g.getIdentifier(),ee=g.args[0].getIdentifier(),fe=g.args[1].getIdentifier()):(U=g.getContent().getIdentifier(),ee=g.args[0].getContent().getIdentifier(),fe=g.args[1].getContent().getIdentifier()),B!==null&&(o.properties[E][U].latexLeftParens===!1&&(x=!1),o.properties[B][ee].latexParens===!1&&(x=!1)),H!==null&&(o.properties[E][U].latexRightParens===!1&&(j=!1),o.properties[H][fe].latexParens===!1&&(j=!1))}T=[x,j];break;default:(g.getIdentifier()==="OperatorNode:add"||g.getIdentifier()==="OperatorNode:multiply")&&(T=_.map(function(ve){var Q=o.getPrecedence(ve,y),se=o.isAssociativeWith(g,ve,y),be=o.getAssociativity(ve,y);return Q===null?!1:E===Q&&b===be&&!se?!0:Q<E}));break}return _.length>=2&&g.getIdentifier()==="OperatorNode:multiply"&&g.implicit&&y==="auto"&&d==="hide"&&(T=_.map(function(ve,Q){var se=ve.getIdentifier()==="ParenthesisNode";return!!(T[Q]||se)})),T}return h.prototype._toString=function(g){var y=g&&g.parenthesis?g.parenthesis:"keep",d=g&&g.implicit?g.implicit:"hide",_=this.args,v=p(this,y,d,_,!1);if(_.length===1){var E=o.getAssociativity(this,y),b=_[0].toString(g);v[0]&&(b="("+b+")");var N=/[a-zA-Z]+/.test(this.op);return E==="right"?this.op+(N?" ":"")+b:E==="left"?b+(N?" ":"")+this.op:b+this.op}else if(_.length===2){var T=_[0].toString(g),k=_[1].toString(g);return v[0]&&(T="("+T+")"),v[1]&&(k="("+k+")"),this.implicit&&this.getIdentifier()==="OperatorNode:multiply"&&d==="hide"?T+" "+k:T+" "+this.op+" "+k}else if(_.length>2&&(this.getIdentifier()==="OperatorNode:add"||this.getIdentifier()==="OperatorNode:multiply")){var I=_.map(function(w,x){return w=w.toString(g),v[x]&&(w="("+w+")"),w});return this.implicit&&this.getIdentifier()==="OperatorNode:multiply"&&d==="hide"?I.join(" "):I.join(" "+this.op+" ")}else return this.fn+"("+this.args.join(", ")+")"},h.prototype.toJSON=function(){return{mathjs:"OperatorNode",op:this.op,fn:this.fn,args:this.args,implicit:this.implicit}},h.fromJSON=function(g){return new h(g.op,g.fn,g.args,g.implicit)},h.prototype.toHTML=function(g){var y=g&&g.parenthesis?g.parenthesis:"keep",d=g&&g.implicit?g.implicit:"hide",_=this.args,v=p(this,y,d,_,!1);if(_.length===1){var E=o.getAssociativity(this,y),b=_[0].toHTML(g);return v[0]&&(b='<span class="math-parenthesis math-round-parenthesis">(</span>'+b+'<span class="math-parenthesis math-round-parenthesis">)</span>'),E==="right"?'<span class="math-operator math-unary-operator math-lefthand-unary-operator">'+i(this.op)+"</span>"+b:b+'<span class="math-operator math-unary-operator math-righthand-unary-operator">'+i(this.op)+"</span>"}else if(_.length===2){var N=_[0].toHTML(g),T=_[1].toHTML(g);return v[0]&&(N='<span class="math-parenthesis math-round-parenthesis">(</span>'+N+'<span class="math-parenthesis math-round-parenthesis">)</span>'),v[1]&&(T='<span class="math-parenthesis math-round-parenthesis">(</span>'+T+'<span class="math-parenthesis math-round-parenthesis">)</span>'),this.implicit&&this.getIdentifier()==="OperatorNode:multiply"&&d==="hide"?N+'<span class="math-operator math-binary-operator math-implicit-binary-operator"></span>'+T:N+'<span class="math-operator math-binary-operator math-explicit-binary-operator">'+i(this.op)+"</span>"+T}else{var k=_.map(function(I,w){return I=I.toHTML(g),v[w]&&(I='<span class="math-parenthesis math-round-parenthesis">(</span>'+I+'<span class="math-parenthesis math-round-parenthesis">)</span>'),I});return _.length>2&&(this.getIdentifier()==="OperatorNode:add"||this.getIdentifier()==="OperatorNode:multiply")?this.implicit&&this.getIdentifier()==="OperatorNode:multiply"&&d==="hide"?k.join('<span class="math-operator math-binary-operator math-implicit-binary-operator"></span>'):k.join('<span class="math-operator math-binary-operator math-explicit-binary-operator">'+i(this.op)+"</span>"):'<span class="math-function">'+i(this.fn)+'</span><span class="math-paranthesis math-round-parenthesis">(</span>'+k.join('<span class="math-separator">,</span>')+'<span class="math-paranthesis math-round-parenthesis">)</span>'}},h.prototype._toTex=function(g){var y=g&&g.parenthesis?g.parenthesis:"keep",d=g&&g.implicit?g.implicit:"hide",_=this.args,v=p(this,y,d,_,!0),E=n.operators[this.fn];if(E=typeof E>"u"?this.op:E,_.length===1){var b=o.getAssociativity(this,y),N=_[0].toTex(g);return v[0]&&(N="\\left(".concat(N,"\\right)")),b==="right"?E+N:N+E}else if(_.length===2){var T=_[0],k=T.toTex(g);v[0]&&(k="\\left(".concat(k,"\\right)"));var I=_[1],w=I.toTex(g);v[1]&&(w="\\left(".concat(w,"\\right)"));var x;switch(y==="keep"?x=T.getIdentifier():x=T.getContent().getIdentifier(),this.getIdentifier()){case"OperatorNode:divide":return E+"{"+k+"}{"+w+"}";case"OperatorNode:pow":switch(k="{"+k+"}",w="{"+w+"}",x){case"ConditionalNode":case"OperatorNode:divide":k="\\left(".concat(k,"\\right)")}break;case"OperatorNode:multiply":if(this.implicit&&d==="hide")return k+"~"+w}return k+E+w}else if(_.length>2&&(this.getIdentifier()==="OperatorNode:add"||this.getIdentifier()==="OperatorNode:multiply")){var B=_.map(function(F,j){return F=F.toTex(g),v[j]&&(F="\\left(".concat(F,"\\right)")),F});return this.getIdentifier()==="OperatorNode:multiply"&&this.implicit?B.join("~"):B.join(E)}else return"\\mathrm{"+this.fn+"}\\left("+_.map(function(F){return F.toTex(g)}).join(",")+"\\right)"},h.prototype.getIdentifier=function(){return this.type+":"+this.fn},h}return Vn.name="OperatorNode",Vn.path="expression.node",Vn.factory=a,Vn}var Gn={},Yo;function tc(){if(Yo)return Gn;Yo=1;function n(e,i,t,r){var o=t(ct());function a(l){if(!(this instanceof a))throw new SyntaxError("Constructor must be called with the new operator");if(!e.isNode(l))throw new TypeError('Node expected for parameter "content"');this.content=l}return a.prototype=new o,a.prototype.type="ParenthesisNode",a.prototype.isParenthesisNode=!0,a.prototype._compile=function(l,s){return this.content._compile(l,s)},a.prototype.getContent=function(){return this.content.getContent()},a.prototype.forEach=function(l){l(this.content,"content",this)},a.prototype.map=function(l){var s=l(this.content,"content",this);return new a(s)},a.prototype.clone=function(){return new a(this.content)},a.prototype._toString=function(l){return!l||l&&!l.parenthesis||l&&l.parenthesis==="keep"?"("+this.content.toString(l)+")":this.content.toString(l)},a.prototype.toJSON=function(){return{mathjs:"ParenthesisNode",content:this.content}},a.fromJSON=function(l){return new a(l.content)},a.prototype.toHTML=function(l){return!l||l&&!l.parenthesis||l&&l.parenthesis==="keep"?'<span class="math-parenthesis math-round-parenthesis">(</span>'+this.content.toHTML(l)+'<span class="math-parenthesis math-round-parenthesis">)</span>':this.content.toHTML(l)},a.prototype._toTex=function(l){return!l||l&&!l.parenthesis||l&&l.parenthesis==="keep"?"\\left(".concat(this.content.toTex(l),"\\right)"):this.content.toTex(l)},a}return Gn.name="ParenthesisNode",Gn.path="expression.node",Gn.factory=n,Gn}var fn={},cn={},Jo;function ms(){if(Jo)return cn;Jo=1;var n=xn(),e=Rt().escape,i=ut.hasOwnProperty,t=ft().getSafeProperty;function r(o,a,l,s,f){var u=l(ct());function c(g){return o.Unit?o.Unit.isValuelessUnit(g):!1}function h(g){if(!(this instanceof h))throw new SyntaxError("Constructor must be called with the new operator");if(typeof g!="string")throw new TypeError('String expected for parameter "name"');this.name=g}h.prototype=new u,h.prototype.type="SymbolNode",h.prototype.isSymbolNode=!0,h.prototype._compile=function(g,y){var d=this.name;if(i(y,d))return function(v,E,b){return E[d]};if(d in g)return function(v,E,b){return d in v?t(v,d):t(g,d)};var _=c(d);return function(v,E,b){return d in v?t(v,d):_?new o.Unit(null,d):p(d)}},h.prototype.forEach=function(g){},h.prototype.map=function(g){return this.clone()};function p(g){throw new Error("Undefined symbol "+g)}return h.prototype.clone=function(){return new h(this.name)},h.prototype._toString=function(g){return this.name},h.prototype.toHTML=function(g){var y=e(this.name);return y==="true"||y==="false"?'<span class="math-symbol math-boolean">'+y+"</span>":y==="i"?'<span class="math-symbol math-imaginary-symbol">'+y+"</span>":y==="Infinity"?'<span class="math-symbol math-infinity-symbol">'+y+"</span>":y==="NaN"?'<span class="math-symbol math-nan-symbol">'+y+"</span>":y==="null"?'<span class="math-symbol math-null-symbol">'+y+"</span>":y==="undefined"?'<span class="math-symbol math-undefined-symbol">'+y+"</span>":'<span class="math-symbol">'+y+"</span>"},h.prototype.toJSON=function(){return{mathjs:"SymbolNode",name:this.name}},h.fromJSON=function(g){return new h(g.name)},h.prototype._toTex=function(g){var y=!1;typeof f[this.name]>"u"&&c(this.name)&&(y=!0);var d=n.toSymbol(this.name,y);return d[0]==="\\"?d:" "+d},h}return cn.name="SymbolNode",cn.path="expression.node",cn.math=!0,cn.factory=r,cn}var Ko;function nc(){if(Ko)return fn;Ko=1;function n(f){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?n=function(c){return typeof c}:n=function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},n(f)}function e(){return e=Object.assign||function(f){for(var u=1;u<arguments.length;u++){var c=arguments[u];for(var h in c)Object.prototype.hasOwnProperty.call(c,h)&&(f[h]=c[h])}return f},e.apply(this,arguments)}var i=xn(),t=Rt().escape,r=ut.hasOwnProperty,o=Ut().map,a=ft().validateSafeMethod,l=ft().getSafeProperty;function s(f,u,c,h,p){var g=c(ct()),y=c(ms());function d(b,N){if(!(this instanceof d))throw new SyntaxError("Constructor must be called with the new operator");if(typeof b=="string"&&(b=new y(b)),!f.isNode(b))throw new TypeError('Node expected as parameter "fn"');if(!Array.isArray(N)||!N.every(f.isNode))throw new TypeError('Array containing Nodes expected for parameter "args"');this.fn=b,this.args=N||[],Object.defineProperty(this,"name",{get:function(){return this.fn.name||""}.bind(this),set:function(){throw new Error("Cannot assign a new name, name is read-only")}});var T=function(){throw new Error("Property `FunctionNode.object` is deprecated, use `FunctionNode.fn` instead")};Object.defineProperty(this,"object",{get:T,set:T})}d.prototype=new g,d.prototype.type="FunctionNode",d.prototype.isFunctionNode=!0,d.prototype._compile=function(b,N){if(!(this instanceof d))throw new TypeError("No valid FunctionNode");var T=o(this.args,function(ve){return ve._compile(b,N)});if(f.isSymbolNode(this.fn)){var k=this.fn.name,I=k in b?l(b,k):void 0,w=typeof I=="function"&&I.rawArgs===!0;if(w){var x=this.args;return function(Q,se,be){return(k in Q?l(Q,k):I)(x,b,e({},Q,se))}}else if(T.length===1){var B=T[0];return function(Q,se,be){return(k in Q?l(Q,k):I)(B(Q,se,be))}}else if(T.length===2){var F=T[0],j=T[1];return function(Q,se,be){return(k in Q?l(Q,k):I)(F(Q,se,be),j(Q,se,be))}}else return function(Q,se,be){return(k in Q?l(Q,k):I).apply(null,o(T,function(de){return de(Q,se,be)}))}}else if(f.isAccessorNode(this.fn)&&f.isIndexNode(this.fn.index)&&this.fn.index.isObjectProperty()){var H=this.fn.object._compile(b,N),K=this.fn.index.getObjectProperty(),U=this.args;return function(Q,se,be){var de=H(Q,se,be);a(de,K);var Y=de[K]&&de[K].rawArgs;return Y?de[K](U,b,e({},Q,se)):de[K].apply(de,o(T,function(Ue){return Ue(Q,se,be)}))}}else{var ee=this.fn._compile(b,N),fe=this.args;return function(Q,se,be){var de=ee(Q,se,be),Y=de&&de.rawArgs;return Y?de(fe,b,e({},Q,se)):de.apply(de,o(T,function(Ue){return Ue(Q,se,be)}))}}},d.prototype.forEach=function(b){b(this.fn,"fn",this);for(var N=0;N<this.args.length;N++)b(this.args[N],"args["+N+"]",this)},d.prototype.map=function(b){for(var N=this._ifNode(b(this.fn,"fn",this)),T=[],k=0;k<this.args.length;k++)T[k]=this._ifNode(b(this.args[k],"args["+k+"]",this));return new d(N,T)},d.prototype.clone=function(){return new d(this.fn,this.args.slice(0))};var _=d.prototype.toString;d.prototype.toString=function(b){var N,T=this.fn.toString(b);return b&&n(b.handler)==="object"&&r(b.handler,T)&&(N=b.handler[T](this,b)),typeof N<"u"?N:_.call(this,b)},d.prototype._toString=function(b){var N=this.args.map(function(k){return k.toString(b)}),T=f.isFunctionAssignmentNode(this.fn)?"("+this.fn.toString(b)+")":this.fn.toString(b);return T+"("+N.join(", ")+")"},d.prototype.toJSON=function(){return{mathjs:"FunctionNode",fn:this.fn,args:this.args}},d.fromJSON=function(b){return new d(b.fn,b.args)},d.prototype.toHTML=function(b){var N=this.args.map(function(T){return T.toHTML(b)});return'<span class="math-function">'+t(this.fn)+'</span><span class="math-paranthesis math-round-parenthesis">(</span>'+N.join('<span class="math-separator">,</span>')+'<span class="math-paranthesis math-round-parenthesis">)</span>'};function v(b,N,T){for(var k="",I=new RegExp("\\$(?:\\{([a-z_][a-z_0-9]*)(?:\\[([0-9]+)\\])?\\}|\\$)","ig"),w=0,x;(x=I.exec(b))!==null;)if(k+=b.substring(w,x.index),w=x.index,x[0]==="$$")k+="$",w++;else{w+=x[0].length;var B=N[x[1]];if(!B)throw new ReferenceError("Template: Property "+x[1]+" does not exist.");if(x[2]===void 0)switch(n(B)){case"string":k+=B;break;case"object":if(f.isNode(B))k+=B.toTex(T);else if(Array.isArray(B))k+=B.map(function(F,j){if(f.isNode(F))return F.toTex(T);throw new TypeError("Template: "+x[1]+"["+j+"] is not a Node.")}).join(",");else throw new TypeError("Template: "+x[1]+" has to be a Node, String or array of Nodes");break;default:throw new TypeError("Template: "+x[1]+" has to be a Node, String or array of Nodes")}else if(f.isNode(B[x[2]]&&B[x[2]]))k+=B[x[2]].toTex(T);else throw new TypeError("Template: "+x[1]+"["+x[2]+"] is not a Node.")}return k+=b.slice(w),k}var E=d.prototype.toTex;return d.prototype.toTex=function(b){var N;return b&&n(b.handler)==="object"&&r(b.handler,this.name)&&(N=b.handler[this.name](this,b)),typeof N<"u"?N:E.call(this,b)},d.prototype._toTex=function(b){var N=this.args.map(function(I){return I.toTex(b)}),T;p[this.name]&&(typeof p[this.name].toTex=="function"||n(p[this.name].toTex)==="object"||typeof p[this.name].toTex=="string")&&(T=p[this.name].toTex);var k;switch(n(T)){case"function":k=T(this,b);break;case"string":k=v(T,this,b);break;case"object":switch(n(T[N.length])){case"function":k=T[N.length](this,b);break;case"string":k=v(T[N.length],this,b);break}}return typeof k<"u"?k:v(i.defaultTemplate,this,b)},d.prototype.getIdentifier=function(){return this.type+":"+this.name},d}return fn.name="FunctionNode",fn.path="expression.node",fn.math=!0,fn.factory=s,fn}var Hn={},Zo;function rc(){if(Zo)return Hn;Zo=1;var n=Sn();function e(i,t,r,o){var a=r(ct());function l(f,u,c){if(!(this instanceof l))throw new SyntaxError("Constructor must be called with the new operator");if(!i.isNode(f))throw new TypeError("Node expected");if(!i.isNode(u))throw new TypeError("Node expected");if(c&&!i.isNode(c))throw new TypeError("Node expected");if(arguments.length>3)throw new Error("Too many arguments");this.start=f,this.end=u,this.step=c||null}l.prototype=new a,l.prototype.type="RangeNode",l.prototype.isRangeNode=!0,l.prototype.needsEnd=function(){var f=this.filter(function(u){return i.isSymbolNode(u)&&u.name==="end"});return f.length>0},l.prototype._compile=function(f,u){var c=f.range,h=this.start._compile(f,u),p=this.end._compile(f,u);if(this.step){var g=this.step._compile(f,u);return function(d,_,v){return c(h(d,_,v),p(d,_,v),g(d,_,v))}}else return function(d,_,v){return c(h(d,_,v),p(d,_,v))}},l.prototype.forEach=function(f){f(this.start,"start",this),f(this.end,"end",this),this.step&&f(this.step,"step",this)},l.prototype.map=function(f){return new l(this._ifNode(f(this.start,"start",this)),this._ifNode(f(this.end,"end",this)),this.step&&this._ifNode(f(this.step,"step",this)))},l.prototype.clone=function(){return new l(this.start,this.end,this.step&&this.step)};function s(f,u){var c=n.getPrecedence(f,u),h={},p=n.getPrecedence(f.start,u);if(h.start=p!==null&&p<=c||u==="all",f.step){var g=n.getPrecedence(f.step,u);h.step=g!==null&&g<=c||u==="all"}var y=n.getPrecedence(f.end,u);return h.end=y!==null&&y<=c||u==="all",h}return l.prototype._toString=function(f){var u=f&&f.parenthesis?f.parenthesis:"keep",c=s(this,u),h,p=this.start.toString(f);if(c.start&&(p="("+p+")"),h=p,this.step){var g=this.step.toString(f);c.step&&(g="("+g+")"),h+=":"+g}var y=this.end.toString(f);return c.end&&(y="("+y+")"),h+=":"+y,h},l.prototype.toJSON=function(){return{mathjs:"RangeNode",start:this.start,end:this.end,step:this.step}},l.fromJSON=function(f){return new l(f.start,f.end,f.step)},l.prototype.toHTML=function(f){var u=f&&f.parenthesis?f.parenthesis:"keep",c=s(this,u),h,p=this.start.toHTML(f);if(c.start&&(p='<span class="math-parenthesis math-round-parenthesis">(</span>'+p+'<span class="math-parenthesis math-round-parenthesis">)</span>'),h=p,this.step){var g=this.step.toHTML(f);c.step&&(g='<span class="math-parenthesis math-round-parenthesis">(</span>'+g+'<span class="math-parenthesis math-round-parenthesis">)</span>'),h+='<span class="math-operator math-range-operator">:</span>'+g}var y=this.end.toHTML(f);return c.end&&(y='<span class="math-parenthesis math-round-parenthesis">(</span>'+y+'<span class="math-parenthesis math-round-parenthesis">)</span>'),h+='<span class="math-operator math-range-operator">:</span>'+y,h},l.prototype._toTex=function(f){var u=f&&f.parenthesis?f.parenthesis:"keep",c=s(this,u),h=this.start.toTex(f);if(c.start&&(h="\\left(".concat(h,"\\right)")),this.step){var p=this.step.toTex(f);c.step&&(p="\\left(".concat(p,"\\right)")),h+=":"+p}var g=this.end.toTex(f);return c.end&&(g="\\left(".concat(g,"\\right)")),h+=":"+g,h},l}return Hn.name="RangeNode",Hn.path="expression.node",Hn.factory=e,Hn}var qn={},Qo;function ic(){if(Qo)return qn;Qo=1;var n=Sn(),e=xn(),i=Rt().escape;function t(r,o,a,l){var s=a(ct()),f=ft().getSafeProperty;function u(c,h){if(!(this instanceof u))throw new SyntaxError("Constructor must be called with the new operator");if(!Array.isArray(c))throw new TypeError("Parameter conditionals must be an array");if(!Array.isArray(h))throw new TypeError("Parameter params must be an array");if(c.length!==h.length-1)throw new TypeError("Parameter params must contain exactly one more element than parameter conditionals");this.conditionals=c,this.params=h}return u.prototype=new s,u.prototype.type="RelationalNode",u.prototype.isRelationalNode=!0,u.prototype._compile=function(c,h){var p=this,g=this.params.map(function(y){return y._compile(c,h)});return function(d,_,v){for(var E,b=g[0](d,_,v),N=0;N<p.conditionals.length;N++){E=b,b=g[N+1](d,_,v);var T=f(c,p.conditionals[N]);if(!T(E,b))return!1}return!0}},u.prototype.forEach=function(c){var h=this;this.params.forEach(function(p,g){return c(p,"params["+g+"]",h)},this)},u.prototype.map=function(c){var h=this;return new u(this.conditionals.slice(),this.params.map(function(p,g){return h._ifNode(c(p,"params["+g+"]",h))},this))},u.prototype.clone=function(){return new u(this.conditionals,this.params)},u.prototype._toString=function(c){for(var h=c&&c.parenthesis?c.parenthesis:"keep",p=n.getPrecedence(this,h),g=this.params.map(function(v,E){var b=n.getPrecedence(v,h);return h==="all"||b!==null&&b<=p?"("+v.toString(c)+")":v.toString(c)}),y={equal:"==",unequal:"!=",smaller:"<",larger:">",smallerEq:"<=",largerEq:">="},d=g[0],_=0;_<this.conditionals.length;_++)d+=" "+y[this.conditionals[_]]+" "+g[_+1];return d},u.prototype.toJSON=function(){return{mathjs:"RelationalNode",conditionals:this.conditionals,params:this.params}},u.fromJSON=function(c){return new u(c.conditionals,c.params)},u.prototype.toHTML=function(c){for(var h=c&&c.parenthesis?c.parenthesis:"keep",p=n.getPrecedence(this,h),g=this.params.map(function(v,E){var b=n.getPrecedence(v,h);return h==="all"||b!==null&&b<=p?'<span class="math-parenthesis math-round-parenthesis">(</span>'+v.toHTML(c)+'<span class="math-parenthesis math-round-parenthesis">)</span>':v.toHTML(c)}),y={equal:"==",unequal:"!=",smaller:"<",larger:">",smallerEq:"<=",largerEq:">="},d=g[0],_=0;_<this.conditionals.length;_++)d+='<span class="math-operator math-binary-operator math-explicit-binary-operator">'+i(y[this.conditionals[_]])+"</span>"+g[_+1];return d},u.prototype._toTex=function(c){for(var h=c&&c.parenthesis?c.parenthesis:"keep",p=n.getPrecedence(this,h),g=this.params.map(function(_,v){var E=n.getPrecedence(_,h);return h==="all"||E!==null&&E<=p?"\\left("+_.toTex(c)+"\right)":_.toTex(c)}),y=g[0],d=0;d<this.conditionals.length;d++)y+=e.operators[this.conditionals[d]]+g[d+1];return y},u}return qn.name="RelationalNode",qn.path="expression.node",qn.factory=t,qn}var $o;function Ni(){if($o)return Tn;$o=1;function n(){return n=Object.assign||function(r){for(var o=1;o<arguments.length;o++){var a=arguments[o];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(r[l]=a[l])}return r},n.apply(this,arguments)}var e=ss(),i=Nn();function t(r,o,a,l){var s=a(Bf()),f=a(Vf()),u=a(Gf()),c=a(qf()),h=a(Wf()),p=a(Xf()),g=a(Jf()),y=a(Kf()),d=a(Qf()),_=a($f()),v=a(ec()),E=a(tc()),b=a(nc()),N=a(rc()),T=a(ic()),k=a(ms());function I(m,S){if(arguments.length!==1&&arguments.length!==2)throw new e("parse",arguments.length,1,2);var M=S&&S.nodes?S.nodes:{};if(typeof m=="string")return Y(m,M);if(Array.isArray(m)||m instanceof r.Matrix)return i(m,function(z){if(typeof z!="string")throw new TypeError("String expected");return Y(z,M)});throw new TypeError("String or matrix expected")}var w={NULL:0,DELIMITER:1,NUMBER:2,SYMBOL:3,UNKNOWN:4},x={",":!0,"(":!0,")":!0,"[":!0,"]":!0,"{":!0,"}":!0,'"':!0,"'":!0,";":!0,"+":!0,"-":!0,"*":!0,".*":!0,"/":!0,"./":!0,"%":!0,"^":!0,".^":!0,"~":!0,"!":!0,"&":!0,"|":!0,"^|":!0,"=":!0,":":!0,"?":!0,"==":!0,"!=":!0,"<":!0,">":!0,"<=":!0,">=":!0,"<<":!0,">>":!0,">>>":!0},B={mod:!0,to:!0,in:!0,and:!0,xor:!0,or:!0,not:!0},F={true:!0,false:!1,null:null,undefined:void 0},j=["NaN","Infinity"];function H(){return{extraNodes:{},expression:"",comment:"",index:0,token:"",tokenType:w.NULL,nestingLevel:0,conditionalLevel:null}}function K(m,S){return m.expression.substr(m.index,S)}function U(m){return K(m,1)}function ee(m){m.index++}function fe(m){return m.expression.charAt(m.index-1)}function ve(m){return m.expression.charAt(m.index+1)}function Q(m){for(m.tokenType=w.NULL,m.token="",m.comment="";I.isWhitespace(U(m),m.nestingLevel);)ee(m);if(U(m)==="#")for(;U(m)!==`
`&&U(m)!=="";)m.comment+=U(m),ee(m);if(U(m)===""){m.tokenType=w.DELIMITER;return}if(U(m)===`
`&&!m.nestingLevel){m.tokenType=w.DELIMITER,m.token=U(m),ee(m);return}var S=U(m),M=K(m,2),z=K(m,3);if(z.length===3&&x[z]){m.tokenType=w.DELIMITER,m.token=z,ee(m),ee(m),ee(m);return}if(M.length===2&&x[M]){m.tokenType=w.DELIMITER,m.token=M,ee(m),ee(m);return}if(x[S]){m.tokenType=w.DELIMITER,m.token=S,ee(m);return}if(I.isDigitDot(S)){if(m.tokenType=w.NUMBER,U(m)===".")m.token+=U(m),ee(m),I.isDigit(U(m))||(m.tokenType=w.DELIMITER);else{for(;I.isDigit(U(m));)m.token+=U(m),ee(m);I.isDecimalMark(U(m),ve(m))&&(m.token+=U(m),ee(m))}for(;I.isDigit(U(m));)m.token+=U(m),ee(m);if(U(m)==="E"||U(m)==="e"){if(I.isDigit(ve(m))||ve(m)==="-"||ve(m)==="+"){if(m.token+=U(m),ee(m),(U(m)==="+"||U(m)==="-")&&(m.token+=U(m),ee(m)),!I.isDigit(U(m)))throw W(m,'Digit expected, got "'+U(m)+'"');for(;I.isDigit(U(m));)m.token+=U(m),ee(m);if(I.isDecimalMark(U(m),ve(m)))throw W(m,'Digit expected, got "'+U(m)+'"')}else if(ve(m)===".")throw ee(m),W(m,'Digit expected, got "'+U(m)+'"')}return}if(I.isAlpha(U(m),fe(m),ve(m))){for(;I.isAlpha(U(m),fe(m),ve(m))||I.isDigit(U(m));)m.token+=U(m),ee(m);B.hasOwnProperty(m.token)?m.tokenType=w.DELIMITER:m.tokenType=w.SYMBOL;return}for(m.tokenType=w.UNKNOWN;U(m)!=="";)m.token+=U(m),ee(m);throw W(m,'Syntax error in part "'+m.token+'"')}function se(m){do Q(m);while(m.token===`
`)}function be(m){m.nestingLevel++}function de(m){m.nestingLevel--}I.isAlpha=function(S,M,z){return I.isValidLatinOrGreek(S)||I.isValidMathSymbol(S,z)||I.isValidMathSymbol(M,S)},I.isValidLatinOrGreek=function(S){return/^[a-zA-Z_$\u00C0-\u02AF\u0370-\u03FF\u2100-\u214F]$/.test(S)},I.isValidMathSymbol=function(S,M){return/^[\uD835]$/.test(S)&&/^[\uDC00-\uDFFF]$/.test(M)&&/^[^\uDC55\uDC9D\uDCA0\uDCA1\uDCA3\uDCA4\uDCA7\uDCA8\uDCAD\uDCBA\uDCBC\uDCC4\uDD06\uDD0B\uDD0C\uDD15\uDD1D\uDD3A\uDD3F\uDD45\uDD47-\uDD49\uDD51\uDEA6\uDEA7\uDFCC\uDFCD]$/.test(M)},I.isWhitespace=function(S,M){return S===" "||S==="	"||S===`
`&&M>0},I.isDecimalMark=function(S,M){return S==="."&&M!=="/"&&M!=="*"&&M!=="^"},I.isDigitDot=function(S){return S>="0"&&S<="9"||S==="."},I.isDigit=function(S){return S>="0"&&S<="9"};function Y(m,S){var M=H();n(M,{expression:m,extraNodes:S}),Q(M);var z=Ue(M);if(M.token!=="")throw M.tokenType===w.DELIMITER?me(M,"Unexpected operator "+M.token):W(M,'Unexpected part "'+M.token+'"');return z}function Ue(m){var S,M=[],z;for(m.token!==""&&m.token!==`
`&&m.token!==";"&&(S=Oe(m),S.comment=m.comment);m.token===`
`||m.token===";";)M.length===0&&S&&(z=m.token!==";",M.push({node:S,visible:z})),Q(m),m.token!==`
`&&m.token!==";"&&m.token!==""&&(S=Oe(m),S.comment=m.comment,z=m.token!==";",M.push({node:S,visible:z}));return M.length>0?new h(M):(S||(S=new g(void 0),S.comment=m.comment),S)}function Oe(m){var S,M,z,we,Te=We(m);if(m.token==="="){if(r.isSymbolNode(Te))return S=Te.name,se(m),z=Oe(m),new c(new k(S),z);if(r.isAccessorNode(Te))return se(m),z=Oe(m),new c(Te.object,Te.index,z);if(r.isFunctionNode(Te)&&r.isSymbolNode(Te.fn)&&(we=!0,M=[],S=Te.name,Te.args.forEach(function(wt,Bt){r.isSymbolNode(wt)?M[Bt]=wt.name:we=!1}),we))return se(m),z=Oe(m),new y(S,M,z);throw W(m,"Invalid left hand side of assignment operator =")}return Te}function We(m){for(var S=kt(m);m.token==="?";){var M=m.conditionalLevel;m.conditionalLevel=m.nestingLevel,se(m);var z=S,we=Oe(m);if(m.token!==":")throw W(m,"False part of conditional expression expected");m.conditionalLevel=null,se(m);var Te=Oe(m);S=new p(z,we,Te),m.conditionalLevel=M}return S}function kt(m){for(var S=it(m);m.token==="or";)se(m),S=new v("or","or",[S,it(m)]);return S}function it(m){for(var S=ot(m);m.token==="xor";)se(m),S=new v("xor","xor",[S,ot(m)]);return S}function ot(m){for(var S=xt(m);m.token==="and";)se(m),S=new v("and","and",[S,xt(m)]);return S}function xt(m){for(var S=Mt(m);m.token==="|";)se(m),S=new v("|","bitOr",[S,Mt(m)]);return S}function Mt(m){for(var S=rt(m);m.token==="^|";)se(m),S=new v("^|","bitXor",[S,rt(m)]);return S}function rt(m){for(var S=pt(m);m.token==="&";)se(m),S=new v("&","bitAnd",[S,pt(m)]);return S}function pt(m){for(var S=[Pt(m)],M=[],z={"==":"equal","!=":"unequal","<":"smaller",">":"larger","<=":"smallerEq",">=":"largerEq"};z.hasOwnProperty(m.token);){var we={name:m.token,fn:z[m.token]};M.push(we),se(m),S.push(Pt(m))}return S.length===1?S[0]:S.length===2?new v(M[0].name,M[0].fn,S):new T(M.map(function(Te){return Te.fn}),S)}function Pt(m){var S,M,z,we,Te;for(S=tt(m),M={"<<":"leftShift",">>":"rightArithShift",">>>":"rightLogShift"};M.hasOwnProperty(m.token);)z=m.token,we=M[z],se(m),Te=[S,tt(m)],S=new v(z,we,Te);return S}function tt(m){var S,M,z,we,Te;for(S=$(m),M={to:"to",in:"to"};M.hasOwnProperty(m.token);)z=m.token,we=M[z],se(m),z==="in"&&m.token===""?S=new v("*","multiply",[S,new k("in")],!0):(Te=[S,$(m)],S=new v(z,we,Te));return S}function $(m){var S,M=[];if(m.token===":"?S=new g(1):S=Ae(m),m.token===":"&&m.conditionalLevel!==m.nestingLevel){for(M.push(S);m.token===":"&&M.length<3;)se(m),m.token===")"||m.token==="]"||m.token===","||m.token===""?M.push(new k("end")):M.push(Ae(m));M.length===3?S=new N(M[0],M[2],M[1]):S=new N(M[0],M[1])}return S}function Ae(m){var S,M,z,we,Te;for(S=O(m),M={"+":"add","-":"subtract"};M.hasOwnProperty(m.token);)z=m.token,we=M[z],se(m),Te=[S,O(m)],S=new v(z,we,Te);return S}function O(m){var S,M,z,we,Te;for(S=C(m),M=S,z={"*":"multiply",".*":"dotMultiply","/":"divide","./":"dotDivide","%":"mod",mod:"mod"};z.hasOwnProperty(m.token);)we=m.token,Te=z[we],se(m),M=C(m),S=new v(we,Te,[S,M]);return S}function C(m){var S,M;for(S=L(m),M=S;m.tokenType===w.SYMBOL||m.token==="in"&&r.isConstantNode(S)||m.tokenType===w.NUMBER&&!r.isConstantNode(M)&&(!r.isOperatorNode(M)||M.op==="!")||m.token==="(";)M=L(m),S=new v("*","multiply",[S,M],!0);return S}function L(m){for(var S=D(m),M=S,z=[];m.token==="/"&&r.isConstantNode(M);)if(z.push(n({},m)),se(m),m.tokenType===w.NUMBER)if(z.push(n({},m)),se(m),m.tokenType===w.SYMBOL||m.token==="(")n(m,z.pop()),z.pop(),M=D(m),S=new v("/","divide",[S,M]);else{z.pop(),n(m,z.pop());break}else{n(m,z.pop());break}return S}function D(m){var S,M,z,we={"-":"unaryMinus","+":"unaryPlus","~":"bitNot",not:"not"};return we.hasOwnProperty(m.token)?(z=we[m.token],S=m.token,se(m),M=[D(m)],new v(S,z,M)):J(m)}function J(m){var S,M,z,we;return S=Z(m),(m.token==="^"||m.token===".^")&&(M=m.token,z=M==="^"?"pow":"dotPow",se(m),we=[S,D(m)],S=new v(M,z,we)),S}function Z(m){var S,M,z,we,Te;for(S=le(m),M={"!":"factorial","'":"ctranspose"};M.hasOwnProperty(m.token);)z=m.token,we=M[z],Q(m),Te=[S],S=new v(z,we,Te),S=X(m,S);return S}function le(m){var S=[];if(m.tokenType===w.SYMBOL&&m.extraNodes.hasOwnProperty(m.token)){var M=m.extraNodes[m.token];if(Q(m),m.token==="("){if(S=[],be(m),Q(m),m.token!==")")for(S.push(Oe(m));m.token===",";)Q(m),S.push(Oe(m));if(m.token!==")")throw W(m,"Parenthesis ) expected");de(m),Q(m)}return new M(S)}return re(m)}function re(m){var S,M;return m.tokenType===w.SYMBOL||m.tokenType===w.DELIMITER&&m.token in B?(M=m.token,Q(m),F.hasOwnProperty(M)?S=new g(F[M]):j.indexOf(M)!==-1?S=new g(s(M,"number")):S=new k(M),S=X(m,S),S):ie(m)}function X(m,S,M){for(var z;(m.token==="("||m.token==="["||m.token===".")&&(!M||M.indexOf(m.token)!==-1);)if(z=[],m.token==="(")if(r.isSymbolNode(S)||r.isAccessorNode(S)){if(be(m),Q(m),m.token!==")")for(z.push(Oe(m));m.token===",";)Q(m),z.push(Oe(m));if(m.token!==")")throw W(m,"Parenthesis ) expected");de(m),Q(m),S=new b(S,z)}else return S;else if(m.token==="["){if(be(m),Q(m),m.token!=="]")for(z.push(Oe(m));m.token===",";)Q(m),z.push(Oe(m));if(m.token!=="]")throw W(m,"Parenthesis ] expected");de(m),Q(m),S=new f(S,new d(z))}else{if(Q(m),m.tokenType!==w.SYMBOL)throw W(m,"Property name expected after dot");z.push(new g(m.token)),Q(m);var we=!0;S=new f(S,new d(z,we))}return S}function ie(m){var S,M;return m.token==='"'?(M=Ve(m),S=new g(M),S=X(m,S),S):Be(m)}function Ve(m){for(var S="";U(m)!==""&&U(m)!=='"';)U(m)==="\\"&&(S+=U(m),ee(m)),S+=U(m),ee(m);if(Q(m),m.token!=='"')throw W(m,'End of string " expected');return Q(m),JSON.parse('"'+S+'"')}function Be(m){var S,M;return m.token==="'"?(M=Xe(m),S=new g(M),S=X(m,S),S):Ie(m)}function Xe(m){for(var S="";U(m)!==""&&U(m)!=="'";)U(m)==="\\"&&(S+=U(m),ee(m)),S+=U(m),ee(m);if(Q(m),m.token!=="'")throw W(m,"End of string ' expected");return Q(m),JSON.parse('"'+S+'"')}function Ie(m){var S,M,z,we;if(m.token==="["){if(be(m),Q(m),m.token!=="]"){var Te=mt(m);if(m.token===";"){for(z=1,M=[Te];m.token===";";)Q(m),M[z]=mt(m),z++;if(m.token!=="]")throw W(m,"End of matrix ] expected");de(m),Q(m),we=M[0].items.length;for(var wt=1;wt<z;wt++)if(M[wt].items.length!==we)throw me(m,"Column dimensions mismatch ("+M[wt].items.length+" !== "+we+")");S=new u(M)}else{if(m.token!=="]")throw W(m,"End of matrix ] expected");de(m),Q(m),S=Te}}else de(m),Q(m),S=new u([]);return X(m,S)}return nt(m)}function mt(m){for(var S=[Oe(m)],M=1;m.token===",";)Q(m),S[M]=Oe(m),M++;return new u(S)}function nt(m){if(m.token==="{"){be(m);var S,M={};do if(Q(m),m.token!=="}"){if(m.token==='"')S=Ve(m);else if(m.token==="'")S=Xe(m);else if(m.tokenType===w.SYMBOL)S=m.token,Q(m);else throw W(m,"Symbol or string expected as object key");if(m.token!==":")throw W(m,"Colon : expected after object key");Q(m),M[S]=Oe(m)}while(m.token===",");if(m.token!=="}")throw W(m,"Comma , or bracket } expected after object value");de(m),Q(m);var z=new _(M);return z=X(m,z),z}return Me(m)}function Me(m){var S;return m.tokenType===w.NUMBER?(S=m.token,Q(m),new g(s(S,o.number))):On(m)}function On(m){var S;if(m.token==="("){if(be(m),Q(m),S=Oe(m),m.token!==")")throw W(m,"Parenthesis ) expected");return de(m),Q(m),S=new E(S),S=X(m,S),S}return Xt(m)}function Xt(m){throw m.token===""?W(m,"Unexpected end of expression"):W(m,"Value expected")}function Qe(m){return m.index-m.token.length+1}function W(m,S){var M=Qe(m),z=new SyntaxError(S+" (char "+M+")");return z.char=M,z}function me(m,S){var M=Qe(m),z=new SyntaxError(S+" (char "+M+")");return z.char=M,z}return I}return Tn.name="parse",Tn.path="expression",Tn.factory=t,Tn}var ea;function oc(){if(ea)return ar;ea=1;function n(e,i,t,r){var o=t(Ni());return r("parse",{"string | Array | Matrix":o,"string | Array | Matrix, Object":o})}return ar.name="parse",ar.factory=n,ar}var hr={},ta;function ac(){if(ta)return hr;ta=1;var n=Nn();function e(i,t,r,o){var a=r(Ni());return o("compile",{string:function(s){return a(s).compile()},"Array | Matrix":function(s){return n(s,function(f){return a(f).compile()})}})}return hr.name="compile",hr.factory=e,hr}var pr={},na;function sc(){if(na)return pr;na=1;var n=Nn();function e(i,t,r,o){var a=r(Ni());return o("compile",{string:function(s){var f={};return a(s).compile().eval(f)},"string, Object":function(s,f){return a(s).compile().eval(f)},"Array | Matrix":function(s){var f={};return n(s,function(u){return a(u).compile().eval(f)})},"Array | Matrix, Object":function(s,f){return n(s,function(u){return a(u).compile().eval(f)})}})}return pr.name="eval",pr.factory=e,pr}var mr={},ra;function lc(){if(ra)return mr;ra=1;var n=Rt();function e(i,t,r,o){var a=o("format",{any:n.format,"any, Object | function | number":n.format});return a.toTex=void 0,a}return mr.name="format",mr.factory=e,mr}var uc=ts.exports,$t=uc.create();$t.import(oc());$t.import(ac());$t.import(sc());$t.import(lc());$t.import({add:function(n,e){return n+e},subtract:function(n,e){return n-e},multiply:function(n,e){return n*e},divide:function(n,e){return n/e},mod:function(n,e){return n%e},unaryPlus:function(n){return n},unaryMinus:function(n){return-n},bitOr:function(n,e){return n|e},bitXor:function(n,e){return n^e},bitAnd:function(n,e){return n&e},bitNot:function(n){return~n},leftShift:function(n,e){return n<<e},rightArithShift:function(n,e){return n>>e},rightLogShift:function(n,e){return n>>>e},or:function(n,e){return!!(n||e)},xor:function(n,e){return!!n!=!!e},and:function(n,e){return!!(n&&e)},not:function(n){return!n},equal:function(n,e){return n==e},unequal:function(n,e){return n!=e},smaller:function(n,e){return n<e},larger:function(n,e){return n>e},smallerEq:function(n,e){return n<=e},largerEq:function(n,e){return n>=e},matrix:function(){throw new Error("Matrices not supported")},index:function(){throw new Error("Matrix indexes not supported")},pi:Math.PI,e:Math.E,true:!0,false:!1,null:null});var gs={};Object.getOwnPropertyNames(Math).forEach(function(n){Object.prototype.hasOwnProperty(n)||(gs[n]=Math[n])});$t.import(gs);var fc=$t;const Si=function(e){this.gl=e,this.textureIndex=0};Si.prototype.newTextureIndex=function(){const e=this.textureIndex;return this.textureIndex+=1,e};Si.prototype.reset=function(){this.textureIndex=0};function Wt(n,e,i){console.log("HELLO",n),this.gl=n,console.log("\u{1F6A8} shaders:",this.gl.VERTEX_SHADER),this.vShader=this.createShader(e,this.gl.VERTEX_SHADER),this.fShader=this.createShader(i,this.gl.FRAGMENT_SHADER),this.program=this.createProgram(this.vShader,this.fShader),this.locations={}}Wt.prototype.use=function(){try{this.gl.useProgram(this.program)}catch(e){console.error(e),console.error(this.gl.getError())}};Wt.prototype.getUniformLocation=function(e){return this.gl.getUniformLocation(this.program,e)};Wt.prototype.bindVertices=function(){this.use();const e=this.gl.getAttribLocation(this.program,"isf_position");this.buffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer);const i=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);this.gl.bufferData(this.gl.ARRAY_BUFFER,i,this.gl.STATIC_DRAW),this.gl.enableVertexAttribArray(e),this.gl.vertexAttribPointer(e,2,this.gl.FLOAT,!1,0,0)};Wt.prototype.cleanup=function(){this.gl.deleteShader(this.fShader),this.gl.deleteShader(this.vShader),this.gl.deleteProgram(this.program),this.gl.deleteBuffer(this.buffer)};Wt.prototype.createShader=function(e,i){const t=this.gl.createShader(i);this.gl.shaderSource(t,e),this.gl.compileShader(t);const r=this.gl.getShaderParameter(t,this.gl.COMPILE_STATUS);if(window.shaderSrc=e,console.log("\u{1F6A8} compiled:",r,this.gl.getShaderInfoLog(t)),!r){const o=this.gl.getShaderInfoLog(t),a=e.split(`
`);throw console.log(o),o.split(`
`).forEach(l=>{var c,h,p;l=l.substring(9);const s=parseInt(((c=l.split(":"))==null?void 0:c[0])||0),f=((h=l.split(":"))==null?void 0:h[1])||"N/A";console.error(`${f} ${(p=l.split(":"))==null?void 0:p[2]}`);let u="";for(let g=s-1;g<s+1;g++)u+=`${g}: ${a[g].replaceAll("	","").replaceAll(`
`,"")}
`;console.log(u)}),new Error({message:o,type:"shader"})}return t};Wt.prototype.createProgram=function(e,i){const t=this.gl.createProgram();if(this.gl.attachShader(t,e),this.gl.attachShader(t,i),this.gl.linkProgram(t),!this.gl.getProgramParameter(t,this.gl.LINK_STATUS)){const o=this.gl.getProgramInfoLog(t);throw console.log("Error in program linking",o),new Error({message:o,type:"program"})}return t};function wn(n,e){n==null&&(n={}),this.contextState=e,this.float=n.float,this.gl=this.contextState.gl,this.texture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0),this.gl.bindTexture(this.gl.TEXTURE_2D,null)}wn.prototype.bind=function(e){e==null&&(e=-1);const i=this.contextState.newTextureIndex();this.gl.activeTexture(this.gl.TEXTURE0+i),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),e!==-1&&this.gl.uniform1i(e,i)};wn.prototype.setSize=function(e,i){if(this.width!==e||this.height!==i){this.width=e,this.height=i;const t=this.float?this.gl.FLOAT:this.gl.UNSIGNED_BYTE;this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,e,i,0,this.gl.RGBA,t,null)}};wn.prototype.destroy=function(){this.gl.deleteTexture(this.texture)};function In(n,e){this.contextState=e,this.gl=this.contextState.gl,this.persistent=n.persistent,this.name=n.target,this.textures=[],this.textures.push(new wn(n,this.contextState)),this.textures.push(new wn(n,this.contextState)),this.flipFlop=!1,this.fbo=this.gl.createFramebuffer(),this.flipFlop=!1}In.prototype.setSize=function(e,i){if(this.width!==e||this.height!==i){this.width=e,this.height=i;for(let t=0;t<this.textures.length;t++)this.textures[t].setSize(e,i)}};In.prototype.readTexture=function(){return this.flipFlop?this.textures[1]:this.textures[0]};In.prototype.writeTexture=function(){return this.flipFlop?this.textures[0]:this.textures[1]};In.prototype.flip=function(){this.flipFlop=!this.flipFlop};In.prototype.destroy=function(){for(let e=0;e<this.textures.length;e++)this.textures[e].destroy();this.gl.deleteFramebuffer(this.fbo)};const cc=function(){var n,e,i={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},t,r=function(p){throw{name:"SyntaxError",message:p,at:n,text:t}},o=function(p){return p&&p!==e&&r("Expected '"+p+"' instead of '"+e+"'"),e=t.charAt(n),n+=1,e},a=function(){var p,g="";for(e==="-"&&(g="-",o("-"));e>="0"&&e<="9";)g+=e,o();if(e===".")for(g+=".";o()&&e>="0"&&e<="9";)g+=e;if(e==="e"||e==="E")for(g+=e,o(),(e==="-"||e==="+")&&(g+=e,o());e>="0"&&e<="9";)g+=e,o();if(p=+g,!isFinite(p))r("Bad number");else return p},l=function(){var p,g,y="",d;if(e==='"')for(;o();){if(e==='"')return o(),y;if(e==="\\")if(o(),e==="u"){for(d=0,g=0;g<4&&(p=parseInt(o(),16),!!isFinite(p));g+=1)d=d*16+p;y+=String.fromCharCode(d)}else if(typeof i[e]=="string")y+=i[e];else break;else y+=e}r("Bad string")},s=function(){for(;e&&e<=" ";)o()},f=function(){switch(e){case"t":return o("t"),o("r"),o("u"),o("e"),!0;case"f":return o("f"),o("a"),o("l"),o("s"),o("e"),!1;case"n":return o("n"),o("u"),o("l"),o("l"),null}r("Unexpected '"+e+"'")},u,c=function(){var p=[];if(e==="["){if(o("["),s(),e==="]")return o("]"),p;for(;e;){if(p.push(u()),s(),e==="]")return o("]"),p;o(","),s()}}r("Bad array")},h=function(){var p,g={};if(e==="{"){if(o("{"),s(),e==="}")return o("}"),g;for(;e;){if(p=l(),s(),o(":"),Object.hasOwnProperty.call(g,p)&&r("Duplicate key '"+p+"'"),g[p]=u(),s(),e==="}")return o("}"),g;o(","),s()}}r("Bad object")};return u=function(){switch(s(),e){case"{":return h();case"[":return c();case'"':return l();case"-":return a();default:return e>="0"&&e<="9"?a():f()}},function(p,g){var y;return t=p,n=0,e=" ",y=u(),s(),e&&r("Syntax error"),typeof g=="function"?function d(_,v){var E,b,N=_[v];if(N&&typeof N=="object")for(E in N)Object.prototype.hasOwnProperty.call(N,E)&&(b=d(N,E),b!==void 0?N[E]=b:delete N[E]);return g.call(_,v,N)}({"":y},""):y}}(),ia="Something is wrong with your ISF metadata";function dc(n){const i=/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*+/.exec(n);if(!i)throw new Error("There is no metadata here.");let t=i[0];t=t.substring(1,t.length-1);let r;try{r=cc(t)}catch(l){const s=l.at,f=l.message||"Invalid JSON";if(s){const u=(t||"").substring(0,s).split(/\r\n|\r|\n/),c=u.length,h=u[c-1].length,p=`${ia}: ${f}        at line ${c} and position ${h}`,g=new Error(p);throw g.lineNumber=c,g.position=h,g}throw new Error(`${ia}: ${f}`)}const o=n.indexOf("/*"),a=n.indexOf("*/");return{objectValue:r,stringValue:t,startIndex:o,endIndex:a}}const hc={float:"float",image:"sampler2D",bool:"bool",event:"bool",long:"int",color:"vec4",point2D:"vec2"},Ke=function(){};Ke.prototype.parse=function(e,i){try{this.valid=!0,this.rawFragmentShader=e,this.rawVertexShader=i||Ke.vertexShaderDefault,this.error=null;const t=dc(this.rawFragmentShader),r=t.objectValue,o=t.stringValue;this.metadata=r,this.credit=r.CREDIT,this.categories=r.CATEGORIES,this.inputs=r.INPUTS,this.imports=r.IMPORTED||{},this.description=r.DESCRIPTION;const a=r.PASSES||[{}];this.passes=this.parsePasses(a);const l=this.rawFragmentShader.indexOf(o)+o.length+2;this.rawFragmentMain=this.rawFragmentShader.substring(l),this.generateShaders(),this.inferFilterType(),this.isfVersion=this.inferISFVersion()}catch(t){this.valid=!1,this.error=t,this.inputs=[],this.categories=[],this.credit="",this.errorLine=t.lineNumber}};Ke.prototype.parsePasses=function(e){const i=[];for(let t=0;t<e.length;++t){const r=e[t],o={};r.TARGET&&(o.target=r.TARGET),o.persistent=!!r.PERSISTENT,o.width=r.WIDTH||"$WIDTH",o.height=r.HEIGHT||"$HEIGHT",o.float=!!r.FLOAT,i.push(o)}return i};Ke.prototype.generateShaders=function(){this.uniformDefs="";for(let e=0;e<this.inputs.length;++e)this.addUniform(this.inputs[e]);for(let e=0;e<this.passes.length;++e)this.passes[e].target&&this.addUniform({NAME:this.passes[e].target,TYPE:"image"});for(const e in this.imports)({}).hasOwnProperty.call(this.imports,e)&&this.addUniform({NAME:e,TYPE:"image"});this.fragmentShader=this.buildFragmentShader(),this.vertexShader=this.buildVertexShader()};Ke.prototype.addUniform=function(e){const i=this.inputToType(e.TYPE);this.addUniformLine(`uniform ${i} ${e.NAME};`),i==="sampler2D"&&this.addUniformLine(this.samplerUniforms(e))};Ke.prototype.addUniformLine=function(e){this.uniformDefs+=`${e}
`};Ke.prototype.samplerUniforms=function(e){const i=e.NAME;let t="";return t+=`uniform vec4 _${i}_imgRect;
`,t+=`uniform vec2 _${i}_imgSize;
`,t+=`uniform bool _${i}_flip;
`,t+=`varying vec2 _${i}_normTexCoord;
`,t+=`varying vec2 _${i}_texCoord;
`,t+=`
`,t};Ke.prototype.buildFragmentShader=function(){const e=this.replaceSpecialFunctions(this.rawFragmentMain);return Ke.fragmentShaderSkeleton.replace("[[uniforms]]",this.uniformDefs).replace("[[main]]",e)};Ke.prototype.replaceSpecialFunctions=function(e){let i;return i=/IMG_THIS_PIXEL\((.+?)\)/g,e=e.replace(i,(t,r)=>`texture2D(${r}, isf_FragNormCoord)`),i=/IMG_THIS_NORM_PIXEL\((.+?)\)/g,e=e.replace(i,(t,r)=>`texture2D(${r}, isf_FragNormCoord)`),i=/IMG_PIXEL\((.+?)\)/g,e=e.replace(i,(t,r)=>{const o=r.split(","),a=o[0].trim(),l=o[1].trim();return`texture2D(${a}, (${l}) / RENDERSIZE)`}),i=/IMG_NORM_PIXEL\((.+?)\)/g,e=e.replace(i,(t,r)=>{const o=r.split(","),a=o[0].trim(),l=o[1].trim();return`texture2D(${a}, (${l}))`}),i=/IMG_SIZE\((.+?)\)/g,e=e.replace(i,(t,r)=>`_${r}_imgSize`),e};Ke.prototype.buildVertexShader=function(){let e=`
`;for(let i=0;i<this.inputs.length;++i){const t=this.inputs[i];t.TYPE==="image"&&(e+=`${this.texCoordFunctions(t)}
`)}return Ke.vertexShaderSkeleton.replace("[[functions]]",e).replace("[[uniforms]]",this.uniformDefs).replace("[[main]]",this.rawVertexShader)};Ke.prototype.texCoordFunctions=function(e){const i=e.NAME;return["_[[name]]_texCoord =","    vec2(((isf_fragCoord.x / _[[name]]_imgSize.x * _[[name]]_imgRect.z) + _[[name]]_imgRect.x), ","          (isf_fragCoord.y / _[[name]]_imgSize.y * _[[name]]_imgRect.w) + _[[name]]_imgRect.y);","","_[[name]]_normTexCoord =","  vec2((((isf_FragNormCoord.x * _[[name]]_imgSize.x) / _[[name]]_imgSize.x * _[[name]]_imgRect.z) + _[[name]]_imgRect.x),","          ((isf_FragNormCoord.y * _[[name]]_imgSize.y) / _[[name]]_imgSize.y * _[[name]]_imgRect.w) + _[[name]]_imgRect.y);"].join(`
`).replace(/\[\[name\]\]/g,i)};Ke.prototype.inferFilterType=function(){function e(r,o){return r.filter(o).length>0}const i=e(this.inputs,r=>r.TYPE==="image"&&r.NAME==="inputImage"),t=e(this.inputs,r=>r.TYPE==="image"&&r.NAME==="startImage")&&e(this.inputs,r=>r.TYPE==="image"&&r.NAME==="endImage")&&e(this.inputs,r=>r.TYPE==="float"&&r.NAME==="progress");i?this.type="filter":t?this.type="transition":this.type="generator"};Ke.prototype.inferISFVersion=function(){let e=2;return(this.metadata.PERSISTENT_BUFFERS||this.rawFragmentShader.indexOf("vv_FragNormCoord")!==-1||this.rawVertexShader.indexOf("vv_vertShaderInit")!==-1||this.rawVertexShader.indexOf("vv_FragNormCoord")!==-1)&&(e=1),e};Ke.prototype.inputToType=function(e){const i=hc[e];if(!i)throw new Error(`Unknown input type [${e}]`);return i};Ke.fragmentShaderSkeleton=`
precision highp float;
precision highp int;

uniform int PASSINDEX;
uniform vec2 RENDERSIZE;
varying vec2 isf_FragNormCoord;
varying vec2 isf_FragCoord;
uniform float TIME;
uniform float TIMEDELTA;
uniform int FRAMEINDEX;
uniform vec4 DATE;

[[uniforms]]

// We don't need 2DRect functions since we control all inputs.  Don't need flip either, but leaving
// for consistency sake.
vec4 VVSAMPLER_2DBYPIXEL(sampler2D sampler, vec4 samplerImgRect, vec2 samplerImgSize, bool samplerFlip, vec2 loc) {
  return (samplerFlip)
    ? texture2D   (sampler,vec2(((loc.x/samplerImgSize.x*samplerImgRect.z)+samplerImgRect.x), (samplerImgRect.w-(loc.y/samplerImgSize.y*samplerImgRect.w)+samplerImgRect.y)))
    : texture2D   (sampler,vec2(((loc.x/samplerImgSize.x*samplerImgRect.z)+samplerImgRect.x), ((loc.y/samplerImgSize.y*samplerImgRect.w)+samplerImgRect.y)));
}
vec4 VVSAMPLER_2DBYNORM(sampler2D sampler, vec4 samplerImgRect, vec2 samplerImgSize, bool samplerFlip, vec2 normLoc)  {
  vec4    returnMe = VVSAMPLER_2DBYPIXEL(   sampler,samplerImgRect,samplerImgSize,samplerFlip,vec2(normLoc.x*samplerImgSize.x, normLoc.y*samplerImgSize.y));
  return returnMe;
}

[[main]]

`;Ke.vertexShaderDefault=`
void main() {
  isf_vertShaderInit();
}
`;Ke.vertexShaderSkeleton=`
precision highp float;
precision highp int;
void isf_vertShaderInit();

attribute vec2 isf_position; // -1..1

uniform int     PASSINDEX;
uniform vec2    RENDERSIZE;
varying vec2    isf_FragNormCoord; // 0..1
vec2    isf_fragCoord; // Pixel Space

[[uniforms]]

[[main]]
void isf_vertShaderInit(void)  {
gl_Position = vec4( isf_position, 0.0, 1.0 );
  isf_FragNormCoord = vec2((gl_Position.x+1.0)/2.0, (gl_Position.y+1.0)/2.0);
  isf_fragCoord = floor(isf_FragNormCoord * RENDERSIZE);
  [[functions]]
}
`;function oa(n){const e=n.split(`
`);for(let i=0;i<e.length;i++)if(e[i].indexOf("main()")!==-1)return i;return-1}function pc(n,e,i){const t=oa(e),r=oa(i),a=/ERROR: (\d+):(\d+): (.*)/g.exec(n.message),l=a==null?void 0:a[2];return parseInt(l,10)+r-t}const mc=(n,e)=>null,gc=fc.eval;function Ge(n){this.ctx=n,this.gl=n,this.uniforms=[],this.contextState=new Si(this.ctx),console.log("\u{1F6A8} setting up paint"),this.setupPaintToScreen(),this.startTime=Date.now(),this.lastRenderTime=Date.now(),this.frameIndex=0,this.parser={}}Ge.prototype.loadSource=function(e,i){this.parser=new Ke,this.parser.parse(e,i),this.sourceChanged(this.parser.fragmentShader,this.parser.vertexShader,this.parser)};Ge.prototype.sourceChanged=function(e,i,t){if(this.fragmentShader=e,this.vertexShader=i,this.model=t,!this.model.valid){this.valid=!1,this.error=this.model.error,this.errorLine=this.model.errorLine,console.error(this.valid,this.error,this.errorLine);return}try{this.valid=!0,this.error=null,this.errorLine=null,this.setupGL(),this.initUniforms();for(let r=0;r<t.inputs.length;r++){const o=t.inputs[r];o.DEFAULT!==void 0&&this.setValue(o.NAME,o.DEFAULT)}}catch(r){this.valid=!1,this.error=r,this.errorLine=pc(r,this.fragmentShader,this.model.rawFragmentShader)}};Ge.prototype.initUniforms=function(){this.uniforms=this.findUniforms(this.fragmentShader);const e=this.model.inputs;for(let i=0;i<e.length;++i){const t=e[i],r=this.uniforms[t.NAME];!r||(r.value=this.model[t.NAME],r.type==="t"&&(r.texture=new wn({},this.contextState)))}this.pushTextures()};Ge.prototype.setValue=function(e,i){this.program.use();const t=this.uniforms[e];if(!t){console.error(`No uniform named ${e}`);return}t.value=i,t.type==="t"&&(t.textureLoaded=!1),this.pushUniform(t)};Ge.prototype.getValue=function(e){return this.uniforms[e]};Ge.prototype.setNormalizedValue=function(e,i){const t=this.model.inputs;let r=null;for(let o=0;o<t.length;o++){const a=t[o];if(a.NAME===e){r=a;break}}r&&r.MIN!==void 0&&r.MAX!==void 0&&this.setValue(e,r.MIN+(r.MAX-r.MIN)*i)};Ge.prototype.setupPaintToScreen=function(){const{basicVertexShader:e,basicFragmentShader:i}=this;return console.log("\u{1F6A8} new program:",{basicVertexShader:e,basicFragmentShader:i}),this.paintProgram=new Wt(this.ctx,this.basicVertexShader,this.basicFragmentShader),this.paintProgram.bindVertices()};Ge.prototype.setupGL=function(){this.cleanup(),this.program=new Wt(this.ctx,this.vertexShader,this.fragmentShader),this.program.bindVertices(),this.generatePersistentBuffers()};Ge.prototype.generatePersistentBuffers=function(){this.renderBuffers=[];const e=this.model.passes;for(let i=0;i<e.length;++i){const t=e[i],r=new In(t,this.contextState);t.buffer=r,this.renderBuffers.push(r)}};Ge.prototype.paintToScreen=function(e,i){this.paintProgram.use(),this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,null),this.ctx.viewport(0,0,e.width,e.height);const t=this.paintProgram.getUniformLocation("tex");i.readTexture().bind(t),this.ctx.drawArrays(this.ctx.TRIANGLES,0,6),this.program.use()};Ge.prototype.pushTextures=function(){Object.keys(this.uniforms).forEach(e=>{const i=this.uniforms[e];i.type==="t"&&this.pushTexture(i)})};Ge.prototype.pushTexture=function(e){if(!e.value||e.value.constructor.name!=="OffscreenCanvas"&&e.value.tagName!=="CANVAS"&&!e.value.complete&&e.value.readyState!==4)return;const i=this.program.getUniformLocation(e.name);if(e.texture.bind(i),this.ctx.texImage2D(this.ctx.TEXTURE_2D,0,this.ctx.RGBA,this.ctx.RGBA,this.ctx.UNSIGNED_BYTE,e.value),!e.textureLoaded){const t=e.value;e.textureLoaded=!0;const r=t.naturalWidth||t.width||t.videoWidth,o=t.naturalHeight||t.height||t.videoHeight;this.setValue(`_${e.name}_imgSize`,[r,o]),this.setValue(`_${e.name}_imgRect`,[0,0,1,1]),this.setValue(`_${e.name}_flip`,!1)}};Ge.prototype.pushUniforms=function(){for(const e of this.uniforms)this.pushUniform(e)};Ge.prototype.pushUniform=function(e){const i=this.program.getUniformLocation(e.name);if(i!==-1){if(e.type==="t"){this.pushTexture(e);return}const t=e.value;switch(e.type){case"f":this.ctx.uniform1f(i,t);break;case"v2":this.ctx.uniform2f(i,t[0],t[1]);break;case"v3":this.ctx.uniform3f(i,t[0],t[1],t[2]);break;case"v4":this.ctx.uniform4f(i,t[0],t[1],t[2],t[3]);break;case"i":this.ctx.uniform1i(i,t);break;case"color":this.ctx.uniform4f(i,t[0],t[1],t[2],t[3]);break;default:mc(`Unknown type for uniform setting ${e.type}`);break}}};Ge.prototype.findUniforms=function(e){const i=e.split(`
`),t={},r=i.length;for(let o=0;o<r;++o){const a=i[o].trim();if(a.indexOf("uniform")===0){const l=a.split(" "),s=l[2].substring(0,l[2].length-1),f=this.typeToUniform(l[1]);f.name=s,t[s]=f}}return t};Ge.prototype.typeToUniform=function(e){switch(e){case"float":return{type:"f",value:0};case"vec2":return{type:"v2",value:[0,0]};case"vec3":return{type:"v3",value:[0,0,0]};case"vec4":return{type:"v4",value:[0,0,0,0]};case"bool":return{type:"i",value:0};case"int":return{type:"i",value:0};case"color":return{type:"v4",value:[0,0,0,0]};case"point2D":return{type:"v2",value:[0,0],isPoint:!0};case"sampler2D":return{type:"t",value:{complete:!1,readyState:0},texture:null,textureUnit:null};default:throw new Error(`Unknown uniform type in ISFRenderer.typeToUniform: ${e}`)}};Ge.prototype.setDateUniforms=function(){const e=Date.now();this.setValue("TIME",(e-this.startTime)/1e3),this.setValue("TIMEDELTA",(e-this.lastRenderTime)/1e3),this.setValue("FRAMEINDEX",this.frameIndex++);const i=new Date;this.setValue("DATE",[i.getFullYear(),i.getMonth()+1,i.getDate(),i.getHours()*3600+i.getMinutes()*60+i.getSeconds()]),this.lastRenderTime=e};Ge.prototype.draw=function(e){this.contextState.reset(),this.program.use(),this.setDateUniforms();const i=this.renderBuffers;for(let o=0;o<i.length;++o){const a=i[o],l=a.readTexture(),s=this.program.getUniformLocation(a.name);l.bind(s),a.name&&(this.setValue(`_${a.name}_imgSize`,[a.width,a.height]),this.setValue(`_${a.name}_imgRect`,[0,0,1,1]),this.setValue(`_${a.name}_flip`,!1))}let t=null;const r=this.model.passes;for(let o=0;o<r.length;++o){const a=r[o];this.setValue("PASSINDEX",o);const l=a.buffer;if(a.target){const s=this.evaluateSize(e,a.width),f=this.evaluateSize(e,a.height);l.setSize(s,f);const u=l.writeTexture();this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,l.fbo),this.ctx.framebufferTexture2D(this.ctx.FRAMEBUFFER,this.ctx.COLOR_ATTACHMENT0,this.ctx.TEXTURE_2D,u.texture,0),this.setValue("RENDERSIZE",[l.width,l.height]),t=l,this.ctx.viewport(0,0,s,f)}else{const s=e.width,f=e.height;this.ctx.bindTexture(this.ctx.TEXTURE_2D,null),this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,null),this.setValue("RENDERSIZE",[s,f]),t=null,this.ctx.viewport(0,0,s,f)}this.ctx.drawArrays(this.ctx.TRIANGLES,0,6),this.ctx.bindTexture(this.ctx.TEXTURE_2D,null),this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,null)}for(let o=0;o<i.length;++o)i[o].flip();t&&this.paintToScreen(e,t)};Ge.prototype.evaluateSize=function(e,i){i+="";let t=i.replace("$WIDTH",(e==null?void 0:e.offsetWidth)||(e==null?void 0:e.width)).replace("$HEIGHT",(e==null?void 0:e.offsetHeight)||(e==null?void 0:e.height));for(const r in this.uniforms)if({}.hasOwnProperty.call(this.uniforms,r)){const o=this.uniforms[r];t=t.replace(`$${r}`,o.value)}return gc(t)};Ge.prototype.cleanup=function(){if(this.contextState.reset(),this.renderBuffers)for(let e=0;e<this.renderBuffers.length;++e)this.renderBuffers[e].destroy()};Ge.prototype.basicVertexShader=`precision mediump float;
precision mediump int;
attribute vec2 isf_position; // -1..1
varying vec2 texCoord;

void main(void) {
  // Since webctx doesn't support ftransform, we do this by hand.
  gl_Position = vec4(isf_position, 0, 1);
  texCoord = isf_position;
}
`;Ge.prototype.basicFragmentShader=`precision mediump float;
uniform sampler2D tex;
varying vec2 texCoord;
void main()
{
  gl_FragColor = texture2D(tex, texCoord * 0.5 + 0.5);
  //gl_FragColor = vec4(texCoord.x);
}`;const vc="isf_vertShaderInit();",gt={texcoord:"isf_FragNormCoord",width:"RENDERSIZE.x"},yc=`

varying vec2 VTC_11;
varying vec2 VTC_00;
varying vec2 VTC_02;
varying vec2 VTC_20;
varying vec2 VTC_22;

void main() {
  ${vc}

  VTC_11 = ${gt.texcoord};
  VTC_00 = ${gt.texcoord} + vec2(-${gt.width}, -${gt.width});
  VTC_02 = ${gt.texcoord} + vec2( ${gt.width}, -${gt.width});
  VTC_20 = ${gt.texcoord} + vec2( ${gt.width},  ${gt.width});
  VTC_22 = ${gt.texcoord} + vec2(-${gt.width},  ${gt.width});
}`,_c=window;async function bc(){let n=Ee(gn),e=Ee(Zt);if(n)return n.close(),gn.set(null),Ot.set(Ct.COMPILE),null;const i=`toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=no,resizable=yes,width=${e.width},height=${e.height},top=0,left=0`;n=await _c.open("","MXZ",i),n.document.body.style="margin:0;padding:0;background:black;";const t=document.createElement("canvas");return t.id="canvas",t.width=e.width,t.height=e.height,t.style="position:fixed;top:0;left:0;width:100%;height:100%;",n.document.body.appendChild(t),n.document.title="MXZ",gn.set(n),Ot.set(Ct.COMPILE),n.addEventListener("beforeunload",r=>{gn.set(null),Ot.set(Ct.COMPILE)}),n}var vs={exports:{}};/*! file-extension v4.0.5 | (c) silverwind | BSD license */(function(n,e){(function(i){n.exports=i()})(function(){return function(t,r){if(r||(r={}),!t)return"";var o=(/[^./\\]*$/.exec(t)||[""])[0];return r.preserveCase?o:o.toLowerCase()}})})(vs);const wc=vs.exports;function Ec(n){const e=wc(n);return["mkv"].includes(e)?"video/x-matroska;codecs=avc1":"video/webm"}function Nc(n,e={}){const i=new Date;let t=null;const{filename:r=`Recording ${i.toISOString().slice(0,10)} at ${i.toTimeString().slice(0,8).replace(/:/g,".")}.webm`,frameRate:o=25,download:a=!0,recorderOptions:l={audioBitsPerSecond:128e3,videoBitsPerSecond:25e5}}={...e},s=l.mimeType||Ec(r);a&&(t=t||document.createElement("a"),t.download=r);let f=[],u=n.captureStream(o),c=new MediaRecorder(u,{mimeType:s,...l});return c.ondataavailable=h=>{h.data.size&&f.push(h.data)},c.onstop=()=>{if(a&&f.length){const h=new Blob(f,{type:s}),p=URL.createObjectURL(h);t.href=p;const g=new MouseEvent("click");t.dispatchEvent(g),setTimeout(()=>{URL.revokeObjectURL(p)},1)}},{start(h){f=[],c.start(h)},set filename(h){t.download=h},step(){u.getVideoTracks()[0].requestFrame()},stop(){return c.stop(),f},dispose(){c=null,u=null},stream:u,recorder:c}}const{window:Sc}=Ir;function aa(n,e,i){const t=n.slice();return t[4]=e[i][0],t[57]=e[i][1],t[58]=e,t[59]=i,t}function sa(n,e,i){const t=n.slice();return t[60]=e[i],t[61]=e,t[62]=i,t}function la(n,e,i){const t=n.slice();return t[63]=e[i],t[64]=e,t[4]=i,t}function ua(n){let e,i,t,r,o,a,l,s;function f(p){n[29](p,n[4])}let u={min:-1,max:1,step:.001};n[0][n[4]][0]!==void 0&&(u.value=n[0][n[4]][0]),i=new It({props:u}),Je.push(()=>ht(i,"value",f));function c(p){n[30](p,n[4])}let h={min:-1,max:1,step:.001};return n[0][n[4]][1]!==void 0&&(h.value=n[0][n[4]][1]),o=new It({props:h}),Je.push(()=>ht(o,"value",c)),{c(){e=V("div"),Ne(i.$$.fragment),r=te(),Ne(o.$$.fragment),l=te(),this.h()},l(p){e=G(p,"DIV",{class:!0});var g=q(e);Re(i.$$.fragment,g),r=ne(g),Re(o.$$.fragment,g),l=ne(g),g.forEach(R),this.h()},h(){P(e,"class","maxw50pc grow")},m(p,g){ae(p,e,g),Se(i,e,null),A(e,r),Se(o,e,null),A(e,l),s=!0},p(p,g){n=p;const y={};!t&&g[0]&1&&(t=!0,y.value=n[0][n[4]][0],_t(()=>t=!1)),i.$set(y);const d={};!a&&g[0]&1&&(a=!0,d.value=n[0][n[4]][1],_t(()=>a=!1)),o.$set(d)},i(p){s||(oe(i.$$.fragment,p),oe(o.$$.fragment,p),s=!0)},o(p){ue(i.$$.fragment,p),ue(o.$$.fragment,p),s=!1},d(p){p&&R(e),xe(i),xe(o)}}}function fa(n){var a,l,s,f;let e,i,t;function r(u){n[33](u,n[4],n[62])}let o={min:(l=(a=n[16])==null?void 0:a[n[4]])==null?void 0:l.min,max:(f=(s=n[16])==null?void 0:s[n[4]])==null?void 0:f.max,step:.001};return n[11][n[4]][n[62]]!==void 0&&(o.value=n[11][n[4]][n[62]]),e=new It({props:o}),Je.push(()=>ht(e,"value",r)),{c(){Ne(e.$$.fragment)},l(u){Re(e.$$.fragment,u)},m(u,c){Se(e,u,c),t=!0},p(u,c){var p,g,y,d;n=u;const h={};c[0]&2048&&(h.min=(g=(p=n[16])==null?void 0:p[n[4]])==null?void 0:g.min),c[0]&2048&&(h.max=(d=(y=n[16])==null?void 0:y[n[4]])==null?void 0:d.max),!i&&c[0]&2048&&(i=!0,h.value=n[11][n[4]][n[62]],_t(()=>i=!1)),e.$set(h)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){ue(e.$$.fragment,u),t=!1},d(u){xe(e,u)}}}function ca(n){let e,i,t=n[4]+"",r,o,a,l,s=n[57]||[],f=[];for(let c=0;c<s.length;c+=1)f[c]=fa(sa(n,s,c));const u=c=>ue(f[c],1,1,()=>{f[c]=null});return{c(){e=V("div"),i=V("div"),r=he(t),o=te();for(let c=0;c<f.length;c+=1)f[c].c();a=te(),this.h()},l(c){e=G(c,"DIV",{class:!0});var h=q(e);i=G(h,"DIV",{class:!0});var p=q(i);r=pe(p,t),p.forEach(R),o=ne(h);for(let g=0;g<f.length;g+=1)f[g].l(h);a=ne(h),h.forEach(R),this.h()},h(){P(i,"class","mb0-5"),P(e,"class","maxw50pc grow")},m(c,h){ae(c,e,h),A(e,i),A(i,r),A(e,o);for(let p=0;p<f.length;p+=1)f[p].m(e,null);A(e,a),l=!0},p(c,h){if((!l||h[0]&2048)&&t!==(t=c[4]+"")&&De(r,t),h[0]&67584){s=c[57]||[];let p;for(p=0;p<s.length;p+=1){const g=sa(c,s,p);f[p]?(f[p].p(g,h),oe(f[p],1)):(f[p]=fa(g),f[p].c(),oe(f[p],1),f[p].m(e,a))}for(st(),p=s.length;p<f.length;p+=1)u(p);lt()}},i(c){if(!l){for(let h=0;h<s.length;h+=1)oe(f[h]);l=!0}},o(c){f=f.filter(Boolean);for(let h=0;h<f.length;h+=1)ue(f[h]);l=!1},d(c){c&&R(e),Ye(f,c)}}}function xc(n){let e,i,t,r,o,a,l,s,f,u,c,h,p,g,y,d,_,v,E,b,N,T=n[10]?"Recording...":"Record",k,I,w,x=(1e3/n[9]).toFixed(0)+"",B,F,j,H,K,U,ee,fe,ve,Q,se,be,de,Y,Ue,Oe,We,kt,it,ot,xt,Mt,rt,pt,Pt,tt,$,Ae,O,C,L,D,J,Z,le,re,X=n[0],ie=[];for(let W=0;W<X.length;W+=1)ie[W]=ua(la(n,X,W));const Ve=W=>ue(ie[W],1,1,()=>{ie[W]=null});function Be(W){n[31](W)}let Xe={min:0,max:1,step:.01};n[12].speed!==void 0&&(Xe.value=n[12].speed),Oe=new It({props:Xe}),Je.push(()=>ht(Oe,"value",Be));function Ie(W){n[32](W)}let mt={min:0,max:255,step:1};n[12].ideal!==void 0&&(mt.value=n[12].ideal),rt=new It({props:mt}),Je.push(()=>ht(rt,"value",Ie));let nt=Object.entries(n[11]),Me=[];for(let W=0;W<nt.length;W+=1)Me[W]=ca(aa(n,nt,W));const On=W=>ue(Me[W],1,1,()=>{Me[W]=null}),Xt=n[25].default,Qe=ys(Xt,n,n[24],null);return{c(){e=V("div"),i=V("div"),t=V("canvas"),a=te(),l=V("canvas"),u=te(),c=V("div"),h=V("button"),p=he("Popup"),g=te(),y=V("button"),d=he("Grab"),_=te(),v=V("button"),E=he("Fullscreen"),b=te(),N=V("button"),k=he(T),I=te(),w=V("span"),B=he(x),F=te(),j=V("div"),H=V("div"),K=V("div");for(let W=0;W<ie.length;W+=1)ie[W].c();U=te(),ee=V("div"),fe=V("div"),ve=V("span"),Q=he("AutoWB Tool"),se=te(),be=V("div"),de=V("div"),Y=he("Speed"),Ue=te(),Ne(Oe.$$.fragment),kt=te(),it=V("div"),ot=V("div"),xt=he("Destination"),Mt=te(),Ne(rt.$$.fragment),Pt=te(),tt=V("div"),$=V("div"),Ae=V("span"),O=he("Output Mapping"),C=te(),L=V("div");for(let W=0;W<Me.length;W+=1)Me[W].c();D=te(),Qe&&Qe.c(),this.h()},l(W){e=G(W,"DIV",{class:!0,style:!0});var me=q(e);i=G(me,"DIV",{style:!0,class:!0});var m=q(i);t=G(m,"CANVAS",{class:!0,width:!0,height:!0}),q(t).forEach(R),a=ne(m),l=G(m,"CANVAS",{id:!0,class:!0,style:!0,width:!0,height:!0}),q(l).forEach(R),m.forEach(R),u=ne(me),c=G(me,"DIV",{style:!0,class:!0});var S=q(c);h=G(S,"BUTTON",{class:!0});var M=q(h);p=pe(M,"Popup"),M.forEach(R),g=ne(S),y=G(S,"BUTTON",{class:!0});var z=q(y);d=pe(z,"Grab"),z.forEach(R),_=ne(S),v=G(S,"BUTTON",{class:!0});var we=q(v);E=pe(we,"Fullscreen"),we.forEach(R),b=ne(S),N=G(S,"BUTTON",{class:!0});var Te=q(N);k=pe(Te,T),Te.forEach(R),I=ne(S),w=G(S,"SPAN",{class:!0,style:!0});var wt=q(w);B=pe(wt,x),wt.forEach(R),S.forEach(R),F=ne(me),j=G(me,"DIV",{class:!0,style:!0});var Bt=q(j);H=G(Bt,"DIV",{class:!0});var en=q(H);K=G(en,"DIV",{class:!0});var er=q(K);for(let $e=0;$e<ie.length;$e+=1)ie[$e].l(er);er.forEach(R),U=ne(en),ee=G(en,"DIV",{});var jt=q(ee);fe=G(jt,"DIV",{class:!0});var tr=q(fe);ve=G(tr,"SPAN",{class:!0});var nr=q(ve);Q=pe(nr,"AutoWB Tool"),nr.forEach(R),tr.forEach(R),se=ne(jt),be=G(jt,"DIV",{class:!0});var tn=q(be);de=G(tn,"DIV",{class:!0});var rr=q(de);Y=pe(rr,"Speed"),rr.forEach(R),Ue=ne(tn),Re(Oe.$$.fragment,tn),tn.forEach(R),kt=ne(jt),it=G(jt,"DIV",{class:!0});var nn=q(it);ot=G(nn,"DIV",{class:!0});var ir=q(ot);xt=pe(ir,"Destination"),ir.forEach(R),Mt=ne(nn),Re(rt.$$.fragment,nn),nn.forEach(R),jt.forEach(R),en.forEach(R),Pt=ne(Bt),tt=G(Bt,"DIV",{class:!0});var rn=q(tt);$=G(rn,"DIV",{class:!0});var on=q($);Ae=G(on,"SPAN",{class:!0});var qe=q(Ae);O=pe(qe,"Output Mapping"),qe.forEach(R),on.forEach(R),C=ne(rn),L=G(rn,"DIV",{class:!0});var Ze=q(L);for(let $e=0;$e<Me.length;$e+=1)Me[$e].l(Ze);Ze.forEach(R),rn.forEach(R),Bt.forEach(R),D=ne(me),Qe&&Qe.l(me),me.forEach(R),this.h()},h(){P(t,"class","w100pc h100pc"),P(t,"width",r=n[7].width),P(t,"height",o=n[7].height),P(l,"id",n[2]),P(l,"class","w100pc h100pc fill"),je(l,"transform",n[17](n[11])),P(l,"width",s=n[7].width),P(l,"height",f=n[7].height),je(i,"top","0px"),je(i,"left","0px"),je(i,"background","black"),je(i,"z-index","999999999"),P(i,"class","rel t0pc l0pc w100pc h100pc overflow-hidden bt"),ke(i,"fixed",n[6]),P(h,"class","pop pointer f0 br"),P(y,"class","pop pointer f0 br"),P(v,"class","pop pointer f0 br"),P(N,"class","pop pointer f0 br"),ke(N,"active",n[10]),P(w,"class","fps f0"),je(w,"width","32px"),je(c,"background","var(--blue5-0)"),P(c,"class","actions rel z-index99 bt pop"),P(K,"class","flex wrap grow w100pc none"),P(ve,"class","bb"),P(fe,"class","mb1"),P(de,"class","pb0-2"),P(be,"class","row"),P(ot,"class","pb0-2"),P(it,"class","row"),P(H,"class","pop bg4 p0-8"),P(Ae,"class","bb"),P($,"class","mb1"),P(L,"class","flex wrap grow w100pc"),P(tt,"class","pop bg4 p0-8 bt"),P(j,"class","flex column-stretch-flex-start bt pop"),je(j,"background","var(--blue5-0)"),je(j,"z-index","99999"),P(e,"class",J="renderer bb "+n[3]),je(e,"height","auto"),je(e,"min-width",n[1]+"px"),je(e,"max-width",n[1]+"px")},m(W,me){ae(W,e,me),A(e,i),A(i,t),A(i,a),A(i,l),n[26](l),n[27](i),A(e,u),A(e,c),A(c,h),A(h,p),A(c,g),A(c,y),A(y,d),A(c,_),A(c,v),A(v,E),A(c,b),A(c,N),A(N,k),A(c,I),A(c,w),A(w,B),A(e,F),A(e,j),A(j,H),A(H,K);for(let m=0;m<ie.length;m+=1)ie[m].m(K,null);A(H,U),A(H,ee),A(ee,fe),A(fe,ve),A(ve,Q),A(ee,se),A(ee,be),A(be,de),A(de,Y),A(be,Ue),Se(Oe,be,null),A(ee,kt),A(ee,it),A(it,ot),A(ot,xt),A(it,Mt),Se(rt,it,null),A(j,Pt),A(j,tt),A(tt,$),A($,Ae),A(Ae,O),A(tt,C),A(tt,L);for(let m=0;m<Me.length;m+=1)Me[m].m(L,null);A(e,D),Qe&&Qe.m(e,null),Z=!0,le||(re=[ye(Sc,"resize",n[15]),ye(h,"click",bc),ye(y,"click",n[13]),ye(v,"click",n[28]),ye(N,"click",n[14])],le=!0)},p(W,me){if((!Z||me[0]&128&&r!==(r=W[7].width))&&P(t,"width",r),(!Z||me[0]&128&&o!==(o=W[7].height))&&P(t,"height",o),(!Z||me[0]&4)&&P(l,"id",W[2]),(!Z||me[0]&2048)&&je(l,"transform",W[17](W[11])),(!Z||me[0]&128&&s!==(s=W[7].width))&&P(l,"width",s),(!Z||me[0]&128&&f!==(f=W[7].height))&&P(l,"height",f),(!Z||me[0]&64)&&ke(i,"fixed",W[6]),(!Z||me[0]&1024)&&T!==(T=W[10]?"Recording...":"Record")&&De(k,T),(!Z||me[0]&1024)&&ke(N,"active",W[10]),(!Z||me[0]&512)&&x!==(x=(1e3/W[9]).toFixed(0)+"")&&De(B,x),me[0]&1){X=W[0];let M;for(M=0;M<X.length;M+=1){const z=la(W,X,M);ie[M]?(ie[M].p(z,me),oe(ie[M],1)):(ie[M]=ua(z),ie[M].c(),oe(ie[M],1),ie[M].m(K,null))}for(st(),M=X.length;M<ie.length;M+=1)Ve(M);lt()}const m={};!We&&me[0]&4096&&(We=!0,m.value=W[12].speed,_t(()=>We=!1)),Oe.$set(m);const S={};if(!pt&&me[0]&4096&&(pt=!0,S.value=W[12].ideal,_t(()=>pt=!1)),rt.$set(S),me[0]&67584){nt=Object.entries(W[11]);let M;for(M=0;M<nt.length;M+=1){const z=aa(W,nt,M);Me[M]?(Me[M].p(z,me),oe(Me[M],1)):(Me[M]=ca(z),Me[M].c(),oe(Me[M],1),Me[M].m(L,null))}for(st(),M=nt.length;M<Me.length;M+=1)On(M);lt()}Qe&&Qe.p&&(!Z||me[0]&16777216)&&_s(Qe,Xt,W,W[24],Z?ws(Xt,W[24],me,null):bs(W[24]),null),(!Z||me[0]&8&&J!==(J="renderer bb "+W[3]))&&P(e,"class",J),(!Z||me[0]&2)&&je(e,"min-width",W[1]+"px"),(!Z||me[0]&2)&&je(e,"max-width",W[1]+"px")},i(W){if(!Z){for(let me=0;me<X.length;me+=1)oe(ie[me]);oe(Oe.$$.fragment,W),oe(rt.$$.fragment,W);for(let me=0;me<nt.length;me+=1)oe(Me[me]);oe(Qe,W),Z=!0}},o(W){ie=ie.filter(Boolean);for(let me=0;me<ie.length;me+=1)ue(ie[me]);ue(Oe.$$.fragment,W),ue(rt.$$.fragment,W),Me=Me.filter(Boolean);for(let me=0;me<Me.length;me+=1)ue(Me[me]);ue(Qe,W),Z=!1},d(W){W&&R(e),n[26](null),n[27](null),Ye(ie,W),xe(Oe),xe(rt),Ye(Me,W),Qe&&Qe.d(W),le=!1,Et(re)}}}function Ic(n,e,i){let t,r,o,a,l,s,f;ge(n,Nr,$=>i(11,t=$)),ge(n,zn,$=>i(6,r=$)),ge(n,Zt,$=>i(7,o=$)),ge(n,dn,$=>i(12,a=$)),ge(n,Ot,$=>i(45,l=$)),ge(n,ce,$=>i(46,s=$)),ge(n,gn,$=>i(47,f=$));let{$$slots:u={},$$scope:c}=e,{width:h=320}=e,{preview:p}=e,{key:g}=e,{capture:y=!1}=e,{fullscreen:d=!1}=e,{id:_}=e,{style:v=""}=e,{class:E=""}=e;const b=window;let N,T;const k=($,Ae)=>console.log(`[Renderer] ${$}`,Ae||"");let I;function w(){return f?(I||(I=f.document.getElementById("canvas")),I):N}Es(async $=>{f&&(await f.close(),_e(gn,f=null,f))});let x;function B($){l==Ct.COMPILE&&Qr&&(x&&clearTimeout(x),x=setTimeout(Ae=>{k("\u{1F3DE} recompiling"),b.requestAnimationFrame(async O=>{const C=w();T||(T=Nc(C,{recorderOptions:{audioBitsPerSecond:128e3,videoBitsPerSecond:25e5*10}})),b.RNDRS||(b.RNDRS={});const L=C.getContext("webgl2",{preserveDrawingBuffer:!0});console.log("\u26E9\uFE0F context",L),b.RNDRS[g]=new Ge(L),b.ISF=Sr(),b.VTX="// hello world?",b.RNDRS[g].loadSource(b.ISF,yc);const D=document.getElementById("ISF");D&&(D.innerText=b.RNDRS[g].parser.fragmentShader),_e(ce,s={...s},s),_e(Ot,l=Ct.DONE,l)})},1))}Ot.subscribe(B);let F,j=30,H=0;const K=$=>{var L;const Ae=new Date;F||(F=Ae);const O=.98,C=Ae-F;i(9,j=j*O+C*(1-O));try{if((L=b.RNDRS)!=null&&L[g]){const D=w(),J=D.getContext("webgl2");b.RNDRS[g].draw(D);let Z=J.drawingBufferWidth,le=J.drawingBufferHeight,re=new Uint8Array(Z*le*4);J.readPixels(0,0,Z,le,J.RGBA,J.UNSIGNED_BYTE,re);let X=0;for(let Be=0;Be<re.length;Be+=4){let Xe=re[Be],Ie=re[Be+1],mt=re[Be+2],nt=.299*Xe+.587*Ie+.114*mt;X+=nt}const ie=X/(Z*le),Ve=a.ideal;_e(dn,a.exp+=Ve-ie,a),_e(dn,a.luma=ie,a),H=ie}}catch(D){throw console.log("\u274C renderer error:",D.message),D}F=new Date,requestAnimationFrame(K)};En(async $=>{be(),K()});const U=()=>new Date().toISOString();function ee(){b.requestAnimationFrame(async $=>{const Ae=document.createElement("a"),{offsetHeight:O,offsetWidth:C}=N;console.log("\u{1F4BE} saving from canvas:",N.width,N.height,"scaled as:",C,O,"with store dimensions:",o),Ae.setAttribute("download",`synth.v1.${U()}.png`);const L=(await N.toDataURL("image/png",1)).replace(/^data:image\/png/,"data:application/octet-stream");Ae.setAttribute("href",L),Ae.click()})}window.captureImage=ee;let fe=!1;function ve(){i(10,fe=!fe),fe?T.start():(T.stop(),T.dispose()),window.recorder=T}let Q,se;function be(){i(22,Q=b.innerWidth),i(23,se=b.innerHeight)}let{ctrlPoints:de=[[0,0],[0,0],[0,0],[0,0]]}=e;const Y=[[0,0],[0,1],[1,0],[1,1]];let Ue;function Oe($,Ae,O,C){if(!o||!O)return{from:[],to:[],matrix:[]};const L=[],D=[];let J=[],Z=[];const le=r?window.innerWidth:O.offsetWidth,re=r?window.innerHeight:O.offsetHeight;for(let Ie=0;Ie<$.length;Ie++)Z.push([(Y[Ie][0]+$[Ie][0])*le,(Y[Ie][1]+$[Ie][1])*re]),J.push([Y[Ie][0]*le,Y[Ie][1]*re]);for(let Ie=0;Ie<4;Ie++)L.push([J[Ie][0],J[Ie][1],1,0,0,0,-J[Ie][0]*Z[Ie][0],-J[Ie][1]*Z[Ie][0]]),L.push([0,0,0,J[Ie][0],J[Ie][1],1,-J[Ie][0]*Z[Ie][1],-J[Ie][1]*Z[Ie][1]]),D.push(Z[Ie][0]),D.push(Z[Ie][1]);const X=window.numeric.solve(L,D),ie=[[X[0],X[1],0,X[2]],[X[3],X[4],0,X[5]],[0,0,1,0],[X[6],X[7],0,1]];let Ve,Be;Be=[];for(let Ie=Ve=0;Ve<4;Ie=++Ve)Be.push(function(){var mt,nt;nt=[];for(let Me=mt=0;mt<4;Me=++mt)nt.push(ie[Me][Ie].toFixed(20));return nt}());const Xe=`matrix3d(${Be.join(",")})`;return{from:J,to:Z,matrix:Be,matrix3d:Xe}}const We={translate:{unit:"%",min:-15,max:15},rotate:{unit:"deg",min:-15,max:15},scale:{unit:" ",min:.5,max:1},skew:{unit:"deg",min:-15,max:15}};function kt($){let Ae="";for(const[O,C]of Object.entries(t)){let L=0;const D=["X","Y","Z"];Ae+=`${C.map(J=>{var le,re;let Z=(le=We==null?void 0:We[O])!=null&&le.unit?D[L]:"";return L+=1,`${O}${Z}( ${J||0}${((re=We==null?void 0:We[O])==null?void 0:re.unit)||""} )`}).join(" ")} `}return Ae}function it($){Je[$?"unshift":"push"](()=>{N=$,i(8,N)})}function ot($){Je[$?"unshift":"push"](()=>{Ue=$,i(5,Ue)})}const xt=$=>_e(zn,r=!r,r);function Mt($,Ae){n.$$.not_equal(de[Ae][0],$)&&(de[Ae][0]=$,i(0,de))}function rt($,Ae){n.$$.not_equal(de[Ae][1],$)&&(de[Ae][1]=$,i(0,de))}function pt($){n.$$.not_equal(a.speed,$)&&(a.speed=$,dn.set(a))}function Pt($){n.$$.not_equal(a.ideal,$)&&(a.ideal=$,dn.set(a))}function tt($,Ae,O){n.$$.not_equal(t[Ae][O],$)&&(t[Ae][O]=$,Nr.set(t))}return n.$$set=$=>{"width"in $&&i(1,h=$.width),"preview"in $&&i(18,p=$.preview),"key"in $&&i(4,g=$.key),"capture"in $&&i(19,y=$.capture),"fullscreen"in $&&i(20,d=$.fullscreen),"id"in $&&i(2,_=$.id),"style"in $&&i(21,v=$.style),"class"in $&&i(3,E=$.class),"ctrlPoints"in $&&i(0,de=$.ctrlPoints),"$$scope"in $&&i(24,c=$.$$scope)},n.$$.update=()=>{n.$$.dirty[0]&12583104&&r&&(Q/o.width,se/o.height),n.$$.dirty[0]&225&&Oe(de,o,Ue)},[de,h,_,E,g,Ue,r,o,N,j,fe,t,a,ee,ve,be,We,kt,p,y,d,v,Q,se,c,u,it,ot,xt,Mt,rt,pt,Pt,tt]}class Oc extends Ce{constructor(e){super(),Le(this,e,Ic,xc,Fe,{width:1,preview:18,key:4,capture:19,fullscreen:20,id:2,style:21,class:3,ctrlPoints:0},null,[-1,-1,-1])}}const Tc=window;function Kn(n){if(!Ee(Lt))return;n=n.detail?n.detail:n;let i=n.composedPath().find(t=>t.getAttribute("data-drag-type"));for(const t of document.querySelectorAll(".draggedover"))t.classList.remove("draggedover");i&&i.classList.add("draggedover"),n.preventDefault()}function Zn(n){if(!Ee(Lt))return;n=n.detail?n.detail:n;let i=n.composedPath().find(s=>s.getAttribute("data-drag-type")),t=i.getAttribute("data-drag-type"),r=parseInt(i.getAttribute("data-drag-colIdx")),o=parseInt(i.getAttribute("data-drag-rowIdx"));for(const s of document.querySelectorAll(".draggedover"))s.classList.remove("draggedover");const a=Ee(at),l=typeof(a==null?void 0:a[0])=="string"?a:[];Ot.set(Ct.PAUSE),vi(t,o,r,l),Lt.set(!1),at.set(null),di(),Tc.requestAnimationFrame(s=>{Ot.set(Ct.COMPILE)})}function Ac(n){let e;return{c(){e=he("NO SUCH OPERATOR")},l(i){e=pe(i,"NO SUCH OPERATOR")},m(i,t){ae(i,e,t)},p:Pe,i:Pe,o:Pe,d(i){i&&R(e)}}}function Rc(n){let e,i,t;var r=bn[n[0]].COMPONENT;function o(a){return{props:{uuid:a[4],name:a[0],rowIdx:a[1],colIdx:a[2]}}}return r&&(e=new r(o(n))),{c(){e&&Ne(e.$$.fragment),i=He()},l(a){e&&Re(e.$$.fragment,a),i=He()},m(a,l){e&&Se(e,a,l),ae(a,i,l),t=!0},p(a,l){const s={};if(l&16&&(s.uuid=a[4]),l&1&&(s.name=a[0]),l&2&&(s.rowIdx=a[1]),l&4&&(s.colIdx=a[2]),r!==(r=bn[a[0]].COMPONENT)){if(e){st();const f=e;ue(f.$$.fragment,1,0,()=>{xe(f,1)}),lt()}r?(e=new r(o(a)),Ne(e.$$.fragment),oe(e.$$.fragment,1),Se(e,i.parentNode,i)):e=null}else r&&e.$set(s)},i(a){t||(e&&oe(e.$$.fragment,a),t=!0)},o(a){e&&ue(e.$$.fragment,a),t=!1},d(a){a&&R(i),e&&xe(e,a)}}}function Mc(n){let e,i,t,r,o,a,l=Jn(n[1])+"",s,f=n[2]+1+"",u,c,h,p,g,y,d=(n[4]||"")+"",_,v,E,b,N,T,k,I,w,x;const B=[Rc,Ac],F=[];function j(H,K){return bn[H[0]]?0:1}return b=j(n),N=F[b]=B[b](n),{c(){e=V("div"),i=V("header"),t=V("div"),r=V("div"),o=V("div"),a=V("span"),s=he(l),u=he(f),c=te(),h=V("span"),p=he(n[0]),g=te(),y=V("div"),_=he(d),v=te(),E=V("div"),N.c(),this.h()},l(H){e=G(H,"DIV",{"data-drag-type":!0,"data-drag-rowidx":!0,"data-drag-colidx":!0,class:!0});var K=q(e);i=G(K,"HEADER",{draggable:!0,class:!0});var U=q(i);t=G(U,"DIV",{class:!0});var ee=q(t);r=G(ee,"DIV",{class:!0});var fe=q(r);o=G(fe,"DIV",{class:!0});var ve=q(o);a=G(ve,"SPAN",{class:!0});var Q=q(a);s=pe(Q,l),u=pe(Q,f),Q.forEach(R),c=ne(ve),h=G(ve,"SPAN",{class:!0});var se=q(h);p=pe(se,n[0]),se.forEach(R),ve.forEach(R),g=ne(fe),y=G(fe,"DIV",{class:!0});var be=q(y);_=pe(be,d),be.forEach(R),fe.forEach(R),ee.forEach(R),U.forEach(R),v=ne(K),E=G(K,"DIV",{class:!0});var de=q(E);N.l(de),de.forEach(R),K.forEach(R),this.h()},h(){P(a,"class","bold f1"),P(h,"class","italic"),P(o,"class","f2"),P(y,"class","f0"),P(r,"class","grabbable flex grow row-space-between-center rel p0-5 bg5"),P(t,"class","flex row-space-between-center w100pc "),P(i,"draggable",n[6]),P(i,"class","flex column w100pc"),P(E,"class","inner"),P(e,"data-drag-type",dt.MOVE),P(e,"data-drag-rowidx",n[1]),P(e,"data-drag-colidx",T=n[2]-1),P(e,"class",k="op op-"+n[0].toLowerCase()+" global"),ke(e,"pop",n[5]),ke(e,"invisible",n[3]&&!n[5])},m(H,K){ae(H,e,K),A(e,i),A(i,t),A(t,r),A(r,o),A(o,a),A(a,s),A(a,u),A(o,c),A(o,h),A(h,p),A(r,g),A(r,y),A(y,_),A(e,v),A(e,E),F[b].m(E,null),I=!0,w||(x=[ye(r,"mousedown",n[12]),ye(i,"dragstart",n[10]),ye(e,"drop",n[13]),ye(e,"dragover",n[14]),ye(e,"dragenter",n[15]),ye(e,"dragleave",n[16]),ye(e,"mouseup",n[9]),ye(e,"mousedown",n[8])],w=!0)},p(H,[K]){(!I||K&2)&&l!==(l=Jn(H[1])+"")&&De(s,l),(!I||K&4)&&f!==(f=H[2]+1+"")&&De(u,f),(!I||K&1)&&De(p,H[0]),(!I||K&16)&&d!==(d=(H[4]||"")+"")&&De(_,d),(!I||K&64)&&P(i,"draggable",H[6]);let U=b;b=j(H),b===U?F[b].p(H,K):(st(),ue(F[U],1,1,()=>{F[U]=null}),lt(),N=F[b],N?N.p(H,K):(N=F[b]=B[b](H),N.c()),oe(N,1),N.m(E,null)),(!I||K&2)&&P(e,"data-drag-rowidx",H[1]),(!I||K&4&&T!==(T=H[2]-1))&&P(e,"data-drag-colidx",T),(!I||K&1&&k!==(k="op op-"+H[0].toLowerCase()+" global"))&&P(e,"class",k),(!I||K&33)&&ke(e,"pop",H[5]),(!I||K&41)&&ke(e,"invisible",H[3]&&!H[5])},i(H){I||(oe(N),I=!0)},o(H){ue(N),I=!1},d(H){H&&R(e),F[b].d(),w=!1,Et(x)}}}function Pc(n,e,i){let t,r,o,a,l,s;ge(n,at,w=>i(17,r=w)),ge(n,Ht,w=>i(18,o=w)),ge(n,Lt,w=>i(6,a=w)),ge(n,Kt,w=>i(19,l=w)),ge(n,ce,w=>i(20,s=w));const f=(w,x)=>console.log(`[Unit] ${w}`,x||"");let{name:u}=e,{rowIdx:c}=e,{colIdx:h}=e,{index:p}=e,{clone:g=!1}=e,{uuid:y}=e;const d=Ns();function _(w){if(l&&(l==null?void 0:l.uuid)!=y){const x=parseInt(y.substring(1));f(`\u{1F447} setting OpSelect ${l.uuid} to ${y} ${x}`),_e(ce,s[l.key]=x,s),_e(Kt,l=null,l)}}function v(w){_e(Lt,a=!1,a),r||_e(at,r=[[-1,-1],[-1,-1]],r);let x=r;if(o[Us])x[1][0]=c,x[1][1]=h;else try{x[0][0]=x[1][0]=c,x[0][1]=x[1][1]=h}catch{}x=x.sort((B,F)=>B[0]==F[0]?B[1]-F[1]:B[0]-F[0]),console.log(`[Unit] on touchup, setting selected tp ${r}`),_e(at,r=x,r)}const E=w=>{t||(r||_e(at,r=[[-1,-1],[-1,-1]],r),console.log(`[Unit] resetting selected ${r} to [${c},${h}]`),_e(at,r=[[c,h],[c,h]],r));const x=document.getElementById("drag-visualiser");w.dataTransfer.setDragImage(x,80,gi().length*40)},b=w=>_e(Lt,a=!0,a),N=w=>d(dt.DROP,w),T=w=>d(dt.DRAGOVER,w),k=w=>d(dt.DRAGENTER,w),I=w=>d(dt.DRAGLEAVE,w);return n.$$set=w=>{"name"in w&&i(0,u=w.name),"rowIdx"in w&&i(1,c=w.rowIdx),"colIdx"in w&&i(2,h=w.colIdx),"index"in w&&i(11,p=w.index),"clone"in w&&i(3,g=w.clone),"uuid"in w&&i(4,y=w.uuid)},n.$$.update=()=>{n.$$.dirty&6&&i(5,t=hi([c,h]))},[u,c,h,g,y,t,a,d,_,v,E,p,b,N,T,k,I]}class kc extends Ce{constructor(e){super(),Le(this,e,Pc,Mc,Fe,{name:0,rowIdx:1,colIdx:2,index:11,clone:3,uuid:4})}}function da(n,e,i){const t=n.slice();return t[9]=e[i],t[11]=i,t}function ha(n,e,i){const t=n.slice();return t[12]=e[i],t[14]=i,t}function pa(n){let e,i;return e=new kc({props:{name:n[12].split(":")[0],uuid:n[12].split(":")[1],rowIdx:n[11],colIdx:n[14],type:Ws.UNIT,index:Wa(n[11],n[14])}}),e.$on("drop",Zn),e.$on("dragover",Kn),{c(){Ne(e.$$.fragment)},l(t){Re(e.$$.fragment,t)},m(t,r){Se(e,t,r),i=!0},p(t,r){const o={};r&2&&(o.name=t[12].split(":")[0]),r&2&&(o.uuid=t[12].split(":")[1]),e.$set(o)},i(t){i||(oe(e.$$.fragment,t),i=!0)},o(t){ue(e.$$.fragment,t),i=!1},d(t){xe(e,t)}}}function ma(n){let e,i,t,r,o,a,l,s,f,u,c,h,p=n[9],g=[];for(let d=0;d<p.length;d+=1)g[d]=pa(ha(n,p,d));const y=d=>ue(g[d],1,1,()=>{g[d]=null});return{c(){e=V("span"),t=te(),r=V("section");for(let d=0;d<g.length;d+=1)g[d].c();o=te(),a=V("div"),l=te(),this.h()},l(d){e=G(d,"SPAN",{id:!0,"data-drag-type":!0,"data-drag-rowidx":!0,"data-drag-colidx":!0,class:!0}),q(e).forEach(R),t=ne(d),r=G(d,"SECTION",{id:!0,"data-drag-type":!0,"data-drag-rowidx":!0,"data-drag-colidx":!0,class:!0});var _=q(r);for(let v=0;v<g.length;v+=1)g[v].l(_);o=ne(_),a=G(_,"DIV",{class:!0}),q(a).forEach(R),l=ne(_),_.forEach(R),this.h()},h(){P(e,"id",i=[n[0],n[11],"gutter"].join("_")),P(e,"data-drag-type",dt.INSERT),P(e,"data-drag-rowidx",n[11]),P(e,"data-drag-colidx",0),P(e,"class","w2em minw2em z-index99 minh100pc h100pc t0 l0"),P(a,"class","minh4em w100pc"),P(r,"id",s=[n[0],n[11]].join("_")),P(r,"data-drag-type",dt.MOVE),P(r,"data-drag-rowidx",n[11]),P(r,"data-drag-colidx",f=n[9].length-1),P(r,"class","channel global")},m(d,_){ae(d,e,_),ae(d,t,_),ae(d,r,_);for(let v=0;v<g.length;v+=1)g[v].m(r,null);A(r,o),A(r,a),A(r,l),u=!0,c||(h=[ye(e,"drop",Zn),ye(e,"dragover",Kn),ye(r,"drop",Zn),ye(r,"dragover",Kn)],c=!0)},p(d,_){if((!u||_&1&&i!==(i=[d[0],d[11],"gutter"].join("_")))&&P(e,"id",i),_&2){p=d[9];let v;for(v=0;v<p.length;v+=1){const E=ha(d,p,v);g[v]?(g[v].p(E,_),oe(g[v],1)):(g[v]=pa(E),g[v].c(),oe(g[v],1),g[v].m(r,o))}for(st(),v=p.length;v<g.length;v+=1)y(v);lt()}(!u||_&1&&s!==(s=[d[0],d[11]].join("_")))&&P(r,"id",s),(!u||_&2&&f!==(f=d[9].length-1))&&P(r,"data-drag-colidx",f)},i(d){if(!u){for(let _=0;_<p.length;_+=1)oe(g[_]);u=!0}},o(d){g=g.filter(Boolean);for(let _=0;_<g.length;_+=1)ue(g[_]);u=!1},d(d){d&&R(e),d&&R(t),d&&R(r),Ye(g,d),c=!1,Et(h)}}}function Dc(n){let e,i,t,r,o,a,l,s,f,u,c,h,p,g,y=n[1],d=[];for(let v=0;v<y.length;v+=1)d[v]=ma(da(n,y,v));const _=v=>ue(d[v],1,1,()=>{d[v]=null});return{c(){e=V("div"),i=V("div");for(let v=0;v<d.length;v+=1)d[v].c();t=te(),r=V("span"),l=te(),s=V("span"),f=he("BIN"),this.h()},l(v){e=G(v,"DIV",{class:!0});var E=q(e);i=G(E,"DIV",{class:!0});var b=q(i);for(let T=0;T<d.length;T+=1)d[T].l(b);t=ne(b),r=G(b,"SPAN",{id:!0,"data-drag-type":!0,"data-drag-rowidx":!0,"data-drag-colidx":!0,style:!0,class:!0}),q(r).forEach(R),b.forEach(R),l=ne(E),s=G(E,"SPAN",{id:!0,"data-drag-type":!0,"data-drag-rowidx":!0,"data-drag-colidx":!0,class:!0});var N=q(s);f=pe(N,"BIN"),N.forEach(R),E.forEach(R),this.h()},h(){var v,E,b,N;P(r,"id",o=[n[0],"tundra"].join("_")),P(r,"data-drag-type",dt.APPEND),P(r,"data-drag-rowidx",a=n[1].length),P(r,"data-drag-colidx",0),je(r,"padding-right","50vw"),P(r,"class","flex grow h100pc minw16em"),P(i,"class","flex row-flex-start-stretch grow minw100pc"),P(s,"id","bin"),P(s,"data-drag-type",dt.BIN),P(s,"data-drag-rowidx",u=(E=(v=n[2])==null?void 0:v[0])==null?void 0:E[0]),P(s,"data-drag-colidx",c=(N=(b=n[2])==null?void 0:b[0])==null?void 0:N[1]),P(s,"class","flex row-center-center h4em abs t100pc l100pc border w8em fixed bg z-index99"),P(e,"class","flex row-flex-start-stretch pb4 grow rel w100pc")},m(v,E){ae(v,e,E),A(e,i);for(let b=0;b<d.length;b+=1)d[b].m(i,null);A(i,t),A(i,r),A(e,l),A(e,s),A(s,f),h=!0,p||(g=[ye(r,"drop",Zn),ye(r,"dragover",Kn),ye(s,"drop",Zn),ye(s,"dragover",Kn)],p=!0)},p(v,[E]){var b,N,T,k;if(E&3){y=v[1];let I;for(I=0;I<y.length;I+=1){const w=da(v,y,I);d[I]?(d[I].p(w,E),oe(d[I],1)):(d[I]=ma(w),d[I].c(),oe(d[I],1),d[I].m(i,t))}for(st(),I=y.length;I<d.length;I+=1)_(I);lt()}(!h||E&1&&o!==(o=[v[0],"tundra"].join("_")))&&P(r,"id",o),(!h||E&2&&a!==(a=v[1].length))&&P(r,"data-drag-rowidx",a),(!h||E&4&&u!==(u=(N=(b=v[2])==null?void 0:b[0])==null?void 0:N[0]))&&P(s,"data-drag-rowidx",u),(!h||E&4&&c!==(c=(k=(T=v[2])==null?void 0:T[0])==null?void 0:k[1]))&&P(s,"data-drag-colidx",c)},i(v){if(!h){for(let E=0;E<y.length;E+=1)oe(d[E]);h=!0}},o(v){d=d.filter(Boolean);for(let E=0;E<d.length;E+=1)ue(d[E]);h=!1},d(v){v&&R(e),Ye(d,v),p=!1,Et(g)}}}function Cc(n,e,i){let t,r;ge(n,Tt,a=>i(1,t=a)),ge(n,Kt,a=>i(3,a)),ge(n,ce,a=>i(4,a)),ge(n,at,a=>i(2,r=a));let{id:o="editor"}=e;return n.$$set=a=>{"id"in a&&i(0,o=a.id)},n.$$.update=()=>{n.$$.dirty&2&&qa()},[o,t,r]}class Lc extends Ce{constructor(e){super(),Le(this,e,Cc,Dc,Fe,{id:0})}}const{window:Fc}=Ir;function ga(n,e,i){const t=n.slice();return t[15]=e[i][0],t[16]=e[i][1],t}function va(n,e,i){const t=n.slice();return t[19]=e[i],t}function ya(n){let e,i,t=n[19]+"",r,o,a,l;function s(...u){return n[8](n[19],...u)}function f(...u){return n[9](n[19],...u)}return{c(){e=V("div"),i=V("span"),r=he(t),o=te(),this.h()},l(u){e=G(u,"DIV",{id:!0,"data-drag-type":!0,"data-drag-unit":!0,draggable:!0,class:!0});var c=q(e);i=G(c,"SPAN",{class:!0});var h=q(i);r=pe(h,t),h.forEach(R),o=ne(c),c.forEach(R),this.h()},h(){P(i,"class","f1"),P(e,"id","menu_"+n[19].toLowerCase()),P(e,"data-drag-type",dt.MOVE),P(e,"data-drag-unit",n[19]),P(e,"draggable",!0),P(e,"class","plr0-5 grabbable br bt f3 flex row-center-center pop ptb0-5 grow")},m(u,c){ae(u,e,c),A(e,i),A(i,r),A(e,o),a||(l=[ye(e,"mousedown",s),ye(e,"mouseup",f)],a=!0)},p(u,c){n=u},d(u){u&&R(e),a=!1,Et(l)}}}function _a(n){let e,i=Object.keys(n[16]),t=[];for(let r=0;r<i.length;r+=1)t[r]=ya(va(n,i,r));return{c(){for(let r=0;r<t.length;r+=1)t[r].c();e=He()},l(r){for(let o=0;o<t.length;o+=1)t[o].l(r);e=He()},m(r,o){for(let a=0;a<t.length;a+=1)t[a].m(r,o);ae(r,e,o)},p(r,o){if(o&14){i=Object.keys(r[16]);let a;for(a=0;a<i.length;a+=1){const l=va(r,i,a);t[a]?t[a].p(l,o):(t[a]=ya(l),t[a].c(),t[a].m(e.parentNode,e))}for(;a<t.length;a+=1)t[a].d(1);t.length=i.length}},d(r){Ye(t,r),r&&R(e)}}}function Uc(n){let e,i,t,r,o,a,l,s,f,u,c,h,p,g,y,d,_,v,E,b,N,T,k,I,w,x,B,F,j;e=new xa({props:{shortcuts:n[5]}}),o=new _f({}),E=new Oc({props:{width:n[4],id:"main",key:"main",style:"background: var(--blue5-0)",class:"abs t100pc r0 z-index88",capture:!0}}),T=new Lc({props:{id:"editor"}});let H=Object.entries(n[3]),K=[];for(let U=0;U<H.length;U+=1)K[U]=_a(ga(n,H,U));return{c(){Ne(e.$$.fragment),i=te(),t=V("div"),r=V("div"),Ne(o.$$.fragment),a=te(),l=V("div"),s=V("span"),f=he("Width:"),u=te(),c=V("input"),h=te(),p=V("div"),g=V("span"),y=he("Height:"),d=te(),_=V("input"),v=te(),Ne(E.$$.fragment),b=te(),N=V("div"),Ne(T.$$.fragment),k=te(),I=V("div"),w=te(),x=V("div");for(let U=0;U<K.length;U+=1)K[U].c();this.h()},l(U){Re(e.$$.fragment,U),i=ne(U),t=G(U,"DIV",{class:!0});var ee=q(t);r=G(ee,"DIV",{style:!0,class:!0});var fe=q(r);Re(o.$$.fragment,fe),a=ne(fe),l=G(fe,"DIV",{class:!0});var ve=q(l);s=G(ve,"SPAN",{class:!0,style:!0});var Q=q(s);f=pe(Q,"Width:"),Q.forEach(R),u=ne(ve),c=G(ve,"INPUT",{type:!0,class:!0}),ve.forEach(R),h=ne(fe),p=G(fe,"DIV",{class:!0});var se=q(p);g=G(se,"SPAN",{class:!0});var be=q(g);y=pe(be,"Height:"),be.forEach(R),d=ne(se),_=G(se,"INPUT",{type:!0,class:!0}),se.forEach(R),v=ne(fe),Re(E.$$.fragment,fe),fe.forEach(R),b=ne(ee),N=G(ee,"DIV",{class:!0});var de=q(N);Re(T.$$.fragment,de),k=ne(de),I=G(de,"DIV",{class:!0}),q(I).forEach(R),de.forEach(R),w=ne(ee),x=G(ee,"DIV",{style:!0,class:!0});var Y=q(x);for(let Ue=0;Ue<K.length;Ue+=1)K[Ue].l(Y);Y.forEach(R),ee.forEach(R),this.h()},h(){P(s,"class","ml1 pt0-1"),je(s,"padding-left","1px"),P(c,"type","number"),P(c,"class","br ptb0-5 plr1 minw0px pop italic maxw100px"),P(l,"class","flex row-stretch-center pop"),P(g,"class","ml1 pt0-1"),P(_,"type","number"),P(_,"class","br ptb0-5 plr1 minw0px pop italic maxw100px"),P(p,"class","flex row-stretch-center pop"),je(r,"background","var(--blue5-0)"),P(r,"class","flex row-center-stretch rel t0 l0 w100pc bb z-index99"),P(I,"class","w100pc minh4em"),P(N,"class","grow flex column-stretch-stretch overflow-auto"),je(x,"background","var(--blue5-0)"),P(x,"class","flex row w100pc z-index98"),P(t,"class","flex column-stretch-stretch grow h100vh")},m(U,ee){Se(e,U,ee),ae(U,i,ee),ae(U,t,ee),A(t,r),Se(o,r,null),A(r,a),A(r,l),A(l,s),A(s,f),A(l,u),A(l,c),zt(c,n[0].width),A(r,h),A(r,p),A(p,g),A(g,y),A(p,d),A(p,_),zt(_,n[0].height),A(r,v),Se(E,r,null),A(t,b),A(t,N),Se(T,N,null),A(N,k),A(N,I),A(t,w),A(t,x);for(let fe=0;fe<K.length;fe+=1)K[fe].m(x,null);B=!0,F||(j=[ye(Fc,"resize",Bc),ye(c,"input",n[6]),ye(_,"input",n[7])],F=!0)},p(U,[ee]){if(ee&1&&_n(c.value)!==U[0].width&&zt(c,U[0].width),ee&1&&_n(_.value)!==U[0].height&&zt(_,U[0].height),ee&14){H=Object.entries(U[3]);let fe;for(fe=0;fe<H.length;fe+=1){const ve=ga(U,H,fe);K[fe]?K[fe].p(ve,ee):(K[fe]=_a(ve),K[fe].c(),K[fe].m(x,null))}for(;fe<K.length;fe+=1)K[fe].d(1);K.length=H.length}},i(U){B||(oe(e.$$.fragment,U),oe(o.$$.fragment,U),oe(E.$$.fragment,U),oe(T.$$.fragment,U),B=!0)},o(U){ue(e.$$.fragment,U),ue(o.$$.fragment,U),ue(E.$$.fragment,U),ue(T.$$.fragment,U),B=!1},d(U){xe(e,U),U&&R(i),U&&R(t),xe(o),xe(E),xe(T),Ye(K,U),F=!1,Et(j)}}}function Bc(){}function jc(n,e,i){let t,r,o;ge(n,Lt,_=>i(10,t=_)),ge(n,at,_=>i(11,r=_)),ge(n,Zt,_=>i(0,o=_));function a(_){_e(at,r=[Ya(_)],r),_e(Lt,t=!0,t)}function l(_){_e(at,r=[-1,-1,-1,-1],r),_e(Lt,t=!1,t)}const s={ops:bn},f=(_,v)=>console.log(`[MXF] ${_}`,v||"");let u=720/2;En(c);async function c(){f("\u{1F44D} inited")}let h=[];function p(){o.width=_n(this.value),Zt.set(o)}function g(){o.height=_n(this.value),Zt.set(o)}return[o,a,l,s,u,h,p,g,(_,v)=>a(_),(_,v)=>l()]}class Vc extends Ce{constructor(e){super(),Le(this,e,jc,Uc,Fe,{})}}function Gc(n){let e,i;return e=new gf({props:{application:Vc}}),{c(){Ne(e.$$.fragment)},l(t){Re(e.$$.fragment,t)},m(t,r){Se(e,t,r),i=!0},p:Pe,i(t){i||(oe(e.$$.fragment,t),i=!0)},o(t){ue(e.$$.fragment,t),i=!1},d(t){xe(e,t)}}}let Yc=!0;function Hc(n,e,i){return[!1]}class Jc extends Ce{constructor(e){super(),Le(this,e,Hc,Gc,Fe,{prerender:0})}get prerender(){return this.$$.ctx[0]}}export{Jc as default,Yc as prerender};
